
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>upnp.helpers.emailer &#8212; TestCase Documentation  documentation</title>
    <link rel="stylesheet" href="../../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for upnp.helpers.emailer</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">smtplib</span>
<span class="kn">from</span> <span class="nn">sonos.workflow.result</span> <span class="k">import</span> <span class="n">PASS</span><span class="p">,</span> <span class="n">FAIL</span><span class="p">,</span> <span class="n">STOP</span><span class="p">,</span> <span class="n">SKIP</span><span class="p">,</span> <span class="n">WARNING</span><span class="p">,</span> <span class="n">BUG</span>


<div class="viewcode-block" id="SMTPEmailer"><a class="viewcode-back" href="../../../upnp.helpers.html#upnp.helpers.emailer.SMTPEmailer">[docs]</a><span class="k">class</span> <span class="nc">SMTPEmailer</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">EMAIL_MIME_HEADER</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">MIME-Version: 1.0</span><span class="se">\r\n</span><span class="s2">Content-type: text/html</span><span class="se">\r\n</span><span class="s2">&quot;</span>
    <span class="n">EMAIL_FROM_FIELD</span> <span class="o">=</span> <span class="s2">&quot;From: </span><span class="si">%s</span><span class="se">\r\n</span><span class="s2">&quot;</span>
    <span class="n">EMAIL_TO_FIELD</span> <span class="o">=</span> <span class="s2">&quot;To: &quot;</span>
    <span class="n">EMAIL_SUBJECT_FIELD</span> <span class="o">=</span> <span class="s2">&quot;Subject:&quot;</span>

    <span class="n">DEFAULT_SMTP_SERVER</span> <span class="o">=</span> <span class="s2">&quot;mail-relay.rinconnetworks.com&quot;</span>
    <span class="n">DEFAULT_SENDER_ADDRESS</span> <span class="o">=</span> <span class="s2">&quot;automation@sonos.com&quot;</span>

<div class="viewcode-block" id="SMTPEmailer.set_smtp_server"><a class="viewcode-back" href="../../../upnp.helpers.html#upnp.helpers.emailer.SMTPEmailer.set_smtp_server">[docs]</a>    <span class="k">def</span> <span class="nf">set_smtp_server</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">smtp_server_address</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Use this smtp server instead of the default </span>

<span class="sd">        Arguments:</span>
<span class="sd">        smtp_server_address -- string, address of SMTP server</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">smtp_server</span> <span class="o">=</span> <span class="n">smtp_server_address</span></div>

    <span class="k">def</span> <span class="nf">_create_email_header</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subject</span><span class="p">,</span> <span class="n">sender_address</span><span class="p">,</span> <span class="n">recipients</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Arguments:</span>
<span class="sd">        subject -- string, subject of e-mail</span>
<span class="sd">        sender_address -- string, address of e-mail sender</span>
<span class="sd">        recipients -- list of strings, recipient addresses</span>

<span class="sd">        Returns:</span>
<span class="sd">        string -- e-mail header</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">header</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">EMAIL_FROM_FIELD</span> <span class="o">%</span> <span class="n">sender_address</span>
        <span class="n">header</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">EMAIL_TO_FIELD</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">recipients</span><span class="p">)</span>
        <span class="n">header</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">EMAIL_MIME_HEADER</span> 
        <span class="n">header</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">EMAIL_SUBJECT_FIELD</span> <span class="o">+</span> <span class="n">subject</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\r\n\r\n</span><span class="s1">&#39;</span>
        <span class="k">return</span> <span class="n">header</span>

    <span class="k">def</span> <span class="nf">_transmit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">sender_address</span><span class="p">,</span> <span class="n">recipients</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Transmit e-mail to SMTP server</span>

<span class="sd">        Arguments:</span>
<span class="sd">        email -- string, email to send</span>
<span class="sd">        sender_address -- string, address of e-mail sender</span>
<span class="sd">        recipients -- list of strings, recipient addresses</span>
<span class="sd">    </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">smtp_server</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;smtp_server&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_SMTP_SERVER</span><span class="p">)</span>
        <span class="n">smtp_handle</span> <span class="o">=</span> <span class="n">smtplib</span><span class="o">.</span><span class="n">SMTP</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="n">smtp_server</span><span class="p">)</span>
        <span class="n">smtp_handle</span><span class="o">.</span><span class="n">sendmail</span><span class="p">(</span><span class="n">sender_address</span><span class="p">,</span> <span class="n">recipients</span><span class="p">,</span> <span class="n">email</span><span class="p">)</span>

<div class="viewcode-block" id="SMTPEmailer.send"><a class="viewcode-back" href="../../../upnp.helpers.html#upnp.helpers.emailer.SMTPEmailer.send">[docs]</a>    <span class="k">def</span> <span class="nf">send</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">subject</span><span class="p">,</span> <span class="n">sender_address</span><span class="p">,</span> <span class="n">recipients</span><span class="p">):</span>
        <span class="n">header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_email_header</span><span class="p">(</span><span class="n">subject</span><span class="p">,</span> <span class="n">sender_address</span><span class="p">,</span> <span class="n">recipients</span><span class="p">)</span>
        <span class="n">email</span> <span class="o">=</span> <span class="n">header</span> <span class="o">+</span> <span class="n">content</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_transmit</span><span class="p">(</span><span class="n">email</span><span class="p">,</span> <span class="n">sender_address</span><span class="p">,</span> <span class="n">recipients</span><span class="p">)</span></div>

<div class="viewcode-block" id="SMTPEmailer.write"><a class="viewcode-back" href="../../../upnp.helpers.html#upnp.helpers.emailer.SMTPEmailer.write">[docs]</a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">output_filename</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_filename</span><span class="p">,</span> <span class="s1">&#39;w+&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">out_fh</span><span class="p">:</span>
            <span class="n">out_fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">email</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="WorkflowEmailer"><a class="viewcode-back" href="../../../upnp.helpers.html#upnp.helpers.emailer.WorkflowEmailer">[docs]</a><span class="k">class</span> <span class="nc">WorkflowEmailer</span><span class="p">(</span><span class="n">SMTPEmailer</span><span class="p">):</span>

    <span class="n">TEMPLATE_FIXTURE_HEADER</span>     <span class="o">=</span> <span class="s2">&quot;&lt;table border=1&gt;&lt;tr&gt;&lt;td bgcolor=</span><span class="si">%s</span><span class="s2">&gt;&lt;b&gt;</span><span class="si">%s</span><span class="s2">&lt;/b&gt;&lt;/td&gt;&lt;td&gt;&lt;big&gt;&lt;a href=</span><span class="si">%s</span><span class="s2">&gt;</span><span class="si">%s</span><span class="s2">&lt;/a&gt;&lt;/big&gt;&lt;br&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;</span><span class="si">%s</span><span class="s2">&lt;br&gt;&quot;</span>
    <span class="n">TEMPLATE_TESTCASE_HEADER</span>    <span class="o">=</span> <span class="s2">&quot;&lt;table border=0 style=margin-left:20px&gt;&lt;tr&gt;&lt;td&gt;</span><span class="si">%s</span><span class="s2">:&lt;/td&gt;&lt;td&gt;</span><span class="si">%s</span><span class="s2">&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&quot;</span>
    <span class="n">TEMPLATE_TESTCASE_CONTENT</span>   <span class="o">=</span> <span class="s2">&quot;&lt;table border=0 style=margin-left:40px&gt;&lt;tr&gt;&lt;td&gt;&lt;font size=2&gt;</span><span class="si">%s</span><span class="s2">&lt;/font&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&quot;</span>
    <span class="n">TEMPLATE_METRICS</span>            <span class="o">=</span> <span class="s2">&quot;&lt;table&gt;&lt;tr&gt;&lt;td&gt;Metrics:&lt;/td&gt;&lt;td&gt; Passed: </span><span class="si">%s</span><span class="s2"> /&lt;/td&gt;&lt;td&gt; Errors: </span><span class="si">%s</span><span class="s2"> /&lt;/td&gt;&lt;td&gt; Failed: </span><span class="si">%s</span><span class="s2"> /&lt;/td&gt;&lt;td&gt; Time Taken: </span><span class="si">%s</span><span class="s2"> &lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">email_config</span><span class="p">,</span> <span class="o">*</span><span class="n">workflow_suites</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">suites</span> <span class="o">=</span> <span class="n">workflow_suites</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;version&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">branch</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;branch&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_load_config</span><span class="p">(</span><span class="n">email_config</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">queue_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">_get_automation_server_queue_id</span><span class="p">(</span><span class="n">email_config</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">overall_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_overall_status_for_suites</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_testcase_statistics</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fixture_to_status_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_fixture_to_status_dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_duration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_test_duration</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fixtures_added</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_email_subject</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subject</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">email</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_email</span><span class="p">()</span>

<div class="viewcode-block" id="WorkflowEmailer.set_show_passing_tests"><a class="viewcode-back" href="../../../upnp.helpers.html#upnp.helpers.emailer.WorkflowEmailer.set_show_passing_tests">[docs]</a>    <span class="k">def</span> <span class="nf">set_show_passing_tests</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">should_show_passing_tests</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show_passing_tests</span> <span class="o">=</span> <span class="n">should_show_passing_tests</span></div>

<div class="viewcode-block" id="WorkflowEmailer.set_test_number"><a class="viewcode-back" href="../../../upnp.helpers.html#upnp.helpers.emailer.WorkflowEmailer.set_test_number">[docs]</a>    <span class="k">def</span> <span class="nf">set_test_number</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num</span><span class="p">,</span> <span class="n">total</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subject</span> <span class="o">+=</span> <span class="s2">&quot;(</span><span class="si">%d</span><span class="s2">/</span><span class="si">%d</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">total</span><span class="p">)</span></div>

<div class="viewcode-block" id="WorkflowEmailer.send_live_email"><a class="viewcode-back" href="../../../upnp.helpers.html#upnp.helpers.emailer.WorkflowEmailer.send_live_email">[docs]</a>    <span class="k">def</span> <span class="nf">send_live_email</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">email</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">subject</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sender_address</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">recipients</span><span class="p">)</span></div>

<div class="viewcode-block" id="WorkflowEmailer.send_dev_email"><a class="viewcode-back" href="../../../upnp.helpers.html#upnp.helpers.emailer.WorkflowEmailer.send_dev_email">[docs]</a>    <span class="k">def</span> <span class="nf">send_dev_email</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">email</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">subject</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sender_address</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_recipients</span><span class="p">)</span></div>

<div class="viewcode-block" id="WorkflowEmailer.set_email_subject"><a class="viewcode-back" href="../../../upnp.helpers.html#upnp.helpers.emailer.WorkflowEmailer.set_email_subject">[docs]</a>    <span class="k">def</span> <span class="nf">set_email_subject</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subject_str</span><span class="p">):</span>
        <span class="n">subject_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_subject_string</span><span class="p">(</span><span class="n">subject_str</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subject</span> <span class="o">=</span> <span class="n">subject_str</span></div>

    <span class="k">def</span> <span class="nf">_format_subject_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subject</span><span class="p">):</span>
        <span class="n">subject</span> <span class="o">=</span> <span class="n">subject</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&lt;VERSION&gt;&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="p">)</span>
        <span class="n">subject</span> <span class="o">=</span> <span class="n">subject</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&lt;TEST_STATUS&gt;&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">overall_status</span><span class="p">)</span>
        <span class="n">subject</span> <span class="o">=</span> <span class="n">subject</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&lt;BRANCH&gt;&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">branch</span><span class="p">)</span>
        <span class="n">subject</span> <span class="o">=</span> <span class="n">subject</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&lt;AUTOMATION_SERVER_QUEUE_ID&gt;&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">queue_id</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">subject</span>

    <span class="k">def</span> <span class="nf">_load_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config_file</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">smtp_server</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">config_file</span><span class="o">.</span><span class="n">email</span><span class="p">,</span> <span class="s1">&#39;server&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_SMTP_SERVER</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recipients</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">config_file</span><span class="o">.</span><span class="n">email</span><span class="p">,</span> <span class="s1">&#39;recipients&#39;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_recipients</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">config_file</span><span class="o">.</span><span class="n">email</span><span class="p">,</span> <span class="s2">&quot;test_recipients&quot;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sender_address</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">config_file</span><span class="o">.</span><span class="n">email</span><span class="p">,</span> <span class="s2">&quot;sender_address&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_SENDER_ADDRESS</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">email_result_url</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">config_file</span><span class="o">.</span><span class="n">email</span><span class="p">,</span> <span class="s2">&quot;email_result_url&quot;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subject</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">config_file</span><span class="o">.</span><span class="n">email</span><span class="p">,</span> <span class="s2">&quot;subject&quot;</span><span class="p">,</span> <span class="s1">&#39;automation email&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show_passing_tests</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">config_file</span><span class="o">.</span><span class="n">email</span><span class="p">,</span> <span class="s2">&quot;show_passing_tests&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_color_from_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="n">PASS</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;green&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span>
        <span class="k">return</span> <span class="n">color</span>

    <span class="k">def</span> <span class="nf">_workflow_test_status_to_email_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">workflow_status</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">workflow_status</span> <span class="o">==</span> <span class="n">PASS</span><span class="p">:</span>
            <span class="n">email_status</span> <span class="o">=</span> <span class="s2">&quot;PASS&quot;</span>
        <span class="k">elif</span> <span class="n">workflow_status</span> <span class="o">==</span> <span class="n">FAIL</span><span class="p">:</span>
            <span class="n">email_status</span> <span class="o">=</span> <span class="s2">&quot;FAIL&quot;</span>
        <span class="k">elif</span> <span class="n">workflow_status</span> <span class="o">==</span> <span class="n">STOP</span><span class="p">:</span>
            <span class="n">email_status</span> <span class="o">=</span> <span class="s2">&quot;ERROR&quot;</span>
        <span class="k">elif</span> <span class="n">workflow_status</span> <span class="o">==</span> <span class="n">SKIP</span><span class="p">:</span>
            <span class="n">email_status</span> <span class="o">=</span> <span class="s2">&quot;SKIP&quot;</span>
        <span class="k">elif</span> <span class="n">workflow_status</span> <span class="o">==</span> <span class="n">WARNING</span><span class="p">:</span>
            <span class="n">email_status</span> <span class="o">=</span> <span class="s2">&quot;WARN&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">email_status</span> <span class="o">=</span> <span class="s2">&quot;UNKNOWN&quot;</span>
        <span class="k">return</span> <span class="n">email_status</span>

    <span class="k">def</span> <span class="nf">_format_testbed_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">testbed</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">testbed</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">testbed</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">testbed: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">testbed</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">testbed</span>

    <span class="k">def</span> <span class="nf">_add_fixture</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fixture_data</span><span class="p">):</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">fixture</span><span class="p">,</span> <span class="n">detail</span> <span class="o">=</span> <span class="n">fixture_data</span>
        <span class="n">fixture_name</span> <span class="o">=</span> <span class="n">fixture</span><span class="o">.</span><span class="n">_testFixtureName</span>
        <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fixture_to_status_dict</span><span class="p">[</span><span class="n">fixture_name</span><span class="p">]</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">fixtures_added</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fixture_name</span><span class="p">)</span>
        <span class="n">testbed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_testbed_string</span><span class="p">(</span><span class="n">_get_suite_testbed</span><span class="p">(</span><span class="n">fixture</span><span class="p">))</span>
        <span class="n">time_taken_message</span> <span class="o">=</span> <span class="n">_get_fixture_time_taken</span><span class="p">(</span><span class="n">fixture</span><span class="p">)</span>
        <span class="n">additional_messages</span> <span class="o">=</span> <span class="n">_get_fixture_messages</span><span class="p">(</span><span class="n">fixture</span><span class="p">)</span> <span class="ow">or</span> <span class="p">[]</span>
        <span class="n">fixture_messages</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;&lt;br&gt;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">testbed</span><span class="p">]</span><span class="o">+</span><span class="p">[</span><span class="n">time_taken_message</span><span class="p">]</span><span class="o">+</span><span class="n">additional_messages</span><span class="p">)</span>
        <span class="n">result_color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_color_from_status</span><span class="p">(</span><span class="n">status</span><span class="p">)</span>
        <span class="n">suite_email_content</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">TEMPLATE_FIXTURE_HEADER</span> <span class="o">%</span> <span class="p">(</span><span class="n">result_color</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">email_result_url</span><span class="p">,</span> <span class="n">fixture_name</span><span class="p">,</span> <span class="n">fixture_messages</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">suite_email_content</span>

    <span class="k">def</span> <span class="nf">_add_testcase</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">testcase</span><span class="p">):</span>
        <span class="n">testcase_email_content</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">test_status</span><span class="p">,</span> <span class="n">testcase</span><span class="p">,</span> <span class="n">testcase_error_detail</span> <span class="o">=</span> <span class="n">testcase</span>
        <span class="n">test_description</span> <span class="o">=</span> <span class="n">_get_testcase_description</span><span class="p">(</span><span class="n">testcase</span><span class="p">)</span>
        <span class="n">testcase_name</span> <span class="o">=</span> <span class="n">_get_testcase_name</span><span class="p">(</span><span class="n">testcase</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_passing_tests</span> <span class="ow">and</span> <span class="p">(</span><span class="n">test_status</span> <span class="o">==</span> <span class="n">PASS</span> <span class="ow">or</span> <span class="n">test_status</span> <span class="o">==</span> <span class="n">SKIP</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">testcase_email_content</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">test_description</span><span class="p">:</span>
            <span class="n">test_description</span> <span class="o">=</span> <span class="n">testcase_name</span>
        <span class="k">if</span> <span class="n">testcase</span><span class="o">.</span><span class="n">_is_combinatorial</span><span class="p">():</span>
            <span class="n">test_description</span> <span class="o">+=</span> <span class="s2">&quot; (</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span>
                <span class="n">_get_testcase_combinatorial_values</span><span class="p">(</span><span class="n">testcase</span><span class="p">))</span>
        <span class="n">testcase_email_content</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">TEMPLATE_TESTCASE_HEADER</span> <span class="o">%</span> <span class="p">(</span><span class="n">test_description</span><span class="p">,</span> <span class="n">test_status</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">test_status</span> <span class="o">==</span> <span class="n">PASS</span> <span class="ow">or</span> <span class="n">test_status</span> <span class="o">==</span> <span class="n">FAIL</span><span class="p">:</span>
            <span class="n">test_msg</span> <span class="o">=</span> <span class="n">_get_testcase_messages</span><span class="p">(</span><span class="n">testcase</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">test_msg</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">test_msg</span> <span class="o">=</span> <span class="s1">&#39;&lt;pre&gt;&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">test_msg</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;&lt;/pre&gt;&#39;</span>
        <span class="k">elif</span> <span class="n">test_status</span> <span class="o">==</span> <span class="n">STOP</span><span class="p">:</span>
            <span class="n">test_msg</span> <span class="o">=</span> <span class="s1">&#39;&lt;pre&gt;&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">testcase_error_detail</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;&lt;/pre&gt;&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">test_msg</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">test_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_workflow_test_status_to_email_status</span><span class="p">(</span><span class="n">test_status</span><span class="p">)</span>
        <span class="n">testcase_email_content</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">TEMPLATE_TESTCASE_CONTENT</span> <span class="o">%</span> <span class="n">test_msg</span>
        <span class="k">return</span> <span class="n">testcase_email_content</span>

    <span class="k">def</span> <span class="nf">_is_fixture_added</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fixture_data</span><span class="p">):</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">fixture</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">fixture_data</span>
        <span class="n">fixture_name</span> <span class="o">=</span> <span class="n">fixture</span><span class="o">.</span><span class="n">_testFixtureName</span>
        <span class="k">return</span> <span class="n">fixture_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fixtures_added</span>

    <span class="k">def</span> <span class="nf">_add_metrics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stats</span><span class="p">,</span> <span class="n">duration</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">TEMPLATE_METRICS</span> <span class="o">%</span> <span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="n">PASS</span><span class="p">],</span> <span class="n">stats</span><span class="p">[</span><span class="n">STOP</span><span class="p">],</span> <span class="n">stats</span><span class="p">[</span><span class="n">FAIL</span><span class="p">],</span> <span class="n">duration</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_generate_email</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">email</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">for</span> <span class="n">suite</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">suites</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">fixture</span> <span class="ow">in</span> <span class="n">suite</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">tests</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_fixture_added</span><span class="p">(</span><span class="n">fixture</span><span class="p">):</span>
                    <span class="n">email</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_fixture</span><span class="p">(</span><span class="n">fixture</span><span class="p">)</span>
                <span class="n">email</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_testcase</span><span class="p">(</span><span class="n">fixture</span><span class="p">)</span>
        <span class="n">email</span> <span class="o">+=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">_add_metrics</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_duration</span><span class="p">)</span>
        <span class="n">email</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&lt;URL&gt;&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">email_result_url</span><span class="p">)</span>
        <span class="n">email</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&lt;VERSION&gt;&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="p">)</span>
        <span class="n">email</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&lt;BRANCH&gt;&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">branch</span><span class="p">)</span>
        <span class="n">email</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&lt;AUTOMATION_SERVER_QUEUE_ID&gt;&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">queue_id</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">email</span>


    <span class="k">def</span> <span class="nf">_get_overall_status_for_suites</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the overall status for a series of WorkflowTestSuites</span>

<span class="sd">        Arguments:</span>
<span class="sd">        suites -- list of WorkflowTestSuites</span>

<span class="sd">        Returns:</span>
<span class="sd">        string -- overall status of specified WorkflowTestSuites</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">overall_status</span> <span class="o">=</span> <span class="s1">&#39;PASS&#39;</span>
        <span class="k">for</span> <span class="n">suite</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">suites</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">suite</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">is_pass</span><span class="p">():</span>
                <span class="n">overall_status</span> <span class="o">=</span> <span class="s1">&#39;FAIL&#39;</span>
            <span class="k">elif</span> <span class="n">suite</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">is_stop</span><span class="p">():</span>
                <span class="n">overall_status</span> <span class="o">=</span> <span class="s1">&#39;ERROR&#39;</span>
            <span class="k">elif</span> <span class="n">suite</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">is_warning</span><span class="p">():</span>
                <span class="n">overall_status</span> <span class="o">=</span> <span class="s1">&#39;WARNING&#39;</span>
            <span class="k">elif</span> <span class="n">suite</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">is_skip</span><span class="p">():</span>
                <span class="n">overall_status</span> <span class="o">=</span> <span class="s1">&#39;SKIP&#39;</span>
        <span class="k">return</span> <span class="n">overall_status</span>


    <span class="k">def</span> <span class="nf">_get_testcase_statistics</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate statistics for a series of WorkflowTestSuites</span>

<span class="sd">        Arguments:</span>
<span class="sd">        suites -- list of WorkflowTestSuites</span>

<span class="sd">        Returns:</span>
<span class="sd">        map of workflow statuses to number of occurrences</span>
<span class="sd">        ex:</span>
<span class="sd">            {</span>
<span class="sd">                &#39;PASS&#39;: 4,</span>
<span class="sd">                &#39;FAIL&#39;: 0,</span>
<span class="sd">                &#39;ERROR&#39;: 1,</span>
<span class="sd">                &#39;WARNING&#39;: 0,</span>
<span class="sd">                &#39;SKIP&#39;: 2</span>
<span class="sd">            }</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">statistics</span> <span class="o">=</span> <span class="p">{</span><span class="n">PASS</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="n">FAIL</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="n">BUG</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="n">WARNING</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="n">STOP</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="n">SKIP</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">suite</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">suites</span><span class="p">:</span>
            <span class="n">suite_stats</span> <span class="o">=</span> <span class="n">suite</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">counts</span>
            <span class="k">for</span> <span class="n">level</span> <span class="ow">in</span> <span class="n">suite_stats</span><span class="p">:</span>
                <span class="n">statistics</span><span class="p">[</span><span class="n">level</span><span class="p">]</span> <span class="o">+=</span> <span class="n">suite_stats</span><span class="p">[</span><span class="n">level</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">statistics</span>


    <span class="k">def</span> <span class="nf">_generate_fixture_to_statistics_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate a dictionary of fixtures to result statistics</span>

<span class="sd">        Arguments:</span>
<span class="sd">        suite -- WorkflowTestSuite which has completed</span>

<span class="sd">        Returns:</span>
<span class="sd">        dictionary -- WorkflowTestFixture names (keys) to dictionary of result statistics:</span>

<span class="sd">            ex:</span>
<span class="sd">                {</span>
<span class="sd">                    &quot;TestFixtureName1&quot;: { &#39;PASS&#39;: 4, &#39;FAIL&#39;: 0, &#39;ERROR&#39;: 1, &#39;WARNING&#39;: 0, &#39;SKIP&#39;: 2 },</span>
<span class="sd">                    &quot;TestFixtureName2&quot;: { &#39;PASS&#39;: 9, &#39;FAIL&#39;: 2, &#39;ERROR&#39;: 0, &#39;WARNING&#39;: 0, &#39;SKIP&#39;: 0 }</span>
<span class="sd">                }</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fixture_name_to_statistics</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">suite</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">suites</span><span class="p">:</span>
            <span class="n">testcases</span> <span class="o">=</span> <span class="n">suite</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">tests</span>
            <span class="k">for</span> <span class="n">testcase</span> <span class="ow">in</span> <span class="n">testcases</span><span class="p">:</span>
                <span class="n">status</span><span class="p">,</span> <span class="n">fixture</span><span class="p">,</span> <span class="n">reason</span> <span class="o">=</span> <span class="n">testcase</span>
                <span class="n">fixture_name</span> <span class="o">=</span> <span class="n">fixture</span><span class="o">.</span><span class="n">_testFixtureName</span>
                <span class="k">if</span> <span class="n">fixture_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">fixture_name_to_statistics</span><span class="p">:</span>
                    <span class="n">fixture_name_to_statistics</span><span class="p">[</span><span class="n">fixture_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">PASS</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="n">FAIL</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="n">BUG</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="n">WARNING</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="n">STOP</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="n">SKIP</span><span class="p">:</span><span class="mi">0</span><span class="p">}</span>
                <span class="n">fixture_name_to_statistics</span><span class="p">[</span><span class="n">fixture_name</span><span class="p">][</span><span class="n">status</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">fixture_name_to_statistics</span>


    <span class="k">def</span> <span class="nf">_generate_fixture_to_status_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate a dictionary of fixtures to workflow results</span>

<span class="sd">        Arguments:</span>
<span class="sd">        suite -- WorkflowTestSuite which has completed all tests</span>

<span class="sd">        Returns:</span>
<span class="sd">        dictionary -- WorkflowTestFixture names (keys) to overall fixture workflow status (value)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fixture_to_statistics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_fixture_to_statistics_dict</span><span class="p">()</span>
        <span class="n">fixture_to_status_map</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">fixture</span> <span class="ow">in</span> <span class="n">fixture_to_statistics</span><span class="p">:</span>
            <span class="n">fixture_statistics</span> <span class="o">=</span> <span class="n">fixture_to_statistics</span><span class="p">[</span><span class="n">fixture</span><span class="p">]</span>
            <span class="n">num_cases</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">fixture_statistics</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">fixture_statistics</span><span class="p">[</span><span class="n">STOP</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">fixture_to_status_map</span><span class="p">[</span><span class="n">fixture</span><span class="p">]</span> <span class="o">=</span> <span class="n">STOP</span>
            <span class="k">elif</span> <span class="n">fixture_statistics</span><span class="p">[</span><span class="n">FAIL</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">fixture_to_status_map</span><span class="p">[</span><span class="n">fixture</span><span class="p">]</span> <span class="o">=</span> <span class="n">FAIL</span>
            <span class="k">elif</span> <span class="n">fixture_statistics</span><span class="p">[</span><span class="n">SKIP</span><span class="p">]</span> <span class="o">==</span> <span class="n">num_cases</span><span class="p">:</span>
                <span class="n">fixture_to_status_map</span><span class="p">[</span><span class="n">fixture</span><span class="p">]</span> <span class="o">=</span> <span class="n">SKIP</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fixture_to_status_map</span><span class="p">[</span><span class="n">fixture</span><span class="p">]</span> <span class="o">=</span> <span class="n">PASS</span>
        <span class="k">return</span> <span class="n">fixture_to_status_map</span>


    <span class="k">def</span> <span class="nf">_get_test_duration</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the total duration for a series of WorkflowTestSuites</span>

<span class="sd">        Arguments:</span>
<span class="sd">        suites -- list of WorkflowTestSuites</span>

<span class="sd">        Returns:</span>
<span class="sd">        datetime.timedelta instance -- total duration of provided WorkflowTestSuites</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">duration</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">suite</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">suites</span><span class="p">:</span>
            <span class="n">duration</span> <span class="o">+=</span> <span class="n">suite</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">testDuration</span>
        <span class="k">return</span> <span class="n">duration</span></div>


<span class="k">def</span> <span class="nf">_get_automation_server_queue_id</span><span class="p">(</span><span class="n">config</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Determine the Automation Server Queue ID from the WorkflowExecutionConfiguration</span>

<span class="sd">    The Queue ID represents a running job from the Automation Server, and can be used</span>
<span class="sd">    to lookup results from a completed test.</span>

<span class="sd">    The Queue ID is extracted from the &#39;local_test_path&#39; in the &#39;script&#39; section.</span>

<span class="sd">    Ex:</span>
<span class="sd">        &quot;script&quot;: {</span>
<span class="sd">            &quot;local_test_path&quot;: &quot;/home/user/agent_tests/15027/trunk&quot;</span>
<span class="sd">        }</span>

<span class="sd">        Queue ID = 15027</span>

<span class="sd">    Arguments:</span>
<span class="sd">    config -- WorkflowExecutionConfiguration instance</span>

<span class="sd">    Returns:</span>
<span class="sd">    Integer -- Queue ID</span>
<span class="sd">    None -- No Queue ID was found</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">queue_id</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="s1">&#39;script&#39;</span><span class="p">):</span>
        <span class="n">local_test_path</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">script</span><span class="p">,</span> <span class="s1">&#39;local_test_path&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">local_test_path</span> <span class="ow">and</span> <span class="s2">&quot;branches&quot;</span> <span class="ow">in</span> <span class="n">local_test_path</span><span class="p">:</span>
            <span class="c1"># if testing on a branch, path will be formatted</span>
            <span class="c1"># like .../&lt;job ID&gt;/branches/&lt;branch&gt;</span>
            <span class="n">queue_id</span> <span class="o">=</span> <span class="n">local_test_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">queue_id</span> <span class="o">=</span> <span class="n">local_test_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">queue_id</span>


<span class="k">def</span> <span class="nf">_get_suite_testbed</span><span class="p">(</span><span class="n">suite</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get information about the testbed used in this WorkflowTestSuite</span>

<span class="sd">    Returns:</span>
<span class="sd">    string -- testbed models</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">suite</span><span class="p">,</span> <span class="s1">&#39;testbed&#39;</span><span class="p">,</span> <span class="s1">&#39;no testbed specified&#39;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_get_testcase_description</span><span class="p">(</span><span class="n">testcase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the description for this testcase</span>

<span class="sd">    Returns:</span>
<span class="sd">    string -- testcase description</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">testcase</span><span class="p">,</span> <span class="s1">&#39;short_description&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_get_testcase_name</span><span class="p">(</span><span class="n">testcase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the name for this testcase</span>

<span class="sd">    Returns:</span>
<span class="sd">    string -- name of this testcase</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">testcase</span><span class="p">,</span> <span class="s1">&#39;_testMethodName&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_get_testcase_messages</span><span class="p">(</span><span class="n">testcase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get runtime testcase messages</span>

<span class="sd">    Returns:</span>
<span class="sd">    string -- runtime message from this testcase</span>
<span class="sd">    list of strings -- multiple runtime messages from this testcase</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">testcase</span><span class="p">,</span> <span class="s1">&#39;success_msg&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_get_fixture_messages</span><span class="p">(</span><span class="n">fixture</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get runtime fixture messages</span>

<span class="sd">    Returns:</span>
<span class="sd">    list of strings -- multiple runtime messages from this WorkflowTestFixture</span>
<span class="sd">    None -- no fixture messages were specified in testcase</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">fixture</span><span class="p">,</span> <span class="s1">&#39;fixture_msg&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_get_fixture_time_taken</span><span class="p">(</span><span class="n">fixture</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the total number of seconds it took to run this fixture</span>

<span class="sd">    Returns:</span>
<span class="sd">    string -- message showing the time this fixture took</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">time_taken_seconds</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">start_time</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">fixture</span><span class="p">,</span> <span class="s2">&quot;start_time&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">start_time</span><span class="p">:</span>
        <span class="n">time_taken_seconds</span> <span class="o">=</span> <span class="s2">&quot;fixture start time: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">start_time</span>
    <span class="k">return</span> <span class="n">time_taken_seconds</span>


<span class="k">def</span> <span class="nf">_get_testcase_combinatorial_values</span><span class="p">(</span><span class="n">testcase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the combinatorial test values used by this testcase</span>

<span class="sd">    Returns:</span>
<span class="sd">    string -- values used by this combinatorial testcase</span>
<span class="sd">    None -- testcase has no combinatorial values</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">testcase</span><span class="p">,</span> <span class="s1">&#39;_combinatorial_values&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../index.html">TestCase Documentation</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../audio.html">audio package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../cloud.html">cloud package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../common.html">common package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../data_reporting.html">data_reporting package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dataio.html">dataio package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples.html">examples package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../hdmi.html">hdmi package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ixchariot.html">ixchariot package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../networking.html">networking package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../other.html">other package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../perf.html">perf package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../pytest_automation.html">pytest_automation package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../secure_registration.html">secure_registration package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../syssw.html">syssw package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../upnp.html">upnp package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../voice.html">voice package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../webserver.html">webserver package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../webserver_v0.html">webserver_v0 package</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../index.html">Module code</a><ul>
  <li><a href="../helpers.html">upnp.helpers</a><ul>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019, Author.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.8.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>