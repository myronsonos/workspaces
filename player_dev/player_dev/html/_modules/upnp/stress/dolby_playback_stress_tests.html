
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>upnp.stress.dolby_playback_stress_tests &#8212; TestCase Documentation  documentation</title>
    <link rel="stylesheet" href="../../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for upnp.stress.dolby_playback_stress_tests</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="k">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">commands</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">sonos.workflow.fixture</span> <span class="k">import</span> <span class="p">(</span><span class="n">combinatorial</span><span class="p">,</span> <span class="n">AssertionLevel</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">stress_tests_base</span> <span class="k">import</span> <span class="p">(</span><span class="n">StressTestsBaseNew</span><span class="p">,</span> <span class="n">TV</span><span class="p">,</span> <span class="n">DIAGCS</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">sonos.services.common</span> <span class="k">import</span> <span class="n">XMLAccessor</span>
<span class="kn">from</span> <span class="nn">sonos.client.zone_player</span> <span class="k">import</span> <span class="p">(</span><span class="n">HT_SATELLITE_DEVICES</span><span class="p">,</span>
                                      <span class="n">PAIRABLE_MODEL_COMPATIBILITY_MAP</span><span class="p">,</span>
                                      <span class="n">HT_MASTER_MODELS</span><span class="p">,</span>
                                      <span class="n">SUB</span><span class="p">,</span> <span class="n">ZP120</span><span class="p">,</span> <span class="n">HIDEOUT</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">sonos.workflow.suite</span> <span class="k">import</span> <span class="n">WorkflowTestSuite</span>
<span class="kn">from</span> <span class="nn">sonos.simple_upgrade</span> <span class="k">import</span> <span class="n">ConditionalUpgradeTestFixture</span>
<span class="kn">from</span> <span class="nn">audio_playback.mplayer_playback</span> <span class="k">import</span> <span class="n">MplayerAc3Playback</span>
<span class="kn">from</span> <span class="nn">sonos.exception</span> <span class="k">import</span> <span class="ne">TimeoutError</span>
<span class="kn">from</span> <span class="nn">upnp.helpers.tos_link_stream_helper</span> <span class="k">import</span> <span class="n">TosLinkStreamHelper</span>

<span class="n">EXPECTED_HT_CONFIG</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;standalone&#39;</span><span class="p">,</span> <span class="s1">&#39;3.1&#39;</span><span class="p">,</span> <span class="s1">&#39;5.0&#39;</span><span class="p">,</span> <span class="s1">&#39;5.1&#39;</span><span class="p">]</span>
<span class="n">SPDIF_SILENCE_TIME</span> <span class="o">=</span> <span class="mi">30</span>
<span class="n">STREAM_TYPE</span> <span class="o">=</span> <span class="s2">&quot;Dolby Digital 5.1&quot;</span>
<span class="n">DEFAULT_PLAYBACK_DURATION</span> <span class="o">=</span> <span class="mi">600</span>
<span class="n">TV_TRACK</span> <span class="o">=</span> <span class="s1">&#39;/srv/samba/Automation/long_tracks/AC-3/X-Men Days of Future Past.ac3&#39;</span>
<span class="n">STABILIZATION_TIME</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">BUTTON_ACTION_INTERVAL</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">GROUP_UNGROUP_INTERVAL</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">INDEXING_INTERVAL</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">INDEX_SHARE</span> <span class="o">=</span> <span class="s2">&quot;//camb-sqa-nas2/Indexing/ChineseCharNames&quot;</span>
<span class="n">AUDIO_DELAY_RANGE</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
<span class="n">AUDIO_DELAY_TEST_DURATION</span> <span class="o">=</span> <span class="mi">240</span>
<span class="n">SETTLING_TIME</span> <span class="o">=</span> <span class="mi">3</span>


<div class="viewcode-block" id="DolbyPlaybackStressTest"><a class="viewcode-back" href="../../../upnp.stress.html#upnp.stress.dolby_playback_stress_tests.DolbyPlaybackStressTest">[docs]</a><span class="k">class</span> <span class="nc">DolbyPlaybackStressTest</span><span class="p">(</span><span class="n">StressTestsBaseNew</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Run duration test using DD 5.1 stream. While running the test following is</span>
<span class="sd">    checked:</span>
<span class="sd">    1. Playback errors</span>
<span class="sd">    2. CPU usage.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Sonar coeffs file.</span>
    <span class="n">SONAR_XML_FN</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;S1&#39;</span><span class="p">:</span> <span class="s2">&quot;sonarEQS1.xml&quot;</span><span class="p">,</span>
                    <span class="s1">&#39;S3&#39;</span><span class="p">:</span> <span class="s2">&quot;sonarEQS3.xml&quot;</span><span class="p">,</span>
                    <span class="s1">&#39;S5&#39;</span><span class="p">:</span> <span class="s2">&quot;sonarEQS5.xml&quot;</span><span class="p">,</span>
                    <span class="s1">&#39;S6&#39;</span><span class="p">:</span> <span class="s2">&quot;sonarEQS6.xml&quot;</span><span class="p">,</span>
                    <span class="s1">&#39;S9&#39;</span><span class="p">:</span> <span class="s2">&quot;sonarEQS9.xml&quot;</span><span class="p">,</span>
                    <span class="s1">&#39;S11&#39;</span><span class="p">:</span> <span class="s2">&quot;sonarEQS11.xml&quot;</span><span class="p">,</span>
                    <span class="s1">&#39;S12&#39;</span><span class="p">:</span> <span class="s2">&quot;sonarEQS12.xml&quot;</span><span class="p">,</span>
                    <span class="s1">&#39;Sub&#39;</span><span class="p">:</span> <span class="s2">&quot;sonarEQSub.xml&quot;</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">StressTestsBaseNew</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_parse_test_args</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parse command line args</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
            <span class="s2">&quot;--ht_config&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;configurations&#39;</span><span class="p">,</span><span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Comma seperated list of configs to run of the format: </span><span class="se">\n</span><span class="s2">&quot;</span>
                 <span class="s2">&quot;standalone-&lt;model&gt;&#39;, </span><span class="se">\n</span><span class="s2">&quot;</span>
                 <span class="s2">&quot;5.1-&lt;model&gt;-&lt;model&gt; (S9,S11)-(S6,S3,S1,S12,ZP120) </span><span class="se">\n</span><span class="s2">&quot;</span>
                 <span class="s2">&quot;5.0-&lt;model&gt;-&lt;model&gt; (S9,S11)-(S6,S3,S1,S12,ZP120) </span><span class="se">\n</span><span class="s2">&quot;</span>
                 <span class="s2">&quot;3.1-&lt;model&gt;&#39; (S9, S11)&quot;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--duration&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;duration&quot;</span><span class="p">,</span>
                            <span class="n">default</span><span class="o">=</span><span class="n">DEFAULT_PLAYBACK_DURATION</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
                            <span class="n">help</span><span class="o">=</span><span class="s2">&quot;how long should test run for? Full track =-1&quot;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--num_group_members&quot;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
                            <span class="c1"># default all players that are not part of config</span>
                            <span class="c1"># since we don&#39;t know at this point, set it to all</span>
                            <span class="c1"># device in test minus 1. At test time this will</span>
                            <span class="c1"># be set to all available devices outside of config.</span>
                            <span class="c1"># if set to 0, the test will be skipped.</span>
                            <span class="n">default</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_devices</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                            <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Number of group members Default: </span><span class="si">{}</span><span class="s2">&quot;</span>
                                  <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_devices</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)))</span>
        <span class="n">args</span><span class="p">,</span> <span class="n">unknown_args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_known_args</span><span class="p">()</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="n">unknown_args</span>
        <span class="n">desired_duration</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">duration</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_duration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_test_duration</span><span class="p">(</span><span class="n">TV_TRACK</span><span class="p">,</span>
                                                    <span class="n">desired_duration</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_group_members</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">num_group_members</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">configurations</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">configurations</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Playback duration: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_duration</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Test Configurations: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">configurations</span><span class="p">))</span>

<div class="viewcode-block" id="DolbyPlaybackStressTest.generate_test_config"><a class="viewcode-back" href="../../../upnp.stress.html#upnp.stress.dolby_playback_stress_tests.DolbyPlaybackStressTest.generate_test_config">[docs]</a>    <span class="k">def</span> <span class="nf">generate_test_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate test configurations.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">config</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">configurations</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">config</span></div>

<div class="viewcode-block" id="DolbyPlaybackStressTest.build_config"><a class="viewcode-back" href="../../../upnp.stress.html#upnp.stress.dolby_playback_stress_tests.DolbyPlaybackStressTest.build_config">[docs]</a>    <span class="k">def</span> <span class="nf">build_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Build configuration from the configs provided via commandline</span>
<span class="sd">        :param str config: Test configuration</span>
<span class="sd">        :return ht_master: HT Master SonosZoneComponent or None</span>
<span class="sd">        :rtype: :class:`~sonos.client.internal.SonosZoneComponent`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Building config for : </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">config</span><span class="p">))</span>
        <span class="n">temp_config</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
        <span class="n">ht_config</span> <span class="o">=</span> <span class="n">temp_config</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verifyInOrStop</span><span class="p">(</span><span class="n">ht_config</span><span class="p">,</span> <span class="n">EXPECTED_HT_CONFIG</span><span class="p">,</span>
            <span class="s2">&quot;Config </span><span class="si">{}</span><span class="s2">. Expect ht config from: </span><span class="si">{}</span><span class="s2">&quot;</span>
            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">EXPECTED_HT_CONFIG</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verifyInOrStop</span><span class="p">(</span>
                <span class="n">temp_config</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">HT_MASTER_MODELS</span><span class="p">,</span>
                <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">: Device ht master capable ?&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">temp_config</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="k">if</span> <span class="n">ht_config</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;5.0&#39;</span><span class="p">,</span> <span class="s1">&#39;5.1&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">verifyInOrStop</span><span class="p">(</span>
                <span class="n">temp_config</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">HT_SATELLITE_DEVICES</span><span class="p">,</span>
                <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">: Device ht sat. capable ?&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">temp_config</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">temp_config</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">verifyInOrStop</span><span class="p">(</span>
                    <span class="n">temp_config</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">HT_SATELLITE_DEVICES</span><span class="p">,</span>
                    <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">: Device ht sat. capable ?&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">temp_config</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">verifyInOrStop</span><span class="p">(</span>
                    <span class="n">temp_config</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
                    <span class="n">PAIRABLE_MODEL_COMPATIBILITY_MAP</span><span class="p">[</span><span class="n">temp_config</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span>
                    <span class="s2">&quot;Are Left and right surround compatible pair ?&quot;</span><span class="p">)</span>
        <span class="n">ht_master</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_testbed_device_by_model</span><span class="p">(</span><span class="n">temp_config</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">ht_config</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;3.1&#39;</span><span class="p">,</span> <span class="s1">&#39;5.1&#39;</span><span class="p">]:</span>
            <span class="n">sub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_testbed_device_by_model</span><span class="p">(</span><span class="n">SUB</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ht_config</span> <span class="o">==</span> <span class="s1">&#39;5.1&#39;</span> <span class="ow">or</span> <span class="n">ht_config</span> <span class="o">==</span> <span class="s1">&#39;5.0&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">temp_config</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">sat_model</span> <span class="o">=</span> <span class="n">temp_config</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">sat_model</span> <span class="ow">in</span> <span class="p">[</span><span class="n">ZP120</span><span class="p">,</span> <span class="n">HIDEOUT</span><span class="p">]:</span>
                    <span class="n">sat_l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_testbed_device_by_model</span><span class="p">(</span><span class="n">sat_model</span><span class="p">)</span>
                    <span class="n">sat_r</span> <span class="o">=</span> <span class="n">sat_l</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">devices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_testbed_devices_by_model</span><span class="p">(</span><span class="n">sat_model</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
                    <span class="n">sat_l</span> <span class="o">=</span> <span class="n">devices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">sat_r</span> <span class="o">=</span> <span class="n">devices</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">temp_config</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">sat_l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_testbed_device_by_model</span><span class="p">(</span><span class="n">temp_config</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                <span class="n">sat_r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_testbed_device_by_model</span><span class="p">(</span><span class="n">temp_config</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">ht_config</span> <span class="o">==</span> <span class="s1">&#39;3.1&#39;</span><span class="p">:</span>
            <span class="n">ht_master</span><span class="o">.</span><span class="n">DeviceProperties</span><span class="o">.</span><span class="n">create_31_config</span><span class="p">(</span><span class="n">sub</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">ht_config</span> <span class="o">==</span> <span class="s1">&#39;5.0&#39;</span><span class="p">:</span>
            <span class="n">ht_master</span><span class="o">.</span><span class="n">DeviceProperties</span><span class="o">.</span><span class="n">create_50_config</span><span class="p">(</span><span class="n">sat_l</span><span class="p">,</span> <span class="n">sat_r</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">ht_config</span> <span class="o">==</span> <span class="s1">&#39;5.1&#39;</span><span class="p">:</span>
            <span class="n">ht_master</span><span class="o">.</span><span class="n">DeviceProperties</span><span class="o">.</span><span class="n">create_51_config</span><span class="p">(</span><span class="n">sub</span><span class="p">,</span> <span class="n">sat_l</span><span class="p">,</span> <span class="n">sat_r</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ht_master</span></div>

<div class="viewcode-block" id="DolbyPlaybackStressTest.setUpFixture"><a class="viewcode-back" href="../../../upnp.stress.html#upnp.stress.dolby_playback_stress_tests.DolbyPlaybackStressTest.setUpFixture">[docs]</a>    <span class="k">def</span> <span class="nf">setUpFixture</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Setup fixture</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Setup Fixture&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_devices</span> <span class="o">=</span> <span class="p">[</span><span class="n">zp</span> <span class="k">for</span> <span class="n">zp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">my_devices</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parse_test_args</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wifi_devices</span> <span class="o">=</span> <span class="p">[</span><span class="n">zp</span> <span class="k">for</span> <span class="n">zp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_devices</span> <span class="k">if</span>
                             <span class="n">zp</span><span class="o">.</span><span class="n">playback_device</span> <span class="ow">or</span> <span class="n">zp</span><span class="o">.</span><span class="n">is_sub</span><span class="p">()]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ht_masters</span> <span class="o">=</span> <span class="p">[</span><span class="n">htm</span> <span class="k">for</span> <span class="n">htm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_devices</span>
                           <span class="k">if</span> <span class="n">htm</span><span class="o">.</span><span class="n">is_ht_master_capable</span><span class="p">()]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verifyTrueOrStop</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ht_masters</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
                              <span class="s2">&quot;Expect at least 1 ht master device&quot;</span><span class="p">)</span>
        <span class="p">[</span><span class="n">zp</span><span class="o">.</span><span class="n">DeviceProperties</span><span class="o">.</span><span class="n">SetAutoplayRoomUUID</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">zp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ht_masters</span><span class="p">]</span>
        <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cleanup</span><span class="p">(</span><span class="n">zp</span><span class="p">)</span> <span class="k">for</span> <span class="n">zp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_devices</span><span class="p">]</span>
        <span class="p">[</span><span class="n">zp</span><span class="o">.</span><span class="n">cli</span><span class="o">.</span><span class="n">set_diag</span><span class="p">(</span><span class="n">DIAGCS</span><span class="p">)</span> <span class="k">for</span> <span class="n">zp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_devices</span><span class="p">]</span>
        <span class="p">[</span><span class="n">zp</span><span class="o">.</span><span class="n">wait_for_upnp_alive</span><span class="p">()</span> <span class="k">for</span> <span class="n">zp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_devices</span><span class="p">]</span>
        <span class="p">[</span><span class="n">zp</span><span class="o">.</span><span class="n">cli</span><span class="o">.</span><span class="n">set_device_orientation</span><span class="p">(</span><span class="s1">&#39;vertical&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">zp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_devices</span> <span class="k">if</span> <span class="n">zp</span><span class="o">.</span><span class="n">modelNumber</span> <span class="o">==</span> <span class="s2">&quot;S3&quot;</span><span class="p">]</span>
        <span class="p">[</span><span class="n">zp</span><span class="o">.</span><span class="n">cli</span><span class="o">.</span><span class="n">set_device_orientation</span><span class="p">(</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
         <span class="k">for</span> <span class="n">zp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_devices</span> <span class="k">if</span> <span class="n">zp</span><span class="o">.</span><span class="n">modelNumber</span> <span class="o">==</span> <span class="s2">&quot;S6&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config_devices</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error_stats</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error_counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_error_counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset_error_counters</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">zp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_devices</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error_stats</span><span class="p">[</span><span class="n">zp</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="DolbyPlaybackStressTest.reset_error_counters"><a class="viewcode-back" href="../../../upnp.stress.html#upnp.stress.dolby_playback_stress_tests.DolbyPlaybackStressTest.reset_error_counters">[docs]</a>    <span class="k">def</span> <span class="nf">reset_error_counters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reset all error counters being tracked during the test</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error_counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error_stats</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">zp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_devices</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error_stats</span><span class="p">[</span><span class="n">zp</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="DolbyPlaybackStressTest.get_test_duration"><a class="viewcode-back" href="../../../upnp.stress.html#upnp.stress.dolby_playback_stress_tests.DolbyPlaybackStressTest.get_test_duration">[docs]</a>    <span class="k">def</span> <span class="nf">get_test_duration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">desired_duration</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get test duration track. If track length is less than DEFAULT_DURATION,</span>
<span class="sd">        use track length. Else use test duration provided</span>
<span class="sd">        :param str file_name: DD track name</span>
<span class="sd">        :param int desired_duration: User input for time to run test in sec.</span>
<span class="sd">        :return int track_duration: Seconds to play test for</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Getting test duration based on track: </span><span class="si">{}</span><span class="s2">&quot;</span>
                         <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">file_name</span><span class="p">))</span>
        <span class="n">command</span> <span class="o">=</span> <span class="s1">&#39;mediainfo&#39;</span>
        <span class="n">commandline</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span>
        <span class="n">file_info</span> <span class="o">=</span> <span class="n">commands</span><span class="o">.</span><span class="n">getoutput</span><span class="p">(</span><span class="n">commandline</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">info_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">line_info</span> <span class="ow">in</span> <span class="n">file_info</span><span class="p">:</span>
            <span class="n">param_value</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">line_info</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">param_value</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">param_value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">info_dict</span><span class="p">:</span>
                    <span class="n">info_dict</span><span class="p">[</span><span class="n">param_value</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">param_value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">track_duration</span> <span class="o">=</span> <span class="n">info_dict</span><span class="p">[</span><span class="s1">&#39;Duration&#39;</span><span class="p">]</span>
        <span class="c1"># parse hr, min seconds and ms from track duration, apply appropriate</span>
        <span class="c1"># multiplier to get total seconds.</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="s1">&#39;(\d{1,3})\s*([a-z]{1,3})\s*(\d{1,3})\s*([a-z]{1,3})&#39;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">track_duration</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;hr&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">]:</span>
                <span class="n">major</span> <span class="o">=</span> <span class="mi">3600</span>
            <span class="k">elif</span> <span class="n">result</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="s1">&#39;mn&#39;</span><span class="p">]:</span>
                <span class="n">major</span> <span class="o">=</span> <span class="mi">60</span>
            <span class="k">elif</span> <span class="n">result</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;s&#39;</span><span class="p">:</span>
                <span class="n">major</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">result</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;ms&#39;</span><span class="p">:</span>
                <span class="n">major</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="s1">&#39;mn&#39;</span><span class="p">]:</span>
                <span class="n">minor</span> <span class="o">=</span> <span class="mi">60</span>
            <span class="k">elif</span> <span class="n">result</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;s&#39;</span><span class="p">:</span>
                <span class="n">minor</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">result</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;ms&#39;</span><span class="p">:</span>
                <span class="n">minor</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">track_seconds</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">major</span><span class="p">)</span> <span class="o">+</span>
                             <span class="nb">int</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span> <span class="o">*</span> <span class="n">minor</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">desired_duration</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">track_seconds</span>
        <span class="k">elif</span> <span class="n">desired_duration</span> <span class="o">&gt;</span> <span class="n">track_seconds</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">track_seconds</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">desired_duration</span></div>

    <span class="k">def</span> <span class="nf">_enable_trueplay</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Enable Sonar</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Enabling sonar&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">zp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_devices</span><span class="p">:</span>
            <span class="n">xml_fn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SONAR_XML_FN</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">zp</span><span class="o">.</span><span class="n">modelNumber</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">xml_fn</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">xml_fn</span><span class="p">)</span> <span class="k">as</span> <span class="n">fh</span><span class="p">:</span>
                    <span class="n">sonar_xml_data</span> <span class="o">=</span> <span class="n">fh</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;zp is </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">zp</span><span class="o">.</span><span class="n">ip</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s1">&#39;No sonar EQ file for </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">zp</span><span class="o">.</span><span class="n">modelNumber</span><span class="p">))</span>
                <span class="k">continue</span>

            <span class="n">zp</span><span class="o">.</span><span class="n">http</span><span class="o">.</span><span class="n">http_post</span><span class="p">(</span><span class="s2">&quot;http://</span><span class="si">{}</span><span class="s2">:1400/putDSP&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">zp</span><span class="o">.</span><span class="n">ip</span><span class="p">),</span>
                              <span class="n">data</span><span class="o">=</span><span class="n">sonar_xml_data</span><span class="p">)</span>
            <span class="n">check_xml</span> <span class="o">=</span> <span class="n">zp</span><span class="o">.</span><span class="n">diag</span><span class="o">.</span><span class="n">get_dsp_block</span><span class="p">(</span><span class="s1">&#39;RoomIIR&#39;</span><span class="p">)</span>
            <span class="n">input_xml</span> <span class="o">=</span> <span class="n">XMLAccessor</span><span class="p">(</span><span class="n">sonar_xml_data</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">check_xml</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">zp</span><span class="o">.</span><span class="n">modelNumber</span> <span class="o">==</span> <span class="s1">&#39;S9&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">zp</span><span class="o">.</span><span class="n">modelNumber</span> <span class="o">==</span> <span class="s1">&#39;S11&#39;</span><span class="p">):</span>
                    <span class="c1"># just check the first of three spectral coeff blocks</span>
                    <span class="n">input_coeffs</span> <span class="o">=</span> <span class="p">[</span><span class="n">sec</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">sec</span> <span class="ow">in</span>
                                    <span class="n">input_xml</span><span class="o">.</span><span class="n">block</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">parameter</span><span class="o">.</span><span class="n">set_0</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">input_coeffs</span> <span class="o">=</span> <span class="p">[</span><span class="n">sec</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">sec</span> <span class="ow">in</span>
                                    <span class="n">input_xml</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">parameter</span><span class="o">.</span><span class="n">set_0</span><span class="p">]</span>
                <span class="n">check_coeffs</span> <span class="o">=</span> <span class="p">[</span><span class="n">sec</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">sec</span> <span class="ow">in</span>
                                <span class="n">check_xml</span><span class="o">.</span><span class="n">parameter</span><span class="o">.</span><span class="n">set_0</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">verifyEqualOrStop</span><span class="p">(</span>
                    <span class="n">input_coeffs</span><span class="p">,</span> <span class="n">check_coeffs</span><span class="p">,</span>
                    <span class="s2">&quot;Expect Sonar coeffs to be set correctly&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;No RoomIIR block found in </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">zp</span><span class="p">))</span>

<div class="viewcode-block" id="DolbyPlaybackStressTest.setUpTest"><a class="viewcode-back" href="../../../upnp.stress.html#upnp.stress.dolby_playback_stress_tests.DolbyPlaybackStressTest.setUpTest">[docs]</a>    <span class="k">def</span> <span class="nf">setUpTest</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Setup test</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Setup Test&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config_devices</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset_error_counters</span><span class="p">()</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">DolbyPlaybackStressTest</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">setUpTest</span><span class="p">()</span></div>

<div class="viewcode-block" id="DolbyPlaybackStressTest.tearDownTest"><a class="viewcode-back" href="../../../upnp.stress.html#upnp.stress.dolby_playback_stress_tests.DolbyPlaybackStressTest.tearDownTest">[docs]</a>    <span class="k">def</span> <span class="nf">tearDownTest</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tear Down test</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Tear Down Test&quot;</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">DolbyPlaybackStressTest</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">tearDownTest</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">zp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_devices</span><span class="p">:</span>
            <span class="n">zp</span><span class="o">.</span><span class="n">DeviceProperties</span><span class="o">.</span><span class="n">cleanup_bonded_configuration</span><span class="p">()</span>
        <span class="p">[</span><span class="n">zp</span><span class="o">.</span><span class="n">cli</span><span class="o">.</span><span class="n">set_device_orientation</span><span class="p">(</span><span class="s1">&#39;detect&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">zp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_devices</span> <span class="k">if</span> <span class="n">zp</span><span class="o">.</span><span class="n">modelNumber</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;S3&#39;</span><span class="p">,</span> <span class="s1">&#39;S6&#39;</span><span class="p">]]</span>
        <span class="c1"># leave the player without a persistent Sonar EQ</span>
        <span class="p">[</span><span class="n">zp</span><span class="o">.</span><span class="n">cli</span><span class="o">.</span><span class="n">remove_file</span><span class="p">(</span><span class="s1">&#39;/jffs/sonarEQ.xml&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">zp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">my_devices</span>
         <span class="k">if</span> <span class="n">zp</span><span class="o">.</span><span class="n">device_with_built_in_speakers</span><span class="p">]</span></div>

    <span class="k">def</span> <span class="nf">_get_satellites</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ht_master</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get list of satellites of ht_master device</span>
<span class="sd">        :param ht_master: HT Master SonosZoneComponent or None</span>
<span class="sd">        :type: :class:`~sonos.client.internal.SonosZoneComponent`</span>
<span class="sd">        :return: List of satellites</span>
<span class="sd">        :rtype: :obj:`list`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">satellites</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">ht_master</span><span class="o">.</span><span class="n">is_bonded</span><span class="p">():</span>
            <span class="n">satellites</span> <span class="o">+=</span> <span class="p">[</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">ht_master</span><span class="o">.</span><span class="n">get_bonded_zones</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>
        <span class="k">return</span> <span class="n">satellites</span>

    <span class="k">def</span> <span class="nf">_bounce_anacapa</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">zones</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Bounce anacapa and wait</span>
<span class="sd">        :param list zones: List of sonos zone component.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Bouncing anacapa on </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">zones</span><span class="p">))</span>
        <span class="p">[</span><span class="n">zp</span><span class="o">.</span><span class="n">bounce_anacapa_and_wait</span><span class="p">()</span> <span class="k">for</span> <span class="n">zp</span> <span class="ow">in</span> <span class="n">zones</span><span class="p">]</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">STABILIZATION_TIME</span><span class="p">)</span>

<div class="viewcode-block" id="DolbyPlaybackStressTest.perform_button_actions_and_verify_playback_state"><a class="viewcode-back" href="../../../upnp.stress.html#upnp.stress.dolby_playback_stress_tests.DolbyPlaybackStressTest.perform_button_actions_and_verify_playback_state">[docs]</a>    <span class="k">def</span> <span class="nf">perform_button_actions_and_verify_playback_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ht_master</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Perform peridical volume and mute button actions and check state while</span>
<span class="sd">        running the test. For cap touch devices this causes audio feedback. For</span>
<span class="sd">        non cap touch devices no feedback.</span>
<span class="sd">        :param ht_master: HT Master SonosZoneComponent</span>
<span class="sd">        :type: :class:`~sonos.client.internal.SonosZoneComponent`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">elapsed_time</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">ht_master</span><span class="o">.</span><span class="n">diag</span><span class="o">.</span><span class="n">set_diag_level</span><span class="p">(</span><span class="s1">&#39;buttons&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Now performing button actions on HT Master: </span><span class="si">{}</span><span class="s2">&quot;</span>
                         <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ht_master</span><span class="p">))</span>
        <span class="n">expired</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_duration</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="k">while</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">expired</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Button action test. Elapsed time: </span><span class="si">{}</span><span class="s2">&quot;</span>
                             <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">now</span><span class="p">))</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">ht_master</span><span class="o">.</span><span class="n">AVTransport</span><span class="o">.</span><span class="n">is_playing</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">(</span><span class="s2">&quot;Playback stopped!! DIAG: </span><span class="si">{}</span><span class="s2">.&quot;</span>
                          <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">elapsed_time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_diag</span><span class="p">(</span><span class="n">ht_master</span><span class="p">)))</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">BUTTON_ACTION_INTERVAL</span><span class="p">)</span>
            <span class="n">ht_master</span><span class="o">.</span><span class="n">cli</span><span class="o">.</span><span class="n">volume_down</span><span class="p">()</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">BUTTON_ACTION_INTERVAL</span><span class="p">)</span>
            <span class="n">ht_master</span><span class="o">.</span><span class="n">cli</span><span class="o">.</span><span class="n">volume_up</span><span class="p">()</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">BUTTON_ACTION_INTERVAL</span><span class="p">)</span>
            <span class="n">ht_master</span><span class="o">.</span><span class="n">cli</span><span class="o">.</span><span class="n">volume_mute</span><span class="p">()</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">BUTTON_ACTION_INTERVAL</span><span class="p">)</span>
            <span class="n">ht_master</span><span class="o">.</span><span class="n">cli</span><span class="o">.</span><span class="n">volume_mute</span><span class="p">()</span></div>

<div class="viewcode-block" id="DolbyPlaybackStressTest.perform_grouping_ungrouping_and_verify_state"><a class="viewcode-back" href="../../../upnp.stress.html#upnp.stress.dolby_playback_stress_tests.DolbyPlaybackStressTest.perform_grouping_ungrouping_and_verify_state">[docs]</a>    <span class="k">def</span> <span class="nf">perform_grouping_ungrouping_and_verify_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ht_master</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Perform group ungroup actions while DD5.1 playback is in progress.</span>
<span class="sd">        :param ht_master: HT Master SonosZoneComponent</span>
<span class="sd">        :type: :class:`~sonos.client.internal.SonosZoneComponent`</span>
<span class="sd">        :param list gms: List of sonos zone component.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">elapsed_time</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">gms</span> <span class="o">=</span> <span class="p">[</span><span class="n">gm</span> <span class="k">for</span> <span class="n">gm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_devices</span>
               <span class="k">if</span> <span class="n">gm</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_devices</span><span class="p">][:</span><span class="bp">self</span><span class="o">.</span><span class="n">num_group_members</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Now Performing group/ungroup actions using GMs: </span><span class="si">{}</span><span class="s2"> &quot;</span>
                         <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">gms</span><span class="p">))</span>
        <span class="n">expired</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_duration</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="k">while</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">expired</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Group/Ungroup test. Elapsed time: </span><span class="si">{}</span><span class="s2">&quot;</span>
                             <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">now</span><span class="p">))</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">ht_master</span><span class="o">.</span><span class="n">AVTransport</span><span class="o">.</span><span class="n">is_playing</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">(</span><span class="s2">&quot;Run Time: </span><span class="si">{}</span><span class="s2">. Playback stopped!! DIAG: </span><span class="si">{}</span><span class="s2">.&quot;</span>
                          <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">elapsed_time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_diag</span><span class="p">(</span><span class="n">ht_master</span><span class="p">)))</span>
                <span class="k">break</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">GROUP_UNGROUP_INTERVAL</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Now grouping&quot;</span><span class="p">)</span>
            <span class="n">ht_master</span><span class="o">.</span><span class="n">AVTransport</span><span class="o">.</span><span class="n">link_zones</span><span class="p">(</span><span class="n">gms</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">GROUP_UNGROUP_INTERVAL</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Now un-grouping&quot;</span><span class="p">)</span>
            <span class="p">[</span><span class="n">gm</span><span class="o">.</span><span class="n">AVTransport</span><span class="o">.</span><span class="n">leave_group_and_wait</span><span class="p">()</span> <span class="k">for</span> <span class="n">gm</span> <span class="ow">in</span> <span class="n">gms</span><span class="p">]</span></div>

<div class="viewcode-block" id="DolbyPlaybackStressTest.perform_indexing_and_verify_state"><a class="viewcode-back" href="../../../upnp.stress.html#upnp.stress.dolby_playback_stress_tests.DolbyPlaybackStressTest.perform_indexing_and_verify_state">[docs]</a>    <span class="k">def</span> <span class="nf">perform_indexing_and_verify_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ht_master</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Perform indexing actions while DD5.1 playback is in progress</span>
<span class="sd">        :param ht_master: HT Master SonosZoneComponent</span>
<span class="sd">        :type: :class:`~sonos.client.internal.SonosZoneComponent`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ht_master</span><span class="o">.</span><span class="n">ContentDirectory</span><span class="o">.</span><span class="n">remove_all_shares</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Now Performing index actions using share: </span><span class="si">{}</span><span class="s2">&quot;</span>
                         <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">INDEX_SHARE</span><span class="p">))</span>
        <span class="n">expired</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_duration</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="k">while</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">expired</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Indexing test. Elapsed time: </span><span class="si">{}</span><span class="s2">&quot;</span>
                             <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">now</span><span class="p">))</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">ht_master</span><span class="o">.</span><span class="n">AVTransport</span><span class="o">.</span><span class="n">is_playing</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">(</span><span class="s2">&quot;Playback stopped!! DIAG: </span><span class="si">{}</span><span class="s2">.&quot;</span>
                          <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_diag</span><span class="p">(</span><span class="n">ht_master</span><span class="p">)))</span>
                <span class="k">break</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">INDEXING_INTERVAL</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Adding share&quot;</span><span class="p">)</span>
            <span class="n">ht_master</span><span class="o">.</span><span class="n">ContentDirectory</span><span class="o">.</span><span class="n">add_share</span><span class="p">(</span><span class="n">INDEX_SHARE</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">INDEXING_INTERVAL</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Removing share&quot;</span><span class="p">)</span>
            <span class="n">ht_master</span><span class="o">.</span><span class="n">ContentDirectory</span><span class="o">.</span><span class="n">remove_all_shares</span><span class="p">()</span></div>

<div class="viewcode-block" id="DolbyPlaybackStressTest.perform_lip_sync_settings_and_verify_state"><a class="viewcode-back" href="../../../upnp.stress.html#upnp.stress.dolby_playback_stress_tests.DolbyPlaybackStressTest.perform_lip_sync_settings_and_verify_state">[docs]</a>    <span class="k">def</span> <span class="nf">perform_lip_sync_settings_and_verify_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ht_master</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Perform AudioDelay/Lip Sync settings. Verify no playback errors once</span>
<span class="sd">        settings is done.</span>
<span class="sd">        :param ht_master: HT Master SonosZoneComponent</span>
<span class="sd">        :type: :class:`~sonos.client.internal.SonosZoneComponent`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Now performing Lip Sync Test&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">setting</span> <span class="ow">in</span> <span class="n">AUDIO_DELAY_RANGE</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Now setting Audiodelay to: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">setting</span><span class="p">))</span>
            <span class="n">ht_master</span><span class="o">.</span><span class="n">RenderingControl</span><span class="o">.</span><span class="n">SetEQ</span><span class="p">(</span><span class="s2">&quot;AudioDelay&quot;</span><span class="p">,</span> <span class="n">setting</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">SETTLING_TIME</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ht_master</span><span class="o">.</span><span class="n">AVTransport</span><span class="o">.</span><span class="n">wait_for_avt_state</span><span class="p">(</span>
                <span class="n">ht_master</span><span class="o">.</span><span class="n">AVTransport</span><span class="o">.</span><span class="n">STOPPED_STATE</span><span class="p">,</span>
                <span class="n">iteration_delay</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span>
                <span class="n">timeout_seconds</span><span class="o">=</span><span class="n">AUDIO_DELAY_TEST_DURATION</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">(</span><span class="s2">&quot;Delay Setting: </span><span class="si">{}</span><span class="s2">. Playback stopped!! DIAG: </span><span class="si">{}</span><span class="s2">.&quot;</span>
                          <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">setting</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_diag</span><span class="p">(</span><span class="n">ht_master</span><span class="p">)))</span></div>

    <span class="k">def</span> <span class="nf">_run_dolby_stress_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ht_master</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Run dolby playback stress test</span>
<span class="sd">        :param ht_master: HT Master SonosZoneComponent</span>
<span class="sd">        :type: :class:`~sonos.client.internal.SonosZoneComponent`</span>
<span class="sd">        :param func: Function name to call when performing stress test</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Now performing Dolby playback stress test&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error_detected</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verifyTrueOrStop</span><span class="p">(</span><span class="n">ht_master</span><span class="o">.</span><span class="n">diag</span><span class="o">.</span><span class="n">is_toslink_connected</span><span class="p">(),</span>
                              <span class="s1">&#39;TOSLINK should be connected&#39;</span><span class="p">)</span>
        <span class="n">ht_master</span><span class="o">.</span><span class="n">RenderingControl</span><span class="o">.</span><span class="n">SetVolume</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">MplayerAc3Playback</span><span class="p">(</span><span class="n">TV_TRACK</span><span class="p">)</span> <span class="k">as</span> <span class="n">mplayer_tv_h</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start_playback</span><span class="p">(</span><span class="n">ht_master</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">TV</span><span class="p">)</span>
            <span class="n">TosLinkStreamHelper</span><span class="p">(</span>
                <span class="n">mplayer_tv_h</span><span class="p">,</span>
                <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">)</span><span class="o">.</span><span class="n">verify_tos_link_stream_type</span><span class="p">(</span><span class="n">ht_master</span><span class="p">,</span>
                                                                <span class="n">STREAM_TYPE</span><span class="p">,</span>
                                                                <span class="mi">10</span><span class="p">)</span>
            <span class="n">func</span><span class="p">(</span><span class="n">ht_master</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_for_errors</span><span class="p">(</span><span class="n">ht_master</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">SPDIF_SILENCE_TIME</span><span class="p">)</span>

<div class="viewcode-block" id="DolbyPlaybackStressTest.check_for_errors"><a class="viewcode-back" href="../../../upnp.stress.html#upnp.stress.dolby_playback_stress_tests.DolbyPlaybackStressTest.check_for_errors">[docs]</a>    <span class="k">def</span> <span class="nf">check_for_errors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ht_master</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if there are any errors, fail test on error</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="s1">&#39;error_stats&#39;</span>
        <span class="n">date_time_str</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%H_%M_%S&#39;</span><span class="p">)</span>
        <span class="n">error_state_log</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">.txt&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">ht_master</span><span class="o">.</span><span class="n">modelNumber</span><span class="p">,</span>
                                                <span class="n">date_time_str</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">error_detected</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_counters</span><span class="p">(</span><span class="n">error_stats_file</span><span class="o">=</span><span class="n">error_state_log</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s2">&quot;Errors detected while running test. DIAG: </span><span class="si">{}</span><span class="s2">. Errors &quot;</span>
                      <span class="s2">&quot;logged to: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_diag</span><span class="p">(</span><span class="n">ht_master</span><span class="p">),</span>
                                             <span class="n">error_state_log</span><span class="p">))</span></div>

<div class="viewcode-block" id="DolbyPlaybackStressTest.setup_devices"><a class="viewcode-back" href="../../../upnp.stress.html#upnp.stress.dolby_playback_stress_tests.DolbyPlaybackStressTest.setup_devices">[docs]</a>    <span class="k">def</span> <span class="nf">setup_devices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Setup devices before test. Enable truplay</span>
<span class="sd">        :param str config: Test configuration</span>
<span class="sd">        :return: HT master sonos zone component</span>
<span class="sd">        :rtype: :class:`~sonos.client.internal.SonosZoneComponent`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Test Config: </span><span class="si">{}</span><span class="s2">. Setting up devices&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">config</span><span class="p">))</span>
        <span class="n">ht_master</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_config</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config_devices</span> <span class="o">=</span> <span class="p">[</span><span class="n">ht_master</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_satellites</span><span class="p">(</span><span class="n">ht_master</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bounce_anacapa</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">config_devices</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_enable_trueplay</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">ht_master</span></div>

<div class="viewcode-block" id="DolbyPlaybackStressTest.test_dolby_playback_with_button_actions"><a class="viewcode-back" href="../../../upnp.stress.html#upnp.stress.dolby_playback_stress_tests.DolbyPlaybackStressTest.test_dolby_playback_with_button_actions">[docs]</a>    <span class="nd">@combinatorial</span><span class="p">(</span><span class="s1">&#39;generate_test_config&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_dolby_playback_with_button_actions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Dolby duration playback test</span>
<span class="sd">        :param str config: Test configuration</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ht_master</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">setup_devices</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_run_dolby_stress_test</span><span class="p">(</span>
            <span class="n">ht_master</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">perform_button_actions_and_verify_playback_state</span><span class="p">)</span></div>

<div class="viewcode-block" id="DolbyPlaybackStressTest.test_dolby_playback_with_grouping_ungrouping"><a class="viewcode-back" href="../../../upnp.stress.html#upnp.stress.dolby_playback_stress_tests.DolbyPlaybackStressTest.test_dolby_playback_with_grouping_ungrouping">[docs]</a>    <span class="nd">@combinatorial</span><span class="p">(</span><span class="s1">&#39;generate_test_config&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_dolby_playback_with_grouping_ungrouping</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Dolby duration playback test</span>
<span class="sd">        :param str config: Test configuration</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_group_members</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">skip</span><span class="p">(</span><span class="s2">&quot;Skipping test as no number of group members specified&quot;</span><span class="p">)</span>
        <span class="n">ht_master</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">setup_devices</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_run_dolby_stress_test</span><span class="p">(</span>
            <span class="n">ht_master</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">perform_grouping_ungrouping_and_verify_state</span><span class="p">)</span></div>

<div class="viewcode-block" id="DolbyPlaybackStressTest.test_dolby_playback_with_indexing"><a class="viewcode-back" href="../../../upnp.stress.html#upnp.stress.dolby_playback_stress_tests.DolbyPlaybackStressTest.test_dolby_playback_with_indexing">[docs]</a>    <span class="nd">@combinatorial</span><span class="p">(</span><span class="s1">&#39;generate_test_config&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_dolby_playback_with_indexing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Dolby duration playback test</span>
<span class="sd">        :param str config: Test configuration</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ht_master</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">setup_devices</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_run_dolby_stress_test</span><span class="p">(</span>
            <span class="n">ht_master</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">perform_indexing_and_verify_state</span><span class="p">)</span></div>

<div class="viewcode-block" id="DolbyPlaybackStressTest.test_dolby_playback_with_audio_delay"><a class="viewcode-back" href="../../../upnp.stress.html#upnp.stress.dolby_playback_stress_tests.DolbyPlaybackStressTest.test_dolby_playback_with_audio_delay">[docs]</a>    <span class="nd">@combinatorial</span><span class="p">(</span><span class="s1">&#39;generate_test_config&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_dolby_playback_with_audio_delay</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Dolby duration playback test</span>
<span class="sd">        :param str config: Test configuration</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ht_master</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">setup_devices</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_run_dolby_stress_test</span><span class="p">(</span>
            <span class="n">ht_master</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">perform_lip_sync_settings_and_verify_state</span><span class="p">)</span></div></div>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">suite</span> <span class="o">=</span> <span class="n">WorkflowTestSuite</span><span class="p">(</span><span class="s2">&quot;DolbyPlaybackStressTest&quot;</span><span class="p">)</span>
    <span class="n">suite</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="n">ConditionalUpgradeTestFixture</span><span class="p">(),</span> <span class="n">DolbyPlaybackStressTest</span><span class="p">()])</span>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../index.html">TestCase Documentation</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../audio.html">audio package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../cloud.html">cloud package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../common.html">common package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../data_reporting.html">data_reporting package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dataio.html">dataio package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples.html">examples package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../hdmi.html">hdmi package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ixchariot.html">ixchariot package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../networking.html">networking package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../other.html">other package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../perf.html">perf package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../pytest_automation.html">pytest_automation package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../secure_registration.html">secure_registration package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../syssw.html">syssw package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../upnp.html">upnp package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../voice.html">voice package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../webserver.html">webserver package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../webserver_v0.html">webserver_v0 package</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019, Author.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.8.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>