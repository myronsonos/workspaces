
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>upnp.functional.trueplay.base &#8212; TestCase Documentation  documentation</title>
    <link rel="stylesheet" href="../../../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
   
  <link rel="stylesheet" href="../../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for upnp.functional.trueplay.base</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">decorators</span> <span class="k">import</span> <span class="n">retry</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="k">import</span> <span class="n">product</span>
<span class="kn">from</span> <span class="nn">sonos.client.zone_player</span> <span class="k">import</span> <span class="p">(</span>
    <span class="n">S1</span><span class="p">,</span> <span class="n">S3</span><span class="p">,</span> <span class="n">S5</span><span class="p">,</span> <span class="n">S6</span><span class="p">,</span> <span class="n">S9</span><span class="p">,</span> <span class="n">S11</span><span class="p">,</span> <span class="n">S12</span><span class="p">,</span> <span class="n">S13</span><span class="p">,</span> <span class="n">S14</span><span class="p">,</span> <span class="n">S16</span><span class="p">,</span>
    <span class="n">S17</span><span class="p">,</span> <span class="n">S18</span><span class="p">,</span> <span class="n">S20</span><span class="p">,</span> <span class="n">S21</span><span class="p">,</span> <span class="n">S22</span><span class="p">,</span> <span class="n">S23</span><span class="p">,</span> <span class="n">ZP120</span><span class="p">,</span> <span class="n">SUB</span><span class="p">,</span>
    <span class="n">SONAR_EQ_XML</span><span class="p">,</span>
    <span class="n">STEREO_PAIR_DEVICES</span><span class="p">,</span>
    <span class="n">HT_MASTER_MODELS</span><span class="p">,</span>
    <span class="n">HT_MASTER_TWO_CHANNELS</span><span class="p">,</span>
    <span class="n">HT_MASTER_THREE_CHANNELS</span><span class="p">,</span>
    <span class="n">HT_SOLO_REAR_SURROUND_DEVICES</span><span class="p">,</span>
    <span class="n">HT_SATELLITE_DEVICES</span><span class="p">,</span>
    <span class="n">PAIRABLE_MODEL_COMPATIBILITY_MAP</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">sonos.exception</span> <span class="k">import</span> <span class="n">UPnPError</span><span class="p">,</span> <span class="ne">TimeoutError</span>
<span class="kn">from</span> <span class="nn">sonos.workflow.fixture</span> <span class="k">import</span> <span class="n">wait_until_true</span><span class="p">,</span> <span class="n">WorkflowTestFixture</span>
<span class="kn">from</span> <span class="nn">sonos.services.common</span> <span class="k">import</span> <span class="n">reltime_str_to_seconds</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="k">import</span> <span class="n">ceil</span>
<span class="kn">from</span> <span class="nn">os</span> <span class="k">import</span> <span class="n">path</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="k">import</span> <span class="n">sleep</span>
<span class="kn">import</span> <span class="nn">xml.etree.ElementTree</span> <span class="k">as</span> <span class="nn">ET</span>
<span class="kn">from</span> <span class="nn">sonos.services.common</span> <span class="k">import</span> <span class="n">XMLAccessor</span>
<span class="kn">from</span> <span class="nn">distutils.util</span> <span class="k">import</span> <span class="n">strtobool</span>

<span class="kn">import</span> <span class="nn">logging</span>

<span class="c1"># Only log CRITICAL messages for the following modules</span>
<span class="n">modules</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;SONOS.coherence.upnp&#39;</span><span class="p">,</span>
    <span class="s1">&#39;SONOS.sonos.client&#39;</span><span class="p">,</span>
    <span class="s1">&#39;SONOS.sonos.services&#39;</span><span class="p">,</span>
    <span class="s1">&#39;SONOS.sonos.upnp&#39;</span><span class="p">,</span>
    <span class="s1">&#39;SONOS.telnet_client&#39;</span><span class="p">,</span>
    <span class="s1">&#39;SONOS.UDPLogger&#39;</span><span class="p">]</span>

<span class="k">for</span> <span class="n">module</span> <span class="ow">in</span> <span class="n">modules</span><span class="p">:</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">module</span><span class="p">)</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">CRITICAL</span><span class="p">)</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Temporary counter for diagnostics until SWPBL-82524 is fixed</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="n">DIAG_COUNTER</span> <span class="o">=</span> <span class="mi">0</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Current TRUELAY_VERSION under test</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="n">TRUEPLAY_VERSION</span> <span class="o">=</span> <span class="s1">&#39;2.8.0.0&#39;</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Use the Trueplay staging/test server instead of the production instance.</span>
<span class="sd">Global switch to enable the test server usage in all tests.</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="n">USE_TEST_SERVER</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">TEST_SERVER_STRING_ID</span> <span class="o">=</span> <span class="s1">&#39;O_SONAR_SERVER_URL&#39;</span>
<span class="n">TEST_SERVER_URL</span> <span class="o">=</span> <span class="s1">&#39;https://sonar-test.ws.sonos.com&#39;</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">List of supported testbed components. Any component not in the testbed</span>
<span class="sd">can be disabled from being tested here by setting the value to False.</span>
<span class="sd">All AIO devices require at least 2 units per model for stereo pairs</span>
<span class="sd">and HT surround calibrations. Only one HT unit is required per HT model.</span>
<span class="sd">At least ONE orientation supported AIO + SAT capable model needs to be True,</span>
<span class="sd">otherwise some tests cannot run. (S3 or S6)</span>
<span class="sd">NOTE:</span>
<span class="sd">SUB &amp; Playbar(S9) cannot be excluded presently and</span>
<span class="sd">are required to be in the testbed.</span>
<span class="sd">Testing S1 pairs requires an S12 as well.</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="n">DEFAULT_AUDIOPERF_TESTBED</span> <span class="o">=</span> <span class="s1">&#39;DEFAULT_AUDIOPERF_TESTBED&#39;</span>
<span class="n">LEGACY_AUDIOPERF_TESTBED</span> <span class="o">=</span> <span class="s1">&#39;LEGACY_AUDIOPERF_TESTBED&#39;</span>

<span class="n">SUPPORTED_MODELS_DICT</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">DEFAULT_AUDIOPERF_TESTBED</span><span class="p">:</span> <span class="p">{</span>
        <span class="n">S1</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">S3</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">S5</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">S6</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">S9</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">S11</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">S12</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">S13</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">S14</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">S16</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">S17</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">S18</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">S21</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">S22</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">S23</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">ZP120</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">SUB</span><span class="p">:</span> <span class="kc">True</span>
    <span class="p">},</span>
    <span class="n">LEGACY_AUDIOPERF_TESTBED</span><span class="p">:</span> <span class="p">{</span>
        <span class="n">S1</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">S3</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">S5</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">S6</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">S9</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">S11</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">S12</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">S13</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">S14</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">S16</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">S17</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">S18</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">S21</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">S22</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">S23</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">ZP120</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">SUB</span><span class="p">:</span> <span class="kc">True</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">TESTBED_TYPE</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;JOB_LABEL&#39;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">TESTBED_TYPE</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">SUPPORTED_MODELS_DICT</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="n">TESTBED_TYPE</span> <span class="o">=</span> <span class="n">DEFAULT_AUDIOPERF_TESTBED</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">TESTBED_SUPPORTED_MODELS</span> <span class="o">=</span> <span class="n">SUPPORTED_MODELS_DICT</span><span class="p">[</span><span class="n">TESTBED_TYPE</span><span class="p">]</span>

<span class="n">TESTBED_REQUIRED_DEVICE_COUNT</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">S1</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">S3</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="n">S5</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="n">S6</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="n">S9</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">S11</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">S12</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">S13</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">S14</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">S16</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="n">S17</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">S18</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">S21</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">S22</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">S23</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">ZP120</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">SUB</span><span class="p">:</span> <span class="mi">1</span>
<span class="p">}</span>

<span class="c1"># Internal testbed / debuging</span>
<span class="c1"># TESTBED_SUPPORTED_MODELS = {</span>
<span class="c1">#     S1: False,</span>
<span class="c1">#     S3: False,</span>
<span class="c1">#     S5: False,</span>
<span class="c1">#     S6: False,</span>
<span class="c1">#     S11: False,</span>
<span class="c1">#     S12: True,</span>
<span class="c1">#     S13: False,</span>
<span class="c1">#     S14: False,</span>
<span class="c1">#     ZP120: True</span>
<span class="c1"># }</span>


<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">List of diagnostic log levels to be applied to each ZP under test</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="n">DIAG_LEVEL_LIST</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;chsrc&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;chsnk&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;dp_impl&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span>
                   <span class="p">(</span><span class="s1">&#39;cm_socal&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;xmlpost&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;sonoscp&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
                   <span class="p">(</span><span class="s1">&#39;rc_impl&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;upnp&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)]</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Calibration modes</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="n">SPECTRAL_MODE</span> <span class="o">=</span> <span class="s1">&#39;spectral&#39;</span>
<span class="n">SPATIAL_MODE</span> <span class="o">=</span> <span class="s1">&#39;spatial&#39;</span>
<span class="n">CALIBRATION_MODES</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">SPATIAL_MODE</span><span class="p">,</span> <span class="n">SPECTRAL_MODE</span><span class="p">])</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Coefficient types/ids. Used to identify coefficient templates, as well as</span>
<span class="sd">the ID for the applied coefficient in the player.</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="n">AIO_SPECTRAL_COEFFICIENT</span> <span class="o">=</span> <span class="s1">&#39;aio_spectral_coefficient&#39;</span>
<span class="n">SUB_SPECTRAL_COEFFICIENT</span> <span class="o">=</span> <span class="s1">&#39;sub_spectral_coefficient&#39;</span>
<span class="n">PBAR_SPATIAL_COEFFICIENT</span> <span class="o">=</span> <span class="s1">&#39;pbar_spatial_coefficient&#39;</span>
<span class="n">PBAR_SPECTRAL_COEFFICIENT</span> <span class="o">=</span> <span class="s1">&#39;pbar_spectral_coefficient&#39;</span>
<span class="n">SOL_SPATIAL_COEFFICIENT</span> <span class="o">=</span> <span class="s1">&#39;sol_spatial_coefficient&#39;</span>
<span class="n">SOL_SPECTRAL_COEFFICIENT</span> <span class="o">=</span> <span class="s1">&#39;sol_spectral_coefficient&#39;</span>
<span class="n">ELREY_SPATIAL_COEFFICIENT</span> <span class="o">=</span> <span class="s1">&#39;elrey_spatial_coefficient&#39;</span>
<span class="n">ELREY_SPECTRAL_COEFFICIENT</span> <span class="o">=</span> <span class="s1">&#39;elrey_spectral_coefficient&#39;</span>
<span class="n">HIDEOUT_SPATIAL_COEFFICIENT</span> <span class="o">=</span> <span class="s1">&#39;hideout_spatial_coefficient&#39;</span>
<span class="n">HIDEOUT_SPECTRAL_COEFFICIENT</span> <span class="o">=</span> <span class="s1">&#39;hideout_spectral_coefficient&#39;</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Dict of coefficient files containing templates for the given</span>
<span class="sd">coefficient types.</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="n">MOCK_COEFFICIENT_FILES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">AIO_SPECTRAL_COEFFICIENT</span><span class="p">:</span> <span class="s1">&#39;Coefficients_Spectral_AIO.xml&#39;</span><span class="p">,</span>
    <span class="n">SUB_SPECTRAL_COEFFICIENT</span><span class="p">:</span> <span class="s1">&#39;Coefficients_Spectral_SUB.xml&#39;</span><span class="p">,</span>
    <span class="n">PBAR_SPATIAL_COEFFICIENT</span><span class="p">:</span> <span class="s1">&#39;Coefficients_Spatial_PBAR.xml&#39;</span><span class="p">,</span>
    <span class="n">PBAR_SPECTRAL_COEFFICIENT</span><span class="p">:</span> <span class="s1">&#39;Coefficients_Spectral_PBAR.xml&#39;</span><span class="p">,</span>
    <span class="n">SOL_SPATIAL_COEFFICIENT</span><span class="p">:</span> <span class="s1">&#39;Coefficients_Spatial_SOL.xml&#39;</span><span class="p">,</span>
    <span class="n">SOL_SPECTRAL_COEFFICIENT</span><span class="p">:</span> <span class="s1">&#39;Coefficients_Spectral_SOL.xml&#39;</span><span class="p">,</span>
    <span class="n">ELREY_SPATIAL_COEFFICIENT</span><span class="p">:</span> <span class="s1">&#39;Coefficients_Spatial_ELREY.xml&#39;</span><span class="p">,</span>
    <span class="n">ELREY_SPECTRAL_COEFFICIENT</span><span class="p">:</span> <span class="s1">&#39;Coefficients_Spectral_ELREY.xml&#39;</span><span class="p">,</span>
    <span class="n">HIDEOUT_SPATIAL_COEFFICIENT</span><span class="p">:</span> <span class="s1">&#39;Coefficients_Spatial_HIDEOUT.xml&#39;</span><span class="p">,</span>
    <span class="n">HIDEOUT_SPECTRAL_COEFFICIENT</span><span class="p">:</span> <span class="s1">&#39;Coefficients_Spectral_HIDEOUT.xml&#39;</span>
<span class="p">}</span>

<span class="n">ALTERNATE_SPATIAL_COEFFS_FILES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">S9</span><span class="p">:</span> <span class="s1">&#39;Coefficients_Spatial_ALT_PBAR.xml&#39;</span><span class="p">,</span>
    <span class="n">S11</span><span class="p">:</span> <span class="s1">&#39;Coefficients_Spatial_ALT_SOL.xml&#39;</span><span class="p">,</span>
    <span class="n">S14</span><span class="p">:</span> <span class="s1">&#39;Coefficients_Spatial_ALT_ELREY.xml&#39;</span><span class="p">,</span>
    <span class="n">S16</span><span class="p">:</span> <span class="s1">&#39;Coefficients_Spatial_ALT_HIDEOUT.xml&#39;</span>
<span class="p">}</span>

<span class="n">COEFFICIENT_FILE_TYPES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">SPECTRAL_MODE</span><span class="p">:</span> <span class="p">{</span>
        <span class="n">S1</span><span class="p">:</span> <span class="n">AIO_SPECTRAL_COEFFICIENT</span><span class="p">,</span>
        <span class="n">S3</span><span class="p">:</span> <span class="n">AIO_SPECTRAL_COEFFICIENT</span><span class="p">,</span>
        <span class="n">S5</span><span class="p">:</span> <span class="n">AIO_SPECTRAL_COEFFICIENT</span><span class="p">,</span>
        <span class="n">S6</span><span class="p">:</span> <span class="n">AIO_SPECTRAL_COEFFICIENT</span><span class="p">,</span>
        <span class="n">S9</span><span class="p">:</span> <span class="n">PBAR_SPECTRAL_COEFFICIENT</span><span class="p">,</span>
        <span class="n">S11</span><span class="p">:</span> <span class="n">SOL_SPECTRAL_COEFFICIENT</span><span class="p">,</span>
        <span class="n">S12</span><span class="p">:</span> <span class="n">AIO_SPECTRAL_COEFFICIENT</span><span class="p">,</span>
        <span class="n">S13</span><span class="p">:</span> <span class="n">AIO_SPECTRAL_COEFFICIENT</span><span class="p">,</span>
        <span class="n">S14</span><span class="p">:</span> <span class="n">ELREY_SPECTRAL_COEFFICIENT</span><span class="p">,</span>
        <span class="n">S16</span><span class="p">:</span> <span class="n">HIDEOUT_SPECTRAL_COEFFICIENT</span><span class="p">,</span>
        <span class="n">S18</span><span class="p">:</span> <span class="n">AIO_SPECTRAL_COEFFICIENT</span><span class="p">,</span>
        <span class="n">S22</span><span class="p">:</span> <span class="n">AIO_SPECTRAL_COEFFICIENT</span><span class="p">,</span>
        <span class="n">ZP120</span><span class="p">:</span> <span class="n">AIO_SPECTRAL_COEFFICIENT</span><span class="p">,</span>
        <span class="n">SUB</span><span class="p">:</span> <span class="n">SUB_SPECTRAL_COEFFICIENT</span>
    <span class="p">},</span>
    <span class="n">SPATIAL_MODE</span><span class="p">:</span> <span class="p">{</span>
        <span class="n">S9</span><span class="p">:</span> <span class="n">PBAR_SPATIAL_COEFFICIENT</span><span class="p">,</span>
        <span class="n">S11</span><span class="p">:</span> <span class="n">SOL_SPATIAL_COEFFICIENT</span><span class="p">,</span>
        <span class="n">S14</span><span class="p">:</span> <span class="n">ELREY_SPATIAL_COEFFICIENT</span><span class="p">,</span>
        <span class="n">S16</span><span class="p">:</span> <span class="n">HIDEOUT_SPATIAL_COEFFICIENT</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Trueplay Devices structure. Orientation units require additional testing</span>
<span class="sd">thus giving them their own data structure.</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="n">TRUEPLAY_DEVICES_WITHOUT_ORIENTATION</span> <span class="o">=</span> <span class="p">(</span>
    <span class="nb">set</span><span class="p">([</span><span class="n">S1</span><span class="p">,</span> <span class="n">S5</span><span class="p">,</span> <span class="n">S11</span><span class="p">,</span> <span class="n">S12</span><span class="p">,</span> <span class="n">S13</span><span class="p">,</span> <span class="n">S14</span><span class="p">,</span> <span class="n">S16</span><span class="p">,</span> <span class="n">S18</span><span class="p">]))</span>
<span class="n">TRUEPLAY_DEVICES_WITH_ORIENTATION</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">S3</span><span class="p">,</span> <span class="n">S6</span><span class="p">,</span> <span class="n">S9</span><span class="p">])</span>
<span class="n">TRUEPLAY_AIO_DEVICES</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">TRUEPLAY_DEVICES_WITHOUT_ORIENTATION</span> <span class="o">|</span> <span class="n">TRUEPLAY_DEVICES_WITH_ORIENTATION</span><span class="p">)</span>
<span class="n">TRUEPLAY_DEVICES</span> <span class="o">=</span> <span class="p">(</span><span class="n">TRUEPLAY_AIO_DEVICES</span> <span class="o">|</span> <span class="nb">set</span><span class="p">([</span><span class="n">SUB</span><span class="p">,</span> <span class="n">ZP120</span><span class="p">]))</span>

<span class="n">TRUEPLAY_HT_DEVICES_WITH_ORIENTATION</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">S9</span><span class="p">])</span>
<span class="n">TRUEPLAY_HT_DEVICES_WITHOUT_ORIENTATION</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">S11</span><span class="p">,</span> <span class="n">S14</span><span class="p">,</span> <span class="n">S16</span><span class="p">])</span>
<span class="n">TRUEPLAY_HT_DEVICES</span> <span class="o">=</span> <span class="p">(</span><span class="n">TRUEPLAY_HT_DEVICES_WITH_ORIENTATION</span>
                       <span class="o">|</span> <span class="n">TRUEPLAY_HT_DEVICES_WITHOUT_ORIENTATION</span><span class="p">)</span>

<span class="n">TRUEPLAY_HT_DEVICES_WITHOUT_SPATIAL_STANDALONE</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">S16</span><span class="p">])</span>
<span class="n">TRUEPLAY_HT_DEVICES_WITH_SPATIAL_STANDALONE</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">TRUEPLAY_HT_DEVICES</span> <span class="o">-</span> <span class="n">TRUEPLAY_HT_DEVICES_WITHOUT_SPATIAL_STANDALONE</span><span class="p">)</span>

<span class="n">TRUEPLAY_SATS_WITHOUT_ORIENTATION</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">S1</span><span class="p">,</span> <span class="n">S12</span><span class="p">,</span> <span class="n">S13</span><span class="p">,</span> <span class="n">S16</span><span class="p">,</span> <span class="n">S18</span><span class="p">,</span> <span class="n">ZP120</span><span class="p">])</span>
<span class="n">TRUEPLAY_SATS_WITH_ORIENTATION</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">S3</span><span class="p">,</span> <span class="n">S6</span><span class="p">])</span>
<span class="n">TRUEPLAY_SATS</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">TRUEPLAY_SATS_WITH_ORIENTATION</span> <span class="o">|</span> <span class="n">TRUEPLAY_SATS_WITHOUT_ORIENTATION</span><span class="p">)</span>

<span class="n">TRUEPLAY_GENERATOR_SETS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">TRUEPLAY_DEVICES_WITHOUT_ORIENTATION</span><span class="p">,</span>
    <span class="n">TRUEPLAY_DEVICES_WITH_ORIENTATION</span><span class="p">,</span>
    <span class="n">TRUEPLAY_AIO_DEVICES</span><span class="p">,</span>
    <span class="n">TRUEPLAY_DEVICES</span><span class="p">,</span>
    <span class="n">TRUEPLAY_HT_DEVICES_WITH_ORIENTATION</span><span class="p">,</span>
    <span class="n">TRUEPLAY_HT_DEVICES_WITHOUT_ORIENTATION</span><span class="p">,</span>
    <span class="n">TRUEPLAY_HT_DEVICES_WITH_SPATIAL_STANDALONE</span><span class="p">,</span>
    <span class="n">TRUEPLAY_HT_DEVICES_WITHOUT_SPATIAL_STANDALONE</span><span class="p">,</span>
    <span class="n">TRUEPLAY_HT_DEVICES</span><span class="p">,</span>
    <span class="n">TRUEPLAY_SATS_WITHOUT_ORIENTATION</span><span class="p">,</span>
    <span class="n">TRUEPLAY_SATS_WITH_ORIENTATION</span><span class="p">,</span>
    <span class="n">TRUEPLAY_SATS</span>
<span class="p">]</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Dict of player DSP IDs for use when formatting AIO coefficients.</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="n">PLAYER_DSP_IDS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">S1</span><span class="p">:</span> <span class="s1">&#39;DSPPlay1.RoomIIR&#39;</span><span class="p">,</span>
    <span class="n">S3</span><span class="p">:</span> <span class="s1">&#39;DSPPlay3.RoomIIR&#39;</span><span class="p">,</span>
    <span class="n">S5</span><span class="p">:</span> <span class="s1">&#39;DSPPlay5.RoomIIR&#39;</span><span class="p">,</span>
    <span class="n">S6</span><span class="p">:</span> <span class="s1">&#39;DSPEncore.RoomIIR&#39;</span><span class="p">,</span>
    <span class="n">S12</span><span class="p">:</span> <span class="s1">&#39;DSPPlay1.RoomIIR&#39;</span><span class="p">,</span>
    <span class="n">S13</span><span class="p">:</span> <span class="s1">&#39;DSPPlay1.RoomIIR&#39;</span><span class="p">,</span>
    <span class="n">S18</span><span class="p">:</span> <span class="s1">&#39;DSPPlay1.RoomIIR&#39;</span><span class="p">,</span>
    <span class="n">S22</span><span class="p">:</span> <span class="s1">&#39;DSPPlay1.RoomIIR&#39;</span><span class="p">,</span>
    <span class="n">ZP120</span><span class="p">:</span> <span class="s1">&#39;DSPConnect.RoomIIR&#39;</span>
<span class="p">}</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Dict of coefficient templates, populated at runtime/init by reading</span>
<span class="sd">in the coefficient template files as a single string</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="n">MOCK_COEFFICIENT_TEMPLATES</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">file_type</span><span class="p">,</span> <span class="n">file_name</span> <span class="ow">in</span> <span class="n">MOCK_COEFFICIENT_FILES</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
    <span class="n">file_path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)),</span> <span class="n">file_name</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">coefficient_file</span><span class="p">:</span>
        <span class="n">MOCK_COEFFICIENT_TEMPLATES</span><span class="p">[</span><span class="n">file_type</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">coefficient_file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Bonded Sonos types</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="n">STANDALONE</span> <span class="o">=</span> <span class="s1">&#39;standalone&#39;</span>
<span class="n">STANDALONE_SUB</span> <span class="o">=</span> <span class="s1">&#39;standalone_sub&#39;</span>
<span class="n">STEREO_PAIR</span> <span class="o">=</span> <span class="s1">&#39;stereo_pair&#39;</span>
<span class="n">STEREO_PAIR_SUB</span> <span class="o">=</span> <span class="s1">&#39;stereo_pair_sub&#39;</span>
<span class="n">HT_STANDALONE</span> <span class="o">=</span> <span class="s1">&#39;ht_standalone&#39;</span>
<span class="n">HT_STANDALONE_SUB</span> <span class="o">=</span> <span class="s1">&#39;ht_standalone_sub&#39;</span>
<span class="n">HT_SURROUNDS</span> <span class="o">=</span> <span class="s1">&#39;ht_surrounds&#39;</span>
<span class="n">HT_SURROUNDS_SUB</span> <span class="o">=</span> <span class="s1">&#39;ht_surrounds_sub&#39;</span>
<span class="c1"># Used when you want the program to determine if the standalone type is</span>
<span class="c1">#   HT standalone or normal standalone.</span>
<span class="n">UNKNOWN_STANDALONE</span> <span class="o">=</span> <span class="s1">&#39;unknown_standalone&#39;</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Array of bonded Sonos types</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="n">AIO_BONDED_TYPES</span> <span class="o">=</span> <span class="p">(</span>
    <span class="nb">set</span><span class="p">([</span><span class="n">STANDALONE</span><span class="p">,</span> <span class="n">STANDALONE_SUB</span><span class="p">,</span> <span class="n">STEREO_PAIR</span><span class="p">,</span> <span class="n">STEREO_PAIR_SUB</span><span class="p">]))</span>
<span class="n">HT_BONDED_TYPES</span> <span class="o">=</span> <span class="p">(</span>
    <span class="nb">set</span><span class="p">([</span><span class="n">HT_STANDALONE</span><span class="p">,</span> <span class="n">HT_STANDALONE_SUB</span><span class="p">,</span> <span class="n">HT_SURROUNDS</span><span class="p">,</span> <span class="n">HT_SURROUNDS_SUB</span><span class="p">]))</span>
<span class="n">BONDED_TYPES</span> <span class="o">=</span> <span class="n">AIO_BONDED_TYPES</span> <span class="o">|</span> <span class="n">HT_BONDED_TYPES</span>


<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Dict of Trueplay tone types (Used in EnterConfigMode calls)</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="n">NAME</span> <span class="o">=</span> <span class="s1">&#39;name&#39;</span>
<span class="n">TYPE</span> <span class="o">=</span> <span class="s1">&#39;type&#39;</span>
<span class="n">TRUEPLAY_TONES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">STANDALONE</span><span class="p">:</span> <span class="p">{</span><span class="n">NAME</span><span class="p">:</span> <span class="s1">&#39;HybridMono250Hz16K&#39;</span><span class="p">,</span> <span class="n">TYPE</span><span class="p">:</span> <span class="s1">&#39;flac&#39;</span><span class="p">},</span>
    <span class="n">STANDALONE_SUB</span><span class="p">:</span> <span class="p">{</span><span class="n">NAME</span><span class="p">:</span> <span class="s1">&#39;HybridMonoSUB250Hz32K&#39;</span><span class="p">,</span> <span class="n">TYPE</span><span class="p">:</span> <span class="s1">&#39;flac&#39;</span><span class="p">},</span>
    <span class="n">STEREO_PAIR</span><span class="p">:</span> <span class="p">{</span><span class="n">NAME</span><span class="p">:</span> <span class="s1">&#39;HybridStereo250Hz32K&#39;</span><span class="p">,</span> <span class="n">TYPE</span><span class="p">:</span> <span class="s1">&#39;flac&#39;</span><span class="p">},</span>
    <span class="n">STEREO_PAIR_SUB</span><span class="p">:</span> <span class="p">{</span><span class="n">NAME</span><span class="p">:</span> <span class="s1">&#39;HybridStereoSub150Hz64K&#39;</span><span class="p">,</span> <span class="n">TYPE</span><span class="p">:</span> <span class="s1">&#39;flac&#39;</span><span class="p">},</span>
    <span class="n">HT_STANDALONE</span><span class="p">:</span> <span class="p">{</span><span class="n">NAME</span><span class="p">:</span> <span class="s1">&#39;HybridLCR150Hz64K&#39;</span><span class="p">,</span> <span class="n">TYPE</span><span class="p">:</span> <span class="s1">&#39;ogg&#39;</span><span class="p">},</span>
    <span class="n">HT_STANDALONE_SUB</span><span class="p">:</span> <span class="p">{</span><span class="n">NAME</span><span class="p">:</span> <span class="s1">&#39;HybridLCRSUB150Hz64K&#39;</span><span class="p">,</span> <span class="n">TYPE</span><span class="p">:</span> <span class="s1">&#39;ogg&#39;</span><span class="p">},</span>
    <span class="n">HT_SURROUNDS</span><span class="p">:</span> <span class="p">{</span><span class="n">NAME</span><span class="p">:</span> <span class="s1">&#39;HybridLCRSUR150Hz128K&#39;</span><span class="p">,</span> <span class="n">TYPE</span><span class="p">:</span> <span class="s1">&#39;ogg&#39;</span><span class="p">},</span>
    <span class="n">HT_SURROUNDS_SUB</span><span class="p">:</span> <span class="p">{</span><span class="n">NAME</span><span class="p">:</span> <span class="s1">&#39;HybridLCRSURSUB150Hz128K&#39;</span><span class="p">,</span> <span class="n">TYPE</span><span class="p">:</span> <span class="s1">&#39;ogg&#39;</span><span class="p">}</span>
<span class="p">}</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Dict of Trueplay leader and completion tone titles and types</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="n">LEADER</span> <span class="o">=</span> <span class="s1">&#39;leader&#39;</span>
<span class="n">TESTTONE</span> <span class="o">=</span> <span class="s1">&#39;testtone&#39;</span>
<span class="n">COMPLETE</span> <span class="o">=</span> <span class="s1">&#39;complete&#39;</span>
<span class="n">TRUEPLAY_TONE_FILE_TEMPLATE</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">LEADER</span><span class="p">:</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">-leader.ogg&#39;</span><span class="p">,</span>
    <span class="n">TESTTONE</span><span class="p">:</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">-testtone.</span><span class="si">{}</span><span class="s1">&#39;</span><span class="p">,</span>
    <span class="n">COMPLETE</span><span class="p">:</span> <span class="s1">&#39;complete</span><span class="si">{}</span><span class="s1">.ogg&#39;</span>
<span class="p">}</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Enter/Exit Config Mode parameters</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="n">CALIBRATION_STATE</span> <span class="o">=</span> <span class="s2">&quot;room_calibration-calibrate&quot;</span>
<span class="n">CALIBRATE_OPTIONS</span> <span class="o">=</span> <span class="s2">&quot;ver=</span><span class="si">{}</span><span class="s2">&amp;tone=</span><span class="si">{}</span><span class="s2">&amp;polarity=</span><span class="si">{}</span><span class="s2">&amp;volume=</span><span class="si">{}</span><span class="s2">&quot;</span>
<span class="n">HT_CALIBRATE_OPTIONS</span> <span class="o">=</span> <span class="s2">&quot;&amp;mode=</span><span class="si">{}</span><span class="s2">&quot;</span>
<span class="n">CALIBRATE_SUCCESS</span> <span class="o">=</span> <span class="s2">&quot;success=1&quot;</span>
<span class="n">CALIBRATE_FAIL</span> <span class="o">=</span> <span class="s2">&quot;success=0&quot;</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Dict literal of expected SUB polarities when in config mode.</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="n">SUB_POLARITY</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="n">S1</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">S3</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">S5</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">S6</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">S9</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">S11</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">S12</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">S13</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">S14</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">S16</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">S18</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">ZP120</span><span class="o">=</span><span class="mi">1</span>
<span class="p">)</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Dict of players that should have an inverted polarity</span>
<span class="sd">when the calibration tone is playing. Used in sub_polarity.py</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="n">INVERTED</span> <span class="o">=</span> <span class="s1">&#39;inverted&#39;</span>
<span class="n">NORMAL</span> <span class="o">=</span> <span class="s1">&#39;normal&#39;</span>
<span class="n">CALIBRATION_START_POLARITY</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="n">S1</span><span class="o">=</span><span class="n">INVERTED</span><span class="p">,</span>
    <span class="n">S3</span><span class="o">=</span><span class="n">NORMAL</span><span class="p">,</span>
    <span class="n">S5</span><span class="o">=</span><span class="n">NORMAL</span><span class="p">,</span>
    <span class="n">S6</span><span class="o">=</span><span class="n">NORMAL</span><span class="p">,</span>
    <span class="n">S9</span><span class="o">=</span><span class="n">NORMAL</span><span class="p">,</span>
    <span class="n">S11</span><span class="o">=</span><span class="n">NORMAL</span><span class="p">,</span>
    <span class="n">S12</span><span class="o">=</span><span class="n">INVERTED</span><span class="p">,</span>
    <span class="n">S13</span><span class="o">=</span><span class="n">INVERTED</span><span class="p">,</span>
    <span class="n">S14</span><span class="o">=</span><span class="n">INVERTED</span><span class="p">,</span>
    <span class="n">S16</span><span class="o">=</span><span class="n">NORMAL</span><span class="p">,</span>
    <span class="n">S18</span><span class="o">=</span><span class="n">INVERTED</span><span class="p">,</span>
    <span class="n">ZP120</span><span class="o">=</span><span class="n">NORMAL</span>
<span class="p">)</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Dict of players that should have an inverted polarity</span>
<span class="sd">when the we are mid-tune, in a HT calibration.</span>
<span class="sd">Post spatial, tuning now in spectral.</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="n">CALIBRATION_MIDTUNE_POLARITY</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="n">S1</span><span class="o">=</span><span class="n">NORMAL</span><span class="p">,</span>
    <span class="n">S3</span><span class="o">=</span><span class="n">NORMAL</span><span class="p">,</span>
    <span class="n">S5</span><span class="o">=</span><span class="n">INVERTED</span><span class="p">,</span>
    <span class="n">S6</span><span class="o">=</span><span class="n">INVERTED</span><span class="p">,</span>
    <span class="n">S9</span><span class="o">=</span><span class="n">INVERTED</span><span class="p">,</span>
    <span class="n">S11</span><span class="o">=</span><span class="n">INVERTED</span><span class="p">,</span>
    <span class="n">S12</span><span class="o">=</span><span class="n">NORMAL</span><span class="p">,</span>
    <span class="n">S13</span><span class="o">=</span><span class="n">NORMAL</span><span class="p">,</span>
    <span class="n">S14</span><span class="o">=</span><span class="n">NORMAL</span><span class="p">,</span>
    <span class="n">S16</span><span class="o">=</span><span class="n">INVERTED</span><span class="p">,</span>
    <span class="n">S18</span><span class="o">=</span><span class="n">NORMAL</span><span class="p">,</span>
    <span class="n">ZP120</span><span class="o">=</span><span class="n">INVERTED</span>
<span class="p">)</span>

<span class="n">STANDALONE</span> <span class="o">=</span> <span class="s1">&#39;standalone&#39;</span>
<span class="n">STANDALONE_SUB</span> <span class="o">=</span> <span class="s1">&#39;standalone_sub&#39;</span>
<span class="n">STEREO_PAIR</span> <span class="o">=</span> <span class="s1">&#39;stereo_pair&#39;</span>
<span class="n">STEREO_PAIR_SUB</span> <span class="o">=</span> <span class="s1">&#39;stereo_pair_sub&#39;</span>
<span class="n">HT_STANDALONE</span> <span class="o">=</span> <span class="s1">&#39;ht_standalone&#39;</span>
<span class="n">HT_STANDALONE_SUB</span> <span class="o">=</span> <span class="s1">&#39;ht_standalone_sub&#39;</span>
<span class="n">HT_SURROUNDS</span> <span class="o">=</span> <span class="s1">&#39;ht_surrounds&#39;</span>
<span class="n">HT_SURROUNDS_SUB</span> <span class="o">=</span> <span class="s1">&#39;ht_surrounds_sub&#39;</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Dict of expected UI Volumes when entering config mode</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="n">UI_VOLUMES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">S1</span><span class="p">:</span> <span class="p">{</span>
        <span class="n">STANDALONE</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>
        <span class="n">STANDALONE_SUB</span><span class="p">:</span> <span class="mi">62</span><span class="p">,</span>
        <span class="n">STEREO_PAIR</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>
        <span class="n">STEREO_PAIR_SUB</span><span class="p">:</span> <span class="mi">60</span>
    <span class="p">},</span>
    <span class="n">S3</span><span class="p">:</span> <span class="p">{</span>
        <span class="n">STANDALONE</span><span class="p">:</span> <span class="mi">53</span><span class="p">,</span>
        <span class="n">STANDALONE_SUB</span><span class="p">:</span> <span class="mi">65</span><span class="p">,</span>
        <span class="n">STEREO_PAIR</span><span class="p">:</span> <span class="mi">53</span><span class="p">,</span>
        <span class="n">STEREO_PAIR_SUB</span><span class="p">:</span> <span class="mi">63</span>
    <span class="p">},</span>
    <span class="n">S5</span><span class="p">:</span> <span class="p">{</span>
        <span class="n">STANDALONE</span><span class="p">:</span> <span class="mi">53</span><span class="p">,</span>
        <span class="n">STANDALONE_SUB</span><span class="p">:</span> <span class="mi">65</span><span class="p">,</span>
        <span class="n">STEREO_PAIR</span><span class="p">:</span> <span class="mi">53</span><span class="p">,</span>
        <span class="n">STEREO_PAIR_SUB</span><span class="p">:</span> <span class="mi">63</span>
    <span class="p">},</span>
    <span class="n">S6</span><span class="p">:</span> <span class="p">{</span>
        <span class="n">STANDALONE</span><span class="p">:</span> <span class="mi">53</span><span class="p">,</span>
        <span class="n">STANDALONE_SUB</span><span class="p">:</span> <span class="mi">65</span><span class="p">,</span>
        <span class="n">STEREO_PAIR</span><span class="p">:</span> <span class="mi">53</span><span class="p">,</span>
        <span class="n">STEREO_PAIR_SUB</span><span class="p">:</span> <span class="mi">63</span>
    <span class="p">},</span>
    <span class="n">S9</span><span class="p">:</span> <span class="p">{</span>
        <span class="n">HT_STANDALONE</span><span class="p">:</span> <span class="mi">53</span><span class="p">,</span>
        <span class="n">HT_STANDALONE_SUB</span><span class="p">:</span> <span class="mi">53</span><span class="p">,</span>
        <span class="n">HT_SURROUNDS</span><span class="p">:</span> <span class="mi">53</span><span class="p">,</span>
        <span class="n">HT_SURROUNDS_SUB</span><span class="p">:</span> <span class="mi">53</span>
    <span class="p">},</span>
    <span class="n">S11</span><span class="p">:</span> <span class="p">{</span>
        <span class="n">HT_STANDALONE</span><span class="p">:</span> <span class="mi">53</span><span class="p">,</span>
        <span class="n">HT_STANDALONE_SUB</span><span class="p">:</span> <span class="mi">53</span><span class="p">,</span>
        <span class="n">HT_SURROUNDS</span><span class="p">:</span> <span class="mi">53</span><span class="p">,</span>
        <span class="n">HT_SURROUNDS_SUB</span><span class="p">:</span> <span class="mi">53</span>
    <span class="p">},</span>
    <span class="n">S12</span><span class="p">:</span> <span class="p">{</span>
        <span class="n">STANDALONE</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>
        <span class="n">STANDALONE_SUB</span><span class="p">:</span> <span class="mi">62</span><span class="p">,</span>
        <span class="n">STEREO_PAIR</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>
        <span class="n">STEREO_PAIR_SUB</span><span class="p">:</span> <span class="mi">60</span>
    <span class="p">},</span>
    <span class="n">S13</span><span class="p">:</span> <span class="p">{</span>
        <span class="n">STANDALONE</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>
        <span class="n">STANDALONE_SUB</span><span class="p">:</span> <span class="mi">62</span><span class="p">,</span>
        <span class="n">STEREO_PAIR</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>
        <span class="n">STEREO_PAIR_SUB</span><span class="p">:</span> <span class="mi">60</span>
    <span class="p">},</span>
    <span class="n">S14</span><span class="p">:</span> <span class="p">{</span>
        <span class="n">HT_STANDALONE</span><span class="p">:</span> <span class="mi">53</span><span class="p">,</span>
        <span class="n">HT_STANDALONE_SUB</span><span class="p">:</span> <span class="mi">53</span><span class="p">,</span>
        <span class="n">HT_SURROUNDS</span><span class="p">:</span> <span class="mi">53</span><span class="p">,</span>
        <span class="n">HT_SURROUNDS_SUB</span><span class="p">:</span> <span class="mi">53</span>
    <span class="p">},</span>
    <span class="n">S16</span><span class="p">:</span> <span class="p">{</span>
        <span class="n">STANDALONE</span><span class="p">:</span> <span class="mi">53</span><span class="p">,</span>
        <span class="n">STANDALONE_SUB</span><span class="p">:</span> <span class="mi">65</span><span class="p">,</span>
        <span class="n">STEREO_PAIR</span><span class="p">:</span> <span class="mi">53</span><span class="p">,</span>
        <span class="n">STEREO_PAIR_SUB</span><span class="p">:</span> <span class="mi">63</span><span class="p">,</span>
        <span class="n">HT_SURROUNDS</span><span class="p">:</span> <span class="mi">53</span><span class="p">,</span>
        <span class="n">HT_SURROUNDS_SUB</span><span class="p">:</span> <span class="mi">53</span>
    <span class="p">},</span>
    <span class="n">S18</span><span class="p">:</span> <span class="p">{</span>
        <span class="n">STANDALONE</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>
        <span class="n">STANDALONE_SUB</span><span class="p">:</span> <span class="mi">62</span><span class="p">,</span>
        <span class="n">STEREO_PAIR</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>
        <span class="n">STEREO_PAIR_SUB</span><span class="p">:</span> <span class="mi">60</span>
    <span class="p">},</span>
    <span class="n">ZP120</span><span class="p">:</span> <span class="p">{</span>
        <span class="n">STANDALONE</span><span class="p">:</span> <span class="mi">53</span><span class="p">,</span>
        <span class="n">STANDALONE_SUB</span><span class="p">:</span> <span class="mi">65</span><span class="p">,</span>
        <span class="n">STEREO_PAIR</span><span class="p">:</span> <span class="mi">53</span><span class="p">,</span>
        <span class="n">STEREO_PAIR_SUB</span><span class="p">:</span> <span class="mi">63</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Sonar states</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="n">ENABLED</span> <span class="o">=</span> <span class="s1">&#39;enabled&#39;</span>
<span class="n">AVAILABLE</span> <span class="o">=</span> <span class="s1">&#39;available&#39;</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Sonar Topology state bundling Sonar states</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="n">SONARSTATE_UNDEFINED</span> <span class="o">=</span> <span class="s2">&quot;SONARSTATE_UNDEFINED&quot;</span>
<span class="n">SONARSTATE_ENABLED_AVAILABLE</span> <span class="o">=</span> <span class="s2">&quot;SONARSTATE_ENABLED_AVAILABLE&quot;</span>
<span class="n">SONARSTATE_ENABLED_UNAVAILABLE</span> <span class="o">=</span> <span class="s2">&quot;SONARSTATE_ENABLED_UNAVAILABLE&quot;</span>
<span class="n">SONARSTATE_DISABLED_AVAILABLE</span> <span class="o">=</span> <span class="s2">&quot;SONARSTATE_DISABLED_AVAILABLE&quot;</span>
<span class="n">SONARSTATE_DISABLED_UNAVAILABLE</span> <span class="o">=</span> <span class="s2">&quot;SONARSTATE_DISABLED_UNAVAILABLE&quot;</span>
<span class="n">SONARSTATE_SECONDARY_STATE_IGNORED_BY_CR</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s2">&quot;SONARSTATE_SECONDARY_STATE_IGNORED_BY_CR&quot;</span><span class="p">)</span>
<span class="n">SONARSTATE_NUM_STATES</span> <span class="o">=</span> <span class="s2">&quot;SONARSTATE_NUM_STATES&quot;</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Sonar Topology state enum</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="n">ROOM_CALIBRATION_STATE</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">SONARSTATE_UNDEFINED</span><span class="p">,</span>
    <span class="n">SONARSTATE_ENABLED_AVAILABLE</span><span class="p">,</span>
    <span class="n">SONARSTATE_ENABLED_UNAVAILABLE</span><span class="p">,</span>
    <span class="n">SONARSTATE_DISABLED_AVAILABLE</span><span class="p">,</span>
    <span class="n">SONARSTATE_DISABLED_UNAVAILABLE</span><span class="p">,</span>
    <span class="n">SONARSTATE_SECONDARY_STATE_IGNORED_BY_CR</span><span class="p">,</span>
    <span class="n">SONARSTATE_NUM_STATES</span>
<span class="p">]</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Sonar states mapped to their respective topology bundle state</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="n">ROOM_CALIBRATION_STATE_MAP</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">SONARSTATE_UNDEFINED</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">SONARSTATE_ENABLED_AVAILABLE</span><span class="p">:</span> <span class="p">{</span><span class="n">ENABLED</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="n">AVAILABLE</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
    <span class="n">SONARSTATE_ENABLED_UNAVAILABLE</span><span class="p">:</span> <span class="p">{</span><span class="n">ENABLED</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="n">AVAILABLE</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span>
    <span class="n">SONARSTATE_DISABLED_AVAILABLE</span><span class="p">:</span> <span class="p">{</span><span class="n">ENABLED</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="n">AVAILABLE</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
    <span class="n">SONARSTATE_DISABLED_UNAVAILABLE</span><span class="p">:</span> <span class="p">{</span><span class="n">ENABLED</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="n">AVAILABLE</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span>
    <span class="n">SONARSTATE_SECONDARY_STATE_IGNORED_BY_CR</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">SONARSTATE_NUM_STATES</span><span class="p">:</span> <span class="kc">None</span>
<span class="p">}</span>


<div class="viewcode-block" id="get_topology_state"><a class="viewcode-back" href="../../../../upnp.functional.trueplay.html#upnp.functional.trueplay.base.get_topology_state">[docs]</a><span class="k">def</span> <span class="nf">get_topology_state</span><span class="p">(</span><span class="n">enabled</span><span class="p">,</span> <span class="n">available</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method to map Room states to topology states</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">calibration_state</span> <span class="o">=</span> <span class="p">{</span><span class="n">ENABLED</span><span class="p">:</span> <span class="n">enabled</span><span class="p">,</span> <span class="n">AVAILABLE</span><span class="p">:</span> <span class="n">available</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">ROOM_CALIBRATION_STATE_MAP</span><span class="o">.</span><span class="n">keys</span><span class="p">()[</span>
        <span class="n">ROOM_CALIBRATION_STATE_MAP</span><span class="o">.</span><span class="n">values</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">calibration_state</span><span class="p">)]</span></div>


<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">CIFS Share details</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="n">SHARE</span> <span class="o">=</span> <span class="s1">&#39;//camb-sqa-nas2/automation/cpu/MaggieFarm/&#39;</span>
<span class="n">PRE_TUNE_AV_TRANSPORT_URI</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s1">&#39;x-file-cifs://camb-sqa-nas2/automation/cpu/MaggieFarm/MaggieFarm.mp3&#39;</span><span class="p">)</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Various Static Test data dump</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="n">SONAR_COMPLETION_TONE</span> <span class="o">=</span> <span class="s2">&quot;x-rincon-configmode:sonar-calibrate-complete&quot;</span>
<span class="n">SONAR_CALIBRATION_TONE</span> <span class="o">=</span> <span class="s2">&quot;x-rincon-configmode:sonar-calibrate-tone&quot;</span>
<span class="n">SONAR_COMPLETION_VOLUME</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">COMPLETION_TONE_DURATION</span> <span class="o">=</span> <span class="mf">16.0</span>
<span class="n">INITIAL_VOLUME</span> <span class="o">=</span> <span class="mi">2</span>


<div class="viewcode-block" id="format_tone_files"><a class="viewcode-back" href="../../../../upnp.functional.trueplay.html#upnp.functional.trueplay.base.format_tone_files">[docs]</a><span class="k">def</span> <span class="nf">format_tone_files</span><span class="p">(</span><span class="n">bonded_type</span><span class="p">,</span> <span class="n">tone_type</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Formats a TRUEPLAY_TONE reference into a sequence of trueplay file</span>
<span class="sd">    names that are used when a player goes into config mode. This includes</span>
<span class="sd">    a leader tone, a testtone tone, and a complete tone. These files are</span>
<span class="sd">    formatted by the players internally using the tone reference for</span>
<span class="sd">    a given bonded zone type (Pair, Pair w/ sub, etc). This helper method</span>
<span class="sd">    can be used to manage and host Trueplay tone files locally, if needed, or</span>
<span class="sd">    to verify log messages in the Players when they attempt to download the</span>
<span class="sd">    files, etc.</span>
<span class="sd">    :param bonded_type: TRUEPLAY_TONES reference for a bonded type to be</span>
<span class="sd">    formatted into a tone file reference.</span>
<span class="sd">    :param tone_type: The type of file to return (LEADER, TESTTONE, COMPLETE)</span>
<span class="sd">     If None if given, will return a dict of all 3 tone files for the</span>
<span class="sd">     given reference</span>
<span class="sd">    :return: Dict of tone files for the given reference, or a specific</span>
<span class="sd">    file for the given tone_type</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tone_reference</span> <span class="o">=</span> <span class="n">TRUEPLAY_TONES</span><span class="p">[</span><span class="n">bonded_type</span><span class="p">]</span>
    <span class="n">tone_types</span> <span class="o">=</span> <span class="n">TRUEPLAY_TONE_FILE_TEMPLATE</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="c1"># For now, completion tone is simply divided between HT non HT lines</span>
    <span class="k">if</span> <span class="n">bonded_type</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;ht_&#39;</span><span class="p">):</span>
        <span class="n">completion_formatter</span> <span class="o">=</span> <span class="s1">&#39;_ht&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">completion_formatter</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">tone_types</span><span class="p">[</span><span class="n">LEADER</span><span class="p">]</span> <span class="o">=</span> <span class="n">tone_types</span><span class="p">[</span><span class="n">LEADER</span><span class="p">]</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tone_reference</span><span class="p">[</span><span class="n">NAME</span><span class="p">])</span>
    <span class="n">tone_types</span><span class="p">[</span><span class="n">TESTTONE</span><span class="p">]</span> <span class="o">=</span> <span class="n">tone_types</span><span class="p">[</span><span class="n">TESTTONE</span><span class="p">]</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tone_reference</span><span class="p">[</span><span class="n">NAME</span><span class="p">],</span>
                                                       <span class="n">tone_reference</span><span class="p">[</span><span class="n">TYPE</span><span class="p">])</span>
    <span class="n">tone_types</span><span class="p">[</span><span class="n">COMPLETE</span><span class="p">]</span> <span class="o">=</span> <span class="n">tone_types</span><span class="p">[</span><span class="n">COMPLETE</span><span class="p">]</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">completion_formatter</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">tone_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">tone_types</span>
    <span class="k">return</span> <span class="n">tone_types</span><span class="p">[</span><span class="n">tone_type</span><span class="p">]</span></div>


<div class="viewcode-block" id="generate_tone_files"><a class="viewcode-back" href="../../../../upnp.functional.trueplay.html#upnp.functional.trueplay.base.generate_tone_files">[docs]</a><span class="k">def</span> <span class="nf">generate_tone_files</span><span class="p">(</span><span class="n">bonded_types</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Yields a set of trueplay tone file names for each given bonded type</span>
<span class="sd">    :param bonded_types: array of bonded types to generate tone file names</span>
<span class="sd">    for</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">bonded_type</span> <span class="ow">in</span> <span class="n">bonded_types</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">format_tone_files</span><span class="p">(</span><span class="n">bonded_type</span><span class="p">)</span></div>


<div class="viewcode-block" id="format_coefficient"><a class="viewcode-back" href="../../../../upnp.functional.trueplay.html#upnp.functional.trueplay.base.format_coefficient">[docs]</a><span class="k">def</span> <span class="nf">format_coefficient</span><span class="p">(</span><span class="n">zp</span><span class="p">,</span> <span class="n">calibration_mode</span><span class="o">=</span><span class="n">SPECTRAL_MODE</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Formats and returns a string of xml containing valid coefficients</span>
<span class="sd">    for a given ZP, including its DSP ID, and expected XML data</span>
<span class="sd">    structure.</span>
<span class="sd">    :param :class:`sonos.client.internal.SonosZoneComponent` zp:</span>
<span class="sd">    :param str calibration_mode: &#39;spectral/spatial&#39; coefficient type</span>
<span class="sd">     to be returns</span>
<span class="sd">    :return: str: coefficient xml</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">calibration_mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">CALIBRATION_MODES</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Must be spatial/spectral mode.&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">coeff_file_type</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">COEFFICIENT_FILE_TYPES</span><span class="p">[</span><span class="n">calibration_mode</span><span class="p">][</span><span class="n">zp</span><span class="o">.</span><span class="n">modelNumber</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">coeff_file_type</span> <span class="o">==</span> <span class="n">AIO_SPECTRAL_COEFFICIENT</span><span class="p">:</span>
            <span class="k">return</span><span class="p">(</span><span class="n">coeff_file_type</span><span class="p">,</span>
                   <span class="n">MOCK_COEFFICIENT_TEMPLATES</span><span class="p">[</span><span class="n">coeff_file_type</span><span class="p">]</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                       <span class="n">PLAYER_DSP_IDS</span><span class="p">[</span><span class="n">zp</span><span class="o">.</span><span class="n">modelNumber</span><span class="p">]))</span>
        <span class="k">return</span><span class="p">(</span><span class="n">coeff_file_type</span><span class="p">,</span>
               <span class="n">MOCK_COEFFICIENT_TEMPLATES</span><span class="p">[</span><span class="n">coeff_file_type</span><span class="p">])</span></div>


<div class="viewcode-block" id="TrueplayBaseFixture"><a class="viewcode-back" href="../../../../upnp.functional.trueplay.html#upnp.functional.trueplay.base.TrueplayBaseFixture">[docs]</a><span class="k">class</span> <span class="nc">TrueplayBaseFixture</span><span class="p">(</span><span class="n">WorkflowTestFixture</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Support functionality for testing Trueplay API and requirements.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    When requires_test_server is set to True, the Trueplay</span>
<span class="sd">    base fixture will use a test_server_url in place of the production URL.</span>
<span class="sd">    This is a local switch for tests that ALWAYS need to use a test server,</span>
<span class="sd">    or need to use a custom test server(Such as locally hosting files)</span>
<span class="sd">    at which point this can be set to False and controlled by the test</span>
<span class="sd">    itself when needed through set_test_server_override()</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">requires_test_server</span> <span class="o">=</span> <span class="n">USE_TEST_SERVER</span>
    <span class="n">test_server_url</span> <span class="o">=</span> <span class="n">TEST_SERVER_URL</span>

    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    List of diagnostic log levels to be applied to each ZP under test</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">diag_level_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">DIAG_LEVEL_LIST</span><span class="p">)</span>

    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    List of ZPs that have been shutdown in anacapa, for recovery</span>
<span class="sd">    after a test has run in the teardowns.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">anacapa_zp_list</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">device_list</span> <span class="o">=</span> <span class="p">[]</span>

<div class="viewcode-block" id="TrueplayBaseFixture.ensure_anacapa_running"><a class="viewcode-back" href="../../../../upnp.functional.trueplay.html#upnp.functional.trueplay.base.TrueplayBaseFixture.ensure_anacapa_running">[docs]</a>    <span class="k">def</span> <span class="nf">ensure_anacapa_running</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ensure Anacapa is started for any test that may have failed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">zp</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">anacapa_zp_list</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start_anacapa</span><span class="p">(</span><span class="n">zp</span><span class="p">)</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">anacapa_zp_list</span><span class="p">[:]</span></div>

    <span class="k">def</span> <span class="nf">_set_default_devices_from_testbed_supported_devices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get and set the default devices used by various tests,</span>
<span class="sd">        picking the devices from the generator lists after</span>
<span class="sd">        _adapt_generator_sets_to_testbed_supported_models() is called</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Checking for Sub.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_testbed_device_by_model</span><span class="p">(</span><span class="n">SUB</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Checking for a HT master device.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a_ht_master_device</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_a_ht_master_capable_device</span><span class="p">()</span>

        <span class="c1"># Just use the same a_ht_master_device as the</span>
        <span class="c1"># associated zp used in group/ungroup testing</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Using HT Master device as associated zp.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">associated_zp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">a_ht_master_device</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Checking for a non satellite device.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a_non_sat_device</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_a_non_satellite_device</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Checking for a stereo pair.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a_stereo_pair</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_a_stereo_pair</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Checking for a satellite pair.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a_satellite_pair</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_a_satellite_pair</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_adapt_generator_sets_to_testbed_supported_models</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes any devices not supported in the testbed from the</span>
<span class="sd">        Trueplay generator sets used by the generators</span>
<span class="sd">        being used in the Trueplay generators.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">model</span><span class="p">,</span> <span class="n">supported</span> <span class="ow">in</span> <span class="n">TESTBED_SUPPORTED_MODELS</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">supported</span><span class="p">:</span>
                <span class="n">amount</span> <span class="o">=</span> <span class="n">TESTBED_REQUIRED_DEVICE_COUNT</span><span class="p">[</span><span class="n">model</span><span class="p">]</span>
                <span class="c1"># Verify the testbed has the correct amount of players</span>
                <span class="c1"># of the given model type in the testbed.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="s2">&quot;Verifying testbed has </span><span class="si">{}</span><span class="s2"> player</span><span class="si">{}</span><span class="s2"> of type </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">amount</span><span class="p">,</span> <span class="s2">&quot;s&quot;</span> <span class="k">if</span> <span class="n">amount</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">model</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_testbed_devices_by_model</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">amount</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">generator_set</span> <span class="ow">in</span> <span class="n">TRUEPLAY_GENERATOR_SETS</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">generator_set</span><span class="p">:</span>
                        <span class="n">generator_set</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_a_ht_master_capable_device</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a ht master capable device available in the testbed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">TRUEPLAY_HT_DEVICES</span><span class="p">:</span>
            <span class="n">ht_master_model</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">TRUEPLAY_HT_DEVICES</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;Ht master capable device model is </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ht_master_model</span><span class="p">))</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_testbed_device_by_model</span><span class="p">(</span><span class="n">ht_master_model</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;A HT master capable device was not found!&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_a_non_satellite_device</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a non satellite device available in the testbed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Pick a &#39;Non Sat&#39; zp (None if there aren&#39;t any)</span>
        <span class="n">non_sats_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">TRUEPLAY_AIO_DEVICES</span> <span class="o">-</span> <span class="n">TRUEPLAY_SATS</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">non_sats_list</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;Non satellite device model is </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">non_sats_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_testbed_device_by_model</span><span class="p">(</span><span class="n">non_sats_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;A non satellite device was not found!&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_a_unique_pairable_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        For a given model, return a unique pairable model</span>
<span class="sd">        available in the testbed</span>
<span class="sd">        :param model: the model to find a unique pairable model for. string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pairable_models</span> <span class="o">=</span> <span class="n">PAIRABLE_MODEL_COMPATIBILITY_MAP</span><span class="p">[</span><span class="n">model</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">pairable_model</span> <span class="ow">in</span> <span class="n">pairable_models</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">pairable_model</span> <span class="ow">in</span> <span class="n">TESTBED_SUPPORTED_MODELS</span>
                    <span class="ow">and</span> <span class="n">TESTBED_SUPPORTED_MODELS</span><span class="p">[</span><span class="n">pairable_model</span><span class="p">]</span>
                    <span class="ow">and</span> <span class="n">model</span> <span class="o">!=</span> <span class="n">pairable_model</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">pairable_model</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="s2">&quot;A pairable device model for </span><span class="si">{}</span><span class="s2"> was not found!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_a_stereo_pair</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns two stereo pairable devices available in the testbed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">left_model</span> <span class="o">=</span> <span class="p">[</span><span class="n">model</span> <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">TRUEPLAY_AIO_DEVICES</span>
                      <span class="k">if</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">STEREO_PAIR_DEVICES</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s2">&quot;Left stereo pair device model is </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">left_model</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">TESTBED_REQUIRED_DEVICE_COUNT</span><span class="p">[</span><span class="n">left_model</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">left_zp</span><span class="p">,</span> <span class="n">right_zp</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_testbed_devices_by_model</span><span class="p">(</span><span class="n">left_model</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
            <span class="n">right_model</span> <span class="o">=</span> <span class="n">left_model</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">left_zp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_testbed_device_by_model</span><span class="p">(</span><span class="n">left_model</span><span class="p">)</span>
            <span class="n">right_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_a_unique_pairable_model</span><span class="p">(</span><span class="n">left_model</span><span class="p">)</span>
            <span class="n">right_zp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_testbed_device_by_model</span><span class="p">(</span><span class="n">right_model</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">right_zp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;Right stereo pair device model is </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">right_model</span><span class="p">))</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">left_zp</span><span class="p">,</span> <span class="n">right_zp</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_a_satellite_pair</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns two satellite pairable devices available in the testbed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">left_model</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">TRUEPLAY_SATS</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s2">&quot;Left satellite devices model is </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">left_model</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">left_model</span> <span class="ow">in</span> <span class="n">HT_SOLO_REAR_SURROUND_DEVICES</span><span class="p">:</span>
            <span class="n">left_zp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_testbed_devices_by_model</span><span class="p">(</span><span class="n">left_model</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">right_model</span> <span class="o">=</span> <span class="n">left_model</span>
            <span class="n">right_zp</span> <span class="o">=</span> <span class="n">left_zp</span>
        <span class="k">elif</span> <span class="n">TESTBED_REQUIRED_DEVICE_COUNT</span><span class="p">[</span><span class="n">left_model</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">left_zp</span><span class="p">,</span> <span class="n">right_zp</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_testbed_devices_by_model</span><span class="p">(</span><span class="n">left_model</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
            <span class="n">right_model</span> <span class="o">=</span> <span class="n">left_model</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">left_zp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_testbed_device_by_model</span><span class="p">(</span><span class="n">left_model</span><span class="p">)</span>
            <span class="n">right_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_a_unique_pairable_model</span><span class="p">(</span><span class="n">left_model</span><span class="p">)</span>
            <span class="n">right_zp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_testbed_device_by_model</span><span class="p">(</span><span class="n">right_model</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">right_zp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;Right satellite device model is </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">right_model</span><span class="p">))</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">left_zp</span><span class="p">,</span> <span class="n">right_zp</span><span class="p">]</span>

<div class="viewcode-block" id="TrueplayBaseFixture.setUpFixture"><a class="viewcode-back" href="../../../../upnp.functional.trueplay.html#upnp.functional.trueplay.base.TrueplayBaseFixture.setUpFixture">[docs]</a>    <span class="k">def</span> <span class="nf">setUpFixture</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Performing fixture setup.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">anacapa_zp_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s2">&quot;Adapting generator sets to testbed supported models.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_adapt_generator_sets_to_testbed_supported_models</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s2">&quot;Setting default devices from testbed support models.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_default_devices_from_testbed_supported_devices</span><span class="p">()</span>

        <span class="c1"># Prepare all components for testing</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Cleaning up any bonded configurations.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Clearing play state on any playback devices.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Disabling sonar and removing any calibrations.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s2">&quot;Setting the orientation to detect on devices with orientations.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Disabling speakers on all devices.&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">zp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_all_trueplay_devices</span><span class="p">():</span>
            <span class="c1"># Clean up any bonded configurations</span>
            <span class="k">if</span> <span class="n">zp</span><span class="o">.</span><span class="n">is_bonded</span><span class="p">():</span>
                <span class="n">zp</span><span class="o">.</span><span class="n">DeviceProperties</span><span class="o">.</span><span class="n">cleanup_bonded_configuration</span><span class="p">()</span>

            <span class="c1"># Disable sonar and remove any calibrations</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">disable_sonar_and_remove_calibration</span><span class="p">(</span><span class="n">zp</span><span class="p">)</span>

            <span class="c1"># Clear the play state on any playback devices</span>
            <span class="k">if</span> <span class="n">zp</span><span class="o">.</span><span class="n">is_playback_device</span><span class="p">():</span>
                <span class="n">zp</span><span class="o">.</span><span class="n">AVTransport</span><span class="o">.</span><span class="n">clear_play_state</span><span class="p">()</span>

            <span class="c1"># Set the surround mode to ambient on HT devices</span>
            <span class="k">if</span> <span class="n">zp</span><span class="o">.</span><span class="n">modelNumber</span> <span class="ow">in</span> <span class="n">TRUEPLAY_HT_DEVICES</span><span class="p">:</span>
                <span class="n">zp</span><span class="o">.</span><span class="n">RenderingControl</span><span class="o">.</span><span class="n">set_surround_mode</span><span class="p">(</span><span class="s1">&#39;ambient&#39;</span><span class="p">)</span>

            <span class="c1"># Set the orientation to &#39;detect&#39; on devices with orientations</span>
            <span class="k">if</span> <span class="n">zp</span><span class="o">.</span><span class="n">supported_orientations</span><span class="p">:</span>
                <span class="n">zp</span><span class="o">.</span><span class="n">cli</span><span class="o">.</span><span class="n">set_device_orientation</span><span class="p">(</span><span class="s1">&#39;detect&#39;</span><span class="p">)</span>

            <span class="c1"># Disable the speakers on all devices</span>
            <span class="n">zp</span><span class="o">.</span><span class="n">disable_speaker_audio</span><span class="p">()</span>

        <span class="c1"># Set the Test server in the HHID if needed</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">requires_test_server</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_test_server_override</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_server_url</span><span class="p">)</span></div>

<div class="viewcode-block" id="TrueplayBaseFixture.tearDownFixture"><a class="viewcode-back" href="../../../../upnp.functional.trueplay.html#upnp.functional.trueplay.base.TrueplayBaseFixture.tearDownFixture">[docs]</a>    <span class="k">def</span> <span class="nf">tearDownFixture</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Performing fixture teardown.&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Updating diag levels to default on all devices.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Enabling speakers on all devices.&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">zp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_all_trueplay_devices</span><span class="p">():</span>
            <span class="n">zp</span><span class="o">.</span><span class="n">diag</span><span class="o">.</span><span class="n">set_diag_level</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">zp</span><span class="o">.</span><span class="n">enable_speaker_audio</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">associated_zp</span><span class="o">.</span><span class="n">SystemProperties</span><span class="o">.</span><span class="n">Remove</span><span class="p">(</span><span class="n">TEST_SERVER_STRING_ID</span><span class="p">)</span></div>

<div class="viewcode-block" id="TrueplayBaseFixture.setUpTest"><a class="viewcode-back" href="../../../../upnp.functional.trueplay.html#upnp.functional.trueplay.base.TrueplayBaseFixture.setUpTest">[docs]</a>    <span class="k">def</span> <span class="nf">setUpTest</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get all ZPs, Put them into a default state</span>
<span class="sd">        (Empty avt, not bonded, not tuned)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Performing test setup.&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Ensuring anacapa is running on all devices.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ensure_anacapa_running</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Updating diag levels on all devices.&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">zp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_all_trueplay_devices</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_diag_levels</span><span class="p">(</span><span class="n">zp</span><span class="p">)</span></div>

<div class="viewcode-block" id="TrueplayBaseFixture.tearDownTest"><a class="viewcode-back" href="../../../../upnp.functional.trueplay.html#upnp.functional.trueplay.base.TrueplayBaseFixture.tearDownTest">[docs]</a>    <span class="k">def</span> <span class="nf">tearDownTest</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Performing test teardown.&quot;</span><span class="p">)</span>

        <span class="c1"># Clean up any bonded configurations</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Cleaning up any bonded configurations.&quot;</span><span class="p">)</span>
        <span class="p">[</span><span class="n">zp</span><span class="o">.</span><span class="n">DeviceProperties</span><span class="o">.</span><span class="n">cleanup_bonded_configuration</span><span class="p">()</span>
         <span class="k">for</span> <span class="n">zp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">device_list</span> <span class="k">if</span> <span class="n">zp</span><span class="o">.</span><span class="n">is_bonded</span><span class="p">()]</span>

        <span class="c1"># Disable sonar and remove any calibrations</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Disabling sonar and removing any calibrations.&quot;</span><span class="p">)</span>
        <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">disable_sonar_and_remove_calibration</span><span class="p">(</span><span class="n">zp</span><span class="p">)</span>
         <span class="k">for</span> <span class="n">zp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">device_list</span><span class="p">]</span>

        <span class="c1"># Clear the play state on any playback devices</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Clearing play state on any playback devices.&quot;</span><span class="p">)</span>
        <span class="p">[</span><span class="n">zp</span><span class="o">.</span><span class="n">AVTransport</span><span class="o">.</span><span class="n">clear_play_state</span><span class="p">()</span>
         <span class="k">for</span> <span class="n">zp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">device_list</span> <span class="k">if</span> <span class="n">zp</span><span class="o">.</span><span class="n">is_playback_device</span><span class="p">()]</span>

        <span class="c1"># Set the surround mode to ambient on HT devices</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Setting surround mode to ambient on any HT devices.&quot;</span><span class="p">)</span>
        <span class="p">[</span><span class="n">zp</span><span class="o">.</span><span class="n">RenderingControl</span><span class="o">.</span><span class="n">set_surround_mode</span><span class="p">(</span><span class="s1">&#39;ambient&#39;</span><span class="p">)</span>
         <span class="k">for</span> <span class="n">zp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">device_list</span> <span class="k">if</span> <span class="n">zp</span><span class="o">.</span><span class="n">modelNumber</span> <span class="ow">in</span> <span class="n">TRUEPLAY_HT_DEVICES</span><span class="p">]</span>

        <span class="c1"># Set the orientation to &#39;detect&#39; on devices with orientations</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s2">&quot;Seting the orientation to detect on devices with orientations.&quot;</span><span class="p">)</span>
        <span class="p">[</span><span class="n">zp</span><span class="o">.</span><span class="n">cli</span><span class="o">.</span><span class="n">set_device_orientation</span><span class="p">(</span><span class="s1">&#39;detect&#39;</span><span class="p">)</span>
         <span class="k">for</span> <span class="n">zp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">device_list</span> <span class="k">if</span> <span class="n">zp</span><span class="o">.</span><span class="n">supported_orientations</span><span class="p">]</span></div>

<div class="viewcode-block" id="TrueplayBaseFixture.update_diag_levels"><a class="viewcode-back" href="../../../../upnp.functional.trueplay.html#upnp.functional.trueplay.base.TrueplayBaseFixture.update_diag_levels">[docs]</a>    <span class="k">def</span> <span class="nf">update_diag_levels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">zps</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the required diag levels on the given ZP to the list. This</span>
<span class="sd">        should be called when setting up the test, as well as on</span>
<span class="sd">        any ZP that had anacapa bounce.</span>
<span class="sd">        saved in diag_level_list</span>
<span class="sd">        :param :class:`sonos.client.internal.SonosZoneComponent` zp:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">module</span><span class="p">,</span> <span class="n">level</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">diag_level_list</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">zp</span> <span class="ow">in</span> <span class="n">zps</span><span class="p">:</span>
                <span class="n">zp</span><span class="o">.</span><span class="n">diag</span><span class="o">.</span><span class="n">set_diag_level</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">level</span><span class="p">)</span></div>

<div class="viewcode-block" id="TrueplayBaseFixture.generate_all_trueplay_devices"><a class="viewcode-back" href="../../../../upnp.functional.trueplay.html#upnp.functional.trueplay.base.TrueplayBaseFixture.generate_all_trueplay_devices">[docs]</a>    <span class="k">def</span> <span class="nf">generate_all_trueplay_devices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates all Trueplay supported devices (Including multiples)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">zp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">generators</span><span class="o">.</span><span class="n">generate_testbed_devices</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">zp</span><span class="o">.</span><span class="n">modelNumber</span> <span class="ow">in</span> <span class="n">TRUEPLAY_DEVICES</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">zp</span></div>

<div class="viewcode-block" id="TrueplayBaseFixture.generate_standalone_devices_without_orientation"><a class="viewcode-back" href="../../../../upnp.functional.trueplay.html#upnp.functional.trueplay.base.TrueplayBaseFixture.generate_standalone_devices_without_orientation">[docs]</a>    <span class="k">def</span> <span class="nf">generate_standalone_devices_without_orientation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates standalone devices without orientation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">zp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_standalone_devices</span><span class="p">(</span>
                <span class="n">TRUEPLAY_DEVICES_WITHOUT_ORIENTATION</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">zp</span></div>

<div class="viewcode-block" id="TrueplayBaseFixture.generate_standalone_devices_set_orientation"><a class="viewcode-back" href="../../../../upnp.functional.trueplay.html#upnp.functional.trueplay.base.TrueplayBaseFixture.generate_standalone_devices_set_orientation">[docs]</a>    <span class="k">def</span> <span class="nf">generate_standalone_devices_set_orientation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                                    <span class="n">use_limited_matrix</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates standalone devices with orientation</span>
<span class="sd">        :param use_limited_matrix: If set to true, only a subset of</span>
<span class="sd">            orientations will be generated, to lessen test load.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">zp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_standalone_devices</span><span class="p">(</span>
                <span class="n">TRUEPLAY_DEVICES_WITH_ORIENTATION</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">matrix</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_orientation_matrix</span><span class="p">(</span>
                    <span class="p">(</span><span class="n">zp</span><span class="p">,),</span> <span class="n">use_limited_matrix</span><span class="o">=</span><span class="n">use_limited_matrix</span><span class="p">):</span>
                <span class="k">yield</span> <span class="n">matrix</span></div>

<div class="viewcode-block" id="TrueplayBaseFixture.generate_standalone_devices_with_orientation"><a class="viewcode-back" href="../../../../upnp.functional.trueplay.html#upnp.functional.trueplay.base.TrueplayBaseFixture.generate_standalone_devices_with_orientation">[docs]</a>    <span class="k">def</span> <span class="nf">generate_standalone_devices_with_orientation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates standalone devices with orientation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">zp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_standalone_devices</span><span class="p">(</span>
                <span class="n">TRUEPLAY_DEVICES_WITH_ORIENTATION</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">zp</span></div>

<div class="viewcode-block" id="TrueplayBaseFixture.generate_stereo_pair_devices_without_orientation"><a class="viewcode-back" href="../../../../upnp.functional.trueplay.html#upnp.functional.trueplay.base.TrueplayBaseFixture.generate_stereo_pair_devices_without_orientation">[docs]</a>    <span class="k">def</span> <span class="nf">generate_stereo_pair_devices_without_orientation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates stereo pair devices without orientation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">model_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">zp</span> <span class="k">for</span> <span class="n">zp</span> <span class="ow">in</span> <span class="n">TRUEPLAY_DEVICES_WITHOUT_ORIENTATION</span>
                      <span class="k">if</span> <span class="n">zp</span> <span class="ow">in</span> <span class="n">STEREO_PAIR_DEVICES</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_pairable_devices</span><span class="p">(</span><span class="n">model_list</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">pair</span></div>

<div class="viewcode-block" id="TrueplayBaseFixture.generate_stereo_pair_devices_set_orientation"><a class="viewcode-back" href="../../../../upnp.functional.trueplay.html#upnp.functional.trueplay.base.TrueplayBaseFixture.generate_stereo_pair_devices_set_orientation">[docs]</a>    <span class="k">def</span> <span class="nf">generate_stereo_pair_devices_set_orientation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                                     <span class="n">use_limited_matrix</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates stereo pair devices with orientation</span>
<span class="sd">        :param use_limited_matrix: If set to true, only a subset of</span>
<span class="sd">            orientations will be generated, to lessen test load.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">model_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">zp</span> <span class="k">for</span> <span class="n">zp</span> <span class="ow">in</span> <span class="n">TRUEPLAY_DEVICES_WITH_ORIENTATION</span>
                      <span class="k">if</span> <span class="n">zp</span> <span class="ow">in</span> <span class="n">STEREO_PAIR_DEVICES</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_pairable_devices</span><span class="p">(</span><span class="n">model_list</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">matrix</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_orientation_matrix</span><span class="p">(</span>
                    <span class="n">pair</span><span class="p">,</span> <span class="n">use_limited_matrix</span><span class="o">=</span><span class="n">use_limited_matrix</span><span class="p">):</span>
                <span class="k">yield</span> <span class="n">matrix</span></div>

<div class="viewcode-block" id="TrueplayBaseFixture.generate_stereo_pair_devices_with_orientation"><a class="viewcode-back" href="../../../../upnp.functional.trueplay.html#upnp.functional.trueplay.base.TrueplayBaseFixture.generate_stereo_pair_devices_with_orientation">[docs]</a>    <span class="k">def</span> <span class="nf">generate_stereo_pair_devices_with_orientation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates stereo pair devices with orientation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">model_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">zp</span> <span class="k">for</span> <span class="n">zp</span> <span class="ow">in</span> <span class="n">TRUEPLAY_DEVICES_WITH_ORIENTATION</span>
                      <span class="k">if</span> <span class="n">zp</span> <span class="ow">in</span> <span class="n">STEREO_PAIR_DEVICES</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_pairable_devices</span><span class="p">(</span><span class="n">model_list</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">pair</span></div>

<div class="viewcode-block" id="TrueplayBaseFixture.generate_satellite_pairs_without_orientation"><a class="viewcode-back" href="../../../../upnp.functional.trueplay.html#upnp.functional.trueplay.base.TrueplayBaseFixture.generate_satellite_pairs_without_orientation">[docs]</a>    <span class="k">def</span> <span class="nf">generate_satellite_pairs_without_orientation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates a pair of satellite capable devices without orientation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_satellite_pairs</span><span class="p">(</span>
                <span class="n">TRUEPLAY_SATS_WITHOUT_ORIENTATION</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">pair</span></div>

<div class="viewcode-block" id="TrueplayBaseFixture.generate_satellite_pairs_set_orientation"><a class="viewcode-back" href="../../../../upnp.functional.trueplay.html#upnp.functional.trueplay.base.TrueplayBaseFixture.generate_satellite_pairs_set_orientation">[docs]</a>    <span class="k">def</span> <span class="nf">generate_satellite_pairs_set_orientation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                                 <span class="n">use_limited_matrix</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates a pair of satellite capable devices with orientation</span>
<span class="sd">        :param use_limited_matrix: If set to true, only a subset of</span>
<span class="sd">            orientations will be generated, to lessen test load.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_satellite_pairs</span><span class="p">(</span>
                <span class="n">TRUEPLAY_SATS_WITH_ORIENTATION</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">matrix</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_orientation_matrix</span><span class="p">(</span>
                    <span class="n">pair</span><span class="p">,</span> <span class="n">use_limited_matrix</span><span class="o">=</span><span class="n">use_limited_matrix</span><span class="p">):</span>
                <span class="k">yield</span> <span class="n">matrix</span></div>

<div class="viewcode-block" id="TrueplayBaseFixture.generate_satellite_pairs_with_orientation"><a class="viewcode-back" href="../../../../upnp.functional.trueplay.html#upnp.functional.trueplay.base.TrueplayBaseFixture.generate_satellite_pairs_with_orientation">[docs]</a>    <span class="k">def</span> <span class="nf">generate_satellite_pairs_with_orientation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates a pair of satellite capable devices with orientation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_satellite_pairs</span><span class="p">(</span>
                <span class="n">TRUEPLAY_SATS_WITH_ORIENTATION</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">pair</span></div>

<div class="viewcode-block" id="TrueplayBaseFixture.generate_ht_devices_with_orientation_and_satellites"><a class="viewcode-back" href="../../../../upnp.functional.trueplay.html#upnp.functional.trueplay.base.TrueplayBaseFixture.generate_ht_devices_with_orientation_and_satellites">[docs]</a>    <span class="k">def</span> <span class="nf">generate_ht_devices_with_orientation_and_satellites</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates a HT master with orientation, and a set of sats</span>
<span class="sd">        without orientation support</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">zp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_standalone_devices</span><span class="p">(</span>
                <span class="n">TRUEPLAY_HT_DEVICES_WITH_ORIENTATION</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">left_rear</span><span class="p">,</span> <span class="n">right_rear</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_satellite_pairs</span><span class="p">(</span>
                    <span class="n">TRUEPLAY_SATS</span><span class="p">):</span>
                <span class="k">yield</span> <span class="n">zp</span><span class="p">,</span> <span class="n">left_rear</span><span class="p">,</span> <span class="n">right_rear</span></div>

<div class="viewcode-block" id="TrueplayBaseFixture.generate_ht_devices_set_orientation"><a class="viewcode-back" href="../../../../upnp.functional.trueplay.html#upnp.functional.trueplay.base.TrueplayBaseFixture.generate_ht_devices_set_orientation">[docs]</a>    <span class="k">def</span> <span class="nf">generate_ht_devices_set_orientation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">use_limited_matrix</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates standalone HT devices with orientation</span>
<span class="sd">        :param use_limited_matrix: If set to true, only a subset of</span>
<span class="sd">            orientations will be generated, to lessen test load.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">zp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_standalone_devices</span><span class="p">(</span>
                <span class="n">TRUEPLAY_HT_DEVICES_WITH_ORIENTATION</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">matrix</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_orientation_matrix</span><span class="p">(</span>
                    <span class="p">(</span><span class="n">zp</span><span class="p">,),</span> <span class="n">use_limited_matrix</span><span class="o">=</span><span class="n">use_limited_matrix</span><span class="p">):</span>
                <span class="k">yield</span> <span class="n">matrix</span></div>

<div class="viewcode-block" id="TrueplayBaseFixture.generate_ht_devices_with_orientation"><a class="viewcode-back" href="../../../../upnp.functional.trueplay.html#upnp.functional.trueplay.base.TrueplayBaseFixture.generate_ht_devices_with_orientation">[docs]</a>    <span class="k">def</span> <span class="nf">generate_ht_devices_with_orientation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates standalone HT devices with orientation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">zp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_standalone_devices</span><span class="p">(</span>
                <span class="n">TRUEPLAY_HT_DEVICES_WITH_ORIENTATION</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">zp</span></div>

<div class="viewcode-block" id="TrueplayBaseFixture.generate_ht_devices_without_orientation"><a class="viewcode-back" href="../../../../upnp.functional.trueplay.html#upnp.functional.trueplay.base.TrueplayBaseFixture.generate_ht_devices_without_orientation">[docs]</a>    <span class="k">def</span> <span class="nf">generate_ht_devices_without_orientation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates standalone HT devices with orientation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">zp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_standalone_devices</span><span class="p">(</span>
                <span class="n">TRUEPLAY_HT_DEVICES_WITHOUT_ORIENTATION</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">zp</span></div>

<div class="viewcode-block" id="TrueplayBaseFixture.generate_ht_and_satellite_devices_set_orientation"><a class="viewcode-back" href="../../../../upnp.functional.trueplay.html#upnp.functional.trueplay.base.TrueplayBaseFixture.generate_ht_and_satellite_devices_set_orientation">[docs]</a>    <span class="k">def</span> <span class="nf">generate_ht_and_satellite_devices_set_orientation</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">use_limited_matrix</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates a HT master with a set of sats supported by Trueplay</span>
<span class="sd">        with orientation</span>
<span class="sd">        :param use_limited_matrix: If set to true, only a subset of</span>
<span class="sd">            orientations will be generated, to lessen test load.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">root_zp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_standalone_devices</span><span class="p">(</span>
                <span class="n">TRUEPLAY_HT_DEVICES_WITH_ORIENTATION</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">sats</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_pairable_satellite_devices</span><span class="p">(</span>
                    <span class="n">TRUEPLAY_SATS_WITH_ORIENTATION</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">matrix</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_orientation_matrix</span><span class="p">(</span>
                        <span class="p">(</span><span class="n">root_zp</span><span class="p">,)</span> <span class="o">+</span> <span class="n">sats</span><span class="p">,</span>
                        <span class="n">use_limited_matrix</span><span class="o">=</span><span class="n">use_limited_matrix</span><span class="p">):</span>
                    <span class="k">yield</span> <span class="n">matrix</span></div>

<div class="viewcode-block" id="TrueplayBaseFixture.generate_ht_and_satellite_devices_with_orientation"><a class="viewcode-back" href="../../../../upnp.functional.trueplay.html#upnp.functional.trueplay.base.TrueplayBaseFixture.generate_ht_and_satellite_devices_with_orientation">[docs]</a>    <span class="k">def</span> <span class="nf">generate_ht_and_satellite_devices_with_orientation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates a HT master with a set of sats supported by Trueplay</span>
<span class="sd">        with orientation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">zp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_ht_devices_with_orientation</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">left_rear</span><span class="p">,</span> <span class="n">right_rear</span> <span class="ow">in</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">generate_satellite_pairs_with_orientation</span><span class="p">()):</span>
                <span class="k">yield</span> <span class="n">zp</span><span class="p">,</span> <span class="n">left_rear</span><span class="p">,</span> <span class="n">right_rear</span></div>

<div class="viewcode-block" id="TrueplayBaseFixture.generate_ht_and_satellite_devices_without_orientation"><a class="viewcode-back" href="../../../../upnp.functional.trueplay.html#upnp.functional.trueplay.base.TrueplayBaseFixture.generate_ht_and_satellite_devices_without_orientation">[docs]</a>    <span class="k">def</span> <span class="nf">generate_ht_and_satellite_devices_without_orientation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates a HT master with a set of sats supported by Trueplay</span>
<span class="sd">        with orientation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">zp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_ht_devices_without_orientation</span><span class="p">():</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">left_rear</span><span class="p">,</span> <span class="n">right_rear</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">generate_satellite_pairs_with_orientation</span><span class="p">()):</span>
                <span class="k">yield</span> <span class="n">zp</span><span class="p">,</span> <span class="n">left_rear</span><span class="p">,</span> <span class="n">right_rear</span></div>

<div class="viewcode-block" id="TrueplayBaseFixture.generate_standalone_devices"><a class="viewcode-back" href="../../../../upnp.functional.trueplay.html#upnp.functional.trueplay.base.TrueplayBaseFixture.generate_standalone_devices">[docs]</a>    <span class="k">def</span> <span class="nf">generate_standalone_devices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates Trueplay standalone devices (All types)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">zp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_standalone_devices</span><span class="p">(</span><span class="n">TRUEPLAY_AIO_DEVICES</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">zp</span></div>

<div class="viewcode-block" id="TrueplayBaseFixture.generate_standalone_ht_devices"><a class="viewcode-back" href="../../../../upnp.functional.trueplay.html#upnp.functional.trueplay.base.TrueplayBaseFixture.generate_standalone_ht_devices">[docs]</a>    <span class="k">def</span> <span class="nf">generate_standalone_ht_devices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates Trueplay standalone devices (All types)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">zp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_standalone_devices</span><span class="p">(</span>
                <span class="n">TRUEPLAY_HT_DEVICES_WITH_SPATIAL_STANDALONE</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">zp</span></div>

<div class="viewcode-block" id="TrueplayBaseFixture.generate_standalone_devices_no_ht"><a class="viewcode-back" href="../../../../upnp.functional.trueplay.html#upnp.functional.trueplay.base.TrueplayBaseFixture.generate_standalone_devices_no_ht">[docs]</a>    <span class="k">def</span> <span class="nf">generate_standalone_devices_no_ht</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates Trueplay AIO standalone devices (No HT devices)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">model_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">zp</span> <span class="k">for</span> <span class="n">zp</span> <span class="ow">in</span> <span class="n">TRUEPLAY_AIO_DEVICES</span> <span class="k">if</span> <span class="n">zp</span> <span class="ow">not</span> <span class="ow">in</span>
                      <span class="n">TRUEPLAY_HT_DEVICES_WITH_SPATIAL_STANDALONE</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">zp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_standalone_devices</span><span class="p">(</span><span class="n">model_list</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">zp</span></div>

<div class="viewcode-block" id="TrueplayBaseFixture.generate_stereo_pair_devices"><a class="viewcode-back" href="../../../../upnp.functional.trueplay.html#upnp.functional.trueplay.base.TrueplayBaseFixture.generate_stereo_pair_devices">[docs]</a>    <span class="k">def</span> <span class="nf">generate_stereo_pair_devices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates Trueplay stereo pair devices (All types)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">model_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">zp</span> <span class="k">for</span> <span class="n">zp</span> <span class="ow">in</span> <span class="n">TRUEPLAY_AIO_DEVICES</span>
                      <span class="k">if</span> <span class="n">zp</span> <span class="ow">in</span> <span class="n">STEREO_PAIR_DEVICES</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">zp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_pairable_devices</span><span class="p">(</span><span class="n">model_list</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">zp</span></div>

<div class="viewcode-block" id="TrueplayBaseFixture.generate_satellite_pairs"><a class="viewcode-back" href="../../../../upnp.functional.trueplay.html#upnp.functional.trueplay.base.TrueplayBaseFixture.generate_satellite_pairs">[docs]</a>    <span class="k">def</span> <span class="nf">generate_satellite_pairs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates a pair of satellite capable devices</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_satellite_pairs</span><span class="p">(</span><span class="n">TRUEPLAY_SATS</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">pair</span></div>

<div class="viewcode-block" id="TrueplayBaseFixture.generate_ht_devices"><a class="viewcode-back" href="../../../../upnp.functional.trueplay.html#upnp.functional.trueplay.base.TrueplayBaseFixture.generate_ht_devices">[docs]</a>    <span class="k">def</span> <span class="nf">generate_ht_devices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates all HT master devices</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">zp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_standalone_devices</span><span class="p">(</span><span class="n">TRUEPLAY_HT_DEVICES</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">zp</span></div>

<div class="viewcode-block" id="TrueplayBaseFixture.generate_ht_and_satellite_devices"><a class="viewcode-back" href="../../../../upnp.functional.trueplay.html#upnp.functional.trueplay.base.TrueplayBaseFixture.generate_ht_and_satellite_devices">[docs]</a>    <span class="k">def</span> <span class="nf">generate_ht_and_satellite_devices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates a HT master with a set of sats supported by Trueplay</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">zp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_ht_devices</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">left_rear</span><span class="p">,</span> <span class="n">right_rear</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_satellite_pairs</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">left_rear</span> <span class="o">==</span> <span class="n">right_rear</span> <span class="ow">and</span> <span class="n">left_rear</span> <span class="o">==</span> <span class="n">zp</span><span class="p">:</span>
                    <span class="n">zp</span><span class="p">,</span> <span class="n">left_rear</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">get_testbed_devices_by_model</span><span class="p">(</span><span class="n">zp</span><span class="o">.</span><span class="n">modelNumber</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
                    <span class="n">right_rear</span> <span class="o">=</span> <span class="n">left_rear</span>
                <span class="k">yield</span> <span class="n">zp</span><span class="p">,</span> <span class="n">left_rear</span><span class="p">,</span> <span class="n">right_rear</span></div>

    <span class="k">def</span> <span class="nf">_generate_standalone_devices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Yields a standalone player that can be</span>
<span class="sd">        used for tests from a given list of player models.</span>
<span class="sd">        :param model_list: List of model types</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">model_list</span><span class="p">:</span>
            <span class="n">zp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_testbed_device_by_model</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
            <span class="k">yield</span> <span class="n">zp</span>

    <span class="k">def</span> <span class="nf">_generate_pairable_devices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Yields a pair of players for each model that can be used</span>
<span class="sd">        for stereo pair tests from a given list of player</span>
<span class="sd">        models.</span>
<span class="sd">        :param model_list: List of model types</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">model_list</span><span class="p">:</span>
            <span class="n">left_model</span> <span class="o">=</span> <span class="n">model</span>
            <span class="k">if</span> <span class="n">left_model</span> <span class="ow">in</span> <span class="n">HT_SOLO_REAR_SURROUND_DEVICES</span><span class="p">:</span>
                <span class="n">left_zp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_testbed_device_by_model</span><span class="p">(</span><span class="n">left_model</span><span class="p">)</span>
                <span class="n">right_zp</span> <span class="o">=</span> <span class="n">left_zp</span>
            <span class="k">elif</span> <span class="n">TESTBED_REQUIRED_DEVICE_COUNT</span><span class="p">[</span><span class="n">left_model</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">left_zp</span><span class="p">,</span> <span class="n">right_zp</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">get_testbed_devices_by_model</span><span class="p">(</span><span class="n">left_model</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">left_zp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_testbed_device_by_model</span><span class="p">(</span><span class="n">left_model</span><span class="p">)</span>
                <span class="n">right_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_a_unique_pairable_model</span><span class="p">(</span><span class="n">left_model</span><span class="p">)</span>
                <span class="n">right_zp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_testbed_device_by_model</span><span class="p">(</span><span class="n">right_model</span><span class="p">)</span>
            <span class="k">yield</span> <span class="n">left_zp</span><span class="p">,</span> <span class="n">right_zp</span>

    <span class="k">def</span> <span class="nf">_generate_satellite_pairs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Yields a pair of players for each model that can be used</span>
<span class="sd">        for satellite pair tests from a given list of player</span>
<span class="sd">        models. This method filters the generated pairs so that</span>
<span class="sd">        each model will be yielded only once, as either the left_zp</span>
<span class="sd">        or right_zp in mixed model pairs, where as _generate_pairable_devices</span>
<span class="sd">        will yield each model twice, once as the left_zp and once as the</span>
<span class="sd">        right_zp in mixed model pairs.</span>
<span class="sd">        :param model_list: List of model types</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">used_models</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">model_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">model</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">used_models</span><span class="p">:</span>
                <span class="n">left_model</span> <span class="o">=</span> <span class="n">model</span>
                <span class="n">used_models</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">left_model</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">left_model</span> <span class="ow">in</span> <span class="n">HT_SOLO_REAR_SURROUND_DEVICES</span><span class="p">:</span>
                    <span class="n">left_zp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_testbed_device_by_model</span><span class="p">(</span><span class="n">left_model</span><span class="p">)</span>
                    <span class="n">right_zp</span> <span class="o">=</span> <span class="n">left_zp</span>
                <span class="k">elif</span> <span class="n">TESTBED_REQUIRED_DEVICE_COUNT</span><span class="p">[</span><span class="n">left_model</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">left_zp</span><span class="p">,</span> <span class="n">right_zp</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">get_testbed_devices_by_model</span><span class="p">(</span><span class="n">left_model</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">left_zp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_testbed_device_by_model</span><span class="p">(</span><span class="n">left_model</span><span class="p">)</span>
                    <span class="n">right_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_a_unique_pairable_model</span><span class="p">(</span><span class="n">left_model</span><span class="p">)</span>
                    <span class="n">used_models</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">right_model</span><span class="p">)</span>
                    <span class="n">right_zp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_testbed_device_by_model</span><span class="p">(</span><span class="n">right_model</span><span class="p">)</span>
                <span class="k">yield</span> <span class="n">left_zp</span><span class="p">,</span> <span class="n">right_zp</span>

    <span class="k">def</span> <span class="nf">_generate_orientation_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zps</span><span class="p">,</span>
                                     <span class="n">use_limited_matrix</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Yields a matrix of Zps and orientations</span>
<span class="sd">        for a given list of Zps and their supported</span>
<span class="sd">        orientations. Also sets all ZPs orientations to match the orientation</span>
<span class="sd">        matrix prior to being returned.</span>
<span class="sd">        :param zps: List of ZonePlayers to build the matrix against</span>
<span class="sd">        :param use_limited_matrix: If set to true, only a subset of</span>
<span class="sd">            orientations will be generated, to lessen test load.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">orientation_matrix</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
            <span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="p">(</span>
                <span class="n">zp</span><span class="o">.</span><span class="n">supported_orientations</span> <span class="k">if</span> <span class="n">zp</span><span class="o">.</span><span class="n">supported_orientations</span> <span class="k">else</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">zp</span> <span class="ow">in</span> <span class="n">zps</span><span class="p">)))</span>
        <span class="n">limited_matrix</span> <span class="o">=</span> <span class="n">orientation_matrix</span>
        <span class="k">if</span> <span class="n">use_limited_matrix</span><span class="p">:</span>
            <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Cut back on orientation matrix. Only use first two</span>
<span class="sd">            orientation pairs if the matrix contains multiple zps and</span>
<span class="sd">            multiple orientations(more than 3).</span>
<span class="sd">            Otherwise, only test one orientation.</span>
<span class="sd">            &#39;&#39;&#39;</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">zps</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">orientation_matrix</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">limited_matrix</span> <span class="o">=</span> <span class="n">orientation_matrix</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">zps</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">orientation_matrix</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">limited_matrix</span> <span class="o">=</span> <span class="n">orientation_matrix</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">limited_matrix</span> <span class="o">=</span> <span class="n">orientation_matrix</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">orientations</span> <span class="ow">in</span> <span class="n">limited_matrix</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">zp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">zps</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_orientation</span><span class="p">(</span><span class="n">zp</span><span class="p">,</span> <span class="n">orientations</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
            <span class="k">yield</span> <span class="n">zps</span> <span class="o">+</span> <span class="n">orientations</span>

<div class="viewcode-block" id="TrueplayBaseFixture.set_test_server_override"><a class="viewcode-back" href="../../../../upnp.functional.trueplay.html#upnp.functional.trueplay.base.TrueplayBaseFixture.set_test_server_override">[docs]</a>    <span class="k">def</span> <span class="nf">set_test_server_override</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_server_url</span><span class="p">,</span> <span class="n">active_zp</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the http(s) url to be used by the ZPs when they</span>
<span class="sd">        attempt to fetch and download the Trueplay test tones.</span>
<span class="sd">        Since this is a Household based setting and this</span>
<span class="sd">        override may change very close to the time frame the test</span>
<span class="sd">        if the value is actively changing outside of the setup fixture.</span>
<span class="sd">        Make sure the string has been replicated to an active</span>
<span class="sd">        zp under test, if needed.</span>
<span class="sd">        :param test_server_url: the url to be used</span>
<span class="sd">        :param active_zp: The ZP to verify the replication against (If needed)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">associated_zp</span><span class="o">.</span><span class="n">SystemProperties</span><span class="o">.</span><span class="n">SetString</span><span class="p">(</span>
            <span class="n">TEST_SERVER_STRING_ID</span><span class="p">,</span> <span class="n">test_server_url</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">active_zp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">wait_until_true</span><span class="p">(</span>
                <span class="k">lambda</span><span class="p">:</span> <span class="p">(</span><span class="n">active_zp</span><span class="o">.</span><span class="n">SystemProperties</span><span class="o">.</span>
                         <span class="n">GetString</span><span class="p">(</span><span class="n">TEST_SERVER_STRING_ID</span><span class="p">)</span> <span class="o">==</span> <span class="n">test_server_url</span><span class="p">),</span>
                <span class="n">reason</span><span class="o">=</span><span class="s2">&quot;Failed to set/replicate Trueplay Test Server URL!&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TrueplayBaseFixture.get_list_delays"><a class="viewcode-back" href="../../../../upnp.functional.trueplay.html#upnp.functional.trueplay.base.TrueplayBaseFixture.get_list_delays">[docs]</a>    <span class="k">def</span> <span class="nf">get_list_delays</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zp</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns all delays from SonarSpatial and</span>
<span class="sd">        SonarSpatialSatellite except the last two from each block,</span>
<span class="sd">        which are time constants from gain structures</span>
<span class="sd">        :param :class: `sonos.client.internal.SonosZoneComponent` zp:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_ht_master_delays</span><span class="p">(</span><span class="n">zp</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_satellite_delays</span><span class="p">(</span><span class="n">zp</span><span class="p">)</span></div>

<div class="viewcode-block" id="TrueplayBaseFixture.get_ht_master_delays"><a class="viewcode-back" href="../../../../upnp.functional.trueplay.html#upnp.functional.trueplay.base.TrueplayBaseFixture.get_ht_master_delays">[docs]</a>    <span class="k">def</span> <span class="nf">get_ht_master_delays</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zp</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns list of TruePlay HT delays from SonarSpatial block</span>
<span class="sd">        :param :class: `sonos.client.internal.SonosZoneComponent` zp:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">zp</span><span class="o">.</span><span class="n">modelNumber</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">TRUEPLAY_HT_DEVICES</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>
        <span class="n">delay_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">block</span> <span class="o">=</span> <span class="n">zp</span><span class="o">.</span><span class="n">diag</span><span class="o">.</span><span class="n">get_dsp_block</span><span class="p">(</span><span class="s2">&quot;SonarSpatial&quot;</span><span class="p">)</span>
        <span class="n">root</span> <span class="o">=</span> <span class="n">block</span><span class="o">.</span><span class="n">getroot</span><span class="p">()</span>
        <span class="c1"># xml nesting structure for delays</span>
        <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">root</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;block/parameter/param&quot;</span><span class="p">):</span>
            <span class="n">delay_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">])</span>
        <span class="n">delay_list</span> <span class="o">=</span> <span class="n">delay_list</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">delay_list</span></div>

<div class="viewcode-block" id="TrueplayBaseFixture.get_satellite_delays"><a class="viewcode-back" href="../../../../upnp.functional.trueplay.html#upnp.functional.trueplay.base.TrueplayBaseFixture.get_satellite_delays">[docs]</a>    <span class="k">def</span> <span class="nf">get_satellite_delays</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zp</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns list of TruePlay HT delays from SonarSpatialSatellite</span>
<span class="sd">        :param :class: `sonos.client.internal.SonosZoneComponent` zp:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">zp</span><span class="o">.</span><span class="n">modelNumber</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">TRUEPLAY_HT_DEVICES</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>
        <span class="n">delay_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">block</span> <span class="o">=</span> <span class="n">zp</span><span class="o">.</span><span class="n">diag</span><span class="o">.</span><span class="n">get_dsp_block</span><span class="p">(</span><span class="s2">&quot;SonarSpatialSatellite&quot;</span><span class="p">)</span>
        <span class="n">root</span> <span class="o">=</span> <span class="n">block</span><span class="o">.</span><span class="n">getroot</span><span class="p">()</span>
        <span class="c1"># xml nesting structure for delays</span>
        <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">root</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;block/parameter/param&quot;</span><span class="p">):</span>
            <span class="n">delay_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">])</span>
        <span class="n">delay_list</span> <span class="o">=</span> <span class="n">delay_list</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">delay_list</span></div>

<div class="viewcode-block" id="TrueplayBaseFixture.set_coefficients"><a class="viewcode-back" href="../../../../upnp.functional.trueplay.html#upnp.functional.trueplay.base.TrueplayBaseFixture.set_coefficients">[docs]</a>    <span class="k">def</span> <span class="nf">set_coefficients</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zp</span><span class="p">,</span>
                         <span class="n">bonded_type</span><span class="o">=</span><span class="n">STANDALONE</span><span class="p">,</span>
                         <span class="n">calibration_mode</span><span class="o">=</span><span class="n">SPECTRAL_MODE</span><span class="p">,</span>
                         <span class="n">coefficient_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">coefficients</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="o">**</span><span class="n">_</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Obtains and sets an xml coefficient string onto the given ZP.</span>
<span class="sd">        :param :class: `sonos.client.internal.SonosZoneComponent` zp:</span>
<span class="sd">        :param bonded_type: The type of bonded configuration that this</span>
<span class="sd">        ZP is a part of(Standalone, pair, etc)</span>
<span class="sd">        :param calibration_mode: The type of coefficient we are</span>
<span class="sd">        applying(Spatial, Spectral)</span>
<span class="sd">        :param coefficient_id: ID value for the coefficients being set</span>
<span class="sd">        :param str coefficients: XML file name</span>
<span class="sd">        :param _: unused kwargs</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">coefficient_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">coefficient_id</span> <span class="o">=</span> <span class="n">bonded_type</span>
        <span class="k">if</span> <span class="n">coefficients</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">coefficient_type</span> <span class="o">=</span> <span class="s2">&quot;custom&quot;</span>
            <span class="n">coefficients</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">tostring</span><span class="p">(</span>
                <span class="n">ET</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">coefficients</span><span class="p">)</span><span class="o">.</span><span class="n">getroot</span><span class="p">())</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">coefficient_type</span><span class="p">,</span> <span class="n">coefficients</span> <span class="o">=</span> <span class="n">format_coefficient</span><span class="p">(</span>
                <span class="n">zp</span><span class="p">,</span> <span class="n">calibration_mode</span><span class="o">=</span><span class="n">calibration_mode</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Coefficients: bonded_type=</span><span class="si">{}</span><span class="s2"> calibration_mode=</span><span class="si">{}</span><span class="s2">&quot;</span>
                         <span class="s2">&quot; coefficient_type=</span><span class="si">{}</span><span class="s2"> coefficient_id=</span><span class="si">{}</span><span class="s2">&quot;</span>
                         <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bonded_type</span><span class="p">,</span>
                                 <span class="n">calibration_mode</span><span class="p">,</span>
                                 <span class="n">coefficient_type</span><span class="p">,</span>
                                 <span class="n">coefficient_id</span><span class="p">))</span>
        <span class="n">zp</span><span class="o">.</span><span class="n">RenderingControl</span><span class="o">.</span><span class="n">SetRoomCalibrationX</span><span class="p">(</span><span class="n">coefficient_id</span><span class="p">,</span>
                                                <span class="n">coefficients</span><span class="p">,</span>
                                                <span class="n">calibration_mode</span><span class="p">)</span></div>

<div class="viewcode-block" id="TrueplayBaseFixture.tune_room"><a class="viewcode-back" href="../../../../upnp.functional.trueplay.html#upnp.functional.trueplay.base.TrueplayBaseFixture.tune_room">[docs]</a>    <span class="k">def</span> <span class="nf">tune_room</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">root_zp</span><span class="p">,</span>
                  <span class="n">bonded_zps</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">bonded_type</span><span class="o">=</span><span class="n">STANDALONE</span><span class="p">,</span>
                  <span class="n">calibration_exit_state</span><span class="o">=</span><span class="n">CALIBRATE_SUCCESS</span><span class="p">,</span>
                  <span class="n">use_fast_success</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                  <span class="n">verify_calibration</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                  <span class="n">spatial_config_callback</span><span class="o">=</span><span class="k">lambda</span> <span class="o">*</span><span class="n">_</span><span class="p">,</span> <span class="o">**</span><span class="n">__</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                  <span class="n">spatial_coefficients_callback</span><span class="o">=</span><span class="k">lambda</span> <span class="o">*</span><span class="n">_</span><span class="p">,</span> <span class="o">**</span><span class="n">__</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                  <span class="n">spectral_config_callback</span><span class="o">=</span><span class="k">lambda</span> <span class="o">*</span><span class="n">_</span><span class="p">,</span> <span class="o">**</span><span class="n">__</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                  <span class="n">spectral_coefficients_callback</span><span class="o">=</span><span class="k">lambda</span> <span class="o">*</span><span class="n">_</span><span class="p">,</span> <span class="o">**</span><span class="n">__</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                  <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tunes a &#39;Room&#39; (bonded zps, or standalone) with a Trueplay</span>
<span class="sd">        calibration, using the step by step API process for</span>
<span class="sd">        submitting a calibration. Automatically handles SPATIAL for</span>
<span class="sd">        Spatial supported devices (HT). Automatically verifies tuning for</span>
<span class="sd">        successful calibrations. Failed calibrations will restore to a</span>
<span class="sd">        previous state, and thus should be left up to verification by</span>
<span class="sd">        individual tests.</span>
<span class="sd">        :param :class:`sonos.client.internal.SonosZoneComponent` root_zp:</span>
<span class="sd">        :param bonded_zps: Array of bonded components that are members</span>
<span class="sd">        to the root zp</span>
<span class="sd">        :param bonded_type: The type of bonded configuration that this</span>
<span class="sd">         room is in (Standalone, Pair, etc)</span>
<span class="sd">        :param calibration_exit_state: Success or failure to tune</span>
<span class="sd">        :param use_fast_success: Skip exit tone playback after tuning</span>
<span class="sd">        :param verify_calibration: Verify the calibration is active</span>
<span class="sd">        after it has been applied.</span>
<span class="sd">        :param spatial_config_callback: Callback after entering</span>
<span class="sd">            spatial config mode. kwargs: bonded_type</span>
<span class="sd">        :param spatial_coefficients_callback: Callback after setting</span>
<span class="sd">            spatial coefficients on ht master. kwargs: bonded_type</span>
<span class="sd">        :param spectral_config_callback: Callback after entering</span>
<span class="sd">            spectral config mode. kwargs: bonded_type</span>
<span class="sd">        :param spectral_coefficients_callback: Callback after setting</span>
<span class="sd">            spectral coefficients on the (ht) master &amp; bonded members.</span>
<span class="sd">            kwargs: bonded_type</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Tuning room.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;root=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">root_zp</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;bonded_zps=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bonded_zps</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;bonded_type=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bonded_type</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;use_fast_success=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">use_fast_success</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">bonded_zps</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">bonded_zps</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">zp</span> <span class="ow">in</span> <span class="p">[</span><span class="n">root_zp</span><span class="p">]</span> <span class="o">+</span> <span class="n">bonded_zps</span><span class="p">:</span>
            <span class="n">zp</span><span class="o">.</span><span class="n">disable_speaker_audio</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">bonded_type</span> <span class="ow">in</span> <span class="n">HT_BONDED_TYPES</span><span class="p">:</span>
            <span class="c1"># Perform Spatial calibration</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">enter_config_mode</span><span class="p">(</span><span class="n">root_zp</span><span class="p">,</span> <span class="n">bonded_type</span><span class="o">=</span><span class="n">bonded_type</span><span class="p">,</span>
                                   <span class="n">calibration_mode</span><span class="o">=</span><span class="n">SPATIAL_MODE</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">spatial_config_callback</span><span class="p">(</span><span class="n">bonded_type</span><span class="o">=</span><span class="n">bonded_type</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_coefficients</span><span class="p">(</span><span class="n">root_zp</span><span class="p">,</span> <span class="n">bonded_type</span><span class="o">=</span><span class="n">bonded_type</span><span class="p">,</span>
                                  <span class="n">calibration_mode</span><span class="o">=</span><span class="n">SPATIAL_MODE</span><span class="p">,</span>
                                  <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">spatial_coefficients_callback</span><span class="p">(</span><span class="n">bonded_type</span><span class="o">=</span><span class="n">bonded_type</span><span class="p">)</span>
        <span class="c1"># Perform Spectral calibration</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enter_config_mode</span><span class="p">(</span><span class="n">root_zp</span><span class="p">,</span> <span class="n">bonded_type</span><span class="o">=</span><span class="n">bonded_type</span><span class="p">,</span>
                               <span class="n">calibration_mode</span><span class="o">=</span><span class="n">SPECTRAL_MODE</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">spectral_config_callback</span><span class="p">(</span><span class="n">bonded_type</span><span class="o">=</span><span class="n">bonded_type</span><span class="p">)</span>
        <span class="c1"># Only set spectral coefficients on successful calibration</span>
        <span class="k">if</span> <span class="n">calibration_exit_state</span> <span class="o">==</span> <span class="n">CALIBRATE_SUCCESS</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_coefficients</span><span class="p">(</span><span class="n">root_zp</span><span class="p">,</span> <span class="n">bonded_type</span><span class="o">=</span><span class="n">bonded_type</span><span class="p">,</span>
                                  <span class="n">calibration_mode</span><span class="o">=</span><span class="n">SPECTRAL_MODE</span><span class="p">,</span>
                                  <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">zp</span> <span class="ow">in</span> <span class="n">bonded_zps</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_coefficients</span><span class="p">(</span><span class="n">zp</span><span class="p">,</span> <span class="n">bonded_type</span><span class="o">=</span><span class="n">bonded_type</span><span class="p">,</span>
                                      <span class="n">calibration_mode</span><span class="o">=</span><span class="n">SPECTRAL_MODE</span><span class="p">,</span>
                                      <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">spectral_coefficients_callback</span><span class="p">(</span><span class="n">bonded_type</span><span class="o">=</span><span class="n">bonded_type</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exit_config_mode</span><span class="p">(</span><span class="n">root_zp</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="n">calibration_exit_state</span><span class="p">,</span>
                              <span class="n">use_fast_success</span><span class="o">=</span><span class="n">use_fast_success</span><span class="p">)</span>
        <span class="c1"># Only verify calibration if the calibration was a success.</span>
        <span class="k">if</span> <span class="n">verify_calibration</span> <span class="ow">and</span> <span class="n">calibration_exit_state</span> <span class="o">==</span> <span class="n">CALIBRATE_SUCCESS</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">verify_trueplay_tuning</span><span class="p">(</span><span class="n">root_zp</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">zp</span> <span class="ow">in</span> <span class="n">bonded_zps</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">verify_trueplay_tuning</span><span class="p">(</span><span class="n">zp</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="TrueplayBaseFixture.tune_standalone"><a class="viewcode-back" href="../../../../upnp.functional.trueplay.html#upnp.functional.trueplay.base.TrueplayBaseFixture.tune_standalone">[docs]</a>    <span class="k">def</span> <span class="nf">tune_standalone</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zp</span><span class="p">,</span>
                        <span class="n">room_bonded_callback</span><span class="o">=</span><span class="k">lambda</span> <span class="o">*</span><span class="n">_</span><span class="p">,</span> <span class="o">**</span><span class="n">__</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Trueplay tunes a standalone device</span>
<span class="sd">        :param :class:`sonos.client.internal.SonosZoneComponent` zp:</span>
<span class="sd">        :param room_bonded_callback: Callback after the correct</span>
<span class="sd">            bonded type has been determined. Goes in line with remaining</span>
<span class="sd">            tuning methods, even though there is no</span>
<span class="sd">            bonding being done. kwargs: bonded_type</span>
<span class="sd">        :param kwargs: config arguments</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">zp</span><span class="o">.</span><span class="n">modelNumber</span> <span class="ow">in</span> <span class="n">TRUEPLAY_HT_DEVICES_WITH_SPATIAL_STANDALONE</span><span class="p">:</span>
            <span class="n">bonded_type</span> <span class="o">=</span> <span class="n">HT_STANDALONE</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">bonded_type</span> <span class="o">=</span> <span class="n">STANDALONE</span>
        <span class="n">room_bonded_callback</span><span class="p">(</span><span class="n">bonded_type</span><span class="o">=</span><span class="n">bonded_type</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tune_room</span><span class="p">(</span><span class="n">zp</span><span class="p">,</span> <span class="n">bonded_type</span><span class="o">=</span><span class="n">bonded_type</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="TrueplayBaseFixture.tune_stereo_pair"><a class="viewcode-back" href="../../../../upnp.functional.trueplay.html#upnp.functional.trueplay.base.TrueplayBaseFixture.tune_stereo_pair">[docs]</a>    <span class="k">def</span> <span class="nf">tune_stereo_pair</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span>
                         <span class="n">do_room_bonding</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                         <span class="n">room_bonded_callback</span><span class="o">=</span><span class="k">lambda</span> <span class="o">*</span><span class="n">_</span><span class="p">,</span> <span class="o">**</span><span class="n">__</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                         <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Trueplay tunes stereo pair</span>
<span class="sd">        :param :class:`sonos.client.internal.SonosZoneComponent` left:</span>
<span class="sd">        :param :class:`sonos.client.internal.SonosZoneComponent` right:</span>
<span class="sd">        :param do_room_bonding: Bond the players into a room configuration</span>
<span class="sd">            prior to tuning</span>
<span class="sd">        :param room_bonded_callback: Callback after the room has</span>
<span class="sd">            been bonded. kwargs: bonded_type</span>
<span class="sd">        :param kwargs: config arguments</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">do_room_bonding</span><span class="p">:</span>
            <span class="n">left</span><span class="o">.</span><span class="n">DeviceProperties</span><span class="o">.</span><span class="n">add_stereo_pair</span><span class="p">(</span><span class="n">right</span><span class="p">)</span>
            <span class="n">room_bonded_callback</span><span class="p">(</span><span class="n">bonded_type</span><span class="o">=</span><span class="n">STEREO_PAIR</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tune_room</span><span class="p">(</span><span class="n">left</span><span class="p">,</span>
                       <span class="n">bonded_zps</span><span class="o">=</span><span class="p">[</span><span class="n">right</span><span class="p">],</span>
                       <span class="n">bonded_type</span><span class="o">=</span><span class="n">STEREO_PAIR</span><span class="p">,</span>
                       <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="TrueplayBaseFixture.tune_standalone_with_sub"><a class="viewcode-back" href="../../../../upnp.functional.trueplay.html#upnp.functional.trueplay.base.TrueplayBaseFixture.tune_standalone_with_sub">[docs]</a>    <span class="k">def</span> <span class="nf">tune_standalone_with_sub</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zp</span><span class="p">,</span>
                                 <span class="n">do_room_bonding</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                 <span class="n">room_bonded_callback</span><span class="o">=</span><span class="k">lambda</span> <span class="o">*</span><span class="n">_</span><span class="p">,</span> <span class="o">**</span><span class="n">__</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                                 <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Trueplay tunes standalone device w/ SUB</span>
<span class="sd">        :param :class:`sonos.client.internal.SonosZoneComponent` zp:</span>
<span class="sd">        :param do_room_bonding: Bond the players into a room configuration</span>
<span class="sd">            prior to tuning</span>
<span class="sd">        :param room_bonded_callback: Callback after the room has</span>
<span class="sd">            been bonded. kwargs: bonded_type</span>
<span class="sd">        :param kwargs: config arguments</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">zp</span><span class="o">.</span><span class="n">modelNumber</span> <span class="ow">in</span> <span class="n">TRUEPLAY_HT_DEVICES_WITH_SPATIAL_STANDALONE</span><span class="p">:</span>
            <span class="n">bonded_type</span> <span class="o">=</span> <span class="n">HT_STANDALONE_SUB</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">bonded_type</span> <span class="o">=</span> <span class="n">STANDALONE_SUB</span>

        <span class="k">if</span> <span class="n">do_room_bonding</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_sub</span><span class="p">(</span><span class="n">zp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub</span><span class="p">)</span>
            <span class="n">room_bonded_callback</span><span class="p">(</span><span class="n">bonded_type</span><span class="o">=</span><span class="n">bonded_type</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tune_room</span><span class="p">(</span><span class="n">zp</span><span class="p">,</span>
                       <span class="n">bonded_zps</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">sub</span><span class="p">],</span>
                       <span class="n">bonded_type</span><span class="o">=</span><span class="n">bonded_type</span><span class="p">,</span>
                       <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="TrueplayBaseFixture.tune_stereo_pair_with_sub"><a class="viewcode-back" href="../../../../upnp.functional.trueplay.html#upnp.functional.trueplay.base.TrueplayBaseFixture.tune_stereo_pair_with_sub">[docs]</a>    <span class="k">def</span> <span class="nf">tune_stereo_pair_with_sub</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span>
                                  <span class="n">do_room_bonding</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                  <span class="n">room_bonded_callback</span><span class="o">=</span><span class="k">lambda</span> <span class="o">*</span><span class="n">_</span><span class="p">,</span> <span class="o">**</span><span class="n">__</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                                  <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Trueplay tunes stereo pair + SUB</span>
<span class="sd">        :param :class:`sonos.client.internal.SonosZoneComponent` left:</span>
<span class="sd">        :param :class:`sonos.client.internal.SonosZoneComponent` right:</span>
<span class="sd">        :param do_room_bonding: Bond the players into a room configuration</span>
<span class="sd">            prior to tuning</span>
<span class="sd">        :param room_bonded_callback: Callback after the room has</span>
<span class="sd">            been bonded. kwargs: bonded_type</span>
<span class="sd">        :param kwargs: config arguments</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">do_room_bonding</span><span class="p">:</span>
            <span class="n">left</span><span class="o">.</span><span class="n">DeviceProperties</span><span class="o">.</span><span class="n">add_stereo_bonded_zone_sub_to_this_device</span><span class="p">(</span>
                <span class="n">right</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub</span><span class="p">)</span>
            <span class="n">room_bonded_callback</span><span class="p">(</span><span class="n">bonded_type</span><span class="o">=</span><span class="n">STEREO_PAIR_SUB</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tune_room</span><span class="p">(</span><span class="n">left</span><span class="p">,</span>
                       <span class="n">bonded_zps</span><span class="o">=</span><span class="p">[</span><span class="n">right</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub</span><span class="p">],</span>
                       <span class="n">bonded_type</span><span class="o">=</span><span class="n">STEREO_PAIR_SUB</span><span class="p">,</span>
                       <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="TrueplayBaseFixture.tune_ht_with_surrounds"><a class="viewcode-back" href="../../../../upnp.functional.trueplay.html#upnp.functional.trueplay.base.TrueplayBaseFixture.tune_ht_with_surrounds">[docs]</a>    <span class="k">def</span> <span class="nf">tune_ht_with_surrounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ht_device</span><span class="p">,</span> <span class="n">left_rear</span><span class="p">,</span> <span class="n">right_rear</span><span class="p">,</span>
                               <span class="n">do_room_bonding</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                               <span class="n">room_bonded_callback</span><span class="o">=</span><span class="k">lambda</span> <span class="o">*</span><span class="n">_</span><span class="p">,</span> <span class="o">**</span><span class="n">__</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                               <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Trueplay tunes a HT system with surrounds</span>
<span class="sd">        :param :class:`sonos.client.internal.SonosZoneComponent` ht_device:</span>
<span class="sd">        :param :class:`sonos.client.internal.SonosZoneComponent` left_rear:</span>
<span class="sd">        :param :class:`sonos.client.internal.SonosZoneComponent` right_rear:</span>
<span class="sd">        :param do_room_bonding: Bond the players into a room configuration</span>
<span class="sd">            prior to tuning</span>
<span class="sd">        :param room_bonded_callback: Callback after the room has</span>
<span class="sd">            been bonded. kwargs: bonded_type</span>
<span class="sd">        :param kwargs: config arguments</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">do_room_bonding</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_surrounds</span><span class="p">(</span><span class="n">ht_device</span><span class="p">,</span> <span class="n">left_rear</span><span class="p">,</span> <span class="n">right_rear</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_diag_levels</span><span class="p">(</span><span class="n">left_rear</span><span class="p">,</span> <span class="n">right_rear</span><span class="p">)</span>
            <span class="n">room_bonded_callback</span><span class="p">(</span><span class="n">bonded_type</span><span class="o">=</span><span class="n">HT_SURROUNDS</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tune_room</span><span class="p">(</span><span class="n">ht_device</span><span class="p">,</span>
                       <span class="n">bonded_zps</span><span class="o">=</span><span class="p">[</span><span class="n">left_rear</span><span class="p">,</span> <span class="n">right_rear</span><span class="p">],</span>
                       <span class="n">bonded_type</span><span class="o">=</span><span class="n">HT_SURROUNDS</span><span class="p">,</span>
                       <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="TrueplayBaseFixture.tune_ht_with_surrounds_and_sub"><a class="viewcode-back" href="../../../../upnp.functional.trueplay.html#upnp.functional.trueplay.base.TrueplayBaseFixture.tune_ht_with_surrounds_and_sub">[docs]</a>    <span class="k">def</span> <span class="nf">tune_ht_with_surrounds_and_sub</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">ht_device</span><span class="p">,</span> <span class="n">left_rear</span><span class="p">,</span> <span class="n">right_rear</span><span class="p">,</span>
            <span class="n">do_room_bonding</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">room_bonded_callback</span><span class="o">=</span><span class="k">lambda</span> <span class="o">*</span><span class="n">_</span><span class="p">,</span> <span class="o">**</span><span class="n">__</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Trueplay tunes a HT system with surrounds and sub</span>
<span class="sd">        :param :class:`sonos.client.internal.SonosZoneComponent` ht_device:</span>
<span class="sd">        :param :class:`sonos.client.internal.SonosZoneComponent` left_rear:</span>
<span class="sd">        :param :class:`sonos.client.internal.SonosZoneComponent` right_rear:</span>
<span class="sd">        :param do_room_bonding: Bond the players into a room configuration</span>
<span class="sd">            prior to tuning</span>
<span class="sd">        :param room_bonded_callback: Callback after the room has</span>
<span class="sd">            been bonded. kwargs: bonded_type</span>
<span class="sd">        :param kwargs: config arguments</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">do_room_bonding</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_surrounds_and_sub</span><span class="p">(</span>
                <span class="n">ht_device</span><span class="p">,</span> <span class="n">left_rear</span><span class="p">,</span> <span class="n">right_rear</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_diag_levels</span><span class="p">(</span><span class="n">left_rear</span><span class="p">,</span> <span class="n">right_rear</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub</span><span class="p">)</span>
            <span class="n">room_bonded_callback</span><span class="p">(</span><span class="n">bonded_type</span><span class="o">=</span><span class="n">HT_SURROUNDS_SUB</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tune_room</span><span class="p">(</span><span class="n">ht_device</span><span class="p">,</span>
                       <span class="n">bonded_zps</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">sub</span><span class="p">,</span> <span class="n">left_rear</span><span class="p">,</span> <span class="n">right_rear</span><span class="p">],</span>
                       <span class="n">bonded_type</span><span class="o">=</span><span class="n">HT_SURROUNDS_SUB</span><span class="p">,</span>
                       <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="TrueplayBaseFixture.get_dsp_bypass_block"><a class="viewcode-back" href="../../../../upnp.functional.trueplay.html#upnp.functional.trueplay.base.TrueplayBaseFixture.get_dsp_bypass_block">[docs]</a>    <span class="k">def</span> <span class="nf">get_dsp_bypass_block</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dsp_xml</span><span class="p">,</span> <span class="n">block_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets a bypass block from dsp xml based on a given block name</span>
<span class="sd">        :param dsp_xml:</span>
<span class="sd">        :param block_name:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">block</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;.//block[@name=&quot;</span><span class="si">{}</span><span class="s1">&quot;]&#39;</span> <span class="o">+</span>
                 <span class="s1">&#39;/parameter/param[@name=&quot;BypassMode&quot;]&#39;</span><span class="p">)</span>
        <span class="n">bypass_param</span> <span class="o">=</span> <span class="n">dsp_xml</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">block_name</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">strtobool</span><span class="p">(</span><span class="n">bypass_param</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]))</span></div>

<div class="viewcode-block" id="TrueplayBaseFixture.get_room_calibration_state_from_topology"><a class="viewcode-back" href="../../../../upnp.functional.trueplay.html#upnp.functional.trueplay.base.TrueplayBaseFixture.get_room_calibration_state_from_topology">[docs]</a>    <span class="k">def</span> <span class="nf">get_room_calibration_state_from_topology</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zp</span><span class="p">):</span>
        <span class="n">search_string</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;.//*[@UUID=&quot;</span><span class="si">{}</span><span class="s1">&quot;]&#39;</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">_get_topology_for_zp</span><span class="p">():</span>
            <span class="n">state_xml</span> <span class="o">=</span> <span class="n">XMLAccessor</span><span class="p">(</span>
                <span class="n">zp</span><span class="o">.</span><span class="n">ZoneGroupTopology</span><span class="o">.</span><span class="n">GetZoneGroupState</span><span class="p">()[</span><span class="s1">&#39;ZoneGroupState&#39;</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">state_xml</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">search_string</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">zp</span><span class="o">.</span><span class="n">raw_udn</span><span class="p">))</span>

        <span class="c1"># wait_until_true(lambda: _get_topology_for_zp() is not None,</span>
        <span class="c1">#                 iteration_delay=1,</span>
        <span class="c1">#                 timeout_seconds=10,</span>
        <span class="c1">#                 reason=&quot;Timeout waiting for ZP to&quot;</span>
        <span class="c1">#                        &quot; show itself in its own ZGT.&quot;)</span>
        <span class="n">zp_topology</span> <span class="o">=</span> <span class="n">_get_topology_for_zp</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">zp_topology</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">int_val</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">XMLAccessor</span><span class="p">(</span><span class="n">zp_topology</span><span class="p">)</span><span class="o">.</span><span class="n">RoomCalibrationState</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">int_val</span><span class="p">,</span> <span class="n">ROOM_CALIBRATION_STATE</span><span class="p">[</span><span class="n">int_val</span><span class="p">]</span></div>

<div class="viewcode-block" id="TrueplayBaseFixture.check_dsp_bypass_array"><a class="viewcode-back" href="../../../../upnp.functional.trueplay.html#upnp.functional.trueplay.base.TrueplayBaseFixture.check_dsp_bypass_array">[docs]</a>    <span class="k">def</span> <span class="nf">check_dsp_bypass_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zp</span><span class="p">,</span>
                               <span class="n">roomiir_bypass</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                               <span class="n">spatial_bypass</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                               <span class="n">satellite_bypass</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks if the DSP bypass states meet expectation</span>
<span class="sd">        :param zp:</span>
<span class="sd">        :param roomiir_bypass:</span>
<span class="sd">        :param spatial_bypass:</span>
<span class="sd">        :param satellite_bypass:</span>
<span class="sd">        :return: True if expectation passes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">block_names</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;SonarSpatialSatellite&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;SonarSpatial&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;RoomIIR&#39;</span><span class="p">)</span>
        <span class="n">expected_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">satellite_bypass</span><span class="p">,</span> <span class="n">spatial_bypass</span><span class="p">,</span> <span class="n">roomiir_bypass</span><span class="p">]</span>
        <span class="n">actual_values</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
        <span class="n">dsp_xml</span> <span class="o">=</span> <span class="n">zp</span><span class="o">.</span><span class="n">diag</span><span class="o">.</span><span class="n">get_dsp</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">block_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">block_names</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">expected_values</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">actual_values</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_dsp_bypass_block</span><span class="p">(</span>
                    <span class="n">dsp_xml</span><span class="p">,</span> <span class="n">block_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s2">&quot;DSP Bypass blocks: </span><span class="si">{}</span><span class="s2">. Expected: </span><span class="si">{}</span><span class="s2">. Actual </span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">block_names</span><span class="p">,</span> <span class="n">expected_values</span><span class="p">,</span> <span class="n">actual_values</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">expected_values</span> <span class="o">==</span> <span class="n">actual_values</span></div>

<div class="viewcode-block" id="TrueplayBaseFixture.verify_dsp_bypass"><a class="viewcode-back" href="../../../../upnp.functional.trueplay.html#upnp.functional.trueplay.base.TrueplayBaseFixture.verify_dsp_bypass">[docs]</a>    <span class="k">def</span> <span class="nf">verify_dsp_bypass</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">master_zp</span><span class="p">,</span>
                          <span class="n">roomiir_bypass</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                          <span class="n">spatial_bypass</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                          <span class="n">satellite_bypass</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                          <span class="n">should_add_track_to_avt</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                          <span class="n">should_play_avt</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                          <span class="n">bonded_members</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                          <span class="o">**</span><span class="n">_</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Verifies the DSP bypass states for RoomIIR,</span>
<span class="sd">        SonosSpatial, and SonosSpatialSatellite</span>
<span class="sd">        :param master_zp: zp in test</span>
<span class="sd">        :param bool roomiir_bypass: roomiir bypass on/off</span>
<span class="sd">        :param bool spatial_bypass: spatial bypass on/off</span>
<span class="sd">        :param bool satellite_bypass: sat bypass on/off</span>
<span class="sd">        :param should_add_track_to_avt: Set to True to have a track put into</span>
<span class="sd">        AVT prior to initiating playback.</span>
<span class="sd">        :param should_play_avt: Set to True to have the verification</span>
<span class="sd">          add a track to AVT, play, and wait for DSP xml to update to</span>
<span class="sd">          expected values.</span>
<span class="sd">        :param bonded_members: List of members in room (to have speakers</span>
<span class="sd">          disabled)</span>
<span class="sd">        :param _: Ignored kwargs</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">bonded_members</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">bonded_members</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">should_play_avt</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">should_add_track_to_avt</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_test_track_to_avt</span><span class="p">(</span><span class="n">master_zp</span><span class="p">)</span>
            <span class="n">master_zp</span><span class="o">.</span><span class="n">AVTransport</span><span class="o">.</span><span class="n">Play_and_wait</span><span class="p">()</span>
            <span class="c1"># Allow DSP time to update as it may already</span>
            <span class="c1"># be in a &#39;passing&#39; state</span>
            <span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1"># Verify DSP matches expectation for main unit</span>
        <span class="n">wait_until_true</span><span class="p">(</span>
            <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_dsp_bypass_array</span><span class="p">(</span>
                <span class="n">master_zp</span><span class="p">,</span> <span class="n">roomiir_bypass</span><span class="p">,</span>
                <span class="n">spatial_bypass</span><span class="o">=</span><span class="n">spatial_bypass</span><span class="p">,</span>
                <span class="n">satellite_bypass</span><span class="o">=</span><span class="n">satellite_bypass</span><span class="p">),</span>
            <span class="n">iteration_delay</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
            <span class="n">timeout_seconds</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span>
            <span class="n">reason</span><span class="o">=</span><span class="s2">&quot;Timeout waiting for DSP Bypass to match expectation&quot;</span>
                   <span class="s2">&quot; on zp </span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">master_zp</span><span class="p">))</span>
        <span class="c1"># Bonded units should only have RoomIIR value checked</span>
        <span class="k">for</span> <span class="n">zp</span> <span class="ow">in</span> <span class="n">bonded_members</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;Member should have RoomIIR </span><span class="si">{}</span><span class="s2">. ZP: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">roomiir_bypass</span><span class="p">,</span> <span class="n">zp</span><span class="p">))</span>
            <span class="n">wait_until_true</span><span class="p">(</span>
                <span class="k">lambda</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">get_dsp_bypass_block</span><span class="p">(</span>
                        <span class="n">zp</span><span class="o">.</span><span class="n">diag</span><span class="o">.</span><span class="n">get_dsp</span><span class="p">(),</span> <span class="s1">&#39;RoomIIR&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">roomiir_bypass</span><span class="p">,</span>
                <span class="n">iteration_delay</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                <span class="n">timeout_seconds</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                <span class="n">reason</span><span class="o">=</span><span class="s2">&quot;Timeout waiting for DSP Bypass to match expecation for&quot;</span>
                       <span class="s2">&quot; RoomIIR. Exp: </span><span class="si">{}</span><span class="s2"> Act: </span><span class="si">{}</span><span class="s2">, ZP: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                           <span class="n">roomiir_bypass</span><span class="p">,</span> <span class="ow">not</span> <span class="n">roomiir_bypass</span><span class="p">,</span> <span class="n">zp</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">should_play_avt</span><span class="p">:</span>
            <span class="n">master_zp</span><span class="o">.</span><span class="n">AVTransport</span><span class="o">.</span><span class="n">Stop_and_wait</span><span class="p">()</span></div>

<div class="viewcode-block" id="TrueplayBaseFixture.verify_satellites_have_rendering_control"><a class="viewcode-back" href="../../../../upnp.functional.trueplay.html#upnp.functional.trueplay.base.TrueplayBaseFixture.verify_satellites_have_rendering_control">[docs]</a>    <span class="k">def</span> <span class="nf">verify_satellites_have_rendering_control</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">zps</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Verifies RenderingControl Attribute on home theater satellites</span>
<span class="sd">        :param list zps: one or more</span>
<span class="sd">            :class:`~sonos.client.internal.SonosZoneComponent`s that are</span>
<span class="sd">            configured as HT satellites</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verifyGreaterOrStop</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">zps</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span>
                                 <span class="s2">&quot;ensure at least 1 satellite to verify&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">zp</span> <span class="ow">in</span> <span class="n">zps</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">verifyTrueOrFailCase</span><span class="p">(</span>
                <span class="nb">hasattr</span><span class="p">(</span><span class="n">zp</span><span class="p">,</span> <span class="s1">&#39;RenderingControl&#39;</span><span class="p">),</span>
                <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> should have RenderingControl service&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">zp</span><span class="p">))</span></div>

<div class="viewcode-block" id="TrueplayBaseFixture.verify_avt_uri_restored"><a class="viewcode-back" href="../../../../upnp.functional.trueplay.html#upnp.functional.trueplay.base.TrueplayBaseFixture.verify_avt_uri_restored">[docs]</a>    <span class="k">def</span> <span class="nf">verify_avt_uri_restored</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zp</span><span class="p">,</span>
                                <span class="n">expected_uri</span><span class="o">=</span><span class="n">PRE_TUNE_AV_TRANSPORT_URI</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Verifies AVTransportURI restoration after Trueplay tuning</span>
<span class="sd">        :param :class:`sonos.client.internal.SonosZoneComponent` zp:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">wait_until_true</span><span class="p">(</span>
            <span class="k">lambda</span><span class="p">:</span> <span class="n">zp</span><span class="o">.</span><span class="n">AVTransport</span><span class="o">.</span><span class="n">get_current_uri</span><span class="p">()</span> <span class="o">==</span> <span class="n">expected_uri</span><span class="p">,</span>
            <span class="n">iteration_delay</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">timeout_seconds</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
            <span class="n">reason</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Timeout waiting for AVT URI to be restored: Exp: </span><span class="si">{}</span><span class="s2">&quot;</span>
                    <span class="s2">&quot; Act: </span><span class="si">{}</span><span class="s2">&quot;</span>
                    <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">expected_uri</span><span class="p">,</span> <span class="n">zp</span><span class="o">.</span><span class="n">AVTransport</span><span class="o">.</span><span class="n">get_current_uri</span><span class="p">()))</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verifyEqualOrFailCase</span><span class="p">(</span><span class="n">zp</span><span class="o">.</span><span class="n">AVTransport</span><span class="o">.</span><span class="n">get_current_uri</span><span class="p">(),</span>
                                   <span class="n">expected_uri</span><span class="p">,</span>
                                   <span class="p">(</span><span class="s2">&quot;Expect AVT URI to be restored: </span><span class="si">{}</span><span class="s2">&quot;</span>
                                    <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">expected_uri</span><span class="p">)))</span></div>

<div class="viewcode-block" id="TrueplayBaseFixture.verify_sonar_eq_xml"><a class="viewcode-back" href="../../../../upnp.functional.trueplay.html#upnp.functional.trueplay.base.TrueplayBaseFixture.verify_sonar_eq_xml">[docs]</a>    <span class="k">def</span> <span class="nf">verify_sonar_eq_xml</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zp</span><span class="p">,</span> <span class="n">expected_sonar_calibration_available</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Verifies if /jffs/sonarEQ.xml should/should not exists</span>
<span class="sd">        :param :class:`sonos.client.internal.SonosZoneComponent` zp:</span>
<span class="sd">        :param bool expected_sonar_calibration_available</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">expected_sonar_calibration_available</span><span class="p">:</span>
            <span class="n">wait_until_true</span><span class="p">(</span>
                <span class="k">lambda</span><span class="p">:</span> <span class="n">zp</span><span class="o">.</span><span class="n">cli</span><span class="o">.</span><span class="n">is_file_empty</span><span class="p">(</span><span class="n">SONAR_EQ_XML</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">,</span>
                <span class="n">iteration_delay</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">timeout_seconds</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">verifyFalseOrFailCase</span><span class="p">(</span>
                <span class="n">zp</span><span class="o">.</span><span class="n">cli</span><span class="o">.</span><span class="n">is_file_empty</span><span class="p">(</span>
                    <span class="n">SONAR_EQ_XML</span><span class="p">),</span> <span class="s1">&#39;is_file_empty(</span><span class="si">{}</span><span class="s1">) should = False&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">SONAR_EQ_XML</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">wait_until_true</span><span class="p">(</span>
                <span class="k">lambda</span><span class="p">:</span> <span class="n">zp</span><span class="o">.</span><span class="n">cli</span><span class="o">.</span><span class="n">does_file_exist</span><span class="p">(</span><span class="n">SONAR_EQ_XML</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">,</span>
                <span class="n">iteration_delay</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">timeout_seconds</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">verifyFalseOrFailCase</span><span class="p">(</span>
                <span class="n">zp</span><span class="o">.</span><span class="n">cli</span><span class="o">.</span><span class="n">does_file_exist</span><span class="p">(</span><span class="n">SONAR_EQ_XML</span><span class="p">),</span>
                <span class="s1">&#39;does_file_exist(</span><span class="si">{}</span><span class="s1">) should = False&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">SONAR_EQ_XML</span><span class="p">))</span></div>

<div class="viewcode-block" id="TrueplayBaseFixture.verify_trueplay_tuning"><a class="viewcode-back" href="../../../../upnp.functional.trueplay.html#upnp.functional.trueplay.base.TrueplayBaseFixture.verify_trueplay_tuning">[docs]</a>    <span class="k">def</span> <span class="nf">verify_trueplay_tuning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zp</span><span class="p">,</span> <span class="n">enabled</span><span class="p">,</span> <span class="n">available</span><span class="p">,</span>
                               <span class="n">verify_sonar_eq_xml</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Verifies SonarEnabled &amp; SonarCalibrationAvailable values</span>
<span class="sd">        :param :class:`sonos.client.internal.SonosZoneComponent` zp:</span>
<span class="sd">        :param bool enabled</span>
<span class="sd">        :param bool available</span>
<span class="sd">        :param bool verify_sonar_eq_xml: Should not verify XML file when</span>
<span class="sd">            testing orientation change b/c file should exist after changing</span>
<span class="sd">            orientation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Checking Trueplay status of ZP: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">zp</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">verify_sonar_eq_xml</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">verify_sonar_eq_xml</span><span class="p">(</span><span class="n">zp</span><span class="p">,</span> <span class="n">available</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">_check_calibration_status</span><span class="p">():</span>
            <span class="n">status</span> <span class="o">=</span> <span class="n">zp</span><span class="o">.</span><span class="n">RenderingControl</span><span class="o">.</span><span class="n">GetRoomCalibrationStatus</span><span class="p">()</span>
            <span class="n">expected_states</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;RoomCalibrationEnabled&#39;</span><span class="p">:</span> <span class="n">enabled</span><span class="p">,</span>
                <span class="s1">&#39;RoomCalibrationAvailable&#39;</span><span class="p">:</span> <span class="n">available</span>
            <span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;Room Calibration State Expects: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">expected_states</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;Room Calibration State Actual: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">status</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">status</span> <span class="o">==</span> <span class="n">expected_states</span>

        <span class="k">def</span> <span class="nf">_check_calibration_topology</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">zp</span><span class="o">.</span><span class="n">is_secondary_bonded_zone</span><span class="p">():</span>
                <span class="n">expected_topology_state</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">SONARSTATE_SECONDARY_STATE_IGNORED_BY_CR</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Standalone units and masters</span>
                <span class="c1"># always event their calibration state</span>
                <span class="n">expected_topology_state</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">get_topology_state</span><span class="p">(</span><span class="n">enabled</span><span class="p">,</span> <span class="n">available</span><span class="p">))</span>
            <span class="n">calibration_state</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_room_calibration_state_from_topology</span><span class="p">(</span><span class="n">zp</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">calibration_state</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s2">&quot;No Calibration State for ZP: </span><span class="si">{}</span><span class="s2">. Expected: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">zp</span><span class="p">,</span> <span class="n">expected_topology_state</span><span class="p">))</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="n">topology_state</span> <span class="o">=</span> <span class="n">calibration_state</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;Topology Calibration State Expects: </span><span class="si">{}</span><span class="s2">, Actual: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">expected_topology_state</span><span class="p">,</span> <span class="n">topology_state</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">topology_state</span> <span class="o">==</span> <span class="n">SONARSTATE_UNDEFINED</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                    <span class="s2">&quot;SONARSTATE_UNDEFINED - SWPBL-61109ish - Ignoring&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">return</span> <span class="n">expected_topology_state</span> <span class="o">==</span> <span class="n">topology_state</span>

        <span class="n">wait_until_true</span><span class="p">(</span>
            <span class="k">lambda</span><span class="p">:</span> <span class="nb">all</span><span class="p">(</span>
                <span class="p">[</span><span class="n">_check_calibration_status</span><span class="p">(),</span> <span class="n">_check_calibration_topology</span><span class="p">()]),</span>
            <span class="n">iteration_delay</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span>
            <span class="n">timeout_seconds</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
            <span class="n">reason</span><span class="o">=</span><span class="s1">&#39;Timeout waiting for SonarCalibration states to match&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TrueplayBaseFixture.verify_trueplay_dsp_on"><a class="viewcode-back" href="../../../../upnp.functional.trueplay.html#upnp.functional.trueplay.base.TrueplayBaseFixture.verify_trueplay_dsp_on">[docs]</a>    <span class="k">def</span> <span class="nf">verify_trueplay_dsp_on</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zp</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Verifies the expected DSP bypass states during playback of audio</span>
<span class="sd">        when Trueplay is on and available.</span>
<span class="sd">        Expect TP to be ON/OFF and Available</span>
<span class="sd">        :param zp: ZP to check DSP on</span>
<span class="sd">        :param kwargs: config values</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">my_args</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;should_play_avt&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s1">&#39;should_add_track_to_avt&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s1">&#39;roomiir_bypass&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="n">zp</span><span class="o">.</span><span class="n">modelNumber</span> <span class="ow">in</span> <span class="n">TRUEPLAY_HT_DEVICES</span><span class="p">:</span>
            <span class="c1"># SonarSpatialSatellite is not enabled if Full mode is on</span>
            <span class="k">if</span> <span class="n">zp</span><span class="o">.</span><span class="n">RenderingControl</span><span class="o">.</span><span class="n">GetEQ</span><span class="p">(</span><span class="s1">&#39;SurroundMode&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;1&#39;</span><span class="p">:</span>
                <span class="n">spatial_sat</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">spatial_sat</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">my_args</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;spatial_bypass&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                            <span class="s1">&#39;satellite_bypass&#39;</span><span class="p">:</span> <span class="n">spatial_sat</span><span class="p">})</span>
        <span class="n">my_args</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify_dsp_bypass</span><span class="p">(</span><span class="n">zp</span><span class="p">,</span> <span class="o">**</span><span class="n">my_args</span><span class="p">)</span></div>

<div class="viewcode-block" id="TrueplayBaseFixture.verify_trueplay_dsp_off"><a class="viewcode-back" href="../../../../upnp.functional.trueplay.html#upnp.functional.trueplay.base.TrueplayBaseFixture.verify_trueplay_dsp_off">[docs]</a>    <span class="k">def</span> <span class="nf">verify_trueplay_dsp_off</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zp</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Verifies the expected DSP bypass states during playback of audio</span>
<span class="sd">        when Trueplay is off or unavailable.</span>
<span class="sd">        :param zp: ZP to check DSP on</span>
<span class="sd">        :param kwargs: config values</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">my_args</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;should_play_avt&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s1">&#39;should_add_track_to_avt&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s1">&#39;roomiir_bypass&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="n">zp</span><span class="o">.</span><span class="n">modelNumber</span> <span class="ow">in</span> <span class="n">TRUEPLAY_HT_DEVICES</span><span class="p">:</span>
            <span class="n">my_args</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;spatial_bypass&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                            <span class="s1">&#39;satellite_bypass&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>
        <span class="n">my_args</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify_dsp_bypass</span><span class="p">(</span><span class="n">zp</span><span class="p">,</span> <span class="o">**</span><span class="n">my_args</span><span class="p">)</span></div>

<div class="viewcode-block" id="TrueplayBaseFixture.verify_playtime"><a class="viewcode-back" href="../../../../upnp.functional.trueplay.html#upnp.functional.trueplay.base.TrueplayBaseFixture.verify_playtime">[docs]</a>    <span class="k">def</span> <span class="nf">verify_playtime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zp</span><span class="p">,</span> <span class="n">expected_playtime</span><span class="p">,</span> <span class="n">tolerance</span><span class="o">=</span><span class="mf">2.0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        While ZP is in a Playing state, track the time the song has</span>
<span class="sd">        been playing, until the moment it stops, or the expected</span>
<span class="sd">        playtime tolerance + 5 is exhausted (timeout).</span>
<span class="sd">        :param :class:`sonos.client.internal.SonosZoneComponent` zp:</span>
<span class="sd">        :param int expected_playtime: Expected amount of playtime in seconds</span>
<span class="sd">        :param float tolerance: Expected tolerance within expected_playtime</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Waiting for playback to finish. Exp time: </span><span class="si">{}</span><span class="s2"> ZP: </span><span class="si">{}</span><span class="s2">&quot;</span>
                         <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">expected_playtime</span><span class="p">,</span> <span class="n">zp</span><span class="p">))</span>
        <span class="n">wait_until_true</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">zp</span><span class="o">.</span><span class="n">AVTransport</span><span class="o">.</span><span class="n">is_playing</span><span class="p">(),</span>
                        <span class="n">reason</span><span class="o">=</span><span class="s2">&quot;Timeout waiting for playback to start.&quot;</span><span class="p">)</span>
        <span class="n">wait_until_true</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_track_current_playtime</span><span class="p">(</span><span class="n">zp</span><span class="p">,</span>
                                                     <span class="n">expected_playtime</span><span class="p">,</span>
                                                     <span class="n">tolerance</span><span class="p">),</span>
                        <span class="n">iteration_delay</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>
                        <span class="n">timeout_seconds</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">ceil</span><span class="p">(</span>
                            <span class="n">expected_playtime</span> <span class="o">+</span> <span class="n">tolerance</span> <span class="o">+</span> <span class="mi">5</span><span class="p">)),</span>
                        <span class="n">reason</span><span class="o">=</span><span class="s2">&quot;Timeout waiting for playback to end.&quot;</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_track_current_playtime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zp</span><span class="p">,</span> <span class="n">expected_playtime</span><span class="p">,</span> <span class="n">tolerance</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Track the current playtime for the item in AVT.</span>
<span class="sd">        Update playtime_seconds until STOPPED state is hit.</span>
<span class="sd">        Since RelTime resets to 0 before/on stop, ignore any</span>
<span class="sd">        0 value as it may just be in the stopped state already.</span>
<span class="sd">        This loop should be bundled wrapped by a timeout mechanism</span>
<span class="sd">        :param :class:`sonos.client.internal.SonosZoneComponent` zp:</span>
<span class="sd">        :param int expected_playtime: Expected amount of playback time</span>
<span class="sd">        :param float tolerance: Expected tolerance within expected_playtime</span>
<span class="sd">        :return: True if AVT has stopped and expected_playtime is</span>
<span class="sd">        hit within tolerance</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">playtime_seconds</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">current_uri</span> <span class="o">=</span> <span class="n">zp</span><span class="o">.</span><span class="n">AVTransport</span><span class="o">.</span><span class="n">get_avtransport_uri</span><span class="p">()</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">zp</span><span class="o">.</span><span class="n">AVTransport</span><span class="o">.</span><span class="n">is_playing</span><span class="p">()</span> <span class="ow">and</span>
               <span class="n">current_uri</span> <span class="o">==</span> <span class="n">zp</span><span class="o">.</span><span class="n">AVTransport</span><span class="o">.</span><span class="n">get_avtransport_uri</span><span class="p">()):</span>
            <span class="n">reltime</span> <span class="o">=</span> <span class="n">zp</span><span class="o">.</span><span class="n">AVTransport</span><span class="o">.</span><span class="n">GetPositionInfo</span><span class="p">()[</span><span class="s1">&#39;RelTime&#39;</span><span class="p">]</span>
            <span class="c1"># Nothing is playing (or is stream)</span>
            <span class="k">if</span> <span class="n">reltime</span> <span class="o">==</span> <span class="s1">&#39;NOT_IMPLEMENTED&#39;</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">seconds</span> <span class="o">=</span> <span class="n">reltime_str_to_seconds</span><span class="p">(</span><span class="n">reltime</span><span class="p">)</span>
            <span class="c1"># May reset to 0 before we catch playback as stopped.</span>
            <span class="c1">#   Only capture &gt; 0 values.</span>
            <span class="k">if</span> <span class="n">seconds</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">playtime_seconds</span> <span class="o">=</span> <span class="n">seconds</span>
            <span class="c1"># Don&#39;t hammer the ZP</span>
            <span class="n">sleep</span><span class="p">(</span><span class="mf">0.3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verifyAlmostEqualOrFailCase</span><span class="p">(</span><span class="n">expected_playtime</span><span class="p">,</span>
                                         <span class="n">playtime_seconds</span><span class="p">,</span>
                                         <span class="s2">&quot;Playtime should be in tolerance&quot;</span>
                                         <span class="s2">&quot; (Exp / Act)&quot;</span><span class="p">,</span>
                                         <span class="n">delta</span><span class="o">=</span><span class="n">tolerance</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>

<div class="viewcode-block" id="TrueplayBaseFixture.set_orientation"><a class="viewcode-back" href="../../../../upnp.functional.trueplay.html#upnp.functional.trueplay.base.TrueplayBaseFixture.set_orientation">[docs]</a>    <span class="k">def</span> <span class="nf">set_orientation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zp</span><span class="p">,</span> <span class="n">orientation</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets a device orientation</span>
<span class="sd">        :param :class:`sonos.client.internal.SonosZoneComponent` zp:</span>
<span class="sd">        :param orientation: desired orientation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s1">&#39;Setting orientation: </span><span class="si">{}</span><span class="s1"> on ZP: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">orientation</span><span class="p">,</span> <span class="n">zp</span><span class="p">))</span>
        <span class="n">zp</span><span class="o">.</span><span class="n">cli</span><span class="o">.</span><span class="n">set_device_orientation</span><span class="p">(</span><span class="n">orientation</span><span class="p">)</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Note: https://jira.sonos.com/browse/SWPBL-20407</span>
<span class="sd">        Setting orientation followed by immediately sending a</span>
<span class="sd">        calibration may result in the calibration saving</span>
<span class="sd">        in a &#39;wrong&#39; state (Some other orientation).</span>
<span class="sd">        Sleep 20 seconds to allow the S6 internal(testpoint) logic and</span>
<span class="sd">        eventing to fully trigger before pushing a calibration.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">zp</span><span class="o">.</span><span class="n">is_model</span><span class="p">(</span><span class="n">S6</span><span class="p">):</span>
            <span class="n">sleep</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span></div>

<div class="viewcode-block" id="TrueplayBaseFixture.stop_anacapa"><a class="viewcode-back" href="../../../../upnp.functional.trueplay.html#upnp.functional.trueplay.base.TrueplayBaseFixture.stop_anacapa">[docs]</a>    <span class="k">def</span> <span class="nf">stop_anacapa</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zp</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Stops Anacapa on ZP and preserves the ZP ref for cleanup later</span>
<span class="sd">        (Simulate shutdown)</span>
<span class="sd">        :param zp:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Stopping Anacapa on ZP: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">zp</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">anacapa_zp_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">zp</span><span class="p">)</span>
        <span class="n">zp</span><span class="o">.</span><span class="n">cli</span><span class="o">.</span><span class="n">stop_anacapa_nicely</span><span class="p">()</span></div>

<div class="viewcode-block" id="TrueplayBaseFixture.start_anacapa"><a class="viewcode-back" href="../../../../upnp.functional.trueplay.html#upnp.functional.trueplay.base.TrueplayBaseFixture.start_anacapa">[docs]</a>    <span class="k">def</span> <span class="nf">start_anacapa</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zp</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Starts anacapa on a ZP (Simulate boot)</span>
<span class="sd">        :param zp:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Starting Anacapa on ZP: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">zp</span><span class="p">))</span>
        <span class="n">zp</span><span class="o">.</span><span class="n">start_anacapa</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_diag_levels</span><span class="p">(</span><span class="n">zp</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">zp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">anacapa_zp_list</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">anacapa_zp_list</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">zp</span><span class="p">)</span></div>

<div class="viewcode-block" id="TrueplayBaseFixture.bounce_anacapa"><a class="viewcode-back" href="../../../../upnp.functional.trueplay.html#upnp.functional.trueplay.base.TrueplayBaseFixture.bounce_anacapa">[docs]</a>    <span class="k">def</span> <span class="nf">bounce_anacapa</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zp</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Stop then start anacapa on a ZP (Simulate restart)</span>
<span class="sd">        :param zp:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Bouncing Anacapa on ZP: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">zp</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">anacapa_zp_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">zp</span><span class="p">)</span>
        <span class="n">zp</span><span class="o">.</span><span class="n">bounce_anacapa_and_wait</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_diag_levels</span><span class="p">(</span><span class="n">zp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">anacapa_zp_list</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">zp</span><span class="p">)</span></div>

<div class="viewcode-block" id="TrueplayBaseFixture.add_test_track_to_avt"><a class="viewcode-back" href="../../../../upnp.functional.trueplay.html#upnp.functional.trueplay.base.TrueplayBaseFixture.add_test_track_to_avt">[docs]</a>    <span class="k">def</span> <span class="nf">add_test_track_to_avt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zp</span><span class="p">,</span> <span class="o">**</span><span class="n">_</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a test track to the AVT of a given ZP.</span>
<span class="sd">        :param :class:`sonos.client.internal.SonosZoneComponent` zp:</span>
<span class="sd">        :param _: ignored kwargs (if any)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">zp</span><span class="o">.</span><span class="n">AVTransport</span><span class="o">.</span><span class="n">SetAVTransportURI_and_wait</span><span class="p">(</span>
            <span class="n">PRE_TUNE_AV_TRANSPORT_URI</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TrueplayBaseFixture.toggle_trueplay"><a class="viewcode-back" href="../../../../upnp.functional.trueplay.html#upnp.functional.trueplay.base.TrueplayBaseFixture.toggle_trueplay">[docs]</a>    <span class="k">def</span> <span class="nf">toggle_trueplay</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">master_zp</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span>
                        <span class="n">check_available</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bonded_members</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Turns Trueplay on or off for a given Room and verifies</span>
<span class="sd">        that the room has indeed toggled off.</span>
<span class="sd">        :param master_zp:</span>
<span class="sd">        :param state: &#39;on&#39; or &#39;off&#39; string</span>
<span class="sd">        :param check_available: True to also verify the &#39;Available&#39; state.</span>
<span class="sd">        If set to false, will only verify Enabled state.</span>
<span class="sd">        :param bonded_members: List of Zps bonded to the master_zp</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">bonded_members</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">bonded_members</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">bool_state</span> <span class="o">=</span> <span class="n">strtobool</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Toggling Trueplay to state: </span><span class="si">{}</span><span class="s2"> on zp </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">state</span><span class="p">,</span> <span class="n">master_zp</span><span class="p">))</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">master_zp</span><span class="o">.</span><span class="n">RenderingControl</span><span class="o">.</span><span class="n">SetRoomCalibrationStatus</span><span class="p">(</span><span class="n">bool_state</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">UPnPError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">upnp_error</span> <span class="o">==</span> <span class="mi">501</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="s2">&quot;HT master with missing sub return UPNP 501. &quot;</span>
                    <span class="s2">&quot;See SWPBL-61291 and SWPBL-54700 for details&quot;</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">e</span>
        <span class="k">for</span> <span class="n">zp</span> <span class="ow">in</span> <span class="p">[</span><span class="n">master_zp</span><span class="p">]</span> <span class="o">+</span> <span class="n">bonded_members</span><span class="p">:</span>
            <span class="c1"># Verify all components Trueplay state</span>
            <span class="k">if</span> <span class="n">check_available</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">verify_trueplay_tuning</span><span class="p">(</span><span class="n">zp</span><span class="p">,</span> <span class="nb">bool</span><span class="p">(</span><span class="n">bool_state</span><span class="p">),</span> <span class="kc">True</span><span class="p">,</span>
                                            <span class="n">verify_sonar_eq_xml</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">verifyEqualOrFailCase</span><span class="p">(</span>
                    <span class="nb">bool</span><span class="p">(</span><span class="n">bool_state</span><span class="p">),</span>
                    <span class="n">zp</span><span class="o">.</span><span class="n">RenderingControl</span><span class="o">.</span><span class="n">is_room_calibration_enabled</span><span class="p">(),</span>
                    <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> should have toggled Trueplay.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">zp</span><span class="p">))</span></div>

<div class="viewcode-block" id="TrueplayBaseFixture.disable_sonar_and_remove_calibration"><a class="viewcode-back" href="../../../../upnp.functional.trueplay.html#upnp.functional.trueplay.base.TrueplayBaseFixture.disable_sonar_and_remove_calibration">[docs]</a>    <span class="k">def</span> <span class="nf">disable_sonar_and_remove_calibration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zp</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Disables Sonar &amp; resets Sonar Calibration</span>
<span class="sd">        Removes all coefficients that could have been set during automation</span>
<span class="sd">        :param :class:`sonos.client.internal.SonosZoneComponent` zp:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">zp</span><span class="o">.</span><span class="n">RenderingControl</span><span class="o">.</span><span class="n">SetRoomCalibrationStatus</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">zp</span><span class="o">.</span><span class="n">RenderingControl</span><span class="o">.</span><span class="n">SetRoomCalibrationX</span><span class="p">(</span>
            <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">SPECTRAL_MODE</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify_trueplay_tuning</span><span class="p">(</span><span class="n">zp</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span>
                                    <span class="n">verify_sonar_eq_xml</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_enter_config_mode_upnp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zp</span><span class="p">,</span>
                                <span class="n">bonded_type</span><span class="o">=</span><span class="n">UNKNOWN_STANDALONE</span><span class="p">,</span>
                                <span class="n">calibration_mode</span><span class="o">=</span><span class="n">SPATIAL_MODE</span><span class="p">,</span>
                                <span class="n">verify_dsp</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="c1"># Determine the bond type if unknown</span>
        <span class="k">if</span> <span class="n">bonded_type</span> <span class="ow">is</span> <span class="n">UNKNOWN_STANDALONE</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">zp</span><span class="o">.</span><span class="n">modelNumber</span> <span class="ow">in</span> <span class="n">TRUEPLAY_HT_DEVICES_WITH_SPATIAL_STANDALONE</span><span class="p">:</span>
                <span class="n">bonded_type</span> <span class="o">=</span> <span class="n">HT_STANDALONE</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">bonded_type</span> <span class="o">=</span> <span class="n">STANDALONE</span>
        <span class="n">spatial_bypass</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">satellite_bypass</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># Format calibration options string with</span>
        <span class="c1">#  correct version and sound file ref for the given bonded_type</span>
        <span class="n">options</span> <span class="o">=</span> <span class="n">CALIBRATE_OPTIONS</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">TRUEPLAY_VERSION</span><span class="p">,</span>
            <span class="n">TRUEPLAY_TONES</span><span class="p">[</span><span class="n">bonded_type</span><span class="p">][</span><span class="n">NAME</span><span class="p">],</span>
            <span class="n">SUB_POLARITY</span><span class="p">[</span><span class="n">zp</span><span class="o">.</span><span class="n">modelNumber</span><span class="p">],</span>
            <span class="n">UI_VOLUMES</span><span class="p">[</span><span class="n">zp</span><span class="o">.</span><span class="n">modelNumber</span><span class="p">][</span><span class="n">bonded_type</span><span class="p">])</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">zp</span><span class="o">.</span><span class="n">modelNumber</span> <span class="ow">in</span> <span class="n">TRUEPLAY_HT_DEVICES</span>
                <span class="ow">and</span> <span class="n">bonded_type</span> <span class="ow">in</span> <span class="n">HT_BONDED_TYPES</span><span class="p">):</span>
            <span class="c1"># Append additional HT mode option (spatial/spectral)</span>
            <span class="n">options</span> <span class="o">+=</span> <span class="n">HT_CALIBRATE_OPTIONS</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">calibration_mode</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">calibration_mode</span> <span class="o">==</span> <span class="n">SPATIAL_MODE</span><span class="p">:</span>
                <span class="n">spatial_bypass</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">satellite_bypass</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">spatial_bypass</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">satellite_bypass</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s2">&quot;Entering Config Mode: options=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">options</span><span class="p">))</span>
        <span class="c1"># CALIBRATION_STATE will likely never take new values</span>
        <span class="n">zp</span><span class="o">.</span><span class="n">DeviceProperties</span><span class="o">.</span><span class="n">EnterConfigMode</span><span class="p">(</span><span class="n">CALIBRATION_STATE</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
        <span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">verify_dsp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">verify_dsp_bypass</span><span class="p">(</span><span class="n">zp</span><span class="p">,</span>
                                   <span class="n">roomiir_bypass</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                   <span class="n">spatial_bypass</span><span class="o">=</span><span class="n">spatial_bypass</span><span class="p">,</span>
                                   <span class="n">satellite_bypass</span><span class="o">=</span><span class="n">satellite_bypass</span><span class="p">,</span>
                                   <span class="n">should_play_avt</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<div class="viewcode-block" id="TrueplayBaseFixture.enter_config_mode"><a class="viewcode-back" href="../../../../upnp.functional.trueplay.html#upnp.functional.trueplay.base.TrueplayBaseFixture.enter_config_mode">[docs]</a>    <span class="k">def</span> <span class="nf">enter_config_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zp</span><span class="p">,</span>
                          <span class="n">bonded_type</span><span class="o">=</span><span class="n">UNKNOWN_STANDALONE</span><span class="p">,</span>
                          <span class="n">calibration_mode</span><span class="o">=</span><span class="n">SPATIAL_MODE</span><span class="p">,</span>
                          <span class="n">attempts</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                          <span class="n">verify_dsp</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                          <span class="o">**</span><span class="n">_</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Puts a ZP (and its members through the master) into Trueplay</span>
<span class="sd">        Config Mode for calibration. Attempts to retry up to 3 times</span>
<span class="sd">        if the command hits an 820 error, which could indicate a</span>
<span class="sd">        simple internet hiccup. Could also throw an 824 if ZPs are still</span>
<span class="sd">        transitioning to sat, even if the framework indicates the ZPs are</span>
<span class="sd">        ready.</span>
<span class="sd">        :param :class:`sonos.client.internal.SonosZoneComponent` zp:</span>
<span class="sd">        :param str bonded_type: standalone, stereo_pair, etc type of</span>
<span class="sd">         configuration</span>
<span class="sd">        :param calibration_mode: spatial/spectral calibration mode</span>
<span class="sd">        :param attempts: The amount of attempts to retry the config</span>
<span class="sd">        mode call in order to avoid false failures caused by internet</span>
<span class="sd">        hiccups. Set to 0 to only run 1 attempt (no retry).</span>
<span class="sd">        :param verify_dsp: Set to True to verify the DSP blocks after</span>
<span class="sd">        entering config mode.</span>
<span class="sd">        :param **_: ignored kwargs</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">retry_wrapper</span> <span class="o">=</span> <span class="n">retry</span><span class="p">(</span><span class="n">expected_exception</span><span class="o">=</span><span class="n">UPnPError</span><span class="p">,</span>
                              <span class="n">attempts</span><span class="o">=</span><span class="n">attempts</span><span class="p">,</span>
                              <span class="n">exception_verifier</span><span class="o">=</span><span class="k">lambda</span> <span class="n">exc</span><span class="p">:</span>
                              <span class="n">exc</span><span class="o">.</span><span class="n">upnp_error</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">820</span><span class="p">,</span> <span class="mi">824</span><span class="p">],</span>
                              <span class="n">retry_delay</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1"># Call the internal config mode method, allowing for retries on error.</span>
        <span class="n">enter_config_mode_with_retry</span> <span class="o">=</span> <span class="n">retry_wrapper</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_enter_config_mode_upnp</span><span class="p">)</span>
        <span class="n">enter_config_mode_with_retry</span><span class="p">(</span><span class="n">zp</span><span class="p">,</span> <span class="n">bonded_type</span><span class="o">=</span><span class="n">bonded_type</span><span class="p">,</span>
                                     <span class="n">calibration_mode</span><span class="o">=</span><span class="n">calibration_mode</span><span class="p">,</span>
                                     <span class="n">verify_dsp</span><span class="o">=</span><span class="n">verify_dsp</span><span class="p">)</span></div>

<div class="viewcode-block" id="TrueplayBaseFixture.exit_config_mode"><a class="viewcode-back" href="../../../../upnp.functional.trueplay.html#upnp.functional.trueplay.base.TrueplayBaseFixture.exit_config_mode">[docs]</a>    <span class="k">def</span> <span class="nf">exit_config_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zp</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="n">CALIBRATE_FAIL</span><span class="p">,</span>
                         <span class="n">use_fast_success</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Takes a ZP out of Config Mode. Default is failure (Quicker).</span>
<span class="sd">        :param :class:`sonos.client.internal.SonosZoneComponent` zp:</span>
<span class="sd">        :param Str options: success=1/0</span>
<span class="sd">        :param use_fast_success: When set to true, will skip the</span>
<span class="sd">        16 second playtime when exiting on success=1 by clearing AVT</span>
<span class="sd">        during playback of the completion tone.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Exiting config mode: zp=</span><span class="si">{}</span><span class="s2"> options=</span><span class="si">{}</span><span class="s2">&quot;</span>
                         <span class="s2">&quot; use_fast_success=</span><span class="si">{}</span><span class="s2">&quot;</span>
                         <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">zp</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">use_fast_success</span><span class="p">))</span>
        <span class="n">zp</span><span class="o">.</span><span class="n">DeviceProperties</span><span class="o">.</span><span class="n">ExitConfigMode</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">options</span> <span class="o">==</span> <span class="n">CALIBRATE_SUCCESS</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">use_fast_success</span><span class="p">:</span>
                <span class="n">zp</span><span class="o">.</span><span class="n">AVTransport</span><span class="o">.</span><span class="n">SetAVTransportURI_and_wait</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TrueplayBaseFixture.add_surrounds"><a class="viewcode-back" href="../../../../upnp.functional.trueplay.html#upnp.functional.trueplay.base.TrueplayBaseFixture.add_surrounds">[docs]</a>    <span class="k">def</span> <span class="nf">add_surrounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ht_device</span><span class="p">,</span> <span class="n">left_surround</span><span class="p">,</span> <span class="n">right_surround</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds left and right satellite to ht_device, handling</span>
<span class="sd">        logic to determine which DeviceProperties.create_#0_config()</span>
<span class="sd">        method should be called</span>
<span class="sd">        :param :class: `sonos.client.internal.SonosZoneComponent` ht_device:</span>
<span class="sd">        :param :class: `sonos.client.internal.SonosZoneComponent`</span>
<span class="sd">            left_surround:</span>
<span class="sd">        :param :class: `sonos.client.internal.SonosZoneComponent`</span>
<span class="sd">            right_surround:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">ht_device</span><span class="o">.</span><span class="n">modelNumber</span> <span class="ow">in</span> <span class="n">HT_MASTER_TWO_CHANNELS</span><span class="p">:</span>
            <span class="n">ht_device</span><span class="o">.</span><span class="n">DeviceProperties</span><span class="o">.</span><span class="n">create_40_config</span><span class="p">(</span>
                <span class="n">left_surround</span><span class="p">,</span> <span class="n">right_surround</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ht_device</span><span class="o">.</span><span class="n">DeviceProperties</span><span class="o">.</span><span class="n">create_50_config</span><span class="p">(</span>
                <span class="n">left_surround</span><span class="p">,</span> <span class="n">right_surround</span><span class="p">)</span></div>

<div class="viewcode-block" id="TrueplayBaseFixture.add_surrounds_and_sub"><a class="viewcode-back" href="../../../../upnp.functional.trueplay.html#upnp.functional.trueplay.base.TrueplayBaseFixture.add_surrounds_and_sub">[docs]</a>    <span class="k">def</span> <span class="nf">add_surrounds_and_sub</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ht_device</span><span class="p">,</span>
                              <span class="n">left_surround</span><span class="p">,</span> <span class="n">right_surround</span><span class="p">,</span> <span class="n">sub</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds left and right satellite and sub to ht_device, handling</span>
<span class="sd">        logic to determine which DeviceProperties.create_#0_config()</span>
<span class="sd">        method should be called</span>
<span class="sd">        :param :class: `sonos.client.internal.SonosZoneComponent`</span>
<span class="sd">            ht_device:</span>
<span class="sd">        :param :class: `sonos.client.internal.SonosZoneComponent`</span>
<span class="sd">            left_surround:</span>
<span class="sd">        :param :class: `sonos.client.internal.SonosZoneComponent`</span>
<span class="sd">            right_surround:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">ht_device</span><span class="o">.</span><span class="n">modelNumber</span> <span class="ow">in</span> <span class="n">HT_MASTER_TWO_CHANNELS</span><span class="p">:</span>
            <span class="n">ht_device</span><span class="o">.</span><span class="n">DeviceProperties</span><span class="o">.</span><span class="n">create_41_config</span><span class="p">(</span>
                <span class="n">sub</span><span class="p">,</span> <span class="n">left_surround</span><span class="p">,</span> <span class="n">right_surround</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ht_device</span><span class="o">.</span><span class="n">DeviceProperties</span><span class="o">.</span><span class="n">create_51_config</span><span class="p">(</span>
                <span class="n">sub</span><span class="p">,</span> <span class="n">left_surround</span><span class="p">,</span> <span class="n">right_surround</span><span class="p">)</span></div>

<div class="viewcode-block" id="TrueplayBaseFixture.add_sub"><a class="viewcode-back" href="../../../../upnp.functional.trueplay.html#upnp.functional.trueplay.base.TrueplayBaseFixture.add_sub">[docs]</a>    <span class="k">def</span> <span class="nf">add_sub</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zp</span><span class="p">,</span> <span class="n">sub</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Bonds a sub to the zp, handling logic to determine which of the</span>
<span class="sd">        the following to use</span>
<span class="sd">        zp.DeviceProperties.create_21_config()</span>
<span class="sd">        zp.DeviceProperties.create_31_config()</span>
<span class="sd">        zp.add_bonded_sub_to_this_device()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">zp</span><span class="o">.</span><span class="n">modelNumber</span> <span class="ow">in</span> <span class="n">HT_MASTER_TWO_CHANNELS</span><span class="p">:</span>
            <span class="n">zp</span><span class="o">.</span><span class="n">DeviceProperties</span><span class="o">.</span><span class="n">create_21_config</span><span class="p">(</span><span class="n">sub</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">zp</span><span class="o">.</span><span class="n">modelNumber</span> <span class="ow">in</span> <span class="n">HT_MASTER_THREE_CHANNELS</span><span class="p">:</span>
            <span class="n">zp</span><span class="o">.</span><span class="n">DeviceProperties</span><span class="o">.</span><span class="n">create_31_config</span><span class="p">(</span><span class="n">sub</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">zp</span><span class="o">.</span><span class="n">DeviceProperties</span><span class="o">.</span><span class="n">add_bonded_sub_to_this_device</span><span class="p">(</span><span class="n">sub</span><span class="p">)</span></div></div>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../../index.html">TestCase Documentation</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../audio.html">audio package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../cloud.html">cloud package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../common.html">common package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../data_reporting.html">data_reporting package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../dataio.html">dataio package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../examples.html">examples package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../hdmi.html">hdmi package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../ixchariot.html">ixchariot package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../networking.html">networking package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../other.html">other package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../perf.html">perf package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../pytest_automation.html">pytest_automation package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../secure_registration.html">secure_registration package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../syssw.html">syssw package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../upnp.html">upnp package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../voice.html">voice package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../webserver.html">webserver package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../webserver_v0.html">webserver_v0 package</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../../index.html">Documentation overview</a><ul>
  <li><a href="../../../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019, Author.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.8.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>