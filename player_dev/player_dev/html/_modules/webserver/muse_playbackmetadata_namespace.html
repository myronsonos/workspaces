
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>webserver.muse_playbackmetadata_namespace &#8212; TestCase Documentation  documentation</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for webserver.muse_playbackmetadata_namespace</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">sonos.client.websockets.event</span> <span class="k">import</span> <span class="p">(</span><span class="n">MetadataStatusEvent</span><span class="p">,</span> <span class="n">Error</span><span class="p">,</span> <span class="n">PlaybackStatusEvent</span><span class="p">,</span> <span class="n">Success</span><span class="p">,</span>
                                           <span class="n">PlaybackState</span><span class="p">,</span> <span class="n">GroupCoordinatorChangedEvent</span><span class="p">,</span> <span class="n">GroupStatus</span><span class="p">,</span>
                                           <span class="n">PlaybackExtendedStatusEvent</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">sonos.workflow.suite</span> <span class="k">import</span> <span class="n">WorkflowTestSuite</span>
<span class="kn">from</span> <span class="nn">webserver.base_muse_fixture</span> <span class="k">import</span> <span class="n">MuseClientFixtureMixin</span><span class="p">,</span> \
    <span class="n">BaseMuseFixture</span><span class="p">,</span> <span class="n">MuseCloudServerFixtureMixin</span>
<span class="kn">from</span> <span class="nn">webserver.helpers.cloud_queue_helpers</span> <span class="k">import</span> <span class="n">cq_helpers</span>
<span class="kn">import</span> <span class="nn">track_source.http_track_source</span>
<span class="kn">from</span> <span class="nn">sonos.websrv</span> <span class="k">import</span> <span class="n">DEFAULT_TRACK_SOURCE_LOCATION</span>
<span class="kn">from</span> <span class="nn">upnp.api.queue.helpers</span> <span class="k">import</span> <span class="n">QueueServiceHelpers</span>
<span class="kn">import</span> <span class="nn">webserver.helpers.node_smapi_control</span>
<span class="kn">import</span> <span class="nn">urllib2</span>
<span class="kn">from</span> <span class="nn">sonos.workflow.fixture</span> <span class="k">import</span> <span class="n">skip</span><span class="p">,</span> <span class="n">combinatorial</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">upnp.functional.hls.mock_smapi_base</span> <span class="k">import</span> <span class="p">(</span><span class="n">MockSMAPIBase</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="k">import</span> <span class="n">sleep</span>
<span class="kn">from</span> <span class="nn">sonos.exception</span> <span class="k">import</span> <span class="ne">TimeoutError</span>
<span class="kn">from</span> <span class="nn">sonos.services.common</span> <span class="k">import</span> <span class="n">wait_until_true</span>
<span class="kn">from</span> <span class="nn">coherence.upnp.core</span> <span class="k">import</span> <span class="n">utils</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">from</span> <span class="nn">upnp.helpers.ignore_invoke_errors</span> <span class="k">import</span> <span class="n">IgnoreInvokeErrors</span>


<span class="n">URI_FMT</span> <span class="o">=</span> <span class="s2">&quot;x-sonosapi-hls-static:</span><span class="si">{}</span><span class="s2">?sid=</span><span class="si">{}</span><span class="s2">&amp;flags=32&amp;sn=</span><span class="si">{}</span><span class="s2">&quot;</span>
<span class="n">CONTAINER</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;x-rincon-cpcontainer:0004006cal</span><span class="si">%3a</span><span class="s2">48&quot;</span><span class="p">,)</span>

<span class="n">cq_helper</span> <span class="o">=</span> <span class="n">cq_helpers</span><span class="p">()</span>
<span class="n">smapi</span> <span class="o">=</span> <span class="n">webserver</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">node_smapi_control</span><span class="o">.</span><span class="n">CambTestSmapiControl</span><span class="p">()</span>
<span class="n">webserver</span> <span class="o">=</span> <span class="n">track_source</span><span class="o">.</span><span class="n">http_track_source</span><span class="o">.</span><span class="n">HTTPTrackSource</span><span class="p">(</span><span class="n">DEFAULT_TRACK_SOURCE_LOCATION</span><span class="p">)</span>
<span class="n">queue_helpers</span> <span class="o">=</span> <span class="n">QueueServiceHelpers</span><span class="p">()</span>


<div class="viewcode-block" id="tunein_station_generator"><a class="viewcode-back" href="../../webserver.html#webserver.muse_playbackmetadata_namespace.tunein_station_generator">[docs]</a><span class="k">def</span> <span class="nf">tunein_station_generator</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Test the different formats tunein stations come in</span>
<span class="sd">    BBC: hls-live</span>
<span class="sd">    98.5: m4aradio-adts</span>
<span class="sd">    92.5: mp3radio</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;x-sonosapi-stream:s</span><span class="si">{}</span><span class="s2">?sid=254&amp;flags=8224&amp;sn=0&quot;</span>
    <span class="n">md</span> <span class="o">=</span> <span class="s1">&#39;&lt;DIDL-Lite xmlns:dc=&quot;http://purl.org/dc/elements/1.1/&quot; &#39;</span> \
         <span class="s1">&#39;xmlns:upnp=&quot;urn:schemas-upnp-org:metadata-1-0/upnp/&quot; &#39;</span> \
         <span class="s1">&#39;xmlns:r=&quot;urn:schemas-rinconnetworks-com:metadata-1-0/&quot; &#39;</span> \
         <span class="s1">&#39;xmlns=&quot;urn:schemas-upnp-org:metadata-1-0/DIDL-Lite/&quot;&gt;&#39;</span> \
         <span class="s1">&#39;&lt;item id=&quot;-1&quot; parentID=&quot;-1&quot; restricted=&quot;true&quot;&gt;&#39;</span> \
         <span class="s1">&#39;&lt;dc:title&gt;</span><span class="si">{}</span><span class="s1">&lt;/dc:title&gt;&#39;</span> \
         <span class="s1">&#39;&lt;upnp:class&gt;object.item.audioItem.audioBroadcast&lt;/upnp:class&gt;&#39;</span> \
         <span class="s1">&#39;&lt;desc id=&quot;cdudn&quot; nameSpace=&quot;urn:schemas-rinconnetworks-com:metadata-1-0/&quot;&gt;SA_RINCON65031_&lt;/desc&gt;&#39;</span> \
         <span class="s1">&#39;&lt;/item&gt;&lt;/DIDL-Lite&gt;&#39;</span>
    <span class="n">stations</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;24939&quot;</span><span class="p">:</span> <span class="s2">&quot;BBC&quot;</span><span class="p">,</span> <span class="s2">&quot;27533&quot;</span><span class="p">:</span> <span class="s2">&quot;98.5&quot;</span><span class="p">,</span> <span class="s2">&quot;24062&quot;</span><span class="p">:</span> <span class="s2">&quot;92.5&quot;</span><span class="p">}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">stations</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">yield</span> <span class="n">url</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="n">md</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">value</span></div>


<div class="viewcode-block" id="MuseMetadataNamespaceTestsImpl"><a class="viewcode-back" href="../../webserver.html#webserver.muse_playbackmetadata_namespace.MuseMetadataNamespaceTestsImpl">[docs]</a><span class="k">class</span> <span class="nc">MuseMetadataNamespaceTestsImpl</span><span class="p">(</span><span class="n">BaseMuseFixture</span><span class="p">):</span>
<div class="viewcode-block" id="MuseMetadataNamespaceTestsImpl.setUpFixture"><a class="viewcode-back" href="../../webserver.html#webserver.muse_playbackmetadata_namespace.MuseMetadataNamespaceTestsImpl.setUpFixture">[docs]</a>    <span class="k">def</span> <span class="nf">setUpFixture</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MuseMetadataNamespaceTestsImpl</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">setUpFixture</span><span class="p">()</span>
        <span class="c1"># pcp mock smapi service setup</span>
        <span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">diag</span><span class="o">.</span><span class="n">set_customsd</span>
               <span class="p">(</span><span class="n">smapi</span><span class="o">.</span><span class="n">SMAPI_SERVER_SID</span><span class="p">,</span>
                <span class="n">name</span><span class="o">=</span><span class="n">smapi</span><span class="o">.</span><span class="n">SMAPI_SERVER_NAME</span><span class="p">,</span>
                <span class="n">uri</span><span class="o">=</span><span class="n">smapi</span><span class="o">.</span><span class="n">SMAPI_SERVER_URI</span><span class="p">,</span>
                <span class="n">secure_uri</span><span class="o">=</span><span class="n">smapi</span><span class="o">.</span><span class="n">SMAPI_SERVER_SECURE_URI</span><span class="p">,</span>
                <span class="n">auth_type</span><span class="o">=</span><span class="n">smapi</span><span class="o">.</span><span class="n">SMAPI_SERVER_AUTHTYPE</span><span class="p">,</span>
                <span class="n">strings_version</span><span class="o">=</span><span class="n">smapi</span><span class="o">.</span><span class="n">SMAPI_SERVER_STRINGS_VERSION</span><span class="p">,</span>
                <span class="n">strings_uri</span><span class="o">=</span><span class="n">smapi</span><span class="o">.</span><span class="n">SMAPI_SERVER_STRINGS_URI</span><span class="p">,</span>
                <span class="n">presentation_map_version</span><span class="o">=</span><span class="n">smapi</span><span class="o">.</span><span class="n">SMAPI_SERVER_PRESENTATION_MAP_VERSION</span><span class="p">,</span>
                <span class="n">presentation_map_uri</span><span class="o">=</span><span class="n">smapi</span><span class="o">.</span><span class="n">SMAPI_SERVER_PRESENTATION_MAP_URI</span><span class="p">,</span>
                <span class="n">container_type</span><span class="o">=</span><span class="n">smapi</span><span class="o">.</span><span class="n">SMAPI_SERVER_CONTAINER_TYPE</span><span class="p">,</span>
                <span class="n">caps</span><span class="o">=</span><span class="n">smapi</span><span class="o">.</span><span class="n">SMAPI_SERVER_CAPS</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verifyEqualOrStop</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">smapi</span><span class="o">.</span><span class="n">HTTP_OK</span><span class="p">,</span> <span class="s1">&#39;set_customsd should return 200&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">SystemProperties</span><span class="o">.</span><span class="n">AddAccountX</span><span class="p">(</span><span class="n">smapi</span><span class="o">.</span><span class="n">SMAPI_SERVER_INTERNAL_ID</span><span class="p">,</span>
                                        <span class="n">smapi</span><span class="o">.</span><span class="n">SMAPI_SERVER_USERNAME</span><span class="p">,</span>
                                        <span class="n">smapi</span><span class="o">.</span><span class="n">SMAPI_SERVER_PASSWORD</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">SystemProperties</span><span class="o">.</span>
               <span class="n">does_service_account_exist</span><span class="p">(</span><span class="n">smapi</span><span class="o">.</span><span class="n">SMAPI_SERVER_INTERNAL_ID</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verifyTrueOrStop</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;does_service_account_exist should return &#39;</span>
                                    <span class="s1">&#39;True&#39;</span><span class="p">))</span>

        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">SystemProperties</span><span class="o">.</span><span class="n">AddAccountX</span><span class="p">(</span><span class="mi">9479</span><span class="p">,</span> <span class="s2">&quot;IXContentQATeam@gmail.com&quot;</span><span class="p">,</span> <span class="s2">&quot;S0n0sTest!&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verifyTrueOrFailCase</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="s2">&quot;Added account for service 9479 SiriusXM&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MuseMetadataNamespaceTestsImpl.setUpTest"><a class="viewcode-back" href="../../webserver.html#webserver.muse_playbackmetadata_namespace.MuseMetadataNamespaceTestsImpl.setUpTest">[docs]</a>    <span class="k">def</span> <span class="nf">setUpTest</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MuseMetadataNamespaceTestsImpl</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">setUpTest</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxDiff</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># Set up the player to use the alarm chime</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">AVTransport</span><span class="o">.</span><span class="n">clear_play_state</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">AVTransport</span><span class="o">.</span><span class="n">use_buzzer</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_cloud_queue_server</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">muse_session_helper</span><span class="o">.</span><span class="n">make_muse_session</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="p">,</span> <span class="n">group_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gid</span><span class="p">,</span> <span class="n">hhid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">muse_hhid</span><span class="p">,</span> <span class="n">test_fixture</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="c1"># Subscribe and get a status event</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">group_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gid</span><span class="p">,</span> <span class="n">hhid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">muse_hhid</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify_event</span><span class="p">(</span><span class="n">MetadataStatusEvent</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">subscribe_playback</span><span class="p">(</span><span class="n">group_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gid</span><span class="p">,</span> <span class="n">hhid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">muse_hhid</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify_event</span><span class="p">(</span><span class="n">PlaybackStatusEvent</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                          <span class="n">event_verifier</span><span class="o">=</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">playback_state</span> <span class="o">==</span> <span class="s2">&quot;PLAYBACK_STATE_IDLE&quot;</span><span class="p">))</span></div>

<div class="viewcode-block" id="MuseMetadataNamespaceTestsImpl.tearDownTest"><a class="viewcode-back" href="../../webserver.html#webserver.muse_playbackmetadata_namespace.MuseMetadataNamespaceTestsImpl.tearDownTest">[docs]</a>    <span class="k">def</span> <span class="nf">tearDownTest</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MuseMetadataNamespaceTestsImpl</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">tearDownTest</span><span class="p">()</span></div>

<div class="viewcode-block" id="MuseMetadataNamespaceTestsImpl.tearDownFixture"><a class="viewcode-back" href="../../webserver.html#webserver.muse_playbackmetadata_namespace.MuseMetadataNamespaceTestsImpl.tearDownFixture">[docs]</a>    <span class="k">def</span> <span class="nf">tearDownFixture</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">SystemProperties</span><span class="o">.</span><span class="n">RemoveAccount</span><span class="p">(</span><span class="n">smapi</span><span class="o">.</span><span class="n">SMAPI_SERVER_INTERNAL_ID</span><span class="p">,</span>
                                               <span class="n">smapi</span><span class="o">.</span><span class="n">SMAPI_SERVER_USERNAME</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">SystemProperties</span><span class="o">.</span><span class="n">RemoveAccount</span><span class="p">(</span><span class="mi">9479</span><span class="p">,</span> <span class="s1">&#39;IXContentQATeam@gmail.com&#39;</span><span class="p">)</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">MuseMetadataNamespaceTestsImpl</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">tearDownFixture</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">_customVerifyDictEqualOrFailCase</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expected</span><span class="p">,</span> <span class="n">actual_metadata</span><span class="p">):</span>
        <span class="c1"># normalize the two dicts</span>
        <span class="n">expected</span><span class="p">[</span><span class="s1">&#39;durationMillis&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">expected</span><span class="p">[</span><span class="s1">&#39;durationMillis&#39;</span><span class="p">])</span>
        <span class="n">actual</span> <span class="o">=</span> <span class="n">actual_metadata</span><span class="p">[</span><span class="s2">&quot;track&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="s2">&quot;imageUrl&quot;</span> <span class="ow">in</span> <span class="n">actual</span><span class="p">:</span>
            <span class="n">actual</span><span class="p">[</span><span class="s2">&quot;imageUrl&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">actual</span><span class="p">[</span><span class="s2">&quot;imageUrl&quot;</span><span class="p">])</span>
        <span class="k">if</span> <span class="s2">&quot;type&quot;</span> <span class="ow">in</span> <span class="n">actual</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">actual</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s2">&quot;mediaUrl&quot;</span> <span class="ow">in</span> <span class="n">expected</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">expected</span><span class="p">[</span><span class="s2">&quot;mediaUrl&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s2">&quot;contentType&quot;</span> <span class="ow">in</span> <span class="n">expected</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">expected</span><span class="p">[</span><span class="s2">&quot;contentType&quot;</span><span class="p">]</span>

        <span class="c1"># SWPBL-74358</span>
        <span class="k">if</span> <span class="s2">&quot;tags&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">actual</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;tags&quot;</span> <span class="ow">in</span> <span class="n">expected</span><span class="p">:</span>
                <span class="k">del</span> <span class="n">expected</span><span class="p">[</span><span class="s2">&quot;tags&quot;</span><span class="p">]</span>
                <span class="k">del</span> <span class="n">expected</span><span class="p">[</span><span class="s2">&quot;album&quot;</span><span class="p">][</span><span class="s2">&quot;tags&quot;</span><span class="p">]</span>
                <span class="k">del</span> <span class="n">expected</span><span class="p">[</span><span class="s2">&quot;album&quot;</span><span class="p">][</span><span class="s2">&quot;artist&quot;</span><span class="p">][</span><span class="s2">&quot;tags&quot;</span><span class="p">]</span>
                <span class="k">del</span> <span class="n">expected</span><span class="p">[</span><span class="s2">&quot;artist&quot;</span><span class="p">][</span><span class="s2">&quot;tags&quot;</span><span class="p">]</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">verifyDictEqualOrFailCase</span><span class="p">(</span><span class="n">expected</span><span class="p">,</span> <span class="n">actual</span><span class="p">,</span>
                                              <span class="s2">&quot;Evented metadata should be as expected&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="MuseMetadataNamespaceTestsImpl.validate_album_art_uri"><a class="viewcode-back" href="../../webserver.html#webserver.muse_playbackmetadata_namespace.MuseMetadataNamespaceTestsImpl.validate_album_art_uri">[docs]</a>    <span class="k">def</span> <span class="nf">validate_album_art_uri</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Find a playbackMetadata status event that has current track metadata in it</span>
        <span class="c1"># and use that to pull out an albumart URI</span>
        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">generate_events</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">MetadataStatusEvent</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">event</span><span class="o">.</span><span class="n">current_item</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">event_src</span> <span class="o">=</span> <span class="n">event</span>
                    <span class="k">break</span>
        <span class="n">aa_uri</span> <span class="o">=</span> <span class="n">event_src</span><span class="o">.</span><span class="n">current_item</span><span class="p">[</span><span class="s1">&#39;track&#39;</span><span class="p">][</span><span class="s1">&#39;imageUrl&#39;</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">urllib2</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">aa_uri</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">verifyIsNotNoneOrFailCase</span><span class="p">(</span><span class="n">res</span><span class="p">,</span>
                                           <span class="s2">&quot;URI should not be None&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="n">urllib2</span><span class="o">.</span><span class="n">HTTPError</span><span class="p">,</span> <span class="n">urllib2</span><span class="o">.</span><span class="n">URLError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s2">&quot;Attempt to open &lt;</span><span class="si">{}</span><span class="s2">&gt; failed with error: &lt;</span><span class="si">{}</span><span class="s2">&gt;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">aa_uri</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span></div>

<div class="viewcode-block" id="MuseMetadataNamespaceTestsImpl.setup_for_smapi"><a class="viewcode-back" href="../../webserver.html#webserver.muse_playbackmetadata_namespace.MuseMetadataNamespaceTestsImpl.setup_for_smapi">[docs]</a>    <span class="k">def</span> <span class="nf">setup_for_smapi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zp</span><span class="p">,</span> <span class="n">muse_connection</span><span class="p">):</span>
        <span class="n">zp</span><span class="o">.</span><span class="n">Queue</span><span class="o">.</span><span class="n">AddURI</span><span class="p">(</span><span class="n">queue_id</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                             <span class="n">update_id</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                             <span class="n">enqueueduri</span><span class="o">=</span><span class="n">smapi</span><span class="o">.</span><span class="n">SMAPI_SERVER_TRACK_URI</span><span class="p">,</span>
                             <span class="n">enqueuedurimetadata</span><span class="o">=</span><span class="n">smapi</span><span class="o">.</span><span class="n">SMAPI_SERVER_TRACK_METADATA</span><span class="p">,</span>
                             <span class="n">desiredfirsttracknumberenqueued</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                             <span class="n">enqueueasnext</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">zp</span><span class="o">.</span><span class="n">AVTransport</span><span class="o">.</span><span class="n">use_queue</span><span class="p">()</span>
        <span class="n">muse_connection</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">group_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gid</span><span class="p">,</span> <span class="n">hhid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">muse_hhid</span><span class="p">)</span></div>

<div class="viewcode-block" id="MuseMetadataNamespaceTestsImpl.test_subscribe_missing_target_id"><a class="viewcode-back" href="../../webserver.html#webserver.muse_playbackmetadata_namespace.MuseMetadataNamespaceTestsImpl.test_subscribe_missing_target_id">[docs]</a>    <span class="k">def</span> <span class="nf">test_subscribe_missing_target_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">group_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">hhid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">muse_hhid</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify_event</span><span class="p">(</span><span class="n">Error</span><span class="p">,</span>
                          <span class="n">event_verifier</span><span class="o">=</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">error_code</span> <span class="o">==</span> <span class="n">Error</span><span class="o">.</span><span class="n">MISSING_PARAM</span><span class="p">))</span></div>

<div class="viewcode-block" id="MuseMetadataNamespaceTestsImpl.test_unsubscribe_missing_target_id"><a class="viewcode-back" href="../../webserver.html#webserver.muse_playbackmetadata_namespace.MuseMetadataNamespaceTestsImpl.test_unsubscribe_missing_target_id">[docs]</a>    <span class="k">def</span> <span class="nf">test_unsubscribe_missing_target_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">unsubscribe</span><span class="p">(</span><span class="n">group_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">hhid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">muse_hhid</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify_event</span><span class="p">(</span><span class="n">Error</span><span class="p">,</span>
                          <span class="n">event_verifier</span><span class="o">=</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">error_code</span> <span class="o">==</span> <span class="n">Error</span><span class="o">.</span><span class="n">MISSING_PARAM</span><span class="p">))</span></div>

<div class="viewcode-block" id="MuseMetadataNamespaceTestsImpl.test_unsubscribe"><a class="viewcode-back" href="../../webserver.html#webserver.muse_playbackmetadata_namespace.MuseMetadataNamespaceTestsImpl.test_unsubscribe">[docs]</a>    <span class="k">def</span> <span class="nf">test_unsubscribe</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">unsubscribe</span><span class="p">(</span><span class="n">group_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gid</span><span class="p">,</span> <span class="n">hhid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">muse_hhid</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify_event</span><span class="p">(</span><span class="n">Success</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="p">)</span></div>

<div class="viewcode-block" id="MuseMetadataNamespaceTestsImpl.test_unsubscribe_after_gc_gone"><a class="viewcode-back" href="../../webserver.html#webserver.muse_playbackmetadata_namespace.MuseMetadataNamespaceTestsImpl.test_unsubscribe_after_gc_gone">[docs]</a>    <span class="k">def</span> <span class="nf">test_unsubscribe_after_gc_gone</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Test unsubscribe to playback namespace on after gc gone</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Other group coordinator</span>
        <span class="n">diff_gc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_playback_gc</span><span class="p">()</span>
        <span class="n">diff_gc</span><span class="o">.</span><span class="n">AVTransport</span><span class="o">.</span><span class="n">clear_play_state</span><span class="p">()</span>
        <span class="n">diff_gc</span><span class="o">.</span><span class="n">AVTransport</span><span class="o">.</span><span class="n">clear_queue</span><span class="p">()</span>

        <span class="c1"># Subscribe to playback metadata on zp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">group_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gid</span><span class="p">,</span> <span class="n">hhid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">muse_hhid</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify_event</span><span class="p">(</span><span class="n">MetadataStatusEvent</span><span class="p">)</span>

        <span class="c1"># Cache GID</span>
        <span class="n">gid_cached</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gid</span>

        <span class="c1"># Join other group, zp is no longer group coordinator, this will trigger group coordinator gone</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">AVTransport</span><span class="o">.</span><span class="n">join_group</span><span class="p">(</span><span class="n">diff_gc</span><span class="p">)</span>
        <span class="n">diff_gc</span><span class="o">.</span><span class="n">AVTransport</span><span class="o">.</span><span class="n">BecomeCoordinatorOfStandaloneGroup</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify_event</span><span class="p">(</span><span class="n">GroupCoordinatorChangedEvent</span><span class="p">,</span>
                          <span class="n">event_verifier</span><span class="o">=</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">group_status</span> <span class="o">==</span> <span class="n">GroupStatus</span><span class="o">.</span><span class="n">GONE</span><span class="p">))</span>

        <span class="c1"># Send playback metadata unsubscribe command</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">unsubscribe</span><span class="p">(</span><span class="n">gid_cached</span><span class="p">,</span> <span class="n">hhid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">muse_hhid</span><span class="p">)</span>

        <span class="c1"># Verify the error is global error with code INVALID_OBJECT_ID</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify_event</span><span class="p">(</span><span class="n">Error</span><span class="p">,</span> <span class="n">event_verifier</span><span class="o">=</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="n">e</span><span class="o">.</span><span class="n">error_code</span> <span class="o">==</span> <span class="n">Error</span><span class="o">.</span><span class="n">INVALID_OBJECT_ID</span><span class="p">)</span>

        <span class="c1"># Manually set session id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">session_id</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="MuseMetadataNamespaceTestsImpl.test_unsubscribe_after_gc_moved"><a class="viewcode-back" href="../../webserver.html#webserver.muse_playbackmetadata_namespace.MuseMetadataNamespaceTestsImpl.test_unsubscribe_after_gc_moved">[docs]</a>    <span class="k">def</span> <span class="nf">test_unsubscribe_after_gc_moved</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Test unsubscribe to playback metadata namespace on after gc moved</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Other group coordinator</span>
        <span class="n">diff_gc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_playback_gc</span><span class="p">()</span>

        <span class="c1"># Subscribe to playback metadata on zp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">group_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gid</span><span class="p">,</span> <span class="n">hhid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">muse_hhid</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify_event</span><span class="p">(</span><span class="n">MetadataStatusEvent</span><span class="p">)</span>

        <span class="c1"># Cache GID</span>
        <span class="n">gid_cached</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gid</span>

        <span class="c1"># Have different player join zp and become standalone, this will trigger group coordinator updated and then moved</span>
        <span class="n">diff_gc</span><span class="o">.</span><span class="n">AVTransport</span><span class="o">.</span><span class="n">join_group</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify_event</span><span class="p">(</span><span class="n">GroupCoordinatorChangedEvent</span><span class="p">,</span>
                          <span class="n">event_verifier</span><span class="o">=</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">group_status</span> <span class="o">==</span> <span class="n">GroupStatus</span><span class="o">.</span><span class="n">UPDATED</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">AVTransport</span><span class="o">.</span><span class="n">BecomeCoordinatorOfStandaloneGroup</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify_event</span><span class="p">(</span><span class="n">GroupCoordinatorChangedEvent</span><span class="p">,</span>
                          <span class="n">event_verifier</span><span class="o">=</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">group_status</span> <span class="o">==</span> <span class="n">GroupStatus</span><span class="o">.</span><span class="n">MOVED</span><span class="p">))</span>

        <span class="c1"># Send playback metadata unsubscribe command</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">unsubscribe</span><span class="p">(</span><span class="n">gid_cached</span><span class="p">,</span> <span class="n">hhid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">muse_hhid</span><span class="p">)</span>

        <span class="c1"># Verify the error is global error with code INVALID_OBJECT_ID</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify_event</span><span class="p">(</span><span class="n">Error</span><span class="p">,</span> <span class="n">event_verifier</span><span class="o">=</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="n">e</span><span class="o">.</span><span class="n">error_code</span> <span class="o">==</span> <span class="n">Error</span><span class="o">.</span><span class="n">INVALID_OBJECT_ID</span><span class="p">)</span>

        <span class="c1"># Manually set session id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">session_id</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="MuseMetadataNamespaceTestsImpl.test_sourceurl_from_cq"><a class="viewcode-back" href="../../webserver.html#webserver.muse_playbackmetadata_namespace.MuseMetadataNamespaceTestsImpl.test_sourceurl_from_cq">[docs]</a>    <span class="k">def</span> <span class="nf">test_sourceurl_from_cq</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Check the event&#39;s currentTrack and nextTrack containers to make sure we&#39;re not sending out the trackUrl attribute</span>
<span class="sd">        From a cloud queue source</span>
<span class="sd">        :return:</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">load_cloud_queue</span><span class="p">(</span><span class="n">session_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">session_id</span><span class="p">,</span>
                                         <span class="n">hhid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">muse_hhid</span><span class="p">,</span>
                                         <span class="n">queue_base_url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cq_control</span><span class="o">.</span><span class="n">CQ_PLAYBACK_URI</span><span class="p">,</span>
                                         <span class="n">content_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                         <span class="n">httpAuthorization</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                         <span class="n">item_id</span><span class="o">=</span><span class="s2">&quot;0&quot;</span><span class="p">,</span>
                                         <span class="n">position_millis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                         <span class="n">play_on_completion</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                         <span class="n">track_metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_metadata_sourceUrl</span><span class="p">()</span></div>

<div class="viewcode-block" id="MuseMetadataNamespaceTestsImpl.test_sourceurl_from_web_server"><a class="viewcode-back" href="../../webserver.html#webserver.muse_playbackmetadata_namespace.MuseMetadataNamespaceTestsImpl.test_sourceurl_from_web_server">[docs]</a>    <span class="k">def</span> <span class="nf">test_sourceurl_from_web_server</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Check the event&#39;s currentTrack and nextTrack containers to make sure we&#39;re not sending out the trackUrl attribute</span>
<span class="sd">        From a web server source</span>
<span class="sd">        :return:</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_web_server_add_tracks_md</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_metadata_sourceUrl</span><span class="p">()</span>

        <span class="c1"># Added for SWPBL-83111</span>
        <span class="n">metadata_body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">test_events</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">body</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">subscribe_playbackExtended</span><span class="p">(</span><span class="n">groupId</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gid</span><span class="p">,</span> <span class="n">hhid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">muse_hhid</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify_event</span><span class="p">(</span><span class="n">PlaybackExtendedStatusEvent</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">playbackExt_metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">test_events</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">metadata</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verifyDictEqualOrFailCase</span><span class="p">(</span><span class="n">metadata_body</span><span class="p">,</span> <span class="n">playbackExt_metadata</span><span class="p">,</span>
                                       <span class="s2">&quot;Metadata namespace event should match metadata from&quot;</span>
                                       <span class="s2">&quot;playbackExtended namepace&quot;</span><span class="p">)</span>
        <span class="n">webserver</span><span class="o">.</span><span class="n">cleanup</span><span class="p">()</span></div>

<div class="viewcode-block" id="MuseMetadataNamespaceTestsImpl.test_cq_metadata_accuracy"><a class="viewcode-back" href="../../webserver.html#webserver.muse_playbackmetadata_namespace.MuseMetadataNamespaceTestsImpl.test_cq_metadata_accuracy">[docs]</a>    <span class="k">def</span> <span class="nf">test_cq_metadata_accuracy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Checks the accuracy of the metadata event by comparing it to the actual track metadata</span>
<span class="sd">        after a load, skip and natural track progression</span>
<span class="sd">        From a cloud queue source</span>
<span class="sd">        :return:</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">md0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cq_control</span><span class="o">.</span><span class="n">get_track_metadata</span><span class="p">(</span><span class="s2">&quot;0&quot;</span><span class="p">)</span>
        <span class="n">md1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cq_control</span><span class="o">.</span><span class="n">get_track_metadata</span><span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">)</span>
        <span class="n">md2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cq_control</span><span class="o">.</span><span class="n">get_track_metadata</span><span class="p">(</span><span class="s2">&quot;2&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">load_cloud_queue</span><span class="p">(</span><span class="n">session_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">session_id</span><span class="p">,</span>
                                   <span class="n">hhid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">muse_hhid</span><span class="p">,</span>
                                   <span class="n">queue_base_url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cq_control</span><span class="o">.</span><span class="n">CQ_PLAYBACK_URI</span><span class="p">,</span>
                                   <span class="n">content_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                   <span class="n">httpAuthorization</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                   <span class="n">play_on_completion</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                   <span class="n">track_metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify_event</span><span class="p">(</span><span class="n">MetadataStatusEvent</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                          <span class="n">event_verifier</span><span class="o">=</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">current_item</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                                                    <span class="n">e</span><span class="o">.</span><span class="n">next_item</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">))</span>

        <span class="c1"># Added for SWPBL-83111</span>
        <span class="n">metadata_body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">test_events</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">body</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">subscribe_playbackExtended</span><span class="p">(</span><span class="n">groupId</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gid</span><span class="p">,</span> <span class="n">hhid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">muse_hhid</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify_event</span><span class="p">(</span><span class="n">PlaybackExtendedStatusEvent</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">playbackExt_metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">test_events</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">metadata</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verifyDictEqualOrFailCase</span><span class="p">(</span><span class="n">metadata_body</span><span class="p">,</span> <span class="n">playbackExt_metadata</span><span class="p">,</span>
                                       <span class="s2">&quot;Metadata namespace event should match metadata from&quot;</span>
                                       <span class="s2">&quot;playbackExtended namepace&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_customVerifyDictEqualOrFailCase</span><span class="p">(</span><span class="n">md0</span><span class="p">,</span> <span class="n">metadata_body</span><span class="p">[</span><span class="s2">&quot;currentItem&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_customVerifyDictEqualOrFailCase</span><span class="p">(</span><span class="n">md1</span><span class="p">,</span> <span class="n">metadata_body</span><span class="p">[</span><span class="s2">&quot;nextItem&quot;</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">skip_to_item</span><span class="p">(</span><span class="n">session_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">session_id</span><span class="p">,</span>
                                         <span class="n">hhid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">muse_hhid</span><span class="p">,</span>
                                         <span class="n">item_id</span><span class="o">=</span><span class="s2">&quot;1&quot;</span><span class="p">,</span>
                                         <span class="n">play_on_completion</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                         <span class="n">track_metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify_event</span><span class="p">(</span><span class="n">MetadataStatusEvent</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                          <span class="n">event_verifier</span><span class="o">=</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_customVerifyDictEqualOrFailCase</span><span class="p">(</span><span class="n">md1</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">current_item</span><span class="p">)</span> <span class="ow">and</span>
                                                    <span class="bp">self</span><span class="o">.</span><span class="n">_customVerifyDictEqualOrFailCase</span><span class="p">(</span><span class="n">md2</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">next_item</span><span class="p">)))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">session_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">session_id</span><span class="p">,</span> <span class="n">hhid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">muse_hhid</span><span class="p">,</span>
                       <span class="n">item_id</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="n">position_millis</span><span class="o">=</span><span class="mi">27000</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">play</span><span class="p">(</span><span class="n">group_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gid</span><span class="p">,</span> <span class="n">session_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">session_id</span><span class="p">,</span> <span class="n">hhid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">muse_hhid</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify_event</span><span class="p">(</span><span class="n">MetadataStatusEvent</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                          <span class="n">event_verifier</span><span class="o">=</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_customVerifyDictEqualOrFailCase</span><span class="p">(</span><span class="n">md2</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">current_item</span><span class="p">)))</span>

        <span class="c1"># SWPBL-86324</span>
        <span class="c1"># Verify the md event doesn&#39;t have a container object if you play v1 CQ after v2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">muse_session_helper</span><span class="o">.</span><span class="n">make_muse_session</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="p">,</span> <span class="n">group_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gid</span><span class="p">,</span> <span class="n">hhid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">muse_hhid</span><span class="p">,</span> <span class="n">test_fixture</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop_cloud_queue_server</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_cloud_queue_server</span><span class="p">(</span><span class="n">endpoint_version</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear_message_queue</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">load_cloud_queue</span><span class="p">(</span><span class="n">session_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">session_id</span><span class="p">,</span>
                                   <span class="n">hhid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">muse_hhid</span><span class="p">,</span>
                                   <span class="n">queue_base_url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cq_control</span><span class="o">.</span><span class="n">CQ_PLAYBACK_URI</span><span class="p">,</span>
                                   <span class="n">content_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                   <span class="n">httpAuthorization</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                   <span class="n">play_on_completion</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                   <span class="n">track_metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify_event</span><span class="p">(</span><span class="n">MetadataStatusEvent</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">expect_event</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">iterations</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                          <span class="n">event_verifier</span><span class="o">=</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">container</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span></div>

<div class="viewcode-block" id="MuseMetadataNamespaceTestsImpl.test_cq_get_metadata_status"><a class="viewcode-back" href="../../webserver.html#webserver.muse_playbackmetadata_namespace.MuseMetadataNamespaceTestsImpl.test_cq_get_metadata_status">[docs]</a>    <span class="k">def</span> <span class="nf">test_cq_get_metadata_status</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Checks that the get metadata status command succeeds and that the returned metadata is accurate</span>
<span class="sd">        :return:</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">md0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cq_control</span><span class="o">.</span><span class="n">get_track_metadata</span><span class="p">(</span><span class="s2">&quot;0&quot;</span><span class="p">)</span>
        <span class="n">md1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cq_control</span><span class="o">.</span><span class="n">get_track_metadata</span><span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">)</span>

        <span class="c1"># First load cloud queue and get metadata status event since we are subscribed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">load_cloud_queue</span><span class="p">(</span><span class="n">session_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">session_id</span><span class="p">,</span>
                                   <span class="n">hhid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">muse_hhid</span><span class="p">,</span>
                                   <span class="n">queue_base_url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cq_control</span><span class="o">.</span><span class="n">CQ_PLAYBACK_URI</span><span class="p">,</span>
                                   <span class="n">content_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                   <span class="n">httpAuthorization</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                   <span class="n">play_on_completion</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                   <span class="n">track_metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify_event</span><span class="p">(</span><span class="n">MetadataStatusEvent</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                          <span class="n">event_verifier</span><span class="o">=</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">current_item</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                                                    <span class="n">e</span><span class="o">.</span><span class="n">next_item</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">))</span>

        <span class="c1"># After first metadata status event, use get metdata status to get another event</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">getMetadataStatus</span><span class="p">(</span><span class="n">group_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gid</span><span class="p">,</span> <span class="n">hhid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">muse_hhid</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify_event</span><span class="p">(</span><span class="n">MetadataStatusEvent</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                          <span class="n">event_verifier</span><span class="o">=</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">current_item</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                                                    <span class="n">e</span><span class="o">.</span><span class="n">next_item</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                                                    <span class="n">e</span><span class="o">.</span><span class="n">response</span> <span class="o">==</span> <span class="s2">&quot;getMetadataStatus&quot;</span><span class="p">))</span>

        <span class="c1"># Check the second event payload against the known cloud queue metadata</span>
        <span class="n">metadata_body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">test_events</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">body</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_customVerifyDictEqualOrFailCase</span><span class="p">(</span><span class="n">md0</span><span class="p">,</span> <span class="n">metadata_body</span><span class="p">[</span><span class="s2">&quot;currentItem&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_customVerifyDictEqualOrFailCase</span><span class="p">(</span><span class="n">md1</span><span class="p">,</span> <span class="n">metadata_body</span><span class="p">[</span><span class="s2">&quot;nextItem&quot;</span><span class="p">])</span></div>

<div class="viewcode-block" id="MuseMetadataNamespaceTestsImpl.test_cq_metadata_source_priority"><a class="viewcode-back" href="../../webserver.html#webserver.muse_playbackmetadata_namespace.MuseMetadataNamespaceTestsImpl.test_cq_metadata_source_priority">[docs]</a>    <span class="k">def</span> <span class="nf">test_cq_metadata_source_priority</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Checks that metadata event information is being retrieved from the CQ tracks,</span>
<span class="sd">        not what is being fed in through track_metadata</span>
<span class="sd">        From a cloud queue source</span>
<span class="sd">        :return:</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">bad_md</span> <span class="o">=</span> <span class="n">cq_helper</span><span class="o">.</span><span class="n">fake_metadata</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cq_control</span><span class="o">.</span><span class="n">CQ_URI</span><span class="p">,</span> <span class="n">item</span><span class="o">=</span><span class="s2">&quot;0&quot;</span><span class="p">)</span>
        <span class="n">md0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cq_control</span><span class="o">.</span><span class="n">get_track_metadata</span><span class="p">(</span><span class="s2">&quot;0&quot;</span><span class="p">)</span>
        <span class="n">md1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cq_control</span><span class="o">.</span><span class="n">get_track_metadata</span><span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">)</span>
        <span class="n">md2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cq_control</span><span class="o">.</span><span class="n">get_track_metadata</span><span class="p">(</span><span class="s2">&quot;2&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">load_cloud_queue</span><span class="p">(</span><span class="n">session_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">session_id</span><span class="p">,</span>
                                   <span class="n">hhid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">muse_hhid</span><span class="p">,</span>
                                   <span class="n">queue_base_url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cq_control</span><span class="o">.</span><span class="n">CQ_PLAYBACK_URI</span><span class="p">,</span>
                                   <span class="n">content_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                   <span class="n">httpAuthorization</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                   <span class="n">play_on_completion</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                   <span class="n">track_metadata</span><span class="o">=</span><span class="n">bad_md</span><span class="p">,</span>
                                   <span class="n">item_id</span><span class="o">=</span><span class="s2">&quot;0&quot;</span><span class="p">,</span>
                                   <span class="n">position_millis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify_event</span><span class="p">(</span><span class="n">MetadataStatusEvent</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                          <span class="n">event_verifier</span><span class="o">=</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">current_item</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                                                    <span class="n">e</span><span class="o">.</span><span class="n">next_item</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                                                    <span class="n">e</span><span class="o">.</span><span class="n">current_item</span><span class="p">[</span><span class="s2">&quot;track&quot;</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">md0</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_customVerifyDictEqualOrFailCase</span><span class="p">(</span><span class="n">md0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">test_events</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">current_item</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_customVerifyDictEqualOrFailCase</span><span class="p">(</span><span class="n">md1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">test_events</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">next_item</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">skip_to_item</span><span class="p">(</span><span class="n">session_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">session_id</span><span class="p">,</span>
                               <span class="n">hhid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">muse_hhid</span><span class="p">,</span>
                               <span class="n">item_id</span><span class="o">=</span><span class="s2">&quot;1&quot;</span><span class="p">,</span>
                               <span class="n">play_on_completion</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                               <span class="n">track_metadata</span><span class="o">=</span><span class="n">bad_md</span><span class="p">,</span>
                               <span class="n">position_millis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify_event</span><span class="p">(</span><span class="n">MetadataStatusEvent</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                          <span class="n">event_verifier</span><span class="o">=</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">current_item</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                                                    <span class="n">e</span><span class="o">.</span><span class="n">next_item</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                                                    <span class="n">e</span><span class="o">.</span><span class="n">current_item</span><span class="p">[</span><span class="s2">&quot;track&quot;</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">md1</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_customVerifyDictEqualOrFailCase</span><span class="p">(</span><span class="n">md1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">test_events</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">current_item</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_customVerifyDictEqualOrFailCase</span><span class="p">(</span><span class="n">md2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">test_events</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">next_item</span><span class="p">)</span></div>

<div class="viewcode-block" id="MuseMetadataNamespaceTestsImpl.check_metadata_sourceUrl"><a class="viewcode-back" href="../../webserver.html#webserver.muse_playbackmetadata_namespace.MuseMetadataNamespaceTestsImpl.check_metadata_sourceUrl">[docs]</a>    <span class="k">def</span> <span class="nf">check_metadata_sourceUrl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">next_track</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Subscribes to the metadata namespace and looks for whether the mediaUrl attribute</span>
<span class="sd">        is present in the current or next track metadata fields</span>
<span class="sd">        :return:</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">next_track</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">verify_event</span><span class="p">(</span><span class="n">MetadataStatusEvent</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                              <span class="n">event_verifier</span><span class="o">=</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">current_item</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                                                        <span class="n">e</span><span class="o">.</span><span class="n">next_item</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                                                        <span class="s2">&quot;mediaUrl&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">e</span><span class="o">.</span><span class="n">current_item</span> <span class="ow">and</span>
                                                        <span class="s2">&quot;mediaUrl&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">e</span><span class="o">.</span><span class="n">next_item</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">verify_event</span><span class="p">(</span><span class="n">MetadataStatusEvent</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                              <span class="n">event_verifier</span><span class="o">=</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">current_item</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                                                        <span class="n">e</span><span class="o">.</span><span class="n">next_item</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span>
                                                        <span class="s2">&quot;mediaUrl&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">e</span><span class="o">.</span><span class="n">current_item</span><span class="p">))</span></div>

<div class="viewcode-block" id="MuseMetadataNamespaceTestsImpl.start_web_server_add_tracks_md"><a class="viewcode-back" href="../../webserver.html#webserver.muse_playbackmetadata_namespace.MuseMetadataNamespaceTestsImpl.start_web_server_add_tracks_md">[docs]</a>    <span class="k">def</span> <span class="nf">start_web_server_add_tracks_md</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">webserver</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="n">port</span><span class="o">=</span><span class="mi">8080</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">AVTransport</span><span class="o">.</span><span class="n">use_queue</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">AVTransport</span><span class="o">.</span><span class="n">clear_queue_and_wait</span><span class="p">()</span>
        <span class="n">track_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">track_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">track_source</span><span class="o">.</span><span class="n">tracks</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">track_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">track_source</span><span class="o">.</span><span class="n">tracks</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">track_list_md</span> <span class="o">=</span> <span class="n">queue_helpers</span><span class="o">.</span><span class="n">create_didl_lite_md</span><span class="p">(</span><span class="n">track_list</span><span class="p">)</span>
        <span class="n">enqueued_uris_and_metadata</span> <span class="o">=</span> <span class="n">queue_helpers</span><span class="o">.</span><span class="n">create_uri_and_metadata_xml</span><span class="p">(</span><span class="n">track_list</span><span class="p">,</span> <span class="n">track_list_md</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">Queue</span><span class="o">.</span><span class="n">AddMultipleURIs</span><span class="p">(</span><span class="n">queue_id</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                         <span class="n">update_id</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                         <span class="n">container_uri</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                                         <span class="n">container_metadata</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                                         <span class="n">desired_first_track_number_enqueued</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                         <span class="n">enqueue_as_next</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                         <span class="n">number_of_uris</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">track_list</span><span class="p">),</span>
                                         <span class="n">enqueued_uris_and_metadata</span><span class="o">=</span><span class="n">enqueued_uris_and_metadata</span><span class="p">)</span></div>

<div class="viewcode-block" id="MuseMetadataNamespaceTestsImpl.test_no_next_track_metadata_cq"><a class="viewcode-back" href="../../webserver.html#webserver.muse_playbackmetadata_namespace.MuseMetadataNamespaceTestsImpl.test_no_next_track_metadata_cq">[docs]</a>    <span class="k">def</span> <span class="nf">test_no_next_track_metadata_cq</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Verify when we are playing the last item in the local queue from a cloud queue source</span>
<span class="sd">        that there is no nextTrackMetadata object in the metadataStatusEvent</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">muse_session_helper</span><span class="o">.</span><span class="n">start_cloud_queue_client</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="p">,</span> <span class="n">group_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gid</span><span class="p">,</span> <span class="n">hhid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">muse_hhid</span><span class="p">,</span> <span class="n">test_fixture</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">skip_to_item</span><span class="p">(</span><span class="n">session_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">session_id</span><span class="p">,</span> <span class="n">hhid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">muse_hhid</span><span class="p">,</span>
                               <span class="n">item_id</span><span class="o">=</span><span class="s1">&#39;2&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify_event</span><span class="p">(</span><span class="n">MetadataStatusEvent</span><span class="p">,</span>
                          <span class="n">event_verifier</span><span class="o">=</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="n">e</span><span class="o">.</span><span class="n">next_item</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span></div>

<div class="viewcode-block" id="MuseMetadataNamespaceTestsImpl.test_no_next_track_metadata_smapi"><a class="viewcode-back" href="../../webserver.html#webserver.muse_playbackmetadata_namespace.MuseMetadataNamespaceTestsImpl.test_no_next_track_metadata_smapi">[docs]</a>    <span class="k">def</span> <span class="nf">test_no_next_track_metadata_smapi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Verify when we are playing the last item in the local queue from a smapi source</span>
<span class="sd">        that there is no nextTrackMetadata object in the metadataStatusEvent</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setup_for_smapi</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">AVTransport</span><span class="o">.</span><span class="n">Play_and_wait</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify_event</span><span class="p">(</span><span class="n">MetadataStatusEvent</span><span class="p">,</span>
                          <span class="n">event_verifier</span><span class="o">=</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="n">e</span><span class="o">.</span><span class="n">next_item</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span>

        <span class="c1"># Added for SWPBL-83111</span>
        <span class="n">metadata_body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">test_events</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">body</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">subscribe_playbackExtended</span><span class="p">(</span><span class="n">groupId</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gid</span><span class="p">,</span> <span class="n">hhid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">muse_hhid</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify_event</span><span class="p">(</span><span class="n">PlaybackExtendedStatusEvent</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">playbackExt_metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">test_events</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">metadata</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verifyDictEqualOrFailCase</span><span class="p">(</span><span class="n">metadata_body</span><span class="p">,</span> <span class="n">playbackExt_metadata</span><span class="p">,</span>
                                       <span class="s2">&quot;Metadata namespace event should match metadata from&quot;</span>
                                       <span class="s2">&quot;playbackExtended namepace&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MuseMetadataNamespaceTestsImpl.test_event_sent_after_adding_track"><a class="viewcode-back" href="../../webserver.html#webserver.muse_playbackmetadata_namespace.MuseMetadataNamespaceTestsImpl.test_event_sent_after_adding_track">[docs]</a>    <span class="k">def</span> <span class="nf">test_event_sent_after_adding_track</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Verify when we are playing the last item in the local queue from a cloud queue source</span>
<span class="sd">        that there is no nextTrackMetadata object in the metadataStatusEvent.</span>
<span class="sd">        Verify once another track is added to the player&#39;s local queue from the cloud queue</span>
<span class="sd">        source that a metadataStatusEvent is sent that contains a nextTrackMetadata object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">muse_session_helper</span><span class="o">.</span><span class="n">start_cloud_queue_client</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="p">,</span> <span class="n">group_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gid</span><span class="p">,</span> <span class="n">hhid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">muse_hhid</span><span class="p">,</span> <span class="n">test_fixture</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">skip_to_item</span><span class="p">(</span><span class="n">session_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">session_id</span><span class="p">,</span> <span class="n">hhid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">muse_hhid</span><span class="p">,</span>
                               <span class="n">item_id</span><span class="o">=</span><span class="s1">&#39;2&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify_event</span><span class="p">(</span><span class="n">MetadataStatusEvent</span><span class="p">,</span>
                          <span class="n">event_verifier</span><span class="o">=</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="n">e</span><span class="o">.</span><span class="n">next_item</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cq_control</span><span class="o">.</span><span class="n">add_track_to_end</span><span class="p">(</span><span class="n">track_id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify_event</span><span class="p">(</span><span class="n">MetadataStatusEvent</span><span class="p">,</span>
                          <span class="n">event_verifier</span><span class="o">=</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="n">e</span><span class="o">.</span><span class="n">next_item</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span></div>

<div class="viewcode-block" id="MuseMetadataNamespaceTestsImpl.test_album_art_uri_resolve_cq"><a class="viewcode-back" href="../../webserver.html#webserver.muse_playbackmetadata_namespace.MuseMetadataNamespaceTestsImpl.test_album_art_uri_resolve_cq">[docs]</a>    <span class="k">def</span> <span class="nf">test_album_art_uri_resolve_cq</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Verify CloudQueue music source album art resolves when accessed from the URI returned</span>
<span class="sd">        in the playbackMetadata event.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">muse_session_helper</span><span class="o">.</span><span class="n">start_cloud_queue_client</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="p">,</span> <span class="n">test_fixture</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validate_album_art_uri</span><span class="p">()</span></div>

<div class="viewcode-block" id="MuseMetadataNamespaceTestsImpl.test_album_art_uri_resolve_smapi"><a class="viewcode-back" href="../../webserver.html#webserver.muse_playbackmetadata_namespace.MuseMetadataNamespaceTestsImpl.test_album_art_uri_resolve_smapi">[docs]</a>    <span class="k">def</span> <span class="nf">test_album_art_uri_resolve_smapi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Verify SMAPI music source album art resolves when accessed from the URI returned</span>
<span class="sd">        in the playbackMetadata event.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setup_for_smapi</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validate_album_art_uri</span><span class="p">()</span></div>

<div class="viewcode-block" id="MuseMetadataNamespaceTestsImpl.test_metadata_from_siriusXM"><a class="viewcode-back" href="../../webserver.html#webserver.muse_playbackmetadata_namespace.MuseMetadataNamespaceTestsImpl.test_metadata_from_siriusXM">[docs]</a>    <span class="k">def</span> <span class="nf">test_metadata_from_siriusXM</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        SWPBL-12583</span>
<span class="sd">        Verify the metadata returned when playing a SiriusXM radio station when played through the SiriuXM</span>
<span class="sd">        smapi service.</span>
<span class="sd">        We try to verify as much as possible but we don&#39;t know what song the station will be playing when</span>
<span class="sd">        this test runs.</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># skip this test if we&#39;re not able to add the Sirius account</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="s2">&quot;9479&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">MusicServices</span><span class="o">.</span><span class="n">get_available_service_type_list</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">skip</span><span class="p">(</span><span class="s2">&quot;Skip SiriusXM playback - service not available on testbed&quot;</span><span class="p">)</span>
        <span class="n">svc_acct</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">SystemProperties</span><span class="o">.</span><span class="n">get_service_account</span><span class="p">(</span><span class="mi">9479</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">load_stream</span><span class="p">(</span><span class="n">hhid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">muse_hhid</span><span class="p">,</span> <span class="n">groupId</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gid</span><span class="p">,</span>
                              <span class="n">stationId</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;serviceId&quot;</span><span class="p">:</span> <span class="s2">&quot;37&quot;</span><span class="p">,</span>
                                         <span class="s2">&quot;objectId&quot;</span><span class="p">:</span> <span class="s2">&quot;r:purejazz&quot;</span><span class="p">,</span>
                                         <span class="s2">&quot;accountId&quot;</span><span class="p">:</span> <span class="s2">&quot;sn_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">svc_acct</span><span class="o">.</span><span class="n">serial_number</span><span class="p">)},</span>
                              <span class="n">playOnCompletion</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">group_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gid</span><span class="p">,</span> <span class="n">hhid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">muse_hhid</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify_event</span><span class="p">(</span><span class="n">MetadataStatusEvent</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                          <span class="n">event_verifier</span><span class="o">=</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">next_item</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span>
                                                    <span class="n">e</span><span class="o">.</span><span class="n">current_item</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                                                    <span class="n">e</span><span class="o">.</span><span class="n">current_item</span><span class="p">[</span><span class="s2">&quot;track&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                                                    <span class="n">e</span><span class="o">.</span><span class="n">container</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;67 - Real Jazz&quot;</span> <span class="ow">and</span>
                                                    <span class="n">e</span><span class="o">.</span><span class="n">container</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;station&quot;</span> <span class="ow">and</span>
                                                    <span class="n">e</span><span class="o">.</span><span class="n">container</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                                                    <span class="n">e</span><span class="o">.</span><span class="n">container</span><span class="p">[</span><span class="s2">&quot;service&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">))</span>

        <span class="c1"># Added for SWPBL-83111</span>
        <span class="n">metadata_body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">test_events</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">body</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">subscribe_playbackExtended</span><span class="p">(</span><span class="n">groupId</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gid</span><span class="p">,</span> <span class="n">hhid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">muse_hhid</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify_event</span><span class="p">(</span><span class="n">PlaybackExtendedStatusEvent</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">playbackExt_metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">test_events</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">metadata</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verifyDictEqualOrFailCase</span><span class="p">(</span><span class="n">metadata_body</span><span class="p">,</span> <span class="n">playbackExt_metadata</span><span class="p">,</span>
                                       <span class="s2">&quot;Metadata namespace event should match metadata from&quot;</span>
                                       <span class="s2">&quot;playbackExtended namepace&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MuseMetadataNamespaceTestsImpl.test_metadata_from_TuneIn_radio"><a class="viewcode-back" href="../../webserver.html#webserver.muse_playbackmetadata_namespace.MuseMetadataNamespaceTestsImpl.test_metadata_from_TuneIn_radio">[docs]</a>    <span class="nd">@combinatorial</span><span class="p">(</span><span class="n">tunein_station_generator</span><span class="p">())</span>
    <span class="k">def</span> <span class="nf">test_metadata_from_TuneIn_radio</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">md</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        SWPBL-47115</span>
<span class="sd">        Verify that metadata events for various tunein stations have non-empty &#39;container&#39; and &#39;currentShow&#39; fields</span>
<span class="sd">        Some limitations:</span>
<span class="sd">        1. We&#39;re using live stations so we can&#39;t verify the exact contents of all the fields.</span>
<span class="sd">        2. We can&#39;t verify if streamInfo is present or not since we might be testing while the station is in commercial</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">AVTransport</span><span class="o">.</span><span class="n">SetAVTransportURI</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">md</span><span class="p">)</span>
        <span class="c1"># TODO: This a is a crappy workaround in case one of the station fails to load.</span>
        <span class="c1"># Need to find a more elegant solution to this, maybe modify verify_events to have option</span>
        <span class="c1"># to not fail the test if it fails</span>
        <span class="n">attempts</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">AVTransport</span><span class="o">.</span><span class="n">is_playing</span><span class="p">()</span> <span class="ow">and</span> <span class="n">attempts</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">AVTransport</span><span class="o">.</span><span class="n">Play_and_wait</span><span class="p">(</span><span class="n">timeout_seconds</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">TimeoutError</span><span class="p">:</span>
                <span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
                <span class="n">attempts</span> <span class="o">-=</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">verify_event</span><span class="p">(</span><span class="n">PlaybackStatusEvent</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                          <span class="n">event_verifier</span><span class="o">=</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">playback_state</span> <span class="o">==</span> <span class="n">PlaybackState</span><span class="o">.</span><span class="n">PLAYING</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">group_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gid</span><span class="p">,</span> <span class="n">hhid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">muse_hhid</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify_event</span><span class="p">(</span><span class="n">MetadataStatusEvent</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                          <span class="n">event_verifier</span><span class="o">=</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="p">(</span><span class="c1"># These are commented out for now since they might show up</span>
                                                    <span class="c1"># depending on what station is played and when it is played</span>
                                                    <span class="c1"># &quot;imageUrl&quot; in e.container and</span>
                                                    <span class="c1"># e.currentShow[&quot;name&quot;] is not None and</span>
                                                    <span class="c1"># e.currentShow[&quot;id&quot;] is not None and</span>
                                                    <span class="n">e</span><span class="o">.</span><span class="n">next_item</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span>
                                                    <span class="n">e</span><span class="o">.</span><span class="n">current_item</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span>
                                                    <span class="n">name</span> <span class="ow">in</span> <span class="n">e</span><span class="o">.</span><span class="n">container</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="ow">and</span>
                                                    <span class="n">e</span><span class="o">.</span><span class="n">container</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;station&quot;</span> <span class="ow">and</span>
                                                    <span class="n">e</span><span class="o">.</span><span class="n">container</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                                                    <span class="n">e</span><span class="o">.</span><span class="n">container</span><span class="p">[</span><span class="s2">&quot;service&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify_event</span><span class="p">(</span><span class="n">MetadataStatusEvent</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">iterations</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                          <span class="n">past_events</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">expect_event</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                          <span class="n">event_verifier</span><span class="o">=</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">streamInfo</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;ZPSTR_CONNECTING&quot;</span><span class="p">,</span>
                                                                     <span class="s2">&quot;ZPSTR_BUFFERING&quot;</span><span class="p">]))</span></div>

<div class="viewcode-block" id="MuseMetadataNamespaceTestsImpl.test_cq_explicit_metadata"><a class="viewcode-back" href="../../webserver.html#webserver.muse_playbackmetadata_namespace.MuseMetadataNamespaceTestsImpl.test_cq_explicit_metadata">[docs]</a>    <span class="k">def</span> <span class="nf">test_cq_explicit_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        SWPBL-71794</span>
<span class="sd">        Verify that metadata from cloudqueue tracks that are marked as explicit contains explicit tags</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Reconnect to the player with a new mock CQ server pointing to explicit tracks</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disconnect_all</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">muse</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_connection</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">muse_session_helper</span><span class="o">.</span><span class="n">make_muse_session</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="p">,</span> <span class="n">group_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gid</span><span class="p">,</span>
                                                   <span class="n">hhid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">muse_hhid</span><span class="p">,</span> <span class="n">test_fixture</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">subscribe_playback</span><span class="p">(</span><span class="n">group_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gid</span><span class="p">,</span> <span class="n">hhid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">muse_hhid</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify_event</span><span class="p">(</span><span class="n">PlaybackStatusEvent</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop_cloud_queue_server</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_cloud_queue_server</span><span class="p">(</span><span class="n">library_path</span><span class="o">=</span><span class="s2">&quot;/explicit&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">load_cloud_queue</span><span class="p">(</span><span class="n">session_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">session_id</span><span class="p">,</span>
                                         <span class="n">hhid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">muse_hhid</span><span class="p">,</span>
                                         <span class="n">queue_base_url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cq_control</span><span class="o">.</span><span class="n">CQ_PLAYBACK_URI</span><span class="p">,</span>
                                         <span class="n">content_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                         <span class="n">httpAuthorization</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                         <span class="n">item_id</span><span class="o">=</span><span class="s2">&quot;0&quot;</span><span class="p">,</span>
                                         <span class="n">position_millis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                         <span class="n">play_on_completion</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                         <span class="n">track_metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

        <span class="n">md0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cq_control</span><span class="o">.</span><span class="n">get_track_metadata</span><span class="p">(</span><span class="s2">&quot;0&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verifyEqualOrFailCase</span><span class="p">(</span><span class="n">md0</span><span class="p">[</span><span class="s2">&quot;tags&quot;</span><span class="p">],</span> <span class="p">[</span><span class="sa">u</span><span class="s2">&quot;TAG_EXPLICIT&quot;</span><span class="p">],</span> <span class="s2">&quot;Track should contain explicit tag.&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">subscribe_metadata</span><span class="p">(</span><span class="n">group_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gid</span><span class="p">,</span> <span class="n">hhid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">muse_hhid</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify_event</span><span class="p">(</span><span class="n">MetadataStatusEvent</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                          <span class="n">event_verifier</span><span class="o">=</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">current_item</span><span class="p">[</span><span class="s2">&quot;track&quot;</span><span class="p">][</span><span class="s2">&quot;tags&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="p">[</span><span class="sa">u</span><span class="s2">&quot;TAG_EXPLICIT&quot;</span><span class="p">]))</span></div>

<div class="viewcode-block" id="MuseMetadataNamespaceTestsImpl.test_track_service_object_shows_up_in_metadata_event"><a class="viewcode-back" href="../../webserver.html#webserver.muse_playbackmetadata_namespace.MuseMetadataNamespaceTestsImpl.test_track_service_object_shows_up_in_metadata_event">[docs]</a>    <span class="k">def</span> <span class="nf">test_track_service_object_shows_up_in_metadata_event</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        SWPBL-80424</span>
<span class="sd">        SWPBL-80427</span>
<span class="sd">        Verify the &quot;service&quot; object passed in as part of the metadata shows up in the metadata muse</span>
<span class="sd">        event and upnp properties</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">md</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">md</span><span class="p">[</span><span class="s2">&quot;track&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cq_control</span><span class="o">.</span><span class="n">get_track_metadata</span><span class="p">(</span><span class="s2">&quot;0&quot;</span><span class="p">)</span>
        <span class="n">md</span><span class="p">[</span><span class="s2">&quot;track&quot;</span><span class="p">][</span><span class="s2">&quot;service&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;12&quot;</span><span class="p">,</span>
                         <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Spotify&quot;</span><span class="p">,</span>
                         <span class="s2">&quot;imageUrl&quot;</span><span class="p">:</span> <span class="s2">&quot;SOME_HTTP_LINK&quot;</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cq_control</span><span class="o">.</span><span class="n">add_custom_track_to_end</span><span class="p">(</span><span class="n">md</span><span class="o">=</span><span class="n">md</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">load_cloud_queue</span><span class="p">(</span><span class="n">session_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">session_id</span><span class="p">,</span>
                                         <span class="n">hhid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">muse_hhid</span><span class="p">,</span>
                                         <span class="n">queue_base_url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cq_control</span><span class="o">.</span><span class="n">CQ_PLAYBACK_URI</span><span class="p">,</span>
                                         <span class="n">content_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                         <span class="n">httpAuthorization</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                         <span class="n">item_id</span><span class="o">=</span><span class="s2">&quot;2&quot;</span><span class="p">,</span>
                                         <span class="n">position_millis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                         <span class="n">play_on_completion</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify_event</span><span class="p">(</span><span class="n">MetadataStatusEvent</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                          <span class="n">event_verifier</span><span class="o">=</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">next_item</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                                                    <span class="n">e</span><span class="o">.</span><span class="n">next_item</span><span class="p">[</span><span class="s2">&quot;track&quot;</span><span class="p">][</span><span class="s2">&quot;service&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">md</span><span class="p">[</span><span class="s2">&quot;track&quot;</span><span class="p">][</span><span class="s2">&quot;service&quot;</span><span class="p">]))</span>
        <span class="c1"># Play for a few seconds for the system properties to populate</span>
        <span class="n">wait_until_true</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">AVTransport</span><span class="o">.</span><span class="n">GetPositionInfo</span><span class="p">()[</span><span class="s2">&quot;RelTime&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="s2">&quot;0:00:02&quot;</span><span class="p">,</span>
                        <span class="n">iteration_delay</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                        <span class="n">timeout_seconds</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

        <span class="c1"># Play the track before the custom track</span>
        <span class="c1"># The &quot;NextTrackMetaData&quot; property should have the proper &quot;contentService&quot; object</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">utils</span><span class="o">.</span><span class="n">parse_xml</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">AVTransport</span><span class="o">.</span><span class="n">get_state_variable</span><span class="p">(</span><span class="s2">&quot;NextTrackMetaData&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">getroot</span><span class="p">():</span>
            <span class="k">if</span> <span class="s2">&quot;DIDL-Lite&quot;</span> <span class="ow">in</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">subchild</span> <span class="ow">in</span> <span class="n">child</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s2">&quot;contentService&quot;</span> <span class="ow">in</span> <span class="n">subchild</span><span class="o">.</span><span class="n">tag</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">verifyEqualOrFailCase</span><span class="p">(</span><span class="n">md</span><span class="p">[</span><span class="s2">&quot;track&quot;</span><span class="p">][</span><span class="s2">&quot;service&quot;</span><span class="p">],</span> <span class="n">subchild</span><span class="o">.</span><span class="n">attrib</span><span class="p">,</span>
                                                   <span class="s2">&quot;Verify upnp NextTrackMetaData.contentService value&quot;</span><span class="p">)</span>
                        <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s2">&quot;Failed to find NextTrackMetaData.contentService in the xml&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">skip_to_next</span><span class="p">(</span><span class="n">group_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gid</span><span class="p">,</span> <span class="n">hhid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">muse_hhid</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify_event</span><span class="p">(</span><span class="n">MetadataStatusEvent</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                          <span class="n">event_verifier</span><span class="o">=</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">current_item</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                                                    <span class="n">e</span><span class="o">.</span><span class="n">current_item</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;3&quot;</span> <span class="ow">and</span>
                                                    <span class="n">e</span><span class="o">.</span><span class="n">current_item</span><span class="p">[</span><span class="s2">&quot;track&quot;</span><span class="p">][</span><span class="s2">&quot;service&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">md</span><span class="p">[</span><span class="s2">&quot;track&quot;</span><span class="p">][</span><span class="s2">&quot;service&quot;</span><span class="p">]))</span>
        <span class="n">wait_until_true</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">AVTransport</span><span class="o">.</span><span class="n">GetPositionInfo</span><span class="p">()[</span><span class="s2">&quot;RelTime&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="s2">&quot;0:00:02&quot;</span><span class="p">,</span>
                        <span class="n">iteration_delay</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                        <span class="n">timeout_seconds</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

        <span class="c1"># Play the custom track</span>
        <span class="c1"># The &quot;CurrentTrackMetaData&quot; property should have the proper &quot;contentService&quot; object</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">utils</span><span class="o">.</span><span class="n">parse_xml</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">AVTransport</span><span class="o">.</span><span class="n">get_state_variable</span><span class="p">(</span><span class="s2">&quot;CurrentTrackMetaData&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">getroot</span><span class="p">():</span>
            <span class="k">if</span> <span class="s2">&quot;DIDL-Lite&quot;</span> <span class="ow">in</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">subchild</span> <span class="ow">in</span> <span class="n">child</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s2">&quot;contentService&quot;</span> <span class="ow">in</span> <span class="n">subchild</span><span class="o">.</span><span class="n">tag</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">verifyEqualOrFailCase</span><span class="p">(</span><span class="n">md</span><span class="p">[</span><span class="s2">&quot;track&quot;</span><span class="p">][</span><span class="s2">&quot;service&quot;</span><span class="p">],</span> <span class="n">subchild</span><span class="o">.</span><span class="n">attrib</span><span class="p">,</span>
                                                   <span class="s2">&quot;Verify upnp CurrentTrackMetaData.contentService value&quot;</span><span class="p">)</span>
                        <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s2">&quot;Failed to find CurrentTrackMetaData.contentService in the xml&quot;</span><span class="p">)</span>

        <span class="c1"># Verify EnqueuedTransportURIMetaData.contentService matches the service object in the server&#39;s container</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">utils</span><span class="o">.</span><span class="n">parse_xml</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">AVTransport</span><span class="o">.</span><span class="n">get_state_variable</span><span class="p">(</span><span class="s2">&quot;EnqueuedTransportURIMetaData&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">getroot</span><span class="p">():</span>
            <span class="k">if</span> <span class="s2">&quot;DIDL-Lite&quot;</span> <span class="ow">in</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">subchild</span> <span class="ow">in</span> <span class="n">child</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s2">&quot;contentService&quot;</span> <span class="ow">in</span> <span class="n">subchild</span><span class="o">.</span><span class="n">tag</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">verifyEqualOrFailCase</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cq_control</span><span class="o">.</span><span class="n">get_container_metadata</span><span class="p">()[</span><span class="s2">&quot;service&quot;</span><span class="p">],</span>
                                                   <span class="n">subchild</span><span class="o">.</span><span class="n">attrib</span><span class="p">,</span>
                                                   <span class="s2">&quot;Verify upnp EnqueuedTransportURIMetaData.contentService value&quot;</span><span class="p">)</span>
                        <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s2">&quot;Did not see EnqueuedTransportURIMetaData.contentService in the xml&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MuseMetadataNamespaceTestsImpl.test_nextItem_in_metadate_event_controllable_via_track_policy"><a class="viewcode-back" href="../../webserver.html#webserver.muse_playbackmetadata_namespace.MuseMetadataNamespaceTestsImpl.test_nextItem_in_metadate_event_controllable_via_track_policy">[docs]</a>    <span class="k">def</span> <span class="nf">test_nextItem_in_metadate_event_controllable_via_track_policy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        SWPBL-54270</span>
<span class="sd">        Verify that setting isvisible to True on the next track causes the current track</span>
<span class="sd">        metadata to not have the &#39;nextItem&#39; object.</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Add a couple of tracks with isVisible true and false</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cq_control</span><span class="o">.</span><span class="n">copy_track_with_policies</span><span class="p">(</span><span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;isVisible&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cq_control</span><span class="o">.</span><span class="n">copy_track_with_policies</span><span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;isVisible&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">load_cloud_queue</span><span class="p">(</span><span class="n">session_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">session_id</span><span class="p">,</span>
                                         <span class="n">hhid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">muse_hhid</span><span class="p">,</span>
                                         <span class="n">queue_base_url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cq_control</span><span class="o">.</span><span class="n">CQ_PLAYBACK_URI</span><span class="p">,</span>
                                         <span class="n">content_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                         <span class="n">httpAuthorization</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                         <span class="n">item_id</span><span class="o">=</span><span class="s2">&quot;2&quot;</span><span class="p">,</span>
                                         <span class="n">position_millis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                         <span class="n">play_on_completion</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">wait_until_true</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">AVTransport</span><span class="o">.</span><span class="n">GetPositionInfo</span><span class="p">()[</span><span class="s2">&quot;RelTime&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="s2">&quot;0:00:02&quot;</span><span class="p">,</span>
                        <span class="n">iteration_delay</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                        <span class="n">timeout_seconds</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="c1"># Since the next track is not visible, the current track metadata should not</span>
        <span class="c1"># have a nextItem object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify_event</span><span class="p">(</span><span class="n">MetadataStatusEvent</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                          <span class="n">event_verifier</span><span class="o">=</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">next_item</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span>
                                                    <span class="n">e</span><span class="o">.</span><span class="n">current_item</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;2&quot;</span><span class="p">))</span>
        <span class="c1"># Verify the same on upnp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verifyTrueOrFailCase</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">AVTransport</span><span class="o">.</span><span class="n">get_state_variable</span><span class="p">(</span><span class="s2">&quot;CurrentTrackMetaData&quot;</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
                                  <span class="s2">&quot;itemId 2 should have upnp CurrentTrackMetaData&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verifyTrueOrFailCase</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">AVTransport</span><span class="o">.</span><span class="n">get_state_variable</span><span class="p">(</span><span class="s2">&quot;NextTrackMetaData&quot;</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span>
                                  <span class="s2">&quot;itemId 2 should not have upnp NextTrackMetaData&quot;</span><span class="p">)</span>

        <span class="c1"># This track is not visible but the next track is so it should have a</span>
        <span class="c1"># nextItem object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">skip_to_next</span><span class="p">(</span><span class="n">group_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gid</span><span class="p">,</span> <span class="n">hhid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">muse_hhid</span><span class="p">)</span>
        <span class="n">wait_until_true</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">AVTransport</span><span class="o">.</span><span class="n">GetPositionInfo</span><span class="p">()[</span><span class="s2">&quot;RelTime&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="s2">&quot;0:00:02&quot;</span><span class="p">,</span>
                        <span class="n">iteration_delay</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                        <span class="n">timeout_seconds</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify_event</span><span class="p">(</span><span class="n">MetadataStatusEvent</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                          <span class="n">event_verifier</span><span class="o">=</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">next_item</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                                                    <span class="n">e</span><span class="o">.</span><span class="n">current_item</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;3&quot;</span><span class="p">))</span>
        <span class="c1"># Verify the same on upnp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verifyTrueOrFailCase</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">AVTransport</span><span class="o">.</span><span class="n">get_state_variable</span><span class="p">(</span><span class="s2">&quot;CurrentTrackMetaData&quot;</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
                                  <span class="s2">&quot;itemId 3 should have upnp CurrentTrackMetaData&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verifyTrueOrFailCase</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">AVTransport</span><span class="o">.</span><span class="n">get_state_variable</span><span class="p">(</span><span class="s2">&quot;NextTrackMetaData&quot;</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
                                  <span class="s2">&quot;itemId 3 should have upnp NextTrackMetaData&quot;</span><span class="p">)</span>

        <span class="c1"># This is the last track in the queue so it should not have a &#39;nextItem&#39; object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">skip_to_next</span><span class="p">(</span><span class="n">group_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gid</span><span class="p">,</span> <span class="n">hhid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">muse_hhid</span><span class="p">)</span>
        <span class="n">wait_until_true</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">AVTransport</span><span class="o">.</span><span class="n">GetPositionInfo</span><span class="p">()[</span><span class="s2">&quot;RelTime&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="s2">&quot;0:00:02&quot;</span><span class="p">,</span>
                        <span class="n">iteration_delay</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                        <span class="n">timeout_seconds</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify_event</span><span class="p">(</span><span class="n">MetadataStatusEvent</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                          <span class="n">event_verifier</span><span class="o">=</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">next_item</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span>
                                                    <span class="n">e</span><span class="o">.</span><span class="n">current_item</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;4&quot;</span><span class="p">))</span>
        <span class="c1"># Verify the same on upnp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verifyTrueOrFailCase</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">AVTransport</span><span class="o">.</span><span class="n">get_state_variable</span><span class="p">(</span><span class="s2">&quot;CurrentTrackMetaData&quot;</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
                                  <span class="s2">&quot;itemId 4 should have upnp CurrentTrackMetaData&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verifyTrueOrFailCase</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">AVTransport</span><span class="o">.</span><span class="n">get_state_variable</span><span class="p">(</span><span class="s2">&quot;NextTrackMetaData&quot;</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span>
                                  <span class="s2">&quot;itemId 4 should have upnp NextTrackMetaData&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MuseMetadataNamespaceTestsImpl.test_track_with_replayGain_shows_in_metadataStatus_event"><a class="viewcode-back" href="../../webserver.html#webserver.muse_playbackmetadata_namespace.MuseMetadataNamespaceTestsImpl.test_track_with_replayGain_shows_in_metadataStatus_event">[docs]</a>    <span class="k">def</span> <span class="nf">test_track_with_replayGain_shows_in_metadataStatus_event</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        SWPBL-83217</span>
<span class="sd">        Verify that if the track md has a replayGain value, it is reflect in the metadata event</span>
<span class="sd">        for that track</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Set the gain value and put it into a track&#39;s md</span>
        <span class="n">replayGain</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.96</span>
        <span class="n">md</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">md</span><span class="p">[</span><span class="s2">&quot;track&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cq_control</span><span class="o">.</span><span class="n">get_track_metadata</span><span class="p">(</span><span class="s2">&quot;0&quot;</span><span class="p">)</span>
        <span class="n">md</span><span class="p">[</span><span class="s2">&quot;track&quot;</span><span class="p">][</span><span class="s2">&quot;replayGain&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">replayGain</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cq_control</span><span class="o">.</span><span class="n">add_custom_track_to_end</span><span class="p">(</span><span class="n">md</span><span class="o">=</span><span class="n">md</span><span class="p">)</span>

        <span class="c1"># Start playback on a track with replayGain.</span>
        <span class="c1"># Verify the current item doesn&#39;t have replayGain value but next item does</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">load_cloud_queue</span><span class="p">(</span><span class="n">session_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">session_id</span><span class="p">,</span>
                                   <span class="n">hhid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">muse_hhid</span><span class="p">,</span>
                                   <span class="n">queue_base_url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cq_control</span><span class="o">.</span><span class="n">CQ_PLAYBACK_URI</span><span class="p">,</span>
                                   <span class="n">content_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                   <span class="n">httpAuthorization</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                   <span class="n">item_id</span><span class="o">=</span><span class="s2">&quot;2&quot;</span><span class="p">,</span>
                                   <span class="n">play_on_completion</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify_event</span><span class="p">(</span><span class="n">MetadataStatusEvent</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                          <span class="n">event_verifier</span><span class="o">=</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">current_item</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;2&quot;</span> <span class="ow">and</span>
                                                    <span class="s2">&quot;replayGain&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">e</span><span class="o">.</span><span class="n">current_item</span><span class="p">[</span><span class="s2">&quot;track&quot;</span><span class="p">]</span> <span class="ow">and</span>
                                                    <span class="n">e</span><span class="o">.</span><span class="n">next_item</span><span class="p">[</span><span class="s2">&quot;track&quot;</span><span class="p">][</span><span class="s2">&quot;replayGain&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">replayGain</span><span class="p">))</span>

        <span class="c1"># Skip to the track with replayGain and verify that the current item has replayGain</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">skip_to_next</span><span class="p">(</span><span class="n">group_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gid</span><span class="p">,</span> <span class="n">hhid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">muse_hhid</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify_event</span><span class="p">(</span><span class="n">MetadataStatusEvent</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                          <span class="n">event_verifier</span><span class="o">=</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">current_item</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;3&quot;</span> <span class="ow">and</span>
                                                    <span class="n">e</span><span class="o">.</span><span class="n">current_item</span><span class="p">[</span><span class="s2">&quot;track&quot;</span><span class="p">][</span><span class="s2">&quot;replayGain&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">replayGain</span><span class="p">))</span></div></div>


<div class="viewcode-block" id="MuseMetadataFromAppleHLSTestsImpl"><a class="viewcode-back" href="../../webserver.html#webserver.muse_playbackmetadata_namespace.MuseMetadataFromAppleHLSTestsImpl">[docs]</a><span class="k">class</span> <span class="nc">MuseMetadataFromAppleHLSTestsImpl</span><span class="p">(</span><span class="n">BaseMuseFixture</span><span class="p">,</span> <span class="n">MockSMAPIBase</span><span class="p">):</span>
<div class="viewcode-block" id="MuseMetadataFromAppleHLSTestsImpl.setUpFixture"><a class="viewcode-back" href="../../webserver.html#webserver.muse_playbackmetadata_namespace.MuseMetadataFromAppleHLSTestsImpl.setUpFixture">[docs]</a>    <span class="k">def</span> <span class="nf">setUpFixture</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MuseMetadataFromAppleHLSTestsImpl</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">setUpFixture</span><span class="p">()</span></div>

<div class="viewcode-block" id="MuseMetadataFromAppleHLSTestsImpl.tearDownFixture"><a class="viewcode-back" href="../../webserver.html#webserver.muse_playbackmetadata_namespace.MuseMetadataFromAppleHLSTestsImpl.tearDownFixture">[docs]</a>    <span class="k">def</span> <span class="nf">tearDownFixture</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MuseMetadataFromAppleHLSTestsImpl</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">tearDownFixture</span><span class="p">()</span></div>

<div class="viewcode-block" id="MuseMetadataFromAppleHLSTestsImpl.setUpTest"><a class="viewcode-back" href="../../webserver.html#webserver.muse_playbackmetadata_namespace.MuseMetadataFromAppleHLSTestsImpl.setUpTest">[docs]</a>    <span class="k">def</span> <span class="nf">setUpTest</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MuseMetadataFromAppleHLSTestsImpl</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">setUpTest</span><span class="p">()</span></div>

<div class="viewcode-block" id="MuseMetadataFromAppleHLSTestsImpl.tearDownTest"><a class="viewcode-back" href="../../webserver.html#webserver.muse_playbackmetadata_namespace.MuseMetadataFromAppleHLSTestsImpl.tearDownTest">[docs]</a>    <span class="k">def</span> <span class="nf">tearDownTest</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MuseMetadataFromAppleHLSTestsImpl</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">tearDownTest</span><span class="p">()</span></div>

<div class="viewcode-block" id="MuseMetadataFromAppleHLSTestsImpl.test_metadata_from_apple_HLS"><a class="viewcode-back" href="../../webserver.html#webserver.muse_playbackmetadata_namespace.MuseMetadataFromAppleHLSTestsImpl.test_metadata_from_apple_HLS">[docs]</a>    <span class="k">def</span> <span class="nf">test_metadata_from_apple_HLS</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        SWPBL-46950</span>
<span class="sd">        Verify the metadata when playing a static HLS Apple stream that was previously captured</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">AVTransport</span><span class="o">.</span><span class="n">clear_play_state</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setUpTest</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">maxDiff</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">expected_currentItem</span> <span class="o">=</span> <span class="p">{</span><span class="sa">u</span><span class="s2">&quot;track&quot;</span><span class="p">:</span>
                                    <span class="p">{</span><span class="sa">u</span><span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="sa">u</span><span class="s2">&quot;track&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="sa">u</span><span class="s2">&quot;Welcome To The Pharmacy&quot;</span><span class="p">,</span>
                                     <span class="sa">u</span><span class="s2">&quot;imageUrl&quot;</span><span class="p">:</span><span class="sa">u</span><span class="s2">&quot;http://itsliveradio.apple.com/bb/images/b1/5bc090a8-98ad-4e66-9b43-e9c3219feced.jpg&quot;</span><span class="p">,</span>
                                     <span class="sa">u</span><span class="s2">&quot;artist&quot;</span><span class="p">:</span>
                                         <span class="p">{</span><span class="sa">u</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="sa">u</span><span class="s2">&quot;The Pharmacy with Dr.Dre&quot;</span><span class="p">},</span>
                                     <span class="sa">u</span><span class="s2">&quot;id&quot;</span><span class="p">:</span>
                                         <span class="p">{</span><span class="sa">u</span><span class="s2">&quot;serviceId&quot;</span><span class="p">:</span><span class="sa">u</span><span class="s2">&quot;255&quot;</span><span class="p">,</span>
                                          <span class="sa">u</span><span class="s2">&quot;objectId&quot;</span><span class="p">:</span><span class="sa">u</span><span class="s2">&quot;tr:551&quot;</span><span class="p">,</span>
                                          <span class="sa">u</span><span class="s2">&quot;accountId&quot;</span><span class="p">:</span><span class="sa">u</span><span class="s2">&quot;sn_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">svc_acct</span><span class="o">.</span><span class="n">serial_number</span><span class="p">)},</span>
                                     <span class="sa">u</span><span class="s2">&quot;service&quot;</span><span class="p">:</span>
                                         <span class="p">{</span><span class="sa">u</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="sa">u</span><span class="s2">&quot;Daft Punk SMAPI reference serve&quot;</span><span class="p">,</span>
                                          <span class="sa">u</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="sa">u</span><span class="s2">&quot;255&quot;</span><span class="p">},</span>
                                     <span class="c1"># SWPBL-85826</span>
                                     <span class="c1"># u&quot;durationMillis&quot;:1200000,</span>
                                     <span class="c1"># SWPBL-67071</span>
                                     <span class="c1"># This station doesn&#39;t send &#39;trackNumber&#39; so we should not event it out</span>
                                     <span class="c1"># in the metadataStatus event</span>
                                     <span class="c1"># u&quot;trackNumber&quot;:0</span>
                                     <span class="p">}</span>
                                <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">load_stream</span><span class="p">(</span><span class="n">hhid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">muse_hhid</span><span class="p">,</span> <span class="n">groupId</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gid</span><span class="p">,</span>
                              <span class="n">stationId</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;serviceId&quot;</span><span class="p">:</span> <span class="s2">&quot;255&quot;</span><span class="p">,</span>
                                         <span class="s2">&quot;objectId&quot;</span><span class="p">:</span> <span class="s2">&quot;tr:551&quot;</span><span class="p">,</span>
                                         <span class="s2">&quot;accountId&quot;</span><span class="p">:</span> <span class="s2">&quot;sn_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">svc_acct</span><span class="o">.</span><span class="n">serial_number</span><span class="p">)},</span>
                              <span class="n">playOnCompletion</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">subscribe_playback</span><span class="p">(</span><span class="n">group_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gid</span><span class="p">,</span> <span class="n">hhid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">muse_hhid</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify_event</span><span class="p">(</span><span class="n">PlaybackStatusEvent</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                          <span class="n">event_verifier</span><span class="o">=</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">playback_state</span> <span class="o">==</span> <span class="s2">&quot;PLAYBACK_STATE_PLAYING&quot;</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">subscribe_metadata</span><span class="p">(</span><span class="n">group_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gid</span><span class="p">,</span> <span class="n">hhid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">muse_hhid</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify_event</span><span class="p">(</span><span class="n">MetadataStatusEvent</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                          <span class="n">event_verifier</span><span class="o">=</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">current_item</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                                                    <span class="n">e</span><span class="o">.</span><span class="n">current_item</span><span class="p">[</span><span class="s2">&quot;track&quot;</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Welcome To The Pharmacy&quot;</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">verifyDictEqualOrFailCase</span><span class="p">(</span><span class="n">expected_currentItem</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">test_events</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">current_item</span><span class="p">,</span>
                                       <span class="s2">&quot;Metadata event for the first track should match expected values&quot;</span><span class="p">)</span>

        <span class="n">mock_smapi_log</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mock_server</span><span class="o">.</span><span class="n">get_log</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_server_log</span><span class="p">(</span><span class="n">mock_smapi_log</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tearDownTest</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div></div>


<span class="c1"># SWPBL-67789</span>
<span class="c1"># SWPBL-67788</span>
<div class="viewcode-block" id="MuseMetadataRateItemTestsImpl"><a class="viewcode-back" href="../../webserver.html#webserver.muse_playbackmetadata_namespace.MuseMetadataRateItemTestsImpl">[docs]</a><span class="k">class</span> <span class="nc">MuseMetadataRateItemTestsImpl</span><span class="p">(</span><span class="n">BaseMuseFixture</span><span class="p">):</span>
<div class="viewcode-block" id="MuseMetadataRateItemTestsImpl.setUpFixture"><a class="viewcode-back" href="../../webserver.html#webserver.muse_playbackmetadata_namespace.MuseMetadataRateItemTestsImpl.setUpFixture">[docs]</a>    <span class="k">def</span> <span class="nf">setUpFixture</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MuseMetadataRateItemTestsImpl</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">setUpFixture</span><span class="p">()</span></div>

<div class="viewcode-block" id="MuseMetadataRateItemTestsImpl.setUpTest"><a class="viewcode-back" href="../../webserver.html#webserver.muse_playbackmetadata_namespace.MuseMetadataRateItemTestsImpl.setUpTest">[docs]</a>    <span class="k">def</span> <span class="nf">setUpTest</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MuseMetadataRateItemTestsImpl</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">setUpTest</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_cloud_queue_server</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">muse_session_helper</span><span class="o">.</span><span class="n">make_muse_session</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="p">,</span> <span class="n">group_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gid</span><span class="p">,</span> <span class="n">hhid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">muse_hhid</span><span class="p">,</span> <span class="n">test_fixture</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">group_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gid</span><span class="p">,</span> <span class="n">hhid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">muse_hhid</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify_event</span><span class="p">(</span><span class="n">MetadataStatusEvent</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">subscribe_playback</span><span class="p">(</span><span class="n">group_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gid</span><span class="p">,</span> <span class="n">hhid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">muse_hhid</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify_event</span><span class="p">(</span><span class="n">PlaybackStatusEvent</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                          <span class="n">event_verifier</span><span class="o">=</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">playback_state</span> <span class="o">==</span> <span class="s2">&quot;PLAYBACK_STATE_IDLE&quot;</span><span class="p">))</span></div>

<div class="viewcode-block" id="MuseMetadataRateItemTestsImpl.tearDownTest"><a class="viewcode-back" href="../../webserver.html#webserver.muse_playbackmetadata_namespace.MuseMetadataRateItemTestsImpl.tearDownTest">[docs]</a>    <span class="k">def</span> <span class="nf">tearDownTest</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MuseMetadataRateItemTestsImpl</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">tearDownTest</span><span class="p">()</span></div>

<div class="viewcode-block" id="MuseMetadataRateItemTestsImpl.tearDownFixture"><a class="viewcode-back" href="../../webserver.html#webserver.muse_playbackmetadata_namespace.MuseMetadataRateItemTestsImpl.tearDownFixture">[docs]</a>    <span class="k">def</span> <span class="nf">tearDownFixture</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MuseMetadataRateItemTestsImpl</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">tearDownFixture</span><span class="p">()</span></div>

<div class="viewcode-block" id="MuseMetadataRateItemTestsImpl.test_rateItem_invalid_itemId_values"><a class="viewcode-back" href="../../webserver.html#webserver.muse_playbackmetadata_namespace.MuseMetadataRateItemTestsImpl.test_rateItem_invalid_itemId_values">[docs]</a>    <span class="nd">@combinatorial</span><span class="p">((</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">test_rateItem_invalid_itemId_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Verify the player sends an error if the itemId is blank or null</span>
<span class="sd">        :param value:</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">load_cloud_queue</span><span class="p">(</span><span class="n">session_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">session_id</span><span class="p">,</span>
                                   <span class="n">hhid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">muse_hhid</span><span class="p">,</span>
                                   <span class="n">queue_base_url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cq_control</span><span class="o">.</span><span class="n">CQ_PLAYBACK_URI</span><span class="p">,</span>
                                   <span class="n">content_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                   <span class="n">httpAuthorization</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                   <span class="n">play_on_completion</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                   <span class="n">track_metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify_event</span><span class="p">(</span><span class="n">PlaybackStatusEvent</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                          <span class="n">event_verifier</span><span class="o">=</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">playback_state</span> <span class="o">==</span> <span class="n">PlaybackState</span><span class="o">.</span><span class="n">PLAYING</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">rate_metadata</span><span class="p">(</span><span class="n">group_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gid</span><span class="p">,</span> <span class="n">hhid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">muse_hhid</span><span class="p">,</span>
                                <span class="n">itemId</span><span class="o">=</span><span class="n">value</span><span class="p">,</span>
                                <span class="n">rating</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;THUMBSUP&quot;</span><span class="p">,</span>
                                        <span class="s2">&quot;connotation&quot;</span><span class="p">:</span><span class="s2">&quot;POSITIVE&quot;</span><span class="p">})</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">verify_event</span><span class="p">(</span><span class="n">Error</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                              <span class="n">event_verifier</span><span class="o">=</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;itemId&quot;</span> <span class="ow">in</span> <span class="n">e</span><span class="o">.</span><span class="n">reason</span> <span class="ow">and</span>
                                                        <span class="n">e</span><span class="o">.</span><span class="n">error_code</span> <span class="o">==</span> <span class="s2">&quot;ERROR_MISSING_PARAMETERS&quot;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">verify_event</span><span class="p">(</span><span class="n">Error</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                              <span class="n">event_verifier</span><span class="o">=</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">error_code</span> <span class="o">==</span> <span class="s2">&quot;ERROR_COMMAND_FAILED&quot;</span><span class="p">))</span></div>

<div class="viewcode-block" id="MuseMetadataRateItemTestsImpl.test_rateItem_invalid_rating_values"><a class="viewcode-back" href="../../webserver.html#webserver.muse_playbackmetadata_namespace.MuseMetadataRateItemTestsImpl.test_rateItem_invalid_rating_values">[docs]</a>    <span class="nd">@combinatorial</span><span class="p">((</span><span class="kc">None</span><span class="p">,</span> <span class="p">{},</span> <span class="p">{</span><span class="s2">&quot;BAD&quot;</span><span class="p">:</span> <span class="s2">&quot;PARAM&quot;</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;connotation&quot;</span><span class="p">:</span><span class="s2">&quot;POSITIVE&quot;</span><span class="p">}))</span>
    <span class="k">def</span> <span class="nf">test_rateItem_invalid_rating_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Verify the player sends the right reason in the error message when the rating dict</span>
<span class="sd">        has invalid values</span>
<span class="sd">        :param value:</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">load_cloud_queue</span><span class="p">(</span><span class="n">session_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">session_id</span><span class="p">,</span>
                                   <span class="n">hhid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">muse_hhid</span><span class="p">,</span>
                                   <span class="n">queue_base_url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cq_control</span><span class="o">.</span><span class="n">CQ_PLAYBACK_URI</span><span class="p">,</span>
                                   <span class="n">content_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                   <span class="n">httpAuthorization</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                   <span class="n">play_on_completion</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                   <span class="n">track_metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify_event</span><span class="p">(</span><span class="n">PlaybackStatusEvent</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                          <span class="n">event_verifier</span><span class="o">=</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">playback_state</span> <span class="o">==</span> <span class="n">PlaybackState</span><span class="o">.</span><span class="n">PLAYING</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">rate_metadata</span><span class="p">(</span><span class="n">group_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gid</span><span class="p">,</span> <span class="n">hhid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">muse_hhid</span><span class="p">,</span>
                                <span class="n">itemId</span><span class="o">=</span><span class="s2">&quot;0&quot;</span><span class="p">,</span>
                                <span class="n">rating</span><span class="o">=</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">verify_event</span><span class="p">(</span><span class="n">Error</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                              <span class="n">event_verifier</span><span class="o">=</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;rating&quot;</span> <span class="ow">in</span> <span class="n">e</span><span class="o">.</span><span class="n">reason</span> <span class="ow">and</span>
                                                        <span class="n">e</span><span class="o">.</span><span class="n">error_code</span> <span class="o">==</span> <span class="s2">&quot;ERROR_MISSING_PARAMETERS&quot;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">verify_event</span><span class="p">(</span><span class="n">Error</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                              <span class="n">event_verifier</span><span class="o">=</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;rating.type&quot;</span> <span class="ow">in</span> <span class="n">e</span><span class="o">.</span><span class="n">reason</span> <span class="ow">and</span>
                                                        <span class="n">e</span><span class="o">.</span><span class="n">error_code</span> <span class="o">==</span> <span class="s2">&quot;ERROR_MISSING_PARAMETERS&quot;</span><span class="p">))</span></div>

<div class="viewcode-block" id="MuseMetadataRateItemTestsImpl.test_rateItem_values_match_metadata_ratings_object"><a class="viewcode-back" href="../../webserver.html#webserver.muse_playbackmetadata_namespace.MuseMetadataRateItemTestsImpl.test_rateItem_values_match_metadata_ratings_object">[docs]</a>    <span class="k">def</span> <span class="nf">test_rateItem_values_match_metadata_ratings_object</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Verify that the metadata has the current and next item&#39;s ratings object once they have been rated</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rating</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;THUMBSUP&quot;</span><span class="p">,</span>
                  <span class="s2">&quot;connotation&quot;</span><span class="p">:</span> <span class="s2">&quot;POSITIVE&quot;</span><span class="p">,</span>
                  <span class="s2">&quot;state&quot;</span><span class="p">:</span> <span class="s2">&quot;RATED&quot;</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">load_cloud_queue</span><span class="p">(</span><span class="n">session_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">session_id</span><span class="p">,</span>
                                   <span class="n">hhid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">muse_hhid</span><span class="p">,</span>
                                   <span class="n">queue_base_url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cq_control</span><span class="o">.</span><span class="n">CQ_PLAYBACK_URI</span><span class="p">,</span>
                                   <span class="n">content_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                   <span class="n">httpAuthorization</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                   <span class="n">play_on_completion</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                   <span class="n">track_metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                   <span class="n">item_id</span><span class="o">=</span><span class="s2">&quot;0&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify_event</span><span class="p">(</span><span class="n">PlaybackStatusEvent</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                          <span class="n">event_verifier</span><span class="o">=</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">playback_state</span> <span class="o">==</span> <span class="n">PlaybackState</span><span class="o">.</span><span class="n">PLAYING</span><span class="p">))</span>

        <span class="c1"># rate itemId 1 first then 0 since only rating the currently heard track will cause the player</span>
        <span class="c1"># to refresh its itemWindow</span>
        <span class="k">for</span> <span class="n">itemId</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">rate_metadata</span><span class="p">(</span><span class="n">group_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gid</span><span class="p">,</span> <span class="n">hhid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">muse_hhid</span><span class="p">,</span>
                                <span class="n">itemId</span><span class="o">=</span><span class="n">itemId</span><span class="p">,</span>
                                <span class="n">rating</span><span class="o">=</span><span class="n">rating</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">verify_event</span><span class="p">(</span><span class="n">MetadataStatusEvent</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                          <span class="n">event_verifier</span><span class="o">=</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;rating&quot;</span> <span class="ow">in</span> <span class="n">e</span><span class="o">.</span><span class="n">current_item</span> <span class="ow">and</span>
                                                    <span class="s2">&quot;rating&quot;</span> <span class="ow">in</span> <span class="n">e</span><span class="o">.</span><span class="n">next_item</span> <span class="ow">and</span>
                                                    <span class="n">e</span><span class="o">.</span><span class="n">current_item</span><span class="p">[</span><span class="s2">&quot;rating&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">rating</span> <span class="ow">and</span>
                                                    <span class="n">e</span><span class="o">.</span><span class="n">next_item</span><span class="p">[</span><span class="s2">&quot;rating&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">rating</span><span class="p">))</span></div>

<div class="viewcode-block" id="MuseMetadataRateItemTestsImpl.test_metadata_shows_ratings_object_on_pre_rate_track"><a class="viewcode-back" href="../../webserver.html#webserver.muse_playbackmetadata_namespace.MuseMetadataRateItemTestsImpl.test_metadata_shows_ratings_object_on_pre_rate_track">[docs]</a>    <span class="k">def</span> <span class="nf">test_metadata_shows_ratings_object_on_pre_rate_track</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Verify that the player is able to parse pre-rated tracks before playback has started</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Add a track that already has a ratings object</span>
        <span class="n">rating</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;THUMBSUP&quot;</span><span class="p">,</span>
                  <span class="s2">&quot;connotation&quot;</span><span class="p">:</span> <span class="s2">&quot;POSITIVE&quot;</span><span class="p">,</span>
                  <span class="s2">&quot;state&quot;</span><span class="p">:</span> <span class="s2">&quot;RATED&quot;</span><span class="p">}</span>
        <span class="n">md</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">md</span><span class="p">[</span><span class="s2">&quot;track&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cq_control</span><span class="o">.</span><span class="n">get_track_metadata</span><span class="p">(</span><span class="s2">&quot;0&quot;</span><span class="p">)</span>
        <span class="n">md</span><span class="p">[</span><span class="s2">&quot;rating&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rating</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cq_control</span><span class="o">.</span><span class="n">add_custom_track_to_end</span><span class="p">(</span><span class="n">md</span><span class="o">=</span><span class="n">md</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">load_cloud_queue</span><span class="p">(</span><span class="n">session_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">session_id</span><span class="p">,</span>
                                   <span class="n">hhid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">muse_hhid</span><span class="p">,</span>
                                   <span class="n">queue_base_url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cq_control</span><span class="o">.</span><span class="n">CQ_PLAYBACK_URI</span><span class="p">,</span>
                                   <span class="n">content_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                   <span class="n">httpAuthorization</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                   <span class="n">play_on_completion</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                   <span class="n">track_metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                   <span class="n">item_id</span><span class="o">=</span><span class="s2">&quot;3&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">verify_event</span><span class="p">(</span><span class="n">MetadataStatusEvent</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                          <span class="n">event_verifier</span><span class="o">=</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;rating&quot;</span> <span class="ow">in</span> <span class="n">e</span><span class="o">.</span><span class="n">current_item</span> <span class="ow">and</span>
                                                    <span class="n">e</span><span class="o">.</span><span class="n">current_item</span><span class="p">[</span><span class="s2">&quot;rating&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">rating</span><span class="p">))</span></div>

<div class="viewcode-block" id="MuseMetadataRateItemTestsImpl.test_rate_track_different_from_current_playing_track"><a class="viewcode-back" href="../../webserver.html#webserver.muse_playbackmetadata_namespace.MuseMetadataRateItemTestsImpl.test_rate_track_different_from_current_playing_track">[docs]</a>    <span class="k">def</span> <span class="nf">test_rate_track_different_from_current_playing_track</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Verify that the playhead doesn&#39;t change tracks if the user rates a track that&#39;s currently not playing</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">load_cloud_queue</span><span class="p">(</span><span class="n">session_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">session_id</span><span class="p">,</span>
                                   <span class="n">hhid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">muse_hhid</span><span class="p">,</span>
                                   <span class="n">queue_base_url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cq_control</span><span class="o">.</span><span class="n">CQ_PLAYBACK_URI</span><span class="p">,</span>
                                   <span class="n">content_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                   <span class="n">httpAuthorization</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                   <span class="n">play_on_completion</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                   <span class="n">track_metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                   <span class="n">item_id</span><span class="o">=</span><span class="s2">&quot;2&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify_event</span><span class="p">(</span><span class="n">PlaybackStatusEvent</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                          <span class="n">event_verifier</span><span class="o">=</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">playback_state</span> <span class="o">==</span> <span class="n">PlaybackState</span><span class="o">.</span><span class="n">PLAYING</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">rate_metadata</span><span class="p">(</span><span class="n">group_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gid</span><span class="p">,</span> <span class="n">hhid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">muse_hhid</span><span class="p">,</span>
                                <span class="n">itemId</span><span class="o">=</span><span class="s2">&quot;0&quot;</span><span class="p">,</span>
                                <span class="n">rating</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;THUMBSUP&quot;</span><span class="p">})</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">subscribe_playback</span><span class="p">(</span><span class="n">group_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gid</span><span class="p">,</span> <span class="n">hhid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">muse_hhid</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify_event</span><span class="p">(</span><span class="n">PlaybackStatusEvent</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                          <span class="n">event_verifier</span><span class="o">=</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">playback_state</span> <span class="o">==</span> <span class="n">PlaybackState</span><span class="o">.</span><span class="n">PLAYING</span> <span class="ow">and</span>
                                                    <span class="n">e</span><span class="o">.</span><span class="n">item_id</span> <span class="o">==</span> <span class="s2">&quot;2&quot;</span><span class="p">))</span></div>

<div class="viewcode-block" id="MuseMetadataRateItemTestsImpl.test_player_respects_playhead_position_in_itemWindow_returned_from_rate_track"><a class="viewcode-back" href="../../webserver.html#webserver.muse_playbackmetadata_namespace.MuseMetadataRateItemTestsImpl.test_player_respects_playhead_position_in_itemWindow_returned_from_rate_track">[docs]</a>    <span class="k">def</span> <span class="nf">test_player_respects_playhead_position_in_itemWindow_returned_from_rate_track</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        SWPBL-78066</span>
<span class="sd">        Verify that the the player will process the playhead position if its included in the itemWindow</span>
<span class="sd">        that gets returned from a rate item command</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">load_cloud_queue</span><span class="p">(</span><span class="n">session_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">session_id</span><span class="p">,</span>
                                   <span class="n">hhid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">muse_hhid</span><span class="p">,</span>
                                   <span class="n">queue_base_url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cq_control</span><span class="o">.</span><span class="n">CQ_PLAYBACK_URI</span><span class="p">,</span>
                                   <span class="n">content_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                   <span class="n">httpAuthorization</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                   <span class="n">play_on_completion</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                   <span class="n">track_metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                   <span class="n">item_id</span><span class="o">=</span><span class="s2">&quot;1&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify_event</span><span class="p">(</span><span class="n">PlaybackStatusEvent</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                          <span class="n">event_verifier</span><span class="o">=</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">playback_state</span> <span class="o">==</span> <span class="n">PlaybackState</span><span class="o">.</span><span class="n">PLAYING</span><span class="p">))</span>

        <span class="c1"># Set the playhead to track 0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cq_control</span><span class="o">.</span><span class="n">set_window_playhead</span><span class="p">({</span><span class="s2">&quot;itemId&quot;</span><span class="p">:</span> <span class="s2">&quot;0&quot;</span><span class="p">})</span>
        <span class="c1"># This whole mechanism only works if we rate the currently heard track</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">rate_metadata</span><span class="p">(</span><span class="n">group_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gid</span><span class="p">,</span> <span class="n">hhid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">muse_hhid</span><span class="p">,</span>
                                <span class="n">itemId</span><span class="o">=</span><span class="s2">&quot;1&quot;</span><span class="p">,</span>
                                <span class="n">rating</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;THUMBSUP&quot;</span><span class="p">})</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">verify_event</span><span class="p">(</span><span class="n">PlaybackStatusEvent</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                          <span class="n">event_verifier</span><span class="o">=</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">playback_state</span> <span class="o">==</span> <span class="n">PlaybackState</span><span class="o">.</span><span class="n">PLAYING</span> <span class="ow">and</span>
                                                    <span class="n">e</span><span class="o">.</span><span class="n">item_id</span> <span class="o">==</span> <span class="s2">&quot;0&quot;</span><span class="p">))</span></div>

<div class="viewcode-block" id="MuseMetadataRateItemTestsImpl.test_rateItem_200_rating_response_replace_queue"><a class="viewcode-back" href="../../webserver.html#webserver.muse_playbackmetadata_namespace.MuseMetadataRateItemTestsImpl.test_rateItem_200_rating_response_replace_queue">[docs]</a>    <span class="k">def</span> <span class="nf">test_rateItem_200_rating_response_replace_queue</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A 200 response should replace the current queue. Verifies that the player ingested the new</span>
<span class="sd">        window correctly.</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">load_cloud_queue</span><span class="p">(</span><span class="n">session_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">session_id</span><span class="p">,</span>
                                   <span class="n">hhid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">muse_hhid</span><span class="p">,</span>
                                   <span class="n">queue_base_url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cq_control</span><span class="o">.</span><span class="n">CQ_PLAYBACK_URI</span><span class="p">,</span>
                                   <span class="n">content_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                   <span class="n">httpAuthorization</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                   <span class="n">play_on_completion</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                   <span class="n">track_metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                   <span class="n">position_millis</span><span class="o">=</span><span class="mi">26000</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify_event</span><span class="p">(</span><span class="n">PlaybackStatusEvent</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                          <span class="n">event_verifier</span><span class="o">=</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">playback_state</span> <span class="o">==</span> <span class="n">PlaybackState</span><span class="o">.</span><span class="n">PLAYING</span><span class="p">))</span>

        <span class="c1"># Return 304 to any itemWindow requests so that any queue changes are not due to a new itemWindow</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cq_control</span><span class="o">.</span><span class="n">arm_error_script</span><span class="p">(</span><span class="n">call</span><span class="o">=</span><span class="s2">&quot;itemWindow&quot;</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="mi">304</span><span class="p">,</span> <span class="n">num_errors</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

        <span class="c1"># Delete the next track so the playlist changes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cq_control</span><span class="o">.</span><span class="n">delete_track</span><span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">rate_metadata</span><span class="p">(</span><span class="n">group_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gid</span><span class="p">,</span> <span class="n">hhid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">muse_hhid</span><span class="p">,</span>
                                <span class="n">itemId</span><span class="o">=</span><span class="s2">&quot;0&quot;</span><span class="p">,</span>
                                <span class="n">rating</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;THUMBSUP&quot;</span><span class="p">})</span>

        <span class="c1"># Verify that the new rating is reflected in the metadata event</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify_event</span><span class="p">(</span><span class="n">MetadataStatusEvent</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                          <span class="n">event_verifier</span><span class="o">=</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;rating&quot;</span> <span class="ow">in</span> <span class="n">e</span><span class="o">.</span><span class="n">current_item</span> <span class="ow">and</span>
                                                    <span class="n">e</span><span class="o">.</span><span class="n">current_item</span><span class="p">[</span><span class="s2">&quot;rating&quot;</span><span class="p">][</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;THUMBSUP&quot;</span><span class="p">))</span>
        <span class="c1"># The default response is 200 to the rating endpoint so no need to arm a script</span>
        <span class="c1"># The player should be playing itemId=2 after itemId=0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify_event</span><span class="p">(</span><span class="n">PlaybackStatusEvent</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                          <span class="n">event_verifier</span><span class="o">=</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">playback_state</span> <span class="o">==</span> <span class="n">PlaybackState</span><span class="o">.</span><span class="n">PLAYING</span> <span class="ow">and</span>
                                                    <span class="n">e</span><span class="o">.</span><span class="n">item_id</span> <span class="o">==</span> <span class="s2">&quot;2&quot;</span><span class="p">))</span></div>

<div class="viewcode-block" id="MuseMetadataRateItemTestsImpl.test_rateItem_200_rating_response_skip_deleted_current_track"><a class="viewcode-back" href="../../webserver.html#webserver.muse_playbackmetadata_namespace.MuseMetadataRateItemTestsImpl.test_rateItem_200_rating_response_skip_deleted_current_track">[docs]</a>    <span class="k">def</span> <span class="nf">test_rateItem_200_rating_response_skip_deleted_current_track</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Verifies that the player will skip over a deleted track after a rating change</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">load_cloud_queue</span><span class="p">(</span><span class="n">session_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">session_id</span><span class="p">,</span>
                                   <span class="n">hhid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">muse_hhid</span><span class="p">,</span>
                                   <span class="n">queue_base_url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cq_control</span><span class="o">.</span><span class="n">CQ_PLAYBACK_URI</span><span class="p">,</span>
                                   <span class="n">content_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                   <span class="n">httpAuthorization</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                   <span class="n">play_on_completion</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                   <span class="n">track_metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify_event</span><span class="p">(</span><span class="n">PlaybackStatusEvent</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                          <span class="n">event_verifier</span><span class="o">=</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">playback_state</span> <span class="o">==</span> <span class="n">PlaybackState</span><span class="o">.</span><span class="n">PLAYING</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cq_control</span><span class="o">.</span><span class="n">arm_error_script</span><span class="p">(</span><span class="n">call</span><span class="o">=</span><span class="s2">&quot;itemWindow&quot;</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="mi">304</span><span class="p">,</span> <span class="n">num_errors</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

        <span class="c1"># Delete the current track to simulate a negative rating causing the server to remove the</span>
        <span class="c1"># rated track</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cq_control</span><span class="o">.</span><span class="n">delete_track</span><span class="p">(</span><span class="s2">&quot;0&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">rate_metadata</span><span class="p">(</span><span class="n">group_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gid</span><span class="p">,</span> <span class="n">hhid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">muse_hhid</span><span class="p">,</span>
                                <span class="n">itemId</span><span class="o">=</span><span class="s2">&quot;0&quot;</span><span class="p">,</span>
                                <span class="n">rating</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;THUMBSUP&quot;</span><span class="p">})</span>

        <span class="c1"># Verify that the new rating is reflected in the metadata event</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify_event</span><span class="p">(</span><span class="n">MetadataStatusEvent</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                          <span class="n">event_verifier</span><span class="o">=</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;rating&quot;</span> <span class="ow">in</span> <span class="n">e</span><span class="o">.</span><span class="n">current_item</span> <span class="ow">and</span>
                                                    <span class="n">e</span><span class="o">.</span><span class="n">current_item</span><span class="p">[</span><span class="s2">&quot;rating&quot;</span><span class="p">][</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;THUMBSUP&quot;</span><span class="p">))</span>
        <span class="c1"># The player should move to the next track after the new window is processed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify_event</span><span class="p">(</span><span class="n">PlaybackStatusEvent</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">past_events</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                          <span class="n">event_verifier</span><span class="o">=</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">playback_state</span> <span class="o">==</span> <span class="n">PlaybackState</span><span class="o">.</span><span class="n">PLAYING</span> <span class="ow">and</span>
                                                    <span class="n">e</span><span class="o">.</span><span class="n">item_id</span> <span class="o">==</span> <span class="s2">&quot;1&quot;</span><span class="p">))</span></div>

<div class="viewcode-block" id="MuseMetadataRateItemTestsImpl.test_rateItem_200_negative_rating_late_track_in_queue"><a class="viewcode-back" href="../../webserver.html#webserver.muse_playbackmetadata_namespace.MuseMetadataRateItemTestsImpl.test_rateItem_200_negative_rating_late_track_in_queue">[docs]</a>    <span class="k">def</span> <span class="nf">test_rateItem_200_negative_rating_late_track_in_queue</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        SWPBL-75253</span>
<span class="sd">        Verify that if the last track in the queue is deleted due to a bad rating, the player</span>
<span class="sd">        will pause on the new last track and not continue to play.</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">load_cloud_queue</span><span class="p">(</span><span class="n">session_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">session_id</span><span class="p">,</span>
                                   <span class="n">hhid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">muse_hhid</span><span class="p">,</span>
                                   <span class="n">queue_base_url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cq_control</span><span class="o">.</span><span class="n">CQ_PLAYBACK_URI</span><span class="p">,</span>
                                   <span class="n">content_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                   <span class="n">httpAuthorization</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                   <span class="n">play_on_completion</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                   <span class="n">track_metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                   <span class="n">item_id</span><span class="o">=</span><span class="s2">&quot;2&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify_event</span><span class="p">(</span><span class="n">PlaybackStatusEvent</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                          <span class="n">event_verifier</span><span class="o">=</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">playback_state</span> <span class="o">==</span> <span class="n">PlaybackState</span><span class="o">.</span><span class="n">PLAYING</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cq_control</span><span class="o">.</span><span class="n">arm_error_script</span><span class="p">(</span><span class="n">call</span><span class="o">=</span><span class="s2">&quot;itemWindow&quot;</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="mi">304</span><span class="p">,</span> <span class="n">num_errors</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

        <span class="c1"># Delete the track to simulate a server that deletes tracks due to negative ratings</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cq_control</span><span class="o">.</span><span class="n">delete_track</span><span class="p">(</span><span class="s2">&quot;2&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">rate_metadata</span><span class="p">(</span><span class="n">group_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gid</span><span class="p">,</span> <span class="n">hhid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">muse_hhid</span><span class="p">,</span>
                                <span class="n">itemId</span><span class="o">=</span><span class="s2">&quot;2&quot;</span><span class="p">,</span>
                                <span class="n">rating</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;THUMBSDOWN&quot;</span><span class="p">,</span>
                                        <span class="s2">&quot;connotation&quot;</span><span class="p">:</span> <span class="s2">&quot;NEGATIVE&quot;</span><span class="p">})</span>

        <span class="c1"># The player should pause on the new last track</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify_event</span><span class="p">(</span><span class="n">PlaybackStatusEvent</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                          <span class="n">event_verifier</span><span class="o">=</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">playback_state</span> <span class="o">==</span> <span class="n">PlaybackState</span><span class="o">.</span><span class="n">PAUSED</span> <span class="ow">and</span>
                                                    <span class="n">e</span><span class="o">.</span><span class="n">item_id</span> <span class="o">==</span> <span class="s2">&quot;1&quot;</span><span class="p">))</span></div>

<div class="viewcode-block" id="MuseMetadataRateItemTestsImpl.test_rateItem_202_rating_response"><a class="viewcode-back" href="../../webserver.html#webserver.muse_playbackmetadata_namespace.MuseMetadataRateItemTestsImpl.test_rateItem_202_rating_response">[docs]</a>    <span class="k">def</span> <span class="nf">test_rateItem_202_rating_response</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A 202 response should clear the queue except for the current track. Verifies that the player</span>
<span class="sd">        will pause after finishing the current track</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">load_cloud_queue</span><span class="p">(</span><span class="n">session_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">session_id</span><span class="p">,</span>
                                   <span class="n">hhid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">muse_hhid</span><span class="p">,</span>
                                   <span class="n">queue_base_url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cq_control</span><span class="o">.</span><span class="n">CQ_PLAYBACK_URI</span><span class="p">,</span>
                                   <span class="n">content_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                   <span class="n">httpAuthorization</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                   <span class="n">play_on_completion</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                   <span class="n">track_metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                   <span class="n">position_millis</span><span class="o">=</span><span class="mi">26000</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify_event</span><span class="p">(</span><span class="n">PlaybackStatusEvent</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                          <span class="n">event_verifier</span><span class="o">=</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">playback_state</span> <span class="o">==</span> <span class="n">PlaybackState</span><span class="o">.</span><span class="n">PLAYING</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cq_control</span><span class="o">.</span><span class="n">clear_log</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;api&#39;</span><span class="p">)</span>
        <span class="c1"># Arm the 202 response script</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cq_control</span><span class="o">.</span><span class="n">arm_error_script</span><span class="p">(</span><span class="n">call</span><span class="o">=</span><span class="s2">&quot;rating&quot;</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="mi">202</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">rate_metadata</span><span class="p">(</span><span class="n">group_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gid</span><span class="p">,</span> <span class="n">hhid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">muse_hhid</span><span class="p">,</span>
                                <span class="n">itemId</span><span class="o">=</span><span class="s2">&quot;0&quot;</span><span class="p">,</span>
                                <span class="n">rating</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;THUMBSUP&quot;</span><span class="p">})</span>
        <span class="c1"># Return 304 to any itemWindow request so it doesn&#39;t modify the queue</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cq_control</span><span class="o">.</span><span class="n">arm_error_script</span><span class="p">(</span><span class="n">call</span><span class="o">=</span><span class="s2">&quot;itemWindow&quot;</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="mi">304</span><span class="p">,</span> <span class="n">num_errors</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="c1"># Verify background window fetch occurs</span>
        <span class="n">log</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cq_control</span><span class="o">.</span><span class="n">wait_for_filtered_log</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;api&#39;</span><span class="p">,</span>
                                                                  <span class="n">fn</span><span class="o">=</span><span class="k">lambda</span> <span class="n">l</span><span class="p">:</span> <span class="n">l</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;/itemWindow&#39;</span><span class="p">,</span>
                                                                  <span class="n">timeout</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">expected</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verifyTrueOrFailCase</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">log</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Verify new itemWindow fetched.&quot;</span><span class="p">)</span>
        <span class="c1"># Verify that the player paused after finishing the track</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify_event</span><span class="p">(</span><span class="n">PlaybackStatusEvent</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                          <span class="n">event_verifier</span><span class="o">=</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">playback_state</span> <span class="o">==</span> <span class="n">PlaybackState</span><span class="o">.</span><span class="n">PLAYING</span> <span class="ow">and</span>
                                                    <span class="n">e</span><span class="o">.</span><span class="n">item_id</span> <span class="o">==</span> <span class="s2">&quot;1&quot;</span><span class="p">))</span></div>

<div class="viewcode-block" id="MuseMetadataRateItemTestsImpl.test_rateItem_204_304_rating_response"><a class="viewcode-back" href="../../webserver.html#webserver.muse_playbackmetadata_namespace.MuseMetadataRateItemTestsImpl.test_rateItem_204_304_rating_response">[docs]</a>    <span class="nd">@combinatorial</span><span class="p">((</span><span class="mi">204</span><span class="p">,</span> <span class="mi">304</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">test_rateItem_204_304_rating_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A 204/304 response should not change the queue. Verifies that the player transitions</span>
<span class="sd">        to the next track</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">load_cloud_queue</span><span class="p">(</span><span class="n">session_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">session_id</span><span class="p">,</span>
                                   <span class="n">hhid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">muse_hhid</span><span class="p">,</span>
                                   <span class="n">queue_base_url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cq_control</span><span class="o">.</span><span class="n">CQ_PLAYBACK_URI</span><span class="p">,</span>
                                   <span class="n">content_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                   <span class="n">httpAuthorization</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                   <span class="n">play_on_completion</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                   <span class="n">track_metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                   <span class="n">position_millis</span><span class="o">=</span><span class="mi">26000</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify_event</span><span class="p">(</span><span class="n">PlaybackStatusEvent</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                          <span class="n">event_verifier</span><span class="o">=</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">playback_state</span> <span class="o">==</span> <span class="n">PlaybackState</span><span class="o">.</span><span class="n">PLAYING</span><span class="p">))</span>

        <span class="c1"># Arm the 204/304 script</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cq_control</span><span class="o">.</span><span class="n">arm_error_script</span><span class="p">(</span><span class="n">call</span><span class="o">=</span><span class="s2">&quot;rating&quot;</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="n">response</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">rate_metadata</span><span class="p">(</span><span class="n">group_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gid</span><span class="p">,</span> <span class="n">hhid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">muse_hhid</span><span class="p">,</span>
                                <span class="n">itemId</span><span class="o">=</span><span class="s2">&quot;0&quot;</span><span class="p">,</span>
                                <span class="n">rating</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;THUMBSUP&quot;</span><span class="p">})</span>

        <span class="c1"># Verify that the player is playing the next track</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify_event</span><span class="p">(</span><span class="n">PlaybackStatusEvent</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                          <span class="n">event_verifier</span><span class="o">=</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">playback_state</span> <span class="o">==</span> <span class="n">PlaybackState</span><span class="o">.</span><span class="n">PLAYING</span> <span class="ow">and</span>
                                                    <span class="n">e</span><span class="o">.</span><span class="n">item_id</span> <span class="o">==</span> <span class="s2">&quot;1&quot;</span><span class="p">))</span></div>

<div class="viewcode-block" id="MuseMetadataRateItemTestsImpl.test_rateItem_404_rating_response"><a class="viewcode-back" href="../../webserver.html#webserver.muse_playbackmetadata_namespace.MuseMetadataRateItemTestsImpl.test_rateItem_404_rating_response">[docs]</a>    <span class="k">def</span> <span class="nf">test_rateItem_404_rating_response</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A 404 response should clear the queue on the player. Verifies that the player is IDLE and it</span>
<span class="sd">        sent out a proper error event.</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">load_cloud_queue</span><span class="p">(</span><span class="n">session_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">session_id</span><span class="p">,</span>
                                   <span class="n">hhid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">muse_hhid</span><span class="p">,</span>
                                   <span class="n">queue_base_url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cq_control</span><span class="o">.</span><span class="n">CQ_PLAYBACK_URI</span><span class="p">,</span>
                                   <span class="n">content_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                   <span class="n">httpAuthorization</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                   <span class="n">play_on_completion</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                   <span class="n">track_metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                   <span class="n">position_millis</span><span class="o">=</span><span class="mi">25000</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify_event</span><span class="p">(</span><span class="n">PlaybackStatusEvent</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                          <span class="n">event_verifier</span><span class="o">=</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">playback_state</span> <span class="o">==</span> <span class="n">PlaybackState</span><span class="o">.</span><span class="n">PLAYING</span><span class="p">))</span>

        <span class="c1"># Arm the 404 script</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cq_control</span><span class="o">.</span><span class="n">arm_error_script</span><span class="p">(</span><span class="n">call</span><span class="o">=</span><span class="s2">&quot;rating&quot;</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="mi">404</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">rate_metadata</span><span class="p">(</span><span class="n">group_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gid</span><span class="p">,</span> <span class="n">hhid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">muse_hhid</span><span class="p">,</span>
                                <span class="n">itemId</span><span class="o">=</span><span class="s2">&quot;0&quot;</span><span class="p">,</span>
                                <span class="n">rating</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;THUMBSUP&quot;</span><span class="p">})</span>

        <span class="c1"># verify the player is idle</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify_event</span><span class="p">(</span><span class="n">PlaybackStatusEvent</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                          <span class="n">event_verifier</span><span class="o">=</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">playback_state</span> <span class="o">==</span> <span class="n">PlaybackState</span><span class="o">.</span><span class="n">PLAYING</span> <span class="ow">and</span>
                                                    <span class="n">e</span><span class="o">.</span><span class="n">previousItemId</span> <span class="o">==</span> <span class="s2">&quot;0&quot;</span><span class="p">))</span></div>

<div class="viewcode-block" id="MuseMetadataRateItemTestsImpl.test_rateItem_unexpected_rating_type_object"><a class="viewcode-back" href="../../webserver.html#webserver.muse_playbackmetadata_namespace.MuseMetadataRateItemTestsImpl.test_rateItem_unexpected_rating_type_object">[docs]</a>    <span class="k">def</span> <span class="nf">test_rateItem_unexpected_rating_type_object</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        SWPBL-75184</span>
<span class="sd">        Verify that the player returns an error if the rating object contains an unknown</span>
<span class="sd">        rating &quot;type&quot;</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">load_cloud_queue</span><span class="p">(</span><span class="n">session_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">session_id</span><span class="p">,</span>
                                   <span class="n">hhid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">muse_hhid</span><span class="p">,</span>
                                   <span class="n">queue_base_url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cq_control</span><span class="o">.</span><span class="n">CQ_PLAYBACK_URI</span><span class="p">,</span>
                                   <span class="n">content_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                   <span class="n">httpAuthorization</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                   <span class="n">play_on_completion</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                   <span class="n">track_metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify_event</span><span class="p">(</span><span class="n">PlaybackStatusEvent</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                          <span class="n">event_verifier</span><span class="o">=</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">playback_state</span> <span class="o">==</span> <span class="n">PlaybackState</span><span class="o">.</span><span class="n">PLAYING</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">muse</span><span class="o">.</span><span class="n">rate_metadata</span><span class="p">(</span><span class="n">group_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gid</span><span class="p">,</span> <span class="n">hhid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zp</span><span class="o">.</span><span class="n">muse_hhid</span><span class="p">,</span>
                                <span class="n">itemId</span><span class="o">=</span><span class="s2">&quot;0&quot;</span><span class="p">,</span>
                                <span class="n">rating</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;THISSUCKS&quot;</span><span class="p">,</span>
                                        <span class="s2">&quot;connotation&quot;</span><span class="p">:</span> <span class="s2">&quot;NEGATIVE&quot;</span><span class="p">})</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">verify_event</span><span class="p">(</span><span class="n">Error</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                          <span class="n">event_verifier</span><span class="o">=</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;rating.type&quot;</span> <span class="ow">in</span> <span class="n">e</span><span class="o">.</span><span class="n">reason</span> <span class="ow">and</span>
                                                    <span class="n">e</span><span class="o">.</span><span class="n">error_code</span> <span class="o">==</span> <span class="s2">&quot;ERROR_INVALID_PARAMETER&quot;</span><span class="p">))</span></div></div>


<div class="viewcode-block" id="MuseMetadataNamespaceTests"><a class="viewcode-back" href="../../webserver.html#webserver.muse_playbackmetadata_namespace.MuseMetadataNamespaceTests">[docs]</a><span class="k">class</span> <span class="nc">MuseMetadataNamespaceTests</span><span class="p">(</span><span class="n">MuseMetadataNamespaceTestsImpl</span><span class="p">,</span>
                                 <span class="n">MuseClientFixtureMixin</span><span class="p">):</span>
    <span class="n">TEST_TYPE</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;NIGHTLY_MUSE_MISC_NAMESPACE&#39;</span><span class="p">]</span></div>


<div class="viewcode-block" id="MuseMetadataFromAppleHLSTests"><a class="viewcode-back" href="../../webserver.html#webserver.muse_playbackmetadata_namespace.MuseMetadataFromAppleHLSTests">[docs]</a><span class="k">class</span> <span class="nc">MuseMetadataFromAppleHLSTests</span><span class="p">(</span><span class="n">MuseMetadataFromAppleHLSTestsImpl</span><span class="p">,</span>
                               <span class="n">MuseClientFixtureMixin</span><span class="p">):</span>
    <span class="n">TEST_TYPE</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;NIGHTLY_MUSE_MISC_NAMESPACE&#39;</span><span class="p">]</span></div>


<div class="viewcode-block" id="MuseMetadataRateItemTests"><a class="viewcode-back" href="../../webserver.html#webserver.muse_playbackmetadata_namespace.MuseMetadataRateItemTests">[docs]</a><span class="k">class</span> <span class="nc">MuseMetadataRateItemTests</span><span class="p">(</span><span class="n">MuseMetadataRateItemTestsImpl</span><span class="p">,</span>
                                <span class="n">MuseClientFixtureMixin</span><span class="p">):</span>
    <span class="n">TEST_TYPE</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;NIGHTLY_MUSE_MISC_NAMESPACE&#39;</span><span class="p">]</span></div>


<div class="viewcode-block" id="MuseCloudClientMetadataNamespaceTests"><a class="viewcode-back" href="../../webserver.html#webserver.muse_playbackmetadata_namespace.MuseCloudClientMetadataNamespaceTests">[docs]</a><span class="k">class</span> <span class="nc">MuseCloudClientMetadataNamespaceTests</span><span class="p">(</span><span class="n">MuseMetadataNamespaceTestsImpl</span><span class="p">,</span>
                                            <span class="n">MuseCloudServerFixtureMixin</span><span class="p">):</span>
    <span class="n">TEST_TYPE</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;NIGHTLY_CLOUD_MUSE&#39;</span><span class="p">]</span></div>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">logging</span>
    <span class="n">suite</span> <span class="o">=</span> <span class="n">WorkflowTestSuite</span><span class="p">(</span><span class="s2">&quot;Muse Metadata Namespace Tests&quot;</span><span class="p">)</span>
    <span class="n">suite</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="n">MuseMetadataNamespaceTests</span><span class="p">(),</span>
               <span class="n">MuseMetadataFromAppleHLSTests</span><span class="p">()])</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span> <span class="k">if</span> <span class="n">suite</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">is_pass</span><span class="p">()</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">TestCase Documentation</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../audio.html">audio package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cloud.html">cloud package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../common.html">common package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../data_reporting.html">data_reporting package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dataio.html">dataio package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples.html">examples package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hdmi.html">hdmi package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ixchariot.html">ixchariot package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../networking.html">networking package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../other.html">other package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../perf.html">perf package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pytest_automation.html">pytest_automation package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../secure_registration.html">secure_registration package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../syssw.html">syssw package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../upnp.html">upnp package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../voice.html">voice package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../webserver.html">webserver package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../webserver_v0.html">webserver_v0 package</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019, Author.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.8.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>