
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>pytest_automation.player.user_controls.test_standalone_controls &#8212; TestCase Documentation  documentation</title>
    <link rel="stylesheet" href="../../../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
   
  <link rel="stylesheet" href="../../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for pytest_automation.player.user_controls.test_standalone_controls</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This module is intended to test the controls available to users for any</span>
<span class="sd">standalone player. These controls include loudness enablement/disablement,</span>
<span class="sd">treble adjustment, and bass adjustment. The values are set via Rendering</span>
<span class="sd">Control and are verified via DSP config page.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">pytest</span>
<span class="kn">from</span> <span class="nn">sonos.services.common</span> <span class="k">import</span> <span class="n">wait_until_true</span>

<span class="c1"># number of seconds to wait for loudness change to take effect</span>
<span class="n">LOUDNESS_CHANGE_WAIT_SEC</span> <span class="o">=</span> <span class="mi">10</span>

<span class="c1"># volume to set players to while testing loudness enabled/disabled</span>
<span class="n">LOUDNESS_TEST_VOLUME</span> <span class="o">=</span> <span class="mi">50</span>

<span class="c1"># number of times to test each state change on/off</span>
<span class="n">NUMBER_OF_ITERATIONS</span> <span class="o">=</span> <span class="mi">5</span>

<span class="c1"># number of seconds to wait for a treble/bass change to take effect</span>
<span class="n">TIMEOUT_EQ_CHANGE</span> <span class="o">=</span> <span class="mi">3</span>

<span class="n">DEFAULT_PLAYBACK_STREAM_LOUDNESS_DSP_BLOCK_ID</span> <span class="o">=</span> <span class="s1">&#39;chsnk-as-dsp.Loudness&#39;</span>

<span class="n">PLAYBACK_STREAM_LOUDNESS_DSP_BLOCK_ID_PER_PLAYER</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;S9&#39;</span><span class="p">:</span> <span class="s1">&#39;ChProcSysPlaybar.Loudness&#39;</span><span class="p">,</span>
    <span class="s1">&#39;S11&#39;</span><span class="p">:</span> <span class="s1">&#39;ChProcSysSol.Loudness&#39;</span><span class="p">,</span>
    <span class="s1">&#39;S14&#39;</span><span class="p">:</span> <span class="s1">&#39;ChProcSysElRey.Loudness&#39;</span><span class="p">,</span>
    <span class="s1">&#39;S16&#39;</span><span class="p">:</span> <span class="s1">&#39;ChProcSysHideout.Loudness&#39;</span>
<span class="p">}</span>

<span class="n">pytestmark</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">usefixtures</span><span class="p">(</span><span class="s1">&#39;disable_audio_output&#39;</span><span class="p">)</span>
<span class="p">]</span>


<div class="viewcode-block" id="get_playback_stream_loudness_block_id_for_player"><a class="viewcode-back" href="../../../../pytest_automation.player.user_controls.html#pytest_automation.player.user_controls.test_standalone_controls.get_playback_stream_loudness_block_id_for_player">[docs]</a><span class="k">def</span> <span class="nf">get_playback_stream_loudness_block_id_for_player</span><span class="p">(</span><span class="n">zp</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    return the name of the identifier for the loudness block for the given</span>
<span class="sd">    player that corresponds to the playback stream</span>
<span class="sd">    :param zp: Sonos Zone Component</span>
<span class="sd">    :return: string w/ playback stream loudness block ID</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">zp</span><span class="o">.</span><span class="n">modelNumber</span> <span class="ow">in</span> <span class="n">PLAYBACK_STREAM_LOUDNESS_DSP_BLOCK_ID_PER_PLAYER</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">PLAYBACK_STREAM_LOUDNESS_DSP_BLOCK_ID_PER_PLAYER</span><span class="p">[</span><span class="n">zp</span><span class="o">.</span><span class="n">modelNumber</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">DEFAULT_PLAYBACK_STREAM_LOUDNESS_DSP_BLOCK_ID</span></div>


<div class="viewcode-block" id="loudness_is_enabled"><a class="viewcode-back" href="../../../../pytest_automation.player.user_controls.html#pytest_automation.player.user_controls.test_standalone_controls.loudness_is_enabled">[docs]</a><span class="k">def</span> <span class="nf">loudness_is_enabled</span><span class="p">(</span><span class="n">zp</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check if loudness is enabled on the DSP</span>
<span class="sd">    :param zp: Sonos Zone Component</span>
<span class="sd">    :return: True/False</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># SH4&#39;s layout is different from that of other arches on &lt;ip&gt;:1400/getDSP</span>
    <span class="k">if</span> <span class="n">zp</span><span class="o">.</span><span class="n">get_arch</span><span class="p">()</span> <span class="ow">is</span> <span class="s1">&#39;sh4&#39;</span><span class="p">:</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">zp</span><span class="o">.</span><span class="n">diag</span><span class="o">.</span><span class="n">get_dsp_block</span><span class="p">(</span><span class="s1">&#39;DSPSystemSH4&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s1">&#39;parameter&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;param&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;Loudness&quot;</span><span class="p">:</span>
                <span class="c1"># a &quot;0&quot; denotes off and a &quot;1&quot; denotes on</span>
                <span class="k">return</span> <span class="n">p</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="s2">&quot;1&quot;</span>

    <span class="c1"># for all other arches that are not SH4</span>
    <span class="n">blocks</span> <span class="o">=</span> <span class="n">zp</span><span class="o">.</span><span class="n">diag</span><span class="o">.</span><span class="n">get_dsp_blocks</span><span class="p">(</span><span class="s1">&#39;Loudness&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">blocks</span><span class="p">:</span>

        <span class="c1"># updating as per SWPBL-109694 - loudness control only affects</span>
        <span class="c1"># the chsnk stream, not the  feedback stream or external audio stream</span>
        <span class="n">identifier</span> <span class="o">=</span> <span class="n">block</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">text</span>
        <span class="k">if</span> <span class="n">identifier</span> <span class="o">!=</span> <span class="n">get_playback_stream_loudness_block_id_for_player</span><span class="p">(</span><span class="n">zp</span><span class="p">):</span>
            <span class="n">pytest</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Skipping loudness block w/ ID: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">identifier</span>
            <span class="p">))</span>
            <span class="k">continue</span>

        <span class="n">params</span> <span class="o">=</span> <span class="n">block</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;parameter&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;set_0&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s1">&#39;section_0&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;param&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;loudness&#39;</span> <span class="ow">in</span> <span class="n">val</span><span class="p">:</span>
                <span class="n">pytest</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Value: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>
                <span class="c1"># if either of the gain values are &gt; 0 in the loudness block (</span>
                <span class="c1"># i.e. if not unity gain), then loudness is enabled</span>
                <span class="k">return</span> <span class="nb">float</span><span class="p">(</span>
                    <span class="n">val</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)[</span><span class="mi">2</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mf">0.0</span> <span class="ow">or</span> <span class="nb">float</span><span class="p">(</span>
                    <span class="n">val</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)[</span><span class="mi">4</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mf">0.0</span>
    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;loudness param not found&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="get_bass_level"><a class="viewcode-back" href="../../../../pytest_automation.player.user_controls.html#pytest_automation.player.user_controls.test_standalone_controls.get_bass_level">[docs]</a><span class="k">def</span> <span class="nf">get_bass_level</span><span class="p">(</span><span class="n">zp</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the level of the bass in DB from the DSP of the ZP</span>
<span class="sd">    :param zp: Sonos Zone Component</span>
<span class="sd">    :return: float value representing the bass level on the ZP</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">zp</span><span class="o">.</span><span class="n">get_arch</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;sh4&quot;</span><span class="p">:</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">zp</span><span class="o">.</span><span class="n">diag</span><span class="o">.</span><span class="n">get_dsp_block</span><span class="p">(</span><span class="s1">&#39;DSPSystemSH4&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s1">&#39;parameter&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;param&#39;</span><span class="p">)</span>
        <span class="n">bass</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">params</span> <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;Bass&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">bass</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

    <span class="n">bass</span> <span class="o">=</span> <span class="n">zp</span><span class="o">.</span><span class="n">diag</span><span class="o">.</span><span class="n">get_dsp_block</span><span class="p">(</span><span class="s1">&#39;Bass&#39;</span><span class="p">)</span>
    <span class="n">bass_params</span> <span class="o">=</span> <span class="n">bass</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;parameter&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;set_0&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;section_0&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
        <span class="s1">&#39;param&#39;</span><span class="p">)</span>
    <span class="n">filter_params</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">bass_params</span> <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;filter_0_0&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">bass_level</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">filter_params</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">pytest</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Bass level: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bass_level</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">bass_level</span></div>


<div class="viewcode-block" id="get_treble_level"><a class="viewcode-back" href="../../../../pytest_automation.player.user_controls.html#pytest_automation.player.user_controls.test_standalone_controls.get_treble_level">[docs]</a><span class="k">def</span> <span class="nf">get_treble_level</span><span class="p">(</span><span class="n">zp</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the level of the treble in DB from the DSP of the ZP</span>
<span class="sd">    :param zp: Sonos Zone Component</span>
<span class="sd">    :return: float value representing the treble level on the ZP</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">zp</span><span class="o">.</span><span class="n">get_arch</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;sh4&quot;</span><span class="p">:</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">zp</span><span class="o">.</span><span class="n">diag</span><span class="o">.</span><span class="n">get_dsp_block</span><span class="p">(</span><span class="s1">&#39;DSPSystemSH4&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s1">&#39;parameter&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;param&#39;</span><span class="p">)</span>
        <span class="n">treble</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">params</span> <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;Treble&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">treble</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

    <span class="n">treb</span> <span class="o">=</span> <span class="n">zp</span><span class="o">.</span><span class="n">diag</span><span class="o">.</span><span class="n">get_dsp_block</span><span class="p">(</span><span class="s1">&#39;Treble&#39;</span><span class="p">)</span>
    <span class="n">treb_params</span> <span class="o">=</span> <span class="n">treb</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;parameter&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;set_0&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;section_0&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
        <span class="s1">&#39;param&#39;</span><span class="p">)</span>
    <span class="n">filter_params</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">treb_params</span> <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;filter_0_0&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">treble_level</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">filter_params</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">pytest</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Treble level: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">treble_level</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">treble_level</span></div>


<div class="viewcode-block" id="set_bass_to_level_and_wait"><a class="viewcode-back" href="../../../../pytest_automation.player.user_controls.html#pytest_automation.player.user_controls.test_standalone_controls.set_bass_to_level_and_wait">[docs]</a><span class="k">def</span> <span class="nf">set_bass_to_level_and_wait</span><span class="p">(</span><span class="n">zp</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">exp</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Set the bass level to the level given and wait for the value grabbed</span>
<span class="sd">    from the DSP config to match exp.</span>
<span class="sd">    This function will throw a timeout error if it fails</span>
<span class="sd">    :param zp: Sonos Zone Component</span>
<span class="sd">    :param level: the level to call the RenderingControl method with</span>
<span class="sd">    :param exp: the level to expect when parsing the DSP config</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">zp</span><span class="o">.</span><span class="n">RenderingControl</span><span class="o">.</span><span class="n">SetBass</span><span class="p">(</span><span class="n">level</span><span class="p">)</span>
    <span class="n">pytest</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Waiting for bass to go to </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">exp</span><span class="p">))</span>
    <span class="n">wait_until_true</span><span class="p">(</span><span class="n">predicate</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">get_bass_level</span><span class="p">(</span><span class="n">zp</span><span class="p">)</span> <span class="o">==</span> <span class="n">exp</span><span class="p">,</span>
                    <span class="n">timeout_seconds</span><span class="o">=</span><span class="n">TIMEOUT_EQ_CHANGE</span><span class="p">,</span>
                    <span class="n">reason</span><span class="o">=</span><span class="s2">&quot;Waiting for level to adjust&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="set_treble_to_level_and_wait"><a class="viewcode-back" href="../../../../pytest_automation.player.user_controls.html#pytest_automation.player.user_controls.test_standalone_controls.set_treble_to_level_and_wait">[docs]</a><span class="k">def</span> <span class="nf">set_treble_to_level_and_wait</span><span class="p">(</span><span class="n">zp</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">exp</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Set the treble level to the level given and wait for the value grabbed</span>
<span class="sd">    from the DSP config to match exp.</span>
<span class="sd">    This function will throw a timeout error if it fails</span>
<span class="sd">    :param zp: Sonos Zone Component</span>
<span class="sd">    :param level: the level to call the RenderingControl method with</span>
<span class="sd">    :param exp: the level to expect when parsing the DSP config</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">zp</span><span class="o">.</span><span class="n">RenderingControl</span><span class="o">.</span><span class="n">SetTreble</span><span class="p">(</span><span class="n">level</span><span class="p">)</span>
    <span class="n">pytest</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Waiting for treble to go to </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">exp</span><span class="p">))</span>
    <span class="n">wait_until_true</span><span class="p">(</span><span class="n">predicate</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">get_treble_level</span><span class="p">(</span><span class="n">zp</span><span class="p">)</span> <span class="o">==</span> <span class="n">exp</span><span class="p">,</span>
                    <span class="n">timeout_seconds</span><span class="o">=</span><span class="n">TIMEOUT_EQ_CHANGE</span><span class="p">,</span>
                    <span class="n">reason</span><span class="o">=</span><span class="s2">&quot;Waiting for level to adjust&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="play_music_on_player"><a class="viewcode-back" href="../../../../pytest_automation.player.user_controls.html#pytest_automation.player.user_controls.test_standalone_controls.play_music_on_player">[docs]</a><span class="k">def</span> <span class="nf">play_music_on_player</span><span class="p">(</span><span class="n">zp</span><span class="p">,</span> <span class="n">track_uri</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Begin playback of music on the given ZP</span>
<span class="sd">    :param zp: Sonos Zone Component</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># play some content in order to enable the loudness block in the DSP chain</span>
    <span class="n">zp</span><span class="o">.</span><span class="n">AVTransport</span><span class="o">.</span><span class="n">SetAVTransportURI</span><span class="p">(</span><span class="n">track_uri</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="c1"># disable the speakers so that the test room isn&#39;t blasting</span>
    <span class="n">zp</span><span class="o">.</span><span class="n">AVTransport</span><span class="o">.</span><span class="n">Play_and_wait</span><span class="p">()</span>

    <span class="n">zp</span><span class="o">.</span><span class="n">RenderingControl</span><span class="o">.</span><span class="n">SetVolume</span><span class="p">(</span><span class="n">LOUDNESS_TEST_VOLUME</span><span class="p">)</span></div>


<div class="viewcode-block" id="test_loudness_enable_disable"><a class="viewcode-back" href="../../../../pytest_automation.player.user_controls.html#pytest_automation.player.user_controls.test_standalone_controls.test_loudness_enable_disable">[docs]</a><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">loudness</span>
<span class="k">def</span> <span class="nf">test_loudness_enable_disable</span><span class="p">(</span><span class="n">playback_device</span><span class="p">,</span> <span class="n">track_uri</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This test verifies that when a user changes the loudness setting via</span>
<span class="sd">    RenderingControl, the DSP receives the state change via the player code.</span>

<span class="sd">    Check that the DSP config page shows loudness gain enabled and disabled</span>
<span class="sd">    when configured from RenderingControl</span>
<span class="sd">    :param playback_device: a Sonos Zone Player (test all arches)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">zp</span> <span class="o">=</span> <span class="n">playback_device</span>
    <span class="k">if</span> <span class="n">zp</span><span class="o">.</span><span class="n">is_bonded</span><span class="p">():</span>
        <span class="n">zp</span><span class="o">.</span><span class="n">DeviceProperties</span><span class="o">.</span><span class="n">cleanup_bonded_configuration</span><span class="p">()</span>

    <span class="n">play_music_on_player</span><span class="p">(</span><span class="n">zp</span><span class="p">,</span> <span class="n">track_uri</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">NUMBER_OF_ITERATIONS</span><span class="p">):</span>
        <span class="c1"># disable loudness</span>
        <span class="n">zp</span><span class="o">.</span><span class="n">RenderingControl</span><span class="o">.</span><span class="n">SetLoudness</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># confirm loudness disabled at DSP page</span>
        <span class="n">wait_until_true</span><span class="p">(</span><span class="n">predicate</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">loudness_is_enabled</span><span class="p">(</span><span class="n">zp</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">,</span>
                        <span class="n">timeout_seconds</span><span class="o">=</span><span class="n">LOUDNESS_CHANGE_WAIT_SEC</span><span class="p">,</span>
                        <span class="n">reason</span><span class="o">=</span><span class="s2">&quot;Waiting for Loudness to be disabled in DSP&quot;</span><span class="p">)</span>

        <span class="c1"># enable loudness</span>
        <span class="n">zp</span><span class="o">.</span><span class="n">RenderingControl</span><span class="o">.</span><span class="n">SetLoudness</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># confirm loudness enabled at DSP page</span>
        <span class="n">wait_until_true</span><span class="p">(</span><span class="n">predicate</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">loudness_is_enabled</span><span class="p">(</span><span class="n">zp</span><span class="p">),</span>
                        <span class="n">timeout_seconds</span><span class="o">=</span><span class="n">LOUDNESS_CHANGE_WAIT_SEC</span><span class="p">,</span>
                        <span class="n">reason</span><span class="o">=</span><span class="s2">&quot;Waiting for Loudness to be enabled in DSP&quot;</span><span class="p">)</span>
    <span class="n">zp</span><span class="o">.</span><span class="n">AVTransport</span><span class="o">.</span><span class="n">Stop</span><span class="p">()</span></div>


<div class="viewcode-block" id="test_bass_control"><a class="viewcode-back" href="../../../../pytest_automation.player.user_controls.html#pytest_automation.player.user_controls.test_standalone_controls.test_bass_control">[docs]</a><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">eq</span>
<span class="k">def</span> <span class="nf">test_bass_control</span><span class="p">(</span><span class="n">playback_device</span><span class="p">,</span> <span class="n">track_uri</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Test to verify that specifying the Bass level via RenderingControl does</span>
<span class="sd">    propagate to the DSP</span>
<span class="sd">    :param playback_device: Sonos Zone Component</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">zp</span> <span class="o">=</span> <span class="n">playback_device</span>

    <span class="n">play_music_on_player</span><span class="p">(</span><span class="n">zp</span><span class="p">,</span> <span class="n">track_uri</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">NUMBER_OF_ITERATIONS</span><span class="p">):</span>
        <span class="n">zp</span><span class="o">.</span><span class="n">RenderingControl</span><span class="o">.</span><span class="n">SetBass</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">wait_until_true</span><span class="p">(</span><span class="n">predicate</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">get_bass_level</span><span class="p">(</span><span class="n">zp</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">,</span>
                        <span class="n">timeout_seconds</span><span class="o">=</span><span class="n">TIMEOUT_EQ_CHANGE</span><span class="p">,</span>
                        <span class="n">reason</span><span class="o">=</span><span class="s2">&quot;Waiting for level to adjust&quot;</span><span class="p">)</span>

        <span class="n">zp</span><span class="o">.</span><span class="n">RenderingControl</span><span class="o">.</span><span class="n">SetBass</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">wait_until_true</span><span class="p">(</span><span class="n">predicate</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">get_bass_level</span><span class="p">(</span><span class="n">zp</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
                        <span class="n">timeout_seconds</span><span class="o">=</span><span class="n">TIMEOUT_EQ_CHANGE</span><span class="p">,</span>
                        <span class="n">reason</span><span class="o">=</span><span class="s2">&quot;Waiting for level to adjust&quot;</span><span class="p">)</span>

        <span class="n">zp</span><span class="o">.</span><span class="n">RenderingControl</span><span class="o">.</span><span class="n">SetBass</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">wait_until_true</span><span class="p">(</span><span class="n">predicate</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">get_bass_level</span><span class="p">(</span><span class="n">zp</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span>
                        <span class="n">timeout_seconds</span><span class="o">=</span><span class="n">TIMEOUT_EQ_CHANGE</span><span class="p">,</span>
                        <span class="n">reason</span><span class="o">=</span><span class="s2">&quot;Waiting for level to adjust&quot;</span><span class="p">)</span>
    <span class="n">zp</span><span class="o">.</span><span class="n">AVTransport</span><span class="o">.</span><span class="n">Stop</span><span class="p">()</span></div>


<div class="viewcode-block" id="test_treble_control"><a class="viewcode-back" href="../../../../pytest_automation.player.user_controls.html#pytest_automation.player.user_controls.test_standalone_controls.test_treble_control">[docs]</a><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">eq</span>
<span class="k">def</span> <span class="nf">test_treble_control</span><span class="p">(</span><span class="n">playback_device</span><span class="p">,</span> <span class="n">track_uri</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Test to verify that specifying the Treble level via RenderingControl does</span>
<span class="sd">    propagate to the DSP</span>
<span class="sd">    :param playback_device: Sonos Zone Component</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">zp</span> <span class="o">=</span> <span class="n">playback_device</span>
    <span class="n">play_music_on_player</span><span class="p">(</span><span class="n">zp</span><span class="p">,</span> <span class="n">track_uri</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">NUMBER_OF_ITERATIONS</span><span class="p">):</span>

        <span class="n">zp</span><span class="o">.</span><span class="n">RenderingControl</span><span class="o">.</span><span class="n">SetTreble</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">wait_until_true</span><span class="p">(</span><span class="n">predicate</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">get_treble_level</span><span class="p">(</span><span class="n">zp</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">,</span>
                        <span class="n">timeout_seconds</span><span class="o">=</span><span class="n">TIMEOUT_EQ_CHANGE</span><span class="p">,</span>
                        <span class="n">reason</span><span class="o">=</span><span class="s2">&quot;Waiting for level to adjust&quot;</span><span class="p">)</span>

        <span class="n">zp</span><span class="o">.</span><span class="n">RenderingControl</span><span class="o">.</span><span class="n">SetTreble</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">wait_until_true</span><span class="p">(</span><span class="n">predicate</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">get_treble_level</span><span class="p">(</span><span class="n">zp</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
                        <span class="n">timeout_seconds</span><span class="o">=</span><span class="n">TIMEOUT_EQ_CHANGE</span><span class="p">,</span>
                        <span class="n">reason</span><span class="o">=</span><span class="s2">&quot;Waiting for level to adjust&quot;</span><span class="p">)</span>

        <span class="n">zp</span><span class="o">.</span><span class="n">RenderingControl</span><span class="o">.</span><span class="n">SetTreble</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">wait_until_true</span><span class="p">(</span><span class="n">predicate</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">get_treble_level</span><span class="p">(</span><span class="n">zp</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span>
                        <span class="n">timeout_seconds</span><span class="o">=</span><span class="n">TIMEOUT_EQ_CHANGE</span><span class="p">,</span>
                        <span class="n">reason</span><span class="o">=</span><span class="s2">&quot;Waiting for level to adjust&quot;</span><span class="p">)</span>
    <span class="n">zp</span><span class="o">.</span><span class="n">AVTransport</span><span class="o">.</span><span class="n">Stop</span><span class="p">()</span></div>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../../index.html">TestCase Documentation</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../audio.html">audio package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../cloud.html">cloud package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../common.html">common package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../data_reporting.html">data_reporting package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../dataio.html">dataio package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../examples.html">examples package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../hdmi.html">hdmi package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../ixchariot.html">ixchariot package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../networking.html">networking package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../other.html">other package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../perf.html">perf package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../pytest_automation.html">pytest_automation package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../secure_registration.html">secure_registration package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../syssw.html">syssw package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../upnp.html">upnp package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../voice.html">voice package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../webserver.html">webserver package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../webserver_v0.html">webserver_v0 package</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../../index.html">Documentation overview</a><ul>
  <li><a href="../../../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019, Author.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.8.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>