
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>networking.netstart.transactions &#8212; TestCase Documentation  documentation</title>
    <link rel="stylesheet" href="../../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for networking.netstart.transactions</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="kn">from</span> <span class="nn">networking.netstart.base</span> <span class="k">import</span> <span class="n">NetstartWorkflowTestFixture</span>
<span class="kn">from</span> <span class="nn">sonos.simple_upgrade</span> <span class="k">import</span> <span class="n">SimpleUpgradeTestFixture</span>
<span class="kn">from</span> <span class="nn">sonos.workflow.fixture</span> <span class="k">import</span> <span class="n">WorkflowTestFixture</span><span class="p">,</span> <span class="n">combinatorial</span>
<span class="kn">from</span> <span class="nn">sonos.netstart.netstart_test</span> <span class="k">import</span> <span class="n">NetstartTestTransactionError</span>
<span class="kn">from</span> <span class="nn">sonos.workflow.suite</span> <span class="k">import</span> <span class="n">WorkflowTestSuite</span>


<span class="n">NFWSSID</span> <span class="o">=</span> <span class="s2">&quot;RINCON&quot;</span>
<span class="n">NFWPWD</span> <span class="o">=</span> <span class="s2">&quot;R!nc0n$S0n0s&quot;</span>
<span class="n">TOTO_VERSION</span> <span class="o">=</span> <span class="s1">&#39;24.0&#39;</span>
<span class="n">ELIMINATOR_VERSION</span> <span class="o">=</span> <span class="s1">&#39;25.1&#39;</span>

<span class="n">ARCHES_WITH_V2_CERT_METADATA</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;fenway&#39;</span><span class="p">,</span> <span class="s1">&#39;limelight&#39;</span><span class="p">,</span> <span class="s1">&#39;fillmore&#39;</span><span class="p">,</span> <span class="s1">&#39;connectx&#39;</span><span class="p">,</span>
    <span class="s1">&#39;encore&#39;</span><span class="p">,</span> <span class="s1">&#39;solbase&#39;</span><span class="p">,</span> <span class="s1">&#39;royale&#39;</span><span class="p">,</span> <span class="s1">&#39;bootleg&#39;</span><span class="p">)</span>
<span class="n">TOTAL_ZONES_TO_TEST</span> <span class="o">=</span> <span class="mi">4</span>


<div class="viewcode-block" id="NetstartQueryCertMetadataFixture"><a class="viewcode-back" href="../../../networking.netstart.html#networking.netstart.transactions.NetstartQueryCertMetadataFixture">[docs]</a><span class="k">class</span> <span class="nc">NetstartQueryCertMetadataFixture</span><span class="p">(</span><span class="n">NetstartWorkflowTestFixture</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Verifies...</span>

<span class="sd">    1. Legacy devices that support v2 certs and have them respond with</span>
<span class="sd">       extra metadata their cert is signed with</span>
<span class="sd">    2. Legacy devices that support v2 certs and do not have them do not</span>
<span class="sd">       respond with extra metadata</span>
<span class="sd">    3. Legacy devices that do not support v2 certs do not respond with extra</span>
<span class="sd">       metadata</span>
<span class="sd">    4. Secure boot devices respond with the extra metadata their cert is</span>
<span class="sd">       signed with</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="NetstartQueryCertMetadataFixture.is_cert_metadata_supported"><a class="viewcode-back" href="../../../networking.netstart.html#networking.netstart.transactions.NetstartQueryCertMetadataFixture.is_cert_metadata_supported">[docs]</a>    <span class="k">def</span> <span class="nf">is_cert_metadata_supported</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zone</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks whether or not zone&#39;s architecture is v2 certificate supported</span>

<span class="sd">        :param zone: the zone component to check</span>
<span class="sd">        :type zone: :class:`~sonos.client.internal.SonosZoneComponent`</span>
<span class="sd">        :returns: whether or not zone supports v2 signed certificates</span>
<span class="sd">        :rtype: :obj:`bool`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">zone</span><span class="o">.</span><span class="n">cli</span><span class="o">.</span><span class="n">get_arch</span><span class="p">()</span> <span class="ow">in</span> <span class="n">ARCHES_WITH_V2_CERT_METADATA</span></div>

<div class="viewcode-block" id="NetstartQueryCertMetadataFixture.setUpFixture"><a class="viewcode-back" href="../../../networking.netstart.html#networking.netstart.transactions.NetstartQueryCertMetadataFixture.setUpFixture">[docs]</a>    <span class="k">def</span> <span class="nf">setUpFixture</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Identifies devices to test and stores them in :attr:`test_zones` used</span>
<span class="sd">        to drive the test case</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">NetstartQueryCertMetadataFixture</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">setUpFixture</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_zones</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">has_sec_boot_cert</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">has_v2_cert</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">has_v2_supported_with_v1</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">has_v1_only</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">test_models</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">sol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_testbed_device_by_model</span><span class="p">(</span><span class="s1">&#39;S11&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">test_zones</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sol</span><span class="p">)</span>
            <span class="n">test_models</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sol</span><span class="o">.</span><span class="n">modelNumber</span><span class="p">)</span>
            <span class="n">has_sec_boot_cert</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;no SOL found in my_devices&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">zone</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">my_devices</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">zone</span><span class="o">.</span><span class="n">modelNumber</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">test_models</span><span class="p">:</span>
                <span class="n">mdp2_version</span> <span class="o">=</span> <span class="n">zone</span><span class="o">.</span><span class="n">cli</span><span class="o">.</span><span class="n">mdp</span><span class="o">.</span><span class="n">get_mdp2version</span><span class="p">()</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">mdp2_version</span> <span class="o">&gt;=</span> <span class="mi">4</span> <span class="ow">and</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">is_cert_metadata_supported</span><span class="p">(</span><span class="n">zone</span><span class="p">)):</span>
                    <span class="n">mdp2_enc</span> <span class="o">=</span> <span class="n">zone</span><span class="o">.</span><span class="n">cli</span><span class="o">.</span><span class="n">mdp</span><span class="o">.</span><span class="n">mdp2encversion</span>
                    <span class="k">if</span> <span class="n">mdp2_enc</span> <span class="ow">and</span> <span class="n">mdp2_enc</span> <span class="o">&gt;=</span> <span class="mi">5</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">has_sec_boot_cert</span><span class="p">:</span>
                        <span class="n">has_sec_boot_cert</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">elif</span> <span class="ow">not</span> <span class="n">has_v2_cert</span><span class="p">:</span>
                        <span class="n">has_v2_cert</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">continue</span>
                <span class="k">elif</span> <span class="p">(</span><span class="n">mdp2_version</span> <span class="o">&lt;</span> <span class="mi">4</span> <span class="ow">and</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">is_cert_metadata_supported</span><span class="p">(</span><span class="n">zone</span><span class="p">)</span> <span class="ow">and</span>
                        <span class="ow">not</span> <span class="n">has_v2_supported_with_v1</span><span class="p">):</span>
                    <span class="n">has_v2_supported_with_v1</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">elif</span> <span class="p">(</span><span class="n">mdp2_version</span> <span class="o">&lt;</span> <span class="mi">4</span> <span class="ow">and</span>
                        <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_cert_metadata_supported</span><span class="p">(</span><span class="n">zone</span><span class="p">)</span> <span class="ow">and</span>
                        <span class="ow">not</span> <span class="n">has_v1_only</span><span class="p">):</span>
                    <span class="n">has_v1_only</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_zones</span><span class="p">)</span> <span class="o">==</span> <span class="n">TOTAL_ZONES_TO_TEST</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">test_zones</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">zone</span><span class="p">)</span>
                <span class="n">test_models</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">zone</span><span class="o">.</span><span class="n">modelNumber</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verifyTrueOrStop</span><span class="p">(</span><span class="n">has_sec_boot_cert</span><span class="p">,</span>
            <span class="s2">&quot;Verify zone player with secure boot cert was found&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verifyTrueOrStop</span><span class="p">(</span><span class="n">has_v2_cert</span><span class="p">,</span>
            <span class="s2">&quot;Verify zone player with v2 cert was found&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verifyTrueOrStop</span><span class="p">(</span><span class="n">has_v2_supported_with_v1</span><span class="p">,</span>
            <span class="s2">&quot;Verify zone player that supports v2 cert and has v1 was found&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verifyTrueOrStop</span><span class="p">(</span><span class="n">has_v1_only</span><span class="p">,</span>
            <span class="s2">&quot;Verify zone player that only supports v1 cert was found&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="NetstartQueryCertMetadataFixture.verify_unitsig_metadata"><a class="viewcode-back" href="../../../networking.netstart.html#networking.netstart.transactions.NetstartQueryCertMetadataFixture.verify_unitsig_metadata">[docs]</a>    <span class="k">def</span> <span class="nf">verify_unitsig_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zone</span><span class="p">,</span> <span class="n">expect_sig_data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Verifies unitsig metadata is present or not in the netstart query</span>
<span class="sd">        response on a given zone component.  If unitsig metadata is expected</span>
<span class="sd">        additional verifications against the values are performed</span>

<span class="sd">        :param zone: the zone component to check</span>
<span class="sd">        :type zone: :class:`~sonos.client.internal.SonosZoneComponent`</span>
<span class="sd">        :param expected_sig_data: whether or not to check for unitsig data</span>
<span class="sd">            in the netstart query response</span>
<span class="sd">        :type expect_sig_data: :obj:`bool`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">query_response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">netstart_test</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">zone</span><span class="p">,</span> <span class="n">zone</span><span class="o">.</span><span class="n">hhid</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">expect_sig_data</span><span class="p">:</span>
            <span class="n">expected_auth_resp_version</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">expected_auth_resp_version</span> <span class="o">=</span> <span class="mi">2</span> <span class="k">if</span> <span class="n">zone</span><span class="o">.</span><span class="n">is_br100</span><span class="p">()</span> <span class="k">else</span> <span class="mi">3</span>
        <span class="n">auth_resp_version_match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">ur</span><span class="s1">&#39;Msg RESPONSE.*auth (-?\d+)&#39;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">netstart_test</span><span class="o">.</span><span class="n">transaction_log</span><span class="p">)</span>
        <span class="n">actual_auth_resp_version</span> <span class="o">=</span> <span class="p">(</span><span class="n">auth_resp_version_match</span> <span class="ow">and</span>
            <span class="nb">int</span><span class="p">(</span><span class="n">auth_resp_version_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verifyEqualOrStop</span><span class="p">(</span><span class="n">expected_auth_resp_version</span><span class="p">,</span>
            <span class="n">actual_auth_resp_version</span><span class="p">,</span>
            <span class="s2">&quot;Verify QUERY auth response version number&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">expect_sig_data</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">verifyIsNotNoneOrStop</span><span class="p">(</span><span class="n">query_response</span><span class="o">.</span><span class="n">unitsig_metadata</span><span class="p">,</span>
                <span class="s2">&quot;Verify UNITSIG_METADATA is in response&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">verifyEqualOrFailCase</span><span class="p">(</span><span class="n">zone</span><span class="o">.</span><span class="n">serialNumber</span><span class="p">,</span>
                <span class="n">query_response</span><span class="o">.</span><span class="n">unitsig_metadata</span><span class="o">.</span><span class="n">serial</span><span class="p">,</span>
                <span class="s2">&quot;Verify serial number in UNITSIG_METADATA matches one &quot;</span>
                <span class="s2">&quot;advertised by UPnP&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">verifyEqualOrFailCase</span><span class="p">(</span><span class="n">zone</span><span class="o">.</span><span class="n">cli</span><span class="o">.</span><span class="n">mdp</span><span class="o">.</span><span class="n">model</span><span class="p">,</span>
                <span class="n">query_response</span><span class="o">.</span><span class="n">unitsig_metadata</span><span class="o">.</span><span class="n">model</span><span class="p">,</span>
                <span class="s2">&quot;Verify model number in UNITSIG_METADATA matches MDP value&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">verifyEqualOrFailCase</span><span class="p">(</span><span class="n">zone</span><span class="o">.</span><span class="n">cli</span><span class="o">.</span><span class="n">mdp</span><span class="o">.</span><span class="n">submodel</span><span class="p">,</span>
                <span class="n">query_response</span><span class="o">.</span><span class="n">unitsig_metadata</span><span class="o">.</span><span class="n">submodel</span><span class="p">,</span>
                <span class="s2">&quot;Verify submodel number in UNITSIG_METADATA matches MDP value&quot;</span><span class="p">)</span>
            <span class="c1"># for now &quot;legacy v2 cert&quot; devices have no flags</span>
            <span class="k">if</span> <span class="n">zone</span><span class="o">.</span><span class="n">cli</span><span class="o">.</span><span class="n">mdp</span><span class="o">.</span><span class="n">mdp2encversion</span><span class="p">:</span>
                <span class="c1"># since we get data via Cli we can assume at least the</span>
                <span class="c1"># devunlock flag is set here</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">verifyGreaterEqualOrFailCase</span><span class="p">(</span>
                    <span class="n">query_response</span><span class="o">.</span><span class="n">unitsig_metadata</span><span class="o">.</span><span class="n">flags</span><span class="p">,</span>
                    <span class="mi">1</span><span class="p">,</span>
                    <span class="s2">&quot;Verify secure boot cert has UNITSIG_METADATA flags set&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">verifyFalseOrFailCase</span><span class="p">(</span>
                    <span class="n">query_response</span><span class="o">.</span><span class="n">unitsig_metadata</span><span class="o">.</span><span class="n">flags</span><span class="p">,</span>
                    <span class="s2">&quot;Verify legacy v2 cert UNITSIG_METADATA flags are unset&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">verifyEqualOrFailCase</span><span class="p">(</span><span class="n">zone</span><span class="o">.</span><span class="n">cli</span><span class="o">.</span><span class="n">mdp</span><span class="o">.</span><span class="n">variant</span><span class="p">,</span>
                <span class="n">query_response</span><span class="o">.</span><span class="n">unitsig_metadata</span><span class="o">.</span><span class="n">var</span><span class="p">,</span>
                <span class="s2">&quot;Verify variant number in UNITSIG_METADATA matches MDP value&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">verifyIsNoneOrStop</span><span class="p">(</span><span class="n">query_response</span><span class="o">.</span><span class="n">unitsig_metadata</span><span class="p">,</span>
                <span class="s2">&quot;Verify UNITSIG_METADATA is not in response&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="NetstartQueryCertMetadataFixture.test_v2_cert_query_response"><a class="viewcode-back" href="../../../networking.netstart.html#networking.netstart.transactions.NetstartQueryCertMetadataFixture.test_v2_cert_query_response">[docs]</a>    <span class="nd">@combinatorial</span><span class="p">(</span><span class="s1">&#39;test_zones&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_v2_cert_query_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zone</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Verifies the expected netstart query response for v2 supported and</span>
<span class="sd">        unsupported devices, as outlined in</span>
<span class="sd">        :class:`NetstartLegacyV2CertQueryFixture`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">expect_unitsig_metadata</span> <span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">is_cert_metadata_supported</span><span class="p">(</span><span class="n">zone</span><span class="p">)</span> <span class="ow">and</span>
            <span class="n">zone</span><span class="o">.</span><span class="n">cli</span><span class="o">.</span><span class="n">mdp</span><span class="o">.</span><span class="n">get_mdp2version</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">)</span> <span class="k">else</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify_unitsig_metadata</span><span class="p">(</span><span class="n">zone</span><span class="p">,</span> <span class="n">expect_unitsig_metadata</span><span class="p">)</span></div></div>


<span class="c1"># TODO: Get these tests back up and running</span>
<div class="viewcode-block" id="NetstartTransactionsTestFixture"><a class="viewcode-back" href="../../../networking.netstart.html#networking.netstart.transactions.NetstartTransactionsTestFixture">[docs]</a><span class="k">class</span> <span class="nc">NetstartTransactionsTestFixture</span><span class="p">(</span><span class="n">WorkflowTestFixture</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Makes sure netstart protocol messages aren&#39;t done busted.</span>

<span class="sd">    ..note ::</span>

<span class="sd">        SONOSNET_SETUP and NFW_SETUP transactions are tested in the</span>
<span class="sd">        state_machine module implicitly, so they are not tested here.</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="NetstartTransactionsTestFixture.test_response_to_trusted_v4_query_with_no_hhid"><a class="viewcode-back" href="../../../networking.netstart.html#networking.netstart.transactions.NetstartTransactionsTestFixture.test_response_to_trusted_v4_query_with_no_hhid">[docs]</a>    <span class="k">def</span> <span class="nf">test_response_to_trusted_v4_query_with_no_hhid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Test response to trusted version 4 (builds post Prince) query with</span>
<span class="sd">        no HHID should not return NFW credentials</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">zone</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_zones</span><span class="p">:</span>
            <span class="n">hh_created</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">netstart_test</span><span class="o">.</span><span class="n">sonosnet_setup</span><span class="p">(</span><span class="n">zone</span><span class="p">,</span>
                <span class="n">nfwssid</span><span class="o">=</span><span class="n">NFWSSID</span><span class="p">,</span> <span class="n">nfwpwd</span><span class="o">=</span><span class="n">NFWPWD</span><span class="p">)</span>

            <span class="c1"># Do a trusted. version=4 query with no HHId</span>
            <span class="n">query_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">netstart_test</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">zone</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                <span class="n">hhid</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">untrusted</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">verifyEqualOrFailCase</span><span class="p">(</span><span class="n">hh_created</span><span class="p">,</span> <span class="n">query_result</span><span class="o">.</span><span class="n">hhid</span><span class="p">,</span>
                <span class="s1">&#39;Verify trusted v4 query w/o HHID returns HHID&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">verifyIsNoneOrFailCase</span><span class="p">(</span><span class="n">query_result</span><span class="o">.</span><span class="n">nfw_ssid</span><span class="p">,</span>
                <span class="s1">&#39;Verify NFWSSID is not returned for query w/o HHID&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">verifyIsNoneOrFailCase</span><span class="p">(</span><span class="n">query_result</span><span class="o">.</span><span class="n">nfw_password</span><span class="p">,</span>
                <span class="s1">&#39;Verify NFWPwd is not returned for query w/o HHID&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="NetstartTransactionsTestFixture.test_no_response_to_untrusted_v3_query"><a class="viewcode-back" href="../../../networking.netstart.html#networking.netstart.transactions.NetstartTransactionsTestFixture.test_no_response_to_untrusted_v3_query">[docs]</a>    <span class="k">def</span> <span class="nf">test_no_response_to_untrusted_v3_query</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make sure there is no response to untrusted v3 query (builds :Prince</span>
<span class="sd">        and before) query that contains no HHID</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">zone</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_zones</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">netstart_test</span><span class="o">.</span><span class="n">sonosnet_setup</span><span class="p">(</span><span class="n">zone</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">netstart_test</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">zone</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">untrusted</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">NetstartTestTransactionError</span> <span class="k">as</span> <span class="n">xact_error</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">verifyEqualOrFailCase</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">xact_error</span><span class="o">.</span><span class="n">return_code</span><span class="p">,</span>
                    <span class="s1">&#39;Verify untrusted v3 query fails&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="NetstartTransactionsTestFixture.test_Response_to_Trusted_version_3_Query_with_NO_HHID"><a class="viewcode-back" href="../../../networking.netstart.html#networking.netstart.transactions.NetstartTransactionsTestFixture.test_Response_to_Trusted_version_3_Query_with_NO_HHID">[docs]</a>    <span class="k">def</span> <span class="nf">test_Response_to_Trusted_version_3_Query_with_NO_HHID</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Test Response_to_Trusted version 3 (builds Prince and before) query with_NO_HHID</span>
<span class="sd">           should return NFW crendentials</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">zone</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_zones</span><span class="p">:</span>
            <span class="c1"># setup a household</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">hh_created</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">netstart_test</span><span class="o">.</span><span class="n">sonosnet_setup</span><span class="p">(</span><span class="n">zone</span><span class="p">)</span>
            <span class="c1"># make sure we can connect to zone under test</span>
            <span class="n">zone</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reconnect_zone</span><span class="p">(</span><span class="n">zone</span><span class="p">)</span>
            <span class="c1"># set NFW credentials on zone</span>
            <span class="n">result_code</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">netstart_test</span><span class="o">.</span><span class="n">nfw_update</span><span class="p">(</span><span class="n">zone</span><span class="p">,</span> <span class="n">NFWSSID</span> <span class="p">,</span> <span class="n">NFWPWD</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">result_code</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s2">&quot;NFW credentials could not be set&quot;</span><span class="p">)</span>
            <span class="c1"># do a trusted version=3 query with no household ID</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">result_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">netstart_test</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">zone</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">hhid</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">untrusted</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">hhid</span><span class="p">,</span> <span class="n">nfwssid</span><span class="p">,</span> <span class="n">nfwpwd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">netstart_test</span><span class="o">.</span><span class="n">get_hhid_and_NFW_credentials</span><span class="p">(</span><span class="n">result_file</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">hhid</span> <span class="ow">and</span> <span class="n">nfwssid</span> <span class="ow">and</span> <span class="n">nfwpwd</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s2">&quot;NFW credentials should be returned&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="NetstartTransactionsTestFixture.test_Response_to_Trusted_version_4_Query_with_matching_HHID"><a class="viewcode-back" href="../../../networking.netstart.html#networking.netstart.transactions.NetstartTransactionsTestFixture.test_Response_to_Trusted_version_4_Query_with_matching_HHID">[docs]</a>    <span class="k">def</span> <span class="nf">test_Response_to_Trusted_version_4_Query_with_matching_HHID</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Test Response_to_Trusted version 4 (builds post Prince) query with HHID</span>
<span class="sd">           should return NFW crendentials</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">zone</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_zones</span><span class="p">:</span>
            <span class="c1"># setup a household</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">hh_created</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">netstart_test</span><span class="o">.</span><span class="n">sonosnet_setup</span><span class="p">(</span><span class="n">zone</span><span class="p">)</span>
            <span class="c1"># make sure we can connect to zone under test</span>
            <span class="n">zone</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reconnect_zone</span><span class="p">(</span><span class="n">zone</span><span class="p">)</span>
            <span class="c1"># set NFW credentials on zone</span>
            <span class="n">result_code</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">netstart_test</span><span class="o">.</span><span class="n">nfw_update</span><span class="p">(</span><span class="n">zone</span><span class="p">,</span> <span class="n">NFWSSID</span> <span class="p">,</span> <span class="n">NFWPWD</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">result_code</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s2">&quot;NFW credentials could not be set&quot;</span><span class="p">)</span>
            <span class="c1"># do a trusted, version=4 query with household id above</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">result_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">netstart_test</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">zone</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">hhid</span><span class="o">=</span><span class="n">hh_created</span><span class="p">,</span> <span class="n">untrusted</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">hhid</span><span class="p">,</span> <span class="n">nfwssid</span><span class="p">,</span> <span class="n">nfwpwd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">netstart_test</span><span class="o">.</span><span class="n">get_hhid_and_NFW_credentials</span><span class="p">(</span><span class="n">result_file</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">hhid</span> <span class="ow">and</span> <span class="n">nfwssid</span> <span class="ow">and</span> <span class="n">nfwpwd</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s2">&quot;NFW credentials should be returned&quot;</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_run_nfw_update_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nfw_ssid</span><span class="p">,</span> <span class="n">nfw_password</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">zone</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_zones</span><span class="p">:</span>
            <span class="n">hh_created</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">netstart_test</span><span class="o">.</span><span class="n">sonosnet_setup</span><span class="p">(</span><span class="n">zone</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">netstart_test</span><span class="o">.</span><span class="n">nfw_update</span><span class="p">(</span><span class="n">zone</span><span class="p">,</span> <span class="n">nfw_ssid</span> <span class="p">,</span> <span class="n">nfw_password</span><span class="p">)</span>
            <span class="n">query_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">netstart_test</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">zone</span><span class="p">,</span> <span class="n">hhid</span><span class="o">=</span><span class="n">hh_created</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">verifyEqualOrFailCase</span><span class="p">(</span><span class="n">nfw_ssid</span> <span class="ow">or</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">query_result</span><span class="o">.</span><span class="n">nfw_ssid</span><span class="p">,</span>
                <span class="s2">&quot;Verify NFWSSID is set&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">verifyEqualOrFailCase</span><span class="p">(</span><span class="n">nfw_password</span> <span class="ow">or</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">query_result</span><span class="o">.</span><span class="n">nfw_password</span><span class="p">,</span>
                <span class="s2">&quot;Verify NFWPwd is set&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="NetstartTransactionsTestFixture.test_set_nfw_credentials"><a class="viewcode-back" href="../../../networking.netstart.html#networking.netstart.transactions.NetstartTransactionsTestFixture.test_set_nfw_credentials">[docs]</a>    <span class="k">def</span> <span class="nf">test_set_nfw_credentials</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Test setting of NFW credentials using NFW_UPDATE transaction</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_run_nfw_update_test</span><span class="p">(</span><span class="n">NFWSSID</span><span class="p">,</span> <span class="n">NFWPWD</span><span class="p">)</span></div>

<div class="viewcode-block" id="NetstartTransactionsTestFixture.test_clear_nfw_credentials"><a class="viewcode-back" href="../../../networking.netstart.html#networking.netstart.transactions.NetstartTransactionsTestFixture.test_clear_nfw_credentials">[docs]</a>    <span class="k">def</span> <span class="nf">test_clear_nfw_credentials</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Test clearing of NFW credentials</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_set_nfw_credentials</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_run_nfw_update_test</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="NetstartTransactionsTestFixture.test_version_element_in_ALIVE_message"><a class="viewcode-back" href="../../../networking.netstart.html#networking.netstart.transactions.NetstartTransactionsTestFixture.test_version_element_in_ALIVE_message">[docs]</a>    <span class="k">def</span> <span class="nf">test_version_element_in_ALIVE_message</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Verify netstart alive messages have version information.</span>
<span class="sd">        Actual version number verification for part of this test</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Set open AP timeout to 3 seconds.</span>
        <span class="k">for</span> <span class="n">zone</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_zones</span><span class="p">:</span>
            <span class="n">zone</span><span class="o">.</span><span class="n">cli</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s2">&quot;mkdir /jffs/debug&quot;</span><span class="p">)</span>
            <span class="n">zone</span><span class="o">.</span><span class="n">cli</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s2">&quot;echo &#39;OpenAPTimeout: [2]&#39; &gt; /jffs/debug/netsettings.txt&quot;</span><span class="p">)</span>
            <span class="n">zone</span><span class="o">.</span><span class="n">cli</span><span class="o">.</span><span class="n">reboot</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">zones</span><span class="o">.</span><span class="n">wait_for_devices_to_reboot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_zones</span><span class="p">,</span> <span class="n">timeout_seconds</span><span class="o">=</span><span class="mi">120</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">zone</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_zones</span><span class="p">:</span>
            <span class="c1"># start netstart_test tool locally in verbose mode</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;./netstart_test -v &gt; testVersion.log &amp;&#39;</span><span class="p">)</span>
            <span class="c1"># do a button press on zone</span>
            <span class="n">zone</span><span class="o">.</span><span class="n">cli</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;kill -SIGUSR1 `cat /tmp/netstartd.pid`&#39;</span><span class="p">)</span>
            <span class="c1"># wait few seconds to collect netstart messages after button press.</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
            <span class="c1"># stop netstart_test tool</span>
            <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">&quot;killall netstart_test&quot;</span><span class="p">)</span>
            <span class="c1"># check the netstart_test log file, first line should have version information</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;testVersion.log&quot;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
                <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">(</span><span class="s2">&quot;Could not open netstart_test log file, cannot verify results.&quot;</span><span class="p">)</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

            <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="c1"># store information elements of netstart alive message in dictionary</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
                <span class="c1"># grab one netstart ALIVE message</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Msg ALIVE&quot;</span><span class="p">):</span>
                    <span class="c1"># drop the alive message if not from zone under test</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">zone</span><span class="o">.</span><span class="n">raw_udn</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
                        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="k">continue</span>
                    <span class="c1"># ALIVE message have 3 Information Elements (UUID, VERSION, SRC_MAC) in next 3 lines</span>
                    <span class="n">ies</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">ie</span> <span class="ow">in</span> <span class="n">ies</span><span class="p">:</span>
                        <span class="n">element</span><span class="p">,</span> <span class="n">information</span> <span class="o">=</span> <span class="n">ie</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
                        <span class="n">data</span><span class="p">[</span><span class="n">element</span><span class="p">]</span> <span class="o">=</span> <span class="n">information</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="k">break</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="c1"># check if all elements are present</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="kc">True</span> <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;UUID&quot;</span><span class="p">,</span> <span class="s2">&quot;VERSION&quot;</span><span class="p">,</span> <span class="s2">&quot;SRC_MAC&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">verifyTrueOrFailCase</span><span class="p">(</span><span class="n">zone</span><span class="o">.</span><span class="n">raw_udn</span> <span class="o">==</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;UUID&quot;</span><span class="p">],</span> <span class="s2">&quot;UUID from netstart message should be = zone.raw_udn&quot;</span><span class="p">)</span>
                <span class="n">maj_min_version</span> <span class="o">=</span> <span class="n">zone</span><span class="o">.</span><span class="n">diag</span><span class="o">.</span><span class="n">get_software_version</span><span class="p">()[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">maj_min_version</span> <span class="o">==</span> <span class="n">TOTO_VERSION</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">verifyTrueOrFailCase</span><span class="p">((</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;VERSION&quot;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">4</span><span class="p">),</span> <span class="s2">&quot;Netstart ALIVE, VERSION element should be = 4 for Toto&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">maj_min_version</span> <span class="o">==</span> <span class="n">ELIMINATOR_VERSION</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">verifyTrueOrFailCase</span><span class="p">((</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;VERSION&quot;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">5</span><span class="p">),</span> <span class="s2">&quot;Netstart ALIVE, VERSION element should be = 5 for Eliminator&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s2">&quot;ALIVE message does not contain expected number of elements&quot;</span><span class="p">)</span>

        <span class="c1"># remove debug openAP timeout.</span>
        <span class="k">for</span> <span class="n">zone</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_zones</span><span class="p">:</span>
            <span class="n">zone</span><span class="o">.</span><span class="n">cli</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s2">&quot;rm -rf /jffs/debug&quot;</span><span class="p">)</span>
            <span class="n">zone</span><span class="o">.</span><span class="n">cli</span><span class="o">.</span><span class="n">reboot</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">zones</span><span class="o">.</span><span class="n">wait_for_devices_to_reboot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_zones</span><span class="p">,</span> <span class="n">timeout_seconds</span><span class="o">=</span><span class="mi">120</span><span class="p">)</span></div></div>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">suite</span> <span class="o">=</span> <span class="n">WorkflowTestSuite</span><span class="p">(</span><span class="s1">&#39;NetstartTransactionsSuite&#39;</span><span class="p">)</span>
    <span class="n">suite</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="n">SimpleUpgradeTestFixture</span><span class="p">(),</span>
        <span class="n">NetstartQueryCertMetadataFixture</span><span class="p">()])</span>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../index.html">TestCase Documentation</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../audio.html">audio package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../cloud.html">cloud package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../common.html">common package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../data_reporting.html">data_reporting package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dataio.html">dataio package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples.html">examples package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../hdmi.html">hdmi package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ixchariot.html">ixchariot package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../networking.html">networking package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../other.html">other package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../perf.html">perf package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../pytest_automation.html">pytest_automation package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../secure_registration.html">secure_registration package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../syssw.html">syssw package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../upnp.html">upnp package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../voice.html">voice package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../webserver.html">webserver package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../webserver_v0.html">webserver_v0 package</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../index.html">Module code</a><ul>
  <li><a href="../../networking.html">networking</a><ul>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019, Author.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.8.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>