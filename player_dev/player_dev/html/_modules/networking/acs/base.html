
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>networking.acs.base &#8212; TestCase Documentation  documentation</title>
    <link rel="stylesheet" href="../../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for networking.acs.base</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">sleep</span> <span class="k">import</span> <span class="n">guaranteed_sleep</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">defaultdict</span>
<span class="kn">from</span> <span class="nn">decorators</span> <span class="k">import</span> <span class="n">retry</span>

<span class="kn">from</span> <span class="nn">custom_dicts</span> <span class="k">import</span> <span class="n">FrozenAttributeDict</span>
<span class="kn">from</span> <span class="nn">sonos.client.athconfiglib</span> <span class="k">import</span> <span class="n">Athconfig</span>
<span class="kn">from</span> <span class="nn">sonos.client.cli.mdputil</span> <span class="k">import</span> <span class="n">MdpRegion</span>
<span class="kn">from</span> <span class="nn">sonos.client.zone_player</span> <span class="k">import</span> <span class="p">(</span>
    <span class="n">INTERFACE_2GHZ</span><span class="p">,</span> <span class="n">INTERFACE_5GHZ</span><span class="p">,</span> <span class="n">AcsFlags</span><span class="p">,</span> <span class="n">FULLSTATUS_PROC</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">sonos.exception</span> <span class="k">import</span> <span class="ne">TimeoutError</span>
<span class="kn">from</span> <span class="nn">sonos.log_inspector.dmesg</span> <span class="k">import</span> <span class="n">DmesgLogInspector</span>
<span class="kn">from</span> <span class="nn">sonos.services.common</span> <span class="k">import</span> <span class="n">wait_until_true</span>
<span class="kn">from</span> <span class="nn">sonos.workflow.fixture</span> <span class="k">import</span> <span class="p">(</span>
    <span class="n">WorkflowTestFixture</span><span class="p">,</span> <span class="n">StopRunningTestException</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">networking</span> <span class="k">import</span> <span class="n">NetworkingFixtureArgParser</span><span class="p">,</span> <span class="n">ZoneSelector</span>


<span class="n">US_DATA</span> <span class="o">=</span> <span class="n">FrozenAttributeDict</span><span class="p">(</span><span class="n">region</span><span class="o">=</span><span class="n">MdpRegion</span><span class="o">.</span><span class="n">USCA</span><span class="p">,</span> <span class="n">expected_channels</span><span class="o">=</span><span class="mi">21</span><span class="p">)</span>
<span class="n">EU_DATA</span> <span class="o">=</span> <span class="n">FrozenAttributeDict</span><span class="p">(</span><span class="n">region</span><span class="o">=</span><span class="n">MdpRegion</span><span class="o">.</span><span class="n">EU</span><span class="p">,</span> <span class="n">expected_channels</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">CHINA_DATA</span> <span class="o">=</span> <span class="n">FrozenAttributeDict</span><span class="p">(</span><span class="n">region</span><span class="o">=</span><span class="n">MdpRegion</span><span class="o">.</span><span class="n">CHINA</span><span class="p">,</span> <span class="n">expected_channels</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">JAPAN_DATA</span> <span class="o">=</span> <span class="n">FrozenAttributeDict</span><span class="p">(</span><span class="n">region</span><span class="o">=</span><span class="n">MdpRegion</span><span class="o">.</span><span class="n">JAPAN</span><span class="p">,</span> <span class="n">expected_channels</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">REGION_DATA</span> <span class="o">=</span> <span class="p">(</span><span class="n">US_DATA</span><span class="p">,</span> <span class="n">EU_DATA</span><span class="p">,</span> <span class="n">CHINA_DATA</span><span class="p">,</span> <span class="n">JAPAN_DATA</span><span class="p">)</span>
<span class="n">START_IDLE_SCAN_LOG</span> <span class="o">=</span> <span class="s2">&quot;acs: defer time expired&quot;</span>
<span class="n">DURATION_CHANNEL_SCAN</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">MTK_CHANNEL_GROUP_CENTERS</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5300</span><span class="p">,</span> <span class="mi">5520</span><span class="p">,</span> <span class="mi">5680</span><span class="p">]</span>


<div class="viewcode-block" id="get_scan_duration"><a class="viewcode-back" href="../../../networking.acs.html#networking.acs.base.get_scan_duration">[docs]</a><span class="k">def</span> <span class="nf">get_scan_duration</span><span class="p">(</span><span class="n">region</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    gets the expected ACS channel scan duration for a given region</span>

<span class="sd">    :param region: the region_data</span>
<span class="sd">    :type region: :class:`~custom_dicts.FrozenAttributeDict`</span>
<span class="sd">    :return: the scan duration</span>
<span class="sd">    :rtype: :obj:`int`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">DURATION_CHANNEL_SCAN</span> <span class="o">*</span> <span class="n">region</span><span class="o">.</span><span class="n">expected_channels</span> <span class="o">+</span> <span class="mi">2</span></div>


<div class="viewcode-block" id="AcsWorkflowTestFixure"><a class="viewcode-back" href="../../../networking.acs.html#networking.acs.base.AcsWorkflowTestFixure">[docs]</a><span class="k">class</span> <span class="nc">AcsWorkflowTestFixure</span><span class="p">(</span><span class="n">WorkflowTestFixture</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Common ACS verification methods and fixture setup/teardown functionality</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">MIN_INITIAL_SCAN_INTERVAL</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="n">MIN_SCAN_INTERVAL</span> <span class="o">=</span> <span class="mi">120</span>
    <span class="n">SCAN_DELAY_POST_STOP</span> <span class="o">=</span> <span class="mi">6</span>
    <span class="n">cac_interval</span> <span class="o">=</span> <span class="mi">60</span>
    <span class="n">flee_radar_interval</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="n">TOTAL_ACS_SCAN_TIME</span> <span class="o">=</span> <span class="p">(</span><span class="n">DURATION_CHANNEL_SCAN</span> <span class="o">*</span>
                           <span class="n">US_DATA</span><span class="o">.</span><span class="n">expected_channels</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
    <span class="c1"># nol_timeout is kept above MIN_INITIAL_SCAN_INTERVAL +</span>
    <span class="c1"># SCAN_DELAY_POST_STOP + TOTAL_ACS_SCAN_TIME  to allow for a scan to fit</span>
    <span class="c1"># during its timer</span>
    <span class="n">nol_timeout</span> <span class="o">=</span> <span class="p">(</span><span class="n">MIN_INITIAL_SCAN_INTERVAL</span> <span class="o">+</span> <span class="n">TOTAL_ACS_SCAN_TIME</span><span class="p">)</span>
    <span class="n">DEFAULT_NOL_TIMEOUT</span> <span class="o">=</span> <span class="mi">3600</span>
    <span class="n">TIME_TO_START_SCAN_POST_PLAY</span> <span class="o">=</span> <span class="p">(</span><span class="n">SCAN_DELAY_POST_STOP</span> <span class="o">+</span>
                                    <span class="n">MIN_INITIAL_SCAN_INTERVAL</span><span class="p">)</span>
    <span class="n">TIME_TO_FINISH_SCAN_POST_PLAY</span> <span class="o">=</span> <span class="p">(</span><span class="n">TIME_TO_START_SCAN_POST_PLAY</span> <span class="o">+</span>
                                     <span class="n">TOTAL_ACS_SCAN_TIME</span><span class="p">)</span>
    <span class="n">TIME_TO_START_CAC_POST_PLAY</span> <span class="o">=</span> <span class="n">TIME_TO_FINISH_SCAN_POST_PLAY</span>
    <span class="n">TIME_TO_FINISH_CAC_POST_PLAY</span> <span class="o">=</span> <span class="n">TIME_TO_START_CAC_POST_PLAY</span> <span class="o">+</span> <span class="n">cac_interval</span>

<div class="viewcode-block" id="AcsWorkflowTestFixure.setUpFixture"><a class="viewcode-back" href="../../../networking.acs.html#networking.acs.base.AcsWorkflowTestFixure.setUpFixture">[docs]</a>    <span class="k">def</span> <span class="nf">setUpFixture</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ht_masters</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dmesg_inspectors</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">athconfigs</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">parser</span> <span class="o">=</span> <span class="n">NetworkingFixtureArgParser</span><span class="p">(</span><span class="n">consume_args</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">zs</span> <span class="o">=</span> <span class="n">ZoneSelector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subnet</span><span class="o">.</span><span class="n">get_environment_devices</span><span class="p">())</span>
        <span class="n">duts</span> <span class="o">=</span> <span class="n">zs</span><span class="o">.</span><span class="n">select_from_json</span><span class="p">(</span><span class="n">parser</span><span class="o">.</span><span class="n">zone_json</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sats</span> <span class="o">=</span> <span class="n">duts</span><span class="p">[</span><span class="s2">&quot;sats&quot;</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">master</span> <span class="ow">in</span> <span class="n">duts</span><span class="p">[</span><span class="s1">&#39;master&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dmesg_inspectors</span><span class="p">[</span><span class="n">master</span><span class="p">]</span> <span class="o">=</span> <span class="n">DmesgLogInspector</span><span class="p">(</span><span class="n">master</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">athconfigs</span><span class="p">[</span><span class="n">master</span><span class="p">]</span> <span class="o">=</span> <span class="n">Athconfig</span><span class="p">(</span><span class="n">master</span><span class="p">)</span>
            <span class="c1"># disable link monitoring to prevent intermittent test failures</span>
            <span class="c1"># due to blacklisting channels with high utilization</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_lm_enable</span><span class="p">(</span><span class="n">master</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ht_masters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">master</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">verifyTrueOrStop</span><span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ht_masters</span><span class="p">),</span> <span class="s1">&#39;at least one ht master device is required&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="AcsWorkflowTestFixure.tearDownFixture"><a class="viewcode-back" href="../../../networking.acs.html#networking.acs.base.AcsWorkflowTestFixure.tearDownFixture">[docs]</a>    <span class="k">def</span> <span class="nf">tearDownFixture</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">zone</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">subnet</span><span class="o">.</span><span class="n">get_playback_devices</span><span class="p">():</span>
            <span class="n">zone</span><span class="o">.</span><span class="n">DeviceProperties</span><span class="o">.</span><span class="n">cleanup_bonded_configuration</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">master</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ht_masters</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_lm_enable</span><span class="p">(</span><span class="n">master</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_cac_enable</span><span class="p">(</span><span class="n">master</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_ps_enable</span><span class="p">(</span><span class="n">master</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span></div>

<div class="viewcode-block" id="AcsWorkflowTestFixure.set_initial_scan_interval"><a class="viewcode-back" href="../../../networking.acs.html#networking.acs.base.AcsWorkflowTestFixure.set_initial_scan_interval">[docs]</a>    <span class="k">def</span> <span class="nf">set_initial_scan_interval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zone</span><span class="p">,</span> <span class="n">interval_time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">wait_for_scan</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Uses athconfig tool to change the default initial ACS scan interval</span>
<span class="sd">        to be a given interval_time (if non-None or non-zero) otherwise it is</span>
<span class="sd">        set to :attr:`MIN_INITIAL_SCAN_INTERVAL`</span>

<span class="sd">        :param zone: the zone to use</span>
<span class="sd">        :type zone: :class:`~sonos.client.internal.SonosZoneComponent`</span>
<span class="sd">        :param interval_time: the number of seconds to set for the scan</span>
<span class="sd">            interval.</span>
<span class="sd">        :type interval_time: :obj:`int`</span>
<span class="sd">        :param wait_for_scan: wait for the next scan after setting the new</span>
<span class="sd">            interval</span>
<span class="sd">        :type wait_for_scan: :obj:`bool`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">athconfigs</span><span class="p">[</span><span class="n">zone</span><span class="p">]</span><span class="o">.</span><span class="n">scaninterval</span><span class="p">(</span><span class="n">INTERFACE_5GHZ</span><span class="p">,</span>
            <span class="n">interval_time</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">MIN_INITIAL_SCAN_INTERVAL</span><span class="p">,</span>
            <span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">wait_for_scan</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wait_for_next_idle_scan_to_start</span><span class="p">(</span><span class="n">zone</span><span class="p">)</span></div>

<div class="viewcode-block" id="AcsWorkflowTestFixure.enable_scan"><a class="viewcode-back" href="../../../networking.acs.html#networking.acs.base.AcsWorkflowTestFixure.enable_scan">[docs]</a>    <span class="k">def</span> <span class="nf">enable_scan</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zone</span><span class="p">,</span> <span class="n">wait_for_scan</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Uses athconfig tool to enable ACS scanning for a particular zone</span>

<span class="sd">        .. note::</span>

<span class="sd">            every time this is called it will kick off a counter to perform</span>
<span class="sd">            an initial scan</span>

<span class="sd">        :param zone: the zone to use</span>
<span class="sd">        :type zone: :class:`~sonos.client.internal.SonosZoneComponent`</span>
<span class="sd">        :param wait_for_scan: wait for the next scan after setting the new</span>
<span class="sd">            interval</span>
<span class="sd">        :type wait_for_scan: :obj:`bool`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">athconfigs</span><span class="p">[</span><span class="n">zone</span><span class="p">]</span><span class="o">.</span><span class="n">scanenable</span><span class="p">(</span><span class="n">INTERFACE_5GHZ</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">wait_for_scan</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_zone_scanning</span><span class="p">(</span><span class="n">zone</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">wait_for_next_idle_scan_to_start</span><span class="p">(</span><span class="n">zone</span><span class="p">)</span></div>

<div class="viewcode-block" id="AcsWorkflowTestFixure.disable_scan"><a class="viewcode-back" href="../../../networking.acs.html#networking.acs.base.AcsWorkflowTestFixure.disable_scan">[docs]</a>    <span class="k">def</span> <span class="nf">disable_scan</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zone</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Uses athconfig tool to disable ACS scanning for a particular zone</span>

<span class="sd">        .. note::</span>

<span class="sd">            every time this is called it will kick off a counter to perform</span>
<span class="sd">            an initial scan</span>

<span class="sd">        :param zone: the zone to use</span>
<span class="sd">        :type zone: :class:`~sonos.client.internal.SonosZoneComponent`</span>
<span class="sd">        :param wait_for_scan: wait for the next scan after setting the new</span>
<span class="sd">            interval</span>
<span class="sd">        :type wait_for_scan: :obj:`bool`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">athconfigs</span><span class="p">[</span><span class="n">zone</span><span class="p">]</span><span class="o">.</span><span class="n">scanenable</span><span class="p">(</span><span class="n">INTERFACE_5GHZ</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span></div>

<div class="viewcode-block" id="AcsWorkflowTestFixure.scan_if_not_scanning"><a class="viewcode-back" href="../../../networking.acs.html#networking.acs.base.AcsWorkflowTestFixure.scan_if_not_scanning">[docs]</a>    <span class="k">def</span> <span class="nf">scan_if_not_scanning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zone</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        If zone isn&#39;t scanning checks when the next scan will be and if the</span>
<span class="sd">        method can cause a scan to happen sooner than the next expected scan</span>

<span class="sd">        :param zone: the zone to use</span>
<span class="sd">        :type zone: :class:`~sonos.client.internal.SonosZoneComponent`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">time_to_next_scan</span> <span class="o">=</span> <span class="n">zone</span><span class="o">.</span><span class="n">diag</span><span class="o">.</span><span class="n">get_primary</span><span class="p">()</span><span class="o">.</span><span class="n">acs</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">time_to_next_scan</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_zone_scanning</span><span class="p">(</span><span class="n">zone</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">time_to_next_scan</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">MIN_INITIAL_SCAN_INTERVAL</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;not scanning and next scan in </span><span class="si">{}</span><span class="s1">, forcing &#39;</span>
                    <span class="s1">&#39;scan in </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">time_to_next_scan</span><span class="p">,</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">MIN_INITIAL_SCAN_INTERVAL</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">enable_scan</span><span class="p">(</span><span class="n">zone</span><span class="p">,</span> <span class="n">wait_for_scan</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="AcsWorkflowTestFixure.set_scan_interval"><a class="viewcode-back" href="../../../networking.acs.html#networking.acs.base.AcsWorkflowTestFixure.set_scan_interval">[docs]</a>    <span class="k">def</span> <span class="nf">set_scan_interval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zone</span><span class="p">,</span> <span class="n">interval_time</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Uses athconfig tool to change the default ACS scan interval to be</span>
<span class="sd">        a given interval_time (if non-None or non-zero) otherwise it is set</span>
<span class="sd">        to :attr:`MIN_SCAN_INTERVAL`</span>

<span class="sd">        :param zone: the zone to use</span>
<span class="sd">        :type zone: :class:`~sonos.client.internal.SonosZoneComponent`</span>
<span class="sd">        :param interval_time: the number of seconds to set for the scan</span>
<span class="sd">            interval.</span>
<span class="sd">        :type interval_time: :obj:`int`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">athconfigs</span><span class="p">[</span><span class="n">zone</span><span class="p">]</span><span class="o">.</span><span class="n">scaninterval</span><span class="p">(</span><span class="n">INTERFACE_5GHZ</span><span class="p">,</span>
            <span class="n">interval_time</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">MIN_SCAN_INTERVAL</span><span class="p">,</span>
            <span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="AcsWorkflowTestFixure.set_lm_enable"><a class="viewcode-back" href="../../../networking.acs.html#networking.acs.base.AcsWorkflowTestFixure.set_lm_enable">[docs]</a>    <span class="k">def</span> <span class="nf">set_lm_enable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zone</span><span class="p">,</span> <span class="n">lm_state</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Enables or disables the lm (link monitoring) feature of ACS on zone</span>

<span class="sd">        :param zone: the zone to set set the cac state</span>
<span class="sd">        :type zone: :class:`~sonos.client.internal.SonosZoneComponent`</span>
<span class="sd">        :param lm_state: state to set zone&#39;s lm feature to</span>
<span class="sd">        :type lm_state: :obj:`int`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">athconfigs</span><span class="p">[</span><span class="n">zone</span><span class="p">]</span><span class="o">.</span><span class="n">acslmenable</span><span class="p">(</span><span class="n">INTERFACE_5GHZ</span><span class="p">,</span> <span class="n">lm_state</span><span class="p">)</span></div>

<div class="viewcode-block" id="AcsWorkflowTestFixure.set_cac_enable"><a class="viewcode-back" href="../../../networking.acs.html#networking.acs.base.AcsWorkflowTestFixure.set_cac_enable">[docs]</a>    <span class="k">def</span> <span class="nf">set_cac_enable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zone</span><span class="p">,</span> <span class="n">cac_state</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Enables or disables the cac feature of ACS on zone</span>

<span class="sd">        :param zone: the zone to set set the cac state</span>
<span class="sd">        :type zone: :class:`~sonos.client.internal.SonosZoneComponent`</span>
<span class="sd">        :param cac_state: state to set zone&#39;s nol feature to</span>
<span class="sd">        :type cac_state: :obj:`int`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">athconfigs</span><span class="p">[</span><span class="n">zone</span><span class="p">]</span><span class="o">.</span><span class="n">cacenable</span><span class="p">(</span><span class="n">INTERFACE_5GHZ</span><span class="p">,</span> <span class="n">cac_state</span><span class="p">)</span></div>

<div class="viewcode-block" id="AcsWorkflowTestFixure.set_cac_timeout"><a class="viewcode-back" href="../../../networking.acs.html#networking.acs.base.AcsWorkflowTestFixure.set_cac_timeout">[docs]</a>    <span class="k">def</span> <span class="nf">set_cac_timeout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zone</span><span class="p">,</span> <span class="n">interval_time</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Uses athconfig tool on zone to change the default ACS CAC timeout to be</span>
<span class="sd">        a given interval_time (if non-None or non-zero) otherwise it is set</span>
<span class="sd">        to :attr:`CAC_INTERVAL`</span>

<span class="sd">        :param zone: the zone to use</span>
<span class="sd">        :type zone: :class:`~sonos.client.internal.SonosZoneComponent`</span>
<span class="sd">        :param interval_time: the number of seconds to set for the scan</span>
<span class="sd">            interval.</span>
<span class="sd">        :type interval_time: :obj:`int`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">athconfigs</span><span class="p">[</span><span class="n">zone</span><span class="p">]</span><span class="o">.</span><span class="n">cactimeout</span><span class="p">(</span><span class="n">INTERFACE_5GHZ</span><span class="p">,</span>
                                         <span class="n">interval_time</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">cac_interval</span><span class="p">)</span></div>

<div class="viewcode-block" id="AcsWorkflowTestFixure.reset_cac"><a class="viewcode-back" href="../../../networking.acs.html#networking.acs.base.AcsWorkflowTestFixure.reset_cac">[docs]</a>    <span class="k">def</span> <span class="nf">reset_cac</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zone</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">       Uses athconfig tool on zone to reset the current CAC state</span>

<span class="sd">       :param zone: the zone to use</span>
<span class="sd">       :type zone: :class:`~sonos.client.internal.SonosZoneComponent`</span>
<span class="sd">       &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">athconfigs</span><span class="p">[</span><span class="n">zone</span><span class="p">]</span><span class="o">.</span><span class="n">cacreset</span><span class="p">(</span><span class="n">INTERFACE_5GHZ</span><span class="p">)</span></div>

<div class="viewcode-block" id="AcsWorkflowTestFixure.wait_for_next_idle_scan_to_start"><a class="viewcode-back" href="../../../networking.acs.html#networking.acs.base.AcsWorkflowTestFixure.wait_for_next_idle_scan_to_start">[docs]</a>    <span class="k">def</span> <span class="nf">wait_for_next_idle_scan_to_start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zone</span><span class="p">,</span> <span class="n">verify_is_scanning</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Poll the ACS fullstatus page and dmesg logs to determine when the</span>
<span class="sd">        next idle scan is and when it has started respectively.</span>

<span class="sd">        :param zone: the zone to check</span>
<span class="sd">        :type zone: :class:`~sonos.client.internal.SonosZoneComponent`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">next_scan</span> <span class="o">=</span> <span class="n">zone</span><span class="o">.</span><span class="n">cli</span><span class="o">.</span><span class="n">get_primary</span><span class="p">()</span><span class="o">.</span><span class="n">acs</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">time_to_next_scan</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Sleeping for </span><span class="si">{}</span><span class="s2"> seconds&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">next_scan</span><span class="p">))</span>
        <span class="c1"># wait just over 1 second for the delay in the diag call and the switch</span>
        <span class="c1"># from scan timer reaching 0 and the scan actually starting</span>
        <span class="k">if</span> <span class="n">verify_is_scanning</span><span class="p">:</span>
            <span class="n">sleep_time</span> <span class="o">=</span> <span class="n">next_scan</span> <span class="o">+</span> <span class="mf">1.5</span>
            <span class="n">guaranteed_sleep</span><span class="p">(</span><span class="n">sleep_time</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">verifyTrueOrStop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">is_zone_scanning</span><span class="p">(</span><span class="n">zone</span><span class="p">),</span>
                              <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> should be scanning after </span><span class="si">{}</span><span class="s1"> sleep for </span><span class="si">{}</span><span class="s1"> &#39;</span>
                              <span class="s1">&#39;scan timer&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">zone</span><span class="p">,</span> <span class="n">sleep_time</span><span class="p">,</span> <span class="n">next_scan</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sleep_time</span> <span class="o">=</span> <span class="n">next_scan</span>
            <span class="n">guaranteed_sleep</span><span class="p">(</span><span class="n">sleep_time</span><span class="p">)</span></div>

<div class="viewcode-block" id="AcsWorkflowTestFixure.wait_for_scan_complete"><a class="viewcode-back" href="../../../networking.acs.html#networking.acs.base.AcsWorkflowTestFixure.wait_for_scan_complete">[docs]</a>    <span class="k">def</span> <span class="nf">wait_for_scan_complete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zone</span><span class="p">,</span> <span class="n">region</span><span class="o">=</span><span class="n">US_DATA</span><span class="p">,</span> <span class="n">interval_delay</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
            <span class="n">timeout_seconds</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Waits until the zone is no longer reporting scan is active</span>

<span class="sd">        :param zone: the zone to check</span>
<span class="sd">        :type zone: :class:`~sonos.client.internal.SonosZoneComponent`</span>
<span class="sd">        :param region: the region data</span>
<span class="sd">        :type region: :class:`~custom_dicts.FrozenAttributeDict`</span>
<span class="sd">        :param interval_delay: the number of seconds to wait between checks</span>
<span class="sd">        :type interval_delay: :obj:`int`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">wait_until_true</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_zone_scanning</span><span class="p">(</span><span class="n">zone</span><span class="p">),</span>
            <span class="n">reason</span><span class="o">=</span><span class="s2">&quot;Timeout waiting for idle scan to stop&quot;</span><span class="p">,</span>
            <span class="n">timeout_seconds</span><span class="o">=</span><span class="p">(</span><span class="n">timeout_seconds</span> <span class="k">if</span> <span class="n">timeout_seconds</span> <span class="k">else</span>
                <span class="n">get_scan_duration</span><span class="p">(</span><span class="n">region</span><span class="p">)),</span>
            <span class="n">iteration_delay</span><span class="o">=</span><span class="n">interval_delay</span><span class="p">)</span></div>

<div class="viewcode-block" id="AcsWorkflowTestFixure.get_operating_channels"><a class="viewcode-back" href="../../../networking.acs.html#networking.acs.base.AcsWorkflowTestFixure.get_operating_channels">[docs]</a>    <span class="k">def</span> <span class="nf">get_operating_channels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zone</span><span class="p">,</span> <span class="n">interface</span><span class="o">=</span><span class="n">INTERFACE_5GHZ</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Monitor fullstatus for duration_sec seconds and collect all operating</span>
<span class="sd">        channels observed during this time. Polling get_operating_channel</span>
<span class="sd">        can not read fullstatus fast enough to get reliable results.</span>
<span class="sd">        :param interface: the wifi interface to get operating channel for</span>
<span class="sd">        :type interface: :obj:`str`</span>
<span class="sd">        :param duration_sec: Amount of time in seconds to monitor fullstatus</span>
<span class="sd">        :type interface: :obj:`int`</span>
<span class="sd">        :return: the operating channel for the wifi interface</span>
<span class="sd">        :rtype: :obj:`list` of `int` or :class:`None &lt;types.NoneType&gt;`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">get_channel_shell_script</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;while grep -q &#39;:1) timer&#39; /proc/ath_rincon_ath1/primary; do &quot;</span> <span class="o">+</span>
            <span class="s2">&quot;  grep Operating </span><span class="si">{}</span><span class="s2">; usleep 500000;&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;done&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">FULLSTATUS_PROC</span><span class="p">[</span><span class="n">interface</span><span class="p">])</span>

        <span class="n">cmd_out</span> <span class="o">=</span> <span class="n">zone</span><span class="o">.</span><span class="n">cli</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="n">get_channel_shell_script</span><span class="p">)</span>

        <span class="n">chans</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Operating on channel (\d+)&#39;</span><span class="p">,</span>
                           <span class="n">cmd_out</span><span class="p">,</span>
                           <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">MULTILINE</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">remove_adjacent_chans</span><span class="p">(</span><span class="n">chans</span><span class="p">):</span>
            <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">chans</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">chans</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">chans</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="n">chans</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">return</span> <span class="n">chans</span>

        <span class="n">chans</span> <span class="o">=</span> <span class="n">remove_adjacent_chans</span><span class="p">(</span><span class="n">chans</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">chans</span><span class="p">)</span></div>

<div class="viewcode-block" id="AcsWorkflowTestFixure.is_zone_clearing_cac"><a class="viewcode-back" href="../../../networking.acs.html#networking.acs.base.AcsWorkflowTestFixure.is_zone_clearing_cac">[docs]</a>    <span class="k">def</span> <span class="nf">is_zone_clearing_cac</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zone</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check to see if the zone is curently clearing CAC</span>

<span class="sd">        :param zone: the zone to check</span>
<span class="sd">        :type zone: :class:`~sonos.client.internal.SonosZoneComponent`</span>
<span class="sd">        :return: whether or not the zone is currently clearing CAC</span>
<span class="sd">        :rtype: :obj:`bool`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fullstatus</span> <span class="o">=</span> <span class="n">zone</span><span class="o">.</span><span class="n">cli</span><span class="o">.</span><span class="n">get_primary</span><span class="p">()</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">fullstatus</span><span class="o">.</span><span class="n">acs</span><span class="o">.</span><span class="n">cac</span><span class="o">.</span><span class="n">frequency</span><span class="p">)</span></div>

<div class="viewcode-block" id="AcsWorkflowTestFixure.wait_for_cac_begin"><a class="viewcode-back" href="../../../networking.acs.html#networking.acs.base.AcsWorkflowTestFixure.wait_for_cac_begin">[docs]</a>    <span class="k">def</span> <span class="nf">wait_for_cac_begin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zone</span><span class="p">,</span> <span class="n">timeout_seconds</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                           <span class="n">interval_delay</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Waits until the zone is reporting CAC is active</span>

<span class="sd">        :param zone: the zone to check</span>
<span class="sd">        :type zone: :class:`~sonos.client.internal.SonosZoneComponent`</span>
<span class="sd">        :param timeout_seconds: the number of seconds to wait before timeout</span>
<span class="sd">        :type timeout_seconds: :obj:`int`</span>
<span class="sd">        :param interval_delay: the number of seconds to wait between checks</span>
<span class="sd">        :type interval_delay: :obj:`int`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">timeout_seconds</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">timeout_seconds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">TIME_TO_START_CAC_POST_PLAY</span>
        <span class="k">if</span> <span class="n">interval_delay</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">interval_delay</span> <span class="o">=</span> <span class="n">timeout_seconds</span> <span class="o">*</span> <span class="mf">0.2</span>
        <span class="n">wait_until_true</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_zone_clearing_cac</span><span class="p">(</span><span class="n">zone</span><span class="p">),</span>
            <span class="n">reason</span><span class="o">=</span><span class="s2">&quot;Timeout waiting for idle CAC to start&quot;</span><span class="p">,</span>
            <span class="n">timeout_seconds</span><span class="o">=</span><span class="n">timeout_seconds</span><span class="p">,</span> <span class="n">iteration_delay</span><span class="o">=</span><span class="n">interval_delay</span><span class="p">)</span></div>

<div class="viewcode-block" id="AcsWorkflowTestFixure.wait_for_cac_complete"><a class="viewcode-back" href="../../../networking.acs.html#networking.acs.base.AcsWorkflowTestFixure.wait_for_cac_complete">[docs]</a>    <span class="k">def</span> <span class="nf">wait_for_cac_complete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zone</span><span class="p">,</span> <span class="n">interval_delay</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Waits until the zone is no longer reporting CAC is active</span>

<span class="sd">        :param zone: the zone to check</span>
<span class="sd">        :type zone: :class:`~sonos.client.internal.SonosZoneComponent`</span>
<span class="sd">        :param interval_delay: the number of seconds to wait between checks</span>
<span class="sd">        :type interval_delay: :obj:`int`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">wait_until_true</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_zone_clearing_cac</span><span class="p">(</span><span class="n">zone</span><span class="p">),</span>
            <span class="n">reason</span><span class="o">=</span><span class="s2">&quot;Timeout waiting for idle CAC to stop&quot;</span><span class="p">,</span>
            <span class="n">timeout_seconds</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cac_interval</span> <span class="o">+</span> <span class="n">interval_delay</span><span class="p">,</span>
            <span class="n">iteration_delay</span><span class="o">=</span><span class="n">interval_delay</span><span class="p">)</span></div>

<div class="viewcode-block" id="AcsWorkflowTestFixure.update_idlemgr_client"><a class="viewcode-back" href="../../../networking.acs.html#networking.acs.base.AcsWorkflowTestFixure.update_idlemgr_client">[docs]</a>    <span class="k">def</span> <span class="nf">update_idlemgr_client</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zone</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update idle manager state for client 0 and 6</span>

<span class="sd">        :param zone: the zone to play the alarm on</span>
<span class="sd">        :type zone: :class:`~sonos.client.internal.SonosZoneComponent`</span>
<span class="sd">        :param msg: the message which triggered the update logic containing the</span>
<span class="sd">            update state</span>
<span class="sd">        :type msg: :obj:`str`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> updated idlemgr: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">zone</span><span class="p">,</span> <span class="n">msg</span><span class="p">))</span>
        <span class="n">client_state</span> <span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="s1">&#39;active&#39;</span> <span class="ow">in</span> <span class="n">msg</span> <span class="k">else</span> <span class="kc">False</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">ur</span><span class="s1">&#39;client (\d+)&#39;</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
            <span class="n">num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
            <span class="n">zone</span><span class="o">.</span><span class="n">idlemgr_client</span><span class="p">[</span><span class="n">num</span><span class="p">]</span> <span class="o">=</span> <span class="n">client_state</span></div>

<div class="viewcode-block" id="AcsWorkflowTestFixure.begin_watching_for_client_change"><a class="viewcode-back" href="../../../networking.acs.html#networking.acs.base.AcsWorkflowTestFixure.begin_watching_for_client_change">[docs]</a>    <span class="k">def</span> <span class="nf">begin_watching_for_client_change</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zone</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Start watching the zone&#39;s udp log for client changes</span>

<span class="sd">        :param zone: the zone to watch for the idlemgr client changes</span>
<span class="sd">        :type zone: :class:`~sonos.client.internal.SonosZoneComponent`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">client_msg</span> <span class="o">=</span> <span class="s1">&#39;idlemgr,3&gt; client \d is \w+ with primary chan \d&#39;</span>
        <span class="n">zone</span><span class="o">.</span><span class="n">idlemgr_client</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">zone</span><span class="o">.</span><span class="n">diag</span><span class="o">.</span><span class="n">start_udp_log</span><span class="p">()</span>
        <span class="n">zone</span><span class="o">.</span><span class="n">diag</span><span class="o">.</span><span class="n">watch_udp_log_for_string</span><span class="p">(</span><span class="n">client_msg</span><span class="p">,</span>
            <span class="k">lambda</span> <span class="n">msg</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_idlemgr_client</span><span class="p">(</span><span class="n">zone</span><span class="p">,</span> <span class="n">msg</span><span class="p">))</span></div>

<div class="viewcode-block" id="AcsWorkflowTestFixure.stop_watching_for_client_change"><a class="viewcode-back" href="../../../networking.acs.html#networking.acs.base.AcsWorkflowTestFixure.stop_watching_for_client_change">[docs]</a>    <span class="k">def</span> <span class="nf">stop_watching_for_client_change</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zone</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Stop watching for idlemgr client changes on the zone</span>

<span class="sd">        :param zone: the zone&#39;s upd log for idlemgr client changes</span>
<span class="sd">        :type zone: :class:`~sonos.client.internal.SonosZoneComponent`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">zone</span><span class="o">.</span><span class="n">diag</span><span class="o">.</span><span class="n">stop_udp_log</span><span class="p">()</span></div>

<div class="viewcode-block" id="AcsWorkflowTestFixure.get_zone_region_data"><a class="viewcode-back" href="../../../networking.acs.html#networking.acs.base.AcsWorkflowTestFixure.get_zone_region_data">[docs]</a>    <span class="k">def</span> <span class="nf">get_zone_region_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zone</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a frozen attribute dict representing the expected values for</span>
<span class="sd">        its region</span>

<span class="sd">        :param zone: the zone from which to get the corresponding</span>
<span class="sd">            FrozenAttributeDict of its region parameters</span>
<span class="sd">        :type zone: :class:`~sonos.client.internal.SonosZoneComponent`</span>
<span class="sd">        :return: FrozenAttributeDict of zone&#39;s region attributes</span>
<span class="sd">        :rtype: :class:`~custom_dicts.FrozenAttributeDict`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">region_data</span> <span class="ow">in</span> <span class="n">REGION_DATA</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">region_data</span><span class="o">.</span><span class="n">region</span> <span class="o">==</span> <span class="n">zone</span><span class="o">.</span><span class="n">cli</span><span class="o">.</span><span class="n">mdp</span><span class="o">.</span><span class="n">region</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">region_data</span></div>

<div class="viewcode-block" id="AcsWorkflowTestFixure.get_acs"><a class="viewcode-back" href="../../../networking.acs.html#networking.acs.base.AcsWorkflowTestFixure.get_acs">[docs]</a>    <span class="k">def</span> <span class="nf">get_acs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zone</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a frozen attribute dict of the zone&#39;s ath1 fullstatus acs</span>

<span class="sd">        :param zone: the zone from which to get the acs table from fullstatus</span>
<span class="sd">        :type zone: :class:`~sonos.client.internal.SonosZoneComponent`</span>
<span class="sd">        :return: fullstatus acs FrozenAttributeDict of zone</span>
<span class="sd">        :rtype: :class:`~custom_dicts.FrozenAttributeDict`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">zone</span><span class="o">.</span><span class="n">cli</span><span class="o">.</span><span class="n">get_primary</span><span class="p">()</span><span class="o">.</span><span class="n">acs</span></div>

<div class="viewcode-block" id="AcsWorkflowTestFixure.get_acs_states"><a class="viewcode-back" href="../../../networking.acs.html#networking.acs.base.AcsWorkflowTestFixure.get_acs_states">[docs]</a>    <span class="k">def</span> <span class="nf">get_acs_states</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zone</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a frozen attribute dict of the zone&#39;s ath1 fullstatus acs</span>
<span class="sd">        states</span>

<span class="sd">        :param zone: the zone from which to get the acs states from acs table</span>
<span class="sd">            in fullstatus</span>
<span class="sd">        :type zone: :class:`~sonos.client.internal.SonosZoneComponent`</span>
<span class="sd">        :return: fullstatus acs scan FrozenAttributeDict of zone</span>
<span class="sd">        :rtype: :class:`~custom_dicts.FrozenAttributeDict`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_acs</span><span class="p">(</span><span class="n">zone</span><span class="p">)</span><span class="o">.</span><span class="n">scan</span></div>

<div class="viewcode-block" id="AcsWorkflowTestFixure.get_scan_active_state"><a class="viewcode-back" href="../../../networking.acs.html#networking.acs.base.AcsWorkflowTestFixure.get_scan_active_state">[docs]</a>    <span class="k">def</span> <span class="nf">get_scan_active_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zone</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks if the zone&#39;s idle state, as seen by ACS, is idle thus enabling</span>
<span class="sd">        the ACS scan logic</span>

<span class="sd">        Note this should be opposite of idlemgr client 6 as when client 6 is</span>
<span class="sd">        active idle scanning is not and vice versa</span>

<span class="sd">        :param zone: the zone from which to get the acs idle active state</span>
<span class="sd">        :type zone: :class:`~sonos.client.internal.SonosZoneComponent`</span>
<span class="sd">        :return: zone&#39;s acs idle active state</span>
<span class="sd">        :rtype: :int:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_acs_states</span><span class="p">(</span><span class="n">zone</span><span class="p">)</span><span class="o">.</span><span class="n">active</span></div>

<div class="viewcode-block" id="AcsWorkflowTestFixure.is_zone_scanning"><a class="viewcode-back" href="../../../networking.acs.html#networking.acs.base.AcsWorkflowTestFixure.is_zone_scanning">[docs]</a>    <span class="k">def</span> <span class="nf">is_zone_scanning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zone</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks if the zone is currently scanning</span>

<span class="sd">        :param zone: the zone from which to get state of the acs scan</span>
<span class="sd">        :type zone: :class:`~sonos.client.internal.SonosZoneComponent`</span>
<span class="sd">        :return: is zone scanning</span>
<span class="sd">        :rtype: :bool:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_scan_active_state</span><span class="p">(</span><span class="n">zone</span><span class="p">))</span></div>

<div class="viewcode-block" id="AcsWorkflowTestFixure.is_scan_enabled"><a class="viewcode-back" href="../../../networking.acs.html#networking.acs.base.AcsWorkflowTestFixure.is_scan_enabled">[docs]</a>    <span class="k">def</span> <span class="nf">is_scan_enabled</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zone</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks if the zone has scanning disabled</span>

<span class="sd">        :param zone: the zone from which to get state of the acs scan enable</span>
<span class="sd">        :type zone: :class:`~sonos.client.internal.SonosZoneComponent`</span>
<span class="sd">        :return: is zone&#39;s scan enabled</span>
<span class="sd">        :rtype: :bool:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_acs_states</span><span class="p">(</span><span class="n">zone</span><span class="p">)</span><span class="o">.</span><span class="n">scan_enabled</span><span class="p">)</span></div>

<div class="viewcode-block" id="AcsWorkflowTestFixure.is_scan_idle_state"><a class="viewcode-back" href="../../../networking.acs.html#networking.acs.base.AcsWorkflowTestFixure.is_scan_idle_state">[docs]</a>    <span class="k">def</span> <span class="nf">is_scan_idle_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zone</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks if the zone has its ACS scan idle bit set</span>

<span class="sd">        :param zone: the zone from which to get state of the acs scan idle bit</span>
<span class="sd">            is set</span>
<span class="sd">        :type zone: :class:`~sonos.client.internal.SonosZoneComponent`</span>
<span class="sd">        :return: is zone&#39;s scan idle bit set</span>
<span class="sd">        :rtype: :bool:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_acs_states</span><span class="p">(</span><span class="n">zone</span><span class="p">)</span><span class="o">.</span><span class="n">idle_scan</span><span class="p">)</span></div>

<div class="viewcode-block" id="AcsWorkflowTestFixure.is_channel_in_acs_table"><a class="viewcode-back" href="../../../networking.acs.html#networking.acs.base.AcsWorkflowTestFixure.is_channel_in_acs_table">[docs]</a>    <span class="k">def</span> <span class="nf">is_channel_in_acs_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel</span><span class="p">,</span> <span class="n">zone</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks if the zone has channel in its operating 5GHz dfs channel list,</span>
<span class="sd">        if it isn&#39;t either it is not a valid 5GHz channel or it is a DFS</span>
<span class="sd">        channel and it was removed from the list by radar even</span>

<span class="sd">        :param channel: wireless channel to check if in list of DFS channels on</span>
<span class="sd">            zone</span>
<span class="sd">        :type channel: :obj:`int`</span>
<span class="sd">        :param zone: the zone from which to get state of the acs scan enable</span>
<span class="sd">        :type zone: :class:`~sonos.client.internal.SonosZoneComponent`</span>
<span class="sd">        :return: is channel in zone&#39;s acs table</span>
<span class="sd">        :rtype: :bool:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">channel</span> <span class="ow">in</span> <span class="p">[</span><span class="n">chan</span><span class="o">.</span><span class="n">frequency</span> <span class="k">for</span> <span class="n">chan</span> <span class="ow">in</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">get_acs_channel_table</span><span class="p">(</span><span class="n">zone</span><span class="p">)]</span></div>

<div class="viewcode-block" id="AcsWorkflowTestFixure.is_dfs_channel"><a class="viewcode-back" href="../../../networking.acs.html#networking.acs.base.AcsWorkflowTestFixure.is_dfs_channel">[docs]</a>    <span class="k">def</span> <span class="nf">is_dfs_channel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zone</span><span class="p">,</span> <span class="n">channel</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks if channel has the DFS flag set on zone</span>

<span class="sd">        :param zone: the zone from which check the DFS channels list against</span>
<span class="sd">            channel</span>
<span class="sd">        :type zone: :class:`~sonos.client.internal.SonosZoneComponent`</span>
<span class="sd">        :param channel: wireless channel to check if in list of DFS channels on</span>
<span class="sd">            zone</span>
<span class="sd">        :type channel: :obj:`int` or :obj:`str`</span>
<span class="sd">        :return: is channel in zone&#39;s acs table</span>
<span class="sd">        :rtype: :bool:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">check_chan</span> <span class="o">=</span> <span class="n">channel</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">athconfigs</span><span class="p">[</span><span class="n">zone</span><span class="p">]</span><span class="o">.</span><span class="n">getchannel</span><span class="p">(</span>
            <span class="n">INTERFACE_5GHZ</span><span class="p">)</span>
        <span class="n">acs_channels_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_acs_channel_table</span><span class="p">(</span><span class="n">zone</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">check_chan</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="n">chan</span><span class="o">.</span><span class="n">frequency</span> <span class="k">for</span> <span class="n">chan</span> <span class="ow">in</span>
                                   <span class="n">acs_channels_table</span> <span class="k">if</span> <span class="p">(</span><span class="n">chan</span><span class="o">.</span><span class="n">flags</span> <span class="o">&amp;</span>
                                                          <span class="n">AcsFlags</span><span class="o">.</span><span class="n">DFS</span><span class="p">)]</span></div>

<div class="viewcode-block" id="AcsWorkflowTestFixure.is_post_nol_channel"><a class="viewcode-back" href="../../../networking.acs.html#networking.acs.base.AcsWorkflowTestFixure.is_post_nol_channel">[docs]</a>    <span class="k">def</span> <span class="nf">is_post_nol_channel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zone</span><span class="p">,</span> <span class="n">channel</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks if channel has flags set indicative of having been on the nol,</span>
<span class="sd">        when a channel is actually flagged as nol it will not show up in the</span>
<span class="sd">        acs table of zone</span>

<span class="sd">        :param zone: the zone from which check channel for formerly nol</span>
<span class="sd">        :type zone: :class:`~sonos.client.internal.SonosZoneComponent`</span>
<span class="sd">        :param channel: wireless channel to check if was on nol</span>
<span class="sd">        :type channel: :obj:`int` or :obj:`str`</span>
<span class="sd">        :return: is channel in zone&#39;s acs table</span>
<span class="sd">        :rtype: :bool:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">check_chan</span> <span class="o">=</span> <span class="n">channel</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">athconfigs</span><span class="p">[</span><span class="n">zone</span><span class="p">]</span><span class="o">.</span><span class="n">getchannel</span><span class="p">(</span>
            <span class="n">INTERFACE_5GHZ</span><span class="p">)</span>
        <span class="n">acs_channels_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_acs_channel_table</span><span class="p">(</span><span class="n">zone</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">check_chan</span> <span class="ow">in</span> <span class="p">[</span><span class="n">chan</span><span class="o">.</span><span class="n">frequency</span> <span class="k">for</span> <span class="n">chan</span> <span class="ow">in</span> <span class="n">acs_channels_table</span> <span class="k">if</span>
                              <span class="n">chan</span><span class="o">.</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">AcsFlags</span><span class="o">.</span><span class="n">DFS</span> <span class="o">&amp;</span> <span class="n">AcsFlags</span><span class="o">.</span><span class="n">CAC</span> <span class="o">&amp;</span>
                                            <span class="n">AcsFlags</span><span class="o">.</span><span class="n">RADAR</span> <span class="o">&amp;</span> <span class="n">AcsFlags</span><span class="o">.</span><span class="n">VALID</span> <span class="o">&amp;</span>
                                            <span class="n">AcsFlags</span><span class="o">.</span><span class="n">NOL</span><span class="p">)]</span></div>

<div class="viewcode-block" id="AcsWorkflowTestFixure.is_needs_cac_chan"><a class="viewcode-back" href="../../../networking.acs.html#networking.acs.base.AcsWorkflowTestFixure.is_needs_cac_chan">[docs]</a>    <span class="k">def</span> <span class="nf">is_needs_cac_chan</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zone</span><span class="p">,</span> <span class="n">channel</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks if the zone&#39;s 5GHz channel or the input channel has the needs</span>
<span class="sd">        CAC flag set. If passed will check against the input channel otherwise</span>
<span class="sd">        checks the current HT channel of zone</span>

<span class="sd">        :param zone: the zone from which compare channel or current ht channel</span>
<span class="sd">            with those of zone&#39;s needs CAC channels</span>
<span class="sd">        :type zone: :class:`~sonos.client.internal.SonosZoneComponent`</span>
<span class="sd">        :param channel: wireless channel to compare with needs CAC channels of</span>
<span class="sd">            zone</span>
<span class="sd">        :type channel: :obj:`int` or :obj:`str`</span>
<span class="sd">        :return: is zone&#39;s channel or if not channel zone&#39;s ht channel in</span>
<span class="sd">            zone&#39;s acs needs CAC list</span>
<span class="sd">        :rtype: :bool:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">check_chan</span> <span class="o">=</span> <span class="p">(</span><span class="n">channel</span> <span class="ow">or</span>
                      <span class="bp">self</span><span class="o">.</span><span class="n">athconfigs</span><span class="p">[</span><span class="n">zone</span><span class="p">]</span><span class="o">.</span><span class="n">getchannel</span><span class="p">(</span><span class="n">INTERFACE_5GHZ</span><span class="p">))</span>
        <span class="n">chans_need_cac</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_needscac_dfs_channels</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_acs_channel_table</span><span class="p">(</span><span class="n">zone</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">check_chan</span> <span class="ow">in</span> <span class="n">chans_need_cac</span></div>

<div class="viewcode-block" id="AcsWorkflowTestFixure.get_acs_channel_table"><a class="viewcode-back" href="../../../networking.acs.html#networking.acs.base.AcsWorkflowTestFixure.get_acs_channel_table">[docs]</a>    <span class="k">def</span> <span class="nf">get_acs_channel_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zone</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the acs channel table for the zone</span>

<span class="sd">        :param zone: the zone from which to get the acs channel table</span>
<span class="sd">        :type zone: :class:`~sonos.client.internal.SonosZoneComponent`</span>
<span class="sd">        :return: zone&#39;s acs channel table</span>
<span class="sd">        :rtype: :class:`~custom_dicts.FrozenAttributeDict`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">acs_channels_table</span> <span class="o">=</span> <span class="n">zone</span><span class="o">.</span><span class="n">cli</span><span class="o">.</span><span class="n">get_primary</span><span class="p">()</span><span class="o">.</span><span class="n">acs</span><span class="o">.</span><span class="n">channels_table</span>
        <span class="k">return</span> <span class="n">acs_channels_table</span></div>

<div class="viewcode-block" id="AcsWorkflowTestFixure.get_zones_on_ht_channel"><a class="viewcode-back" href="../../../networking.acs.html#networking.acs.base.AcsWorkflowTestFixure.get_zones_on_ht_channel">[docs]</a>    <span class="k">def</span> <span class="nf">get_zones_on_ht_channel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zones</span><span class="p">,</span> <span class="n">channel</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the subset of zones on the given channel</span>

<span class="sd">        :param zones: the zones from which compare channel or current channel</span>
<span class="sd">        :type zones: :obj:&#39;list&#39;</span>
<span class="sd">        :param channel: wireless channel to compare with channel of zones</span>
<span class="sd">        :type channel: :obj:`int` or :obj:`str`</span>
<span class="sd">        :return: are the  zones channels channel</span>
<span class="sd">        :rtype: :bool:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">zone</span> <span class="ow">in</span> <span class="n">zones</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">zone</span><span class="o">.</span><span class="n">is_ht_master_capable</span><span class="p">():</span>
                <span class="n">interface</span> <span class="o">=</span> <span class="n">INTERFACE_5GHZ</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">interface</span> <span class="o">=</span> <span class="n">INTERFACE_2GHZ</span>
            <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">athconfigs</span><span class="p">[</span><span class="n">zone</span><span class="p">]</span><span class="o">.</span><span class="n">getchannel</span><span class="p">(</span><span class="n">interface</span><span class="p">):</span>
                <span class="n">zones</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">zone</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">zones</span></div>

<div class="viewcode-block" id="AcsWorkflowTestFixure.is_txqs_zero"><a class="viewcode-back" href="../../../networking.acs.html#networking.acs.base.AcsWorkflowTestFixure.is_txqs_zero">[docs]</a>    <span class="k">def</span> <span class="nf">is_txqs_zero</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zone</span><span class="p">,</span> <span class="n">interface</span><span class="o">=</span><span class="n">INTERFACE_2GHZ</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns True when the txqs of zone&#39;s interface has 0 tx</span>

<span class="sd">        :param zone: the zone to check for txq counts</span>
<span class="sd">        :type zone: :class:`~sonos.client.internal.SonosZoneComponent`</span>
<span class="sd">        :param interface: the interface of zone to check the tx counters of</span>
<span class="sd">        :type interface: :obj:`str`</span>
<span class="sd">        :return: whether or not the zone non-zero has txqs</span>
<span class="sd">        :rtype: :obj:`bool`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">txq</span> <span class="ow">in</span> <span class="n">zone</span><span class="o">.</span><span class="n">diag</span><span class="o">.</span><span class="n">get_fullstatus</span><span class="p">(</span><span class="n">interface</span><span class="p">)</span><span class="o">.</span><span class="n">per_txq</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">ur</span><span class="s1">&#39;Per-TXQ \d: &#39;</span><span class="p">,</span> <span class="n">txq</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="AcsWorkflowTestFixure.verify_no_tx_while_cac"><a class="viewcode-back" href="../../../networking.acs.html#networking.acs.base.AcsWorkflowTestFixure.verify_no_tx_while_cac">[docs]</a>    <span class="k">def</span> <span class="nf">verify_no_tx_while_cac</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zone</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Verifies that while performing CAC the zone does not transmit on 5GHz</span>

<span class="sd">        :param zone: the zone to check for no tx while CAC</span>
<span class="sd">        :type zone: :class:`~sonos.client.internal.SonosZoneComponent`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_zone_clearing_cac</span><span class="p">(</span><span class="n">zone</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">verifyListEqualOrFailCase</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="p">]</span> <span class="o">*</span> <span class="mi">10</span><span class="p">,</span>
                <span class="p">[</span><span class="n">q</span><span class="o">.</span><span class="n">started</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span>
                 <span class="n">zone</span><span class="o">.</span><span class="n">diag</span><span class="o">.</span><span class="n">get_fullstatus</span><span class="p">(</span><span class="n">INTERFACE_5GHZ</span><span class="p">)</span><span class="o">.</span><span class="n">per_txq</span><span class="p">],</span>
                <span class="s2">&quot;Verify all TXQ&#39;s on </span><span class="si">{}</span><span class="s2"> are empty for &quot;</span>
                <span class="s2">&quot;interface </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">zone</span><span class="p">,</span> <span class="n">INTERFACE_5GHZ</span><span class="p">))</span>
            <span class="n">guaranteed_sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span></div>

<div class="viewcode-block" id="AcsWorkflowTestFixure.verify_txq_list_zero"><a class="viewcode-back" href="../../../networking.acs.html#networking.acs.base.AcsWorkflowTestFixure.verify_txq_list_zero">[docs]</a>    <span class="k">def</span> <span class="nf">verify_txq_list_zero</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zone</span><span class="p">,</span> <span class="n">interface</span><span class="o">=</span><span class="n">INTERFACE_5GHZ</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Verifes that all txqs of zone interface have not attempted to tx any</span>
<span class="sd">        frames</span>

<span class="sd">        :param zone: the zone to check for no tx while CAC</span>
<span class="sd">        :type zone: :class:`~sonos.client.internal.SonosZoneComponent`</span>
<span class="sd">        :return: whether or not the zone tx while CAC</span>
<span class="sd">        :rtype: :obj:`bool`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verifyListEqualOrFailCase</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="p">]</span> <span class="o">*</span> <span class="mi">10</span><span class="p">,</span>
            <span class="p">[</span><span class="n">q</span><span class="o">.</span><span class="n">started</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">zone</span><span class="o">.</span><span class="n">diag</span><span class="o">.</span><span class="n">get_fullstatus</span><span class="p">(</span><span class="n">interface</span><span class="p">)</span><span class="o">.</span><span class="n">per_txq</span><span class="p">],</span>
            <span class="s2">&quot;Verify all TXQ&#39;s on </span><span class="si">{}</span><span class="s2"> are empty for interface </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">zone</span><span class="p">,</span> <span class="n">interface</span><span class="p">))</span></div>

<div class="viewcode-block" id="AcsWorkflowTestFixure.verify_idle_cac_interval"><a class="viewcode-back" href="../../../networking.acs.html#networking.acs.base.AcsWorkflowTestFixure.verify_idle_cac_interval">[docs]</a>    <span class="k">def</span> <span class="nf">verify_idle_cac_interval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zone</span><span class="p">,</span> <span class="n">dfs_channel</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Verifies the idle CAC time for a given DFS channel was almost</span>
<span class="sd">        self.cac_interval seconds (he expected CAC duration defaults to 60</span>
<span class="sd">        seconds) using dmesg logs and that zone does not transmit on 5GHz while</span>
<span class="sd">        performing CAC</span>

<span class="sd">        :param zone: the zone to check idle CAC time on</span>
<span class="sd">        :type zone: :class:`~sonos.client.internal.SonosZoneComponent`</span>
<span class="sd">        :param dfs_channel: the DFS channel to verify CAC duration for</span>
<span class="sd">        :type dfs_channel: :obj:`int`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Performing idle CAC interval and tx checks on </span><span class="si">{}</span><span class="s2"> &quot;</span>
            <span class="s2">&quot;for DFS frequency </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">zone</span><span class="p">,</span> <span class="n">dfs_channel</span><span class="p">))</span>
        <span class="n">dmesg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dmesg_inspectors</span><span class="p">[</span><span class="n">zone</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verifyTrueOrStop</span><span class="p">(</span>
            <span class="n">dmesg</span><span class="o">.</span><span class="n">go_to_last_occurrence</span><span class="p">(</span>
                <span class="s2">&quot;acs: selected chan </span><span class="si">{}</span><span class="s2"> \(idle CAC\)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dfs_channel</span><span class="p">)),</span>
            <span class="s2">&quot;Verify idle CAC log message was found&quot;</span><span class="p">)</span>
        <span class="n">start_cac</span> <span class="o">=</span> <span class="n">dmesg</span><span class="o">.</span><span class="n">current_marker</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify_no_tx_while_cac</span><span class="p">(</span><span class="n">zone</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verifyTrueOrStop</span><span class="p">(</span>
            <span class="n">dmesg</span><span class="o">.</span><span class="n">find_next</span><span class="p">(</span><span class="s1">&#39;dfs: CAC expired for </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dfs_channel</span><span class="p">)),</span>
            <span class="s2">&quot;Verify idle CAC expired log message was found&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verifyAlmostEqualOrStop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cac_interval</span><span class="p">,</span>
            <span class="p">(</span><span class="n">dmesg</span><span class="o">.</span><span class="n">current_marker</span><span class="o">.</span><span class="n">time</span> <span class="o">-</span> <span class="n">start_cac</span><span class="o">.</span><span class="n">time</span><span class="p">)</span><span class="o">.</span><span class="n">seconds</span><span class="p">,</span>
            <span class="s2">&quot;Verify idle CAC interval&quot;</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span></div>

<div class="viewcode-block" id="AcsWorkflowTestFixure.set_ps_enable"><a class="viewcode-back" href="../../../networking.acs.html#networking.acs.base.AcsWorkflowTestFixure.set_ps_enable">[docs]</a>    <span class="k">def</span> <span class="nf">set_ps_enable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zone</span><span class="p">,</span> <span class="n">ps_state</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Enables or disables the ps feature on zone</span>

<span class="sd">        :param zone: the zone to set set the ps state</span>
<span class="sd">        :type zone: :class:`~sonos.client.internal.SonosZoneComponent`</span>
<span class="sd">        :param ps_state: state to set zone&#39;s ps feature to</span>
<span class="sd">        :type ps_state: :obj:`int`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">athconfigs</span><span class="p">[</span><span class="n">zone</span><span class="p">]</span><span class="o">.</span><span class="n">psenable</span><span class="p">(</span><span class="n">INTERFACE_5GHZ</span><span class="p">,</span> <span class="n">ps_state</span><span class="p">)</span></div>

<div class="viewcode-block" id="AcsWorkflowTestFixure.set_nol_enable"><a class="viewcode-back" href="../../../networking.acs.html#networking.acs.base.AcsWorkflowTestFixure.set_nol_enable">[docs]</a>    <span class="k">def</span> <span class="nf">set_nol_enable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zone</span><span class="p">,</span> <span class="n">nol_state</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Enables or disables the nol feature of ACS on zone</span>

<span class="sd">        :param zone: the zone to set set the nol state</span>
<span class="sd">        :type zone: :class:`~sonos.client.internal.SonosZoneComponent`</span>
<span class="sd">        :param nol_state: state to set zone&#39;s nol feature to</span>
<span class="sd">        :type nol_state: :obj:`int`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">athconfigs</span><span class="p">[</span><span class="n">zone</span><span class="p">]</span><span class="o">.</span><span class="n">nolenable</span><span class="p">(</span><span class="n">INTERFACE_5GHZ</span><span class="p">,</span> <span class="n">nol_state</span><span class="p">)</span></div>

<div class="viewcode-block" id="AcsWorkflowTestFixure.reset_nol"><a class="viewcode-back" href="../../../networking.acs.html#networking.acs.base.AcsWorkflowTestFixure.reset_nol">[docs]</a>    <span class="k">def</span> <span class="nf">reset_nol</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zone</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Disables and enables the nol feature of ACS on zone to clear any set</span>
<span class="sd">        nol flags on DFS channels of zone</span>

<span class="sd">        :param zone: the zone to set set the nol state</span>
<span class="sd">        :type zone: :class:`~sonos.client.internal.SonosZoneComponent`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_nol_enable</span><span class="p">(</span><span class="n">zone</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_nol_enable</span><span class="p">(</span><span class="n">zone</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span></div>

<div class="viewcode-block" id="AcsWorkflowTestFixure.set_nol_timeout"><a class="viewcode-back" href="../../../networking.acs.html#networking.acs.base.AcsWorkflowTestFixure.set_nol_timeout">[docs]</a>    <span class="k">def</span> <span class="nf">set_nol_timeout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zone</span><span class="p">,</span> <span class="n">nol_timeout</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the nol timeout of zone</span>

<span class="sd">        :param zone: the zone to set the nol timeout on</span>
<span class="sd">        :type zone: :class:`~sonos.client.internal.SonosZoneComponent`</span>
<span class="sd">        :param nol_timeout: the number of seconds to set for the nol timeout</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">athconfigs</span><span class="p">[</span><span class="n">zone</span><span class="p">]</span><span class="o">.</span><span class="n">setnoltimeout</span><span class="p">(</span><span class="n">INTERFACE_5GHZ</span><span class="p">,</span> <span class="n">nol_timeout</span> <span class="ow">or</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_NOL_TIMEOUT</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_get_channels_table_sorted_by_metric</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">acs_channels_table</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts a list of acs_channels_table data into a sorted list of</span>
<span class="sd">        channels using channel metric as the primary sort key and channel</span>
<span class="sd">        frequency as the secondary sort key</span>

<span class="sd">        :param acs_channels_table: fullstatus parsed ACS channel table data</span>
<span class="sd">        :type acs_channels_table: :obj:`list`</span>
<span class="sd">        :return: fullstatus parsed ACS channel table data sorted by channel and</span>
<span class="sd">            frequency</span>
<span class="sd">        :rtype: :obj:`list`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sorted_channels</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">acs_channels_table</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="s1">&#39;sorting acs_channels_table </span><span class="se">\n</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">acs_channels_table</span><span class="p">))</span>
        <span class="n">sorted_channels</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span>
            <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">channel</span><span class="p">:</span> <span class="p">(</span><span class="n">channel</span><span class="o">.</span><span class="n">cm</span><span class="p">,</span> <span class="n">channel</span><span class="o">.</span><span class="n">frequency</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">sorted_channels</span>

    <span class="k">def</span> <span class="nf">_get_channels_sorted_by_metric</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">acs_channels_table</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts the acs_channels_table into a sorted tuple of channel</span>
<span class="sd">        frequencies from the table from lowest channel metric to highest</span>

<span class="sd">        :param acs_channels_table: fullstatus parsed ACS channel table data</span>
<span class="sd">        :type acs_channels_table: :obj:`list`</span>
<span class="sd">        :return: a list of channels ordered by their metric value</span>
<span class="sd">        :rtype: :obj:`tuple`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ct</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_channels_table_sorted_by_metric</span><span class="p">(</span><span class="n">acs_channels_table</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;sorted acs_channels_table </span><span class="se">\n</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ct</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">channel</span><span class="o">.</span><span class="n">frequency</span> <span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="n">ct</span><span class="p">)</span>

<div class="viewcode-block" id="AcsWorkflowTestFixure.verify_channel_has_lowest_cm"><a class="viewcode-back" href="../../../networking.acs.html#networking.acs.base.AcsWorkflowTestFixure.verify_channel_has_lowest_cm">[docs]</a>    <span class="k">def</span> <span class="nf">verify_channel_has_lowest_cm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel</span><span class="p">,</span> <span class="n">acs_channels_table</span><span class="p">,</span>
            <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Verify channel has lowest CM&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Verifies that channel has the lowest Channel Metric (CM) found in</span>
<span class="sd">        the parsed ath1 fullstatus ACS channels table</span>

<span class="sd">        :param channel: the channel frequency to search for in the ACS table</span>
<span class="sd">        :type channel: :obj:`int`</span>
<span class="sd">        :param acs_channels_table: the ACS channels table data to search within</span>
<span class="sd">        :type acs_channels_table: :obj:`list`</span>
<span class="sd">        :param message: a custom verification string to log</span>
<span class="sd">        :type message: :obj:`str`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cm_ordered_chans</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_channels_table_sorted_by_metric</span><span class="p">(</span>
            <span class="n">acs_channels_table</span><span class="p">)</span>
        <span class="n">channel_acs_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">chan</span> <span class="k">for</span> <span class="n">chan</span> <span class="ow">in</span> <span class="n">cm_ordered_chans</span> <span class="k">if</span>
                            <span class="n">chan</span><span class="o">.</span><span class="n">frequency</span> <span class="o">==</span> <span class="n">channel</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verifyEqualOrStop</span><span class="p">(</span><span class="n">cm_ordered_chans</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">cm</span><span class="p">,</span>
                               <span class="n">channel_acs_data</span><span class="o">.</span><span class="n">cm</span><span class="p">,</span>
                               <span class="n">message</span><span class="o">=</span><span class="n">message</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_get_cleared_dfs_channels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">acs_channels_table</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Filters the parsed ath1 fullstatus ACS channels table for DFS channels</span>
<span class="sd">        that have successfully cleared CAC by checking their flags values.</span>

<span class="sd">        :param acs_channels_table: the ACS channels table data to search within</span>
<span class="sd">        :type acs_channels_table: :obj:`list`</span>
<span class="sd">        :return: the DFS channels that have cleared CAC</span>
<span class="sd">        :rtype: :obj:`list`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">chan</span> <span class="k">for</span> <span class="n">chan</span> <span class="ow">in</span> <span class="n">acs_channels_table</span>
            <span class="k">if</span> <span class="n">chan</span><span class="o">.</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">AcsFlags</span><span class="o">.</span><span class="n">DFS</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">chan</span><span class="o">.</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">AcsFlags</span><span class="o">.</span><span class="n">CAC</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_get_needscac_dfs_channels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">acs_channels_table</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Filters the parsed ath1 fullstatus ACS channels table for DFS channels</span>
<span class="sd">        that still need to clear CAC by checking their flags values</span>

<span class="sd">        :param acs_channels_table: the ACS channels table data to search within</span>
<span class="sd">        :type acs_channels_table: :obj:`list`</span>
<span class="sd">        :return: the DFS channels that still need to clear CAC</span>
<span class="sd">        :rtype: :obj:`list`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">chan</span> <span class="k">for</span> <span class="n">chan</span> <span class="ow">in</span> <span class="n">acs_channels_table</span>
            <span class="k">if</span> <span class="n">chan</span><span class="o">.</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">AcsFlags</span><span class="o">.</span><span class="n">CAC</span> <span class="ow">and</span> <span class="n">chan</span><span class="o">.</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">AcsFlags</span><span class="o">.</span><span class="n">DFS</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_verify_cac_channel_has_lowest_cm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zone</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Verify that we have cleared CAC on the DFS channel with the lowest CM.</span>

<span class="sd">        .. note::</span>

<span class="sd">            this method also sets the :attr:`idle_cac_channel` and</span>
<span class="sd">            :attr:`idle_cac_channel` attributes which are used in subsequent</span>
<span class="sd">            post CAC verifications in :meth:`verify_unique_channels_scanned`</span>

<span class="sd">        :param zone: the dut to verify</span>
<span class="sd">        :type zone: :class:`~sonos.client.internal.SonosZoneComponent`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">idle_cac_fs</span> <span class="o">=</span> <span class="n">zone</span><span class="o">.</span><span class="n">cli</span><span class="o">.</span><span class="n">get_ath_status</span><span class="p">(</span><span class="n">interface</span><span class="o">=</span><span class="n">INTERFACE_5GHZ</span><span class="p">,</span>
                                              <span class="n">full</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">primary</span> <span class="o">=</span> <span class="n">zone</span><span class="o">.</span><span class="n">cli</span><span class="o">.</span><span class="n">get_primary</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">idle_cac_channel</span> <span class="o">=</span> <span class="n">idle_cac_fs</span><span class="o">.</span><span class="n">operating_channel</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pre_cac_cleared_dfs_channels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_cleared_dfs_channels</span><span class="p">(</span>
            <span class="n">primary</span><span class="o">.</span><span class="n">acs</span><span class="o">.</span><span class="n">channels_table</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify_channel_has_lowest_cm</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">idle_cac_channel</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_get_needscac_dfs_channels</span><span class="p">(</span><span class="n">primary</span><span class="o">.</span><span class="n">acs</span><span class="o">.</span><span class="n">channels_table</span><span class="p">),</span>
            <span class="s1">&#39;Verify DFS channel clearing CAC has lowest CM&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_verify_mtk_cac_channel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zone</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Verify, assuming the zone is currently CACing or has just CACed,  that</span>
<span class="sd">        a mtk ht master CACs the expected channel based on 5GHz DFS channel</span>
<span class="sd">        groups before CACing based on ascending CM values</span>

<span class="sd">        :param zone: the dut to verify</span>
<span class="sd">        :type zone: :class:`~sonos.client.internal.SonosZoneComponent`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">idle_cac_fs</span> <span class="o">=</span> <span class="n">zone</span><span class="o">.</span><span class="n">cli</span><span class="o">.</span><span class="n">get_ath_status</span><span class="p">(</span><span class="n">interface</span><span class="o">=</span><span class="n">INTERFACE_5GHZ</span><span class="p">,</span>
                                              <span class="n">full</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">primary</span> <span class="o">=</span> <span class="n">zone</span><span class="o">.</span><span class="n">cli</span><span class="o">.</span><span class="n">get_primary</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">idle_cac_channel</span> <span class="o">=</span> <span class="n">idle_cac_fs</span><span class="o">.</span><span class="n">operating_channel</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pre_cac_cleared_dfs_channels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_cleared_dfs_channels</span><span class="p">(</span>
            <span class="n">primary</span><span class="o">.</span><span class="n">acs</span><span class="o">.</span><span class="n">channels_table</span><span class="p">)</span>
        <span class="n">need_cac_chans</span> <span class="o">=</span> <span class="p">[</span><span class="n">chan</span><span class="o">.</span><span class="n">frequency</span> <span class="k">for</span> <span class="n">chan</span> <span class="ow">in</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_get_needscac_dfs_channels</span><span class="p">(</span><span class="n">primary</span><span class="o">.</span><span class="n">acs</span><span class="o">.</span><span class="n">channels_table</span><span class="p">)]</span>
        <span class="n">needs_cac_center_chans</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
            <span class="nb">set</span><span class="p">(</span><span class="n">MTK_CHANNEL_GROUP_CENTERS</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">need_cac_chans</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">needs_cac_center_chans</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">verifyTrueOrFailCase</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">idle_cac_channel</span> <span class="o">==</span> <span class="nb">list</span><span class="p">(</span><span class="n">needs_cac_center_chans</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                <span class="s2">&quot;MTK master CACs DFS channel group center channels in &quot;</span>
                <span class="s2">&quot;ascending frequency order before clearing by ascending CM&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_verify_cac_channel_has_lowest_cm</span><span class="p">(</span><span class="n">zone</span><span class="p">)</span>

<div class="viewcode-block" id="AcsWorkflowTestFixure.verify_unique_channels_scanned"><a class="viewcode-back" href="../../../networking.acs.html#networking.acs.base.AcsWorkflowTestFixure.verify_unique_channels_scanned">[docs]</a>    <span class="k">def</span> <span class="nf">verify_unique_channels_scanned</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_list</span><span class="p">,</span> <span class="n">region</span><span class="p">,</span>
            <span class="n">is_boot_scan</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Verifies the number of channels in the channel_list is equal to the</span>
<span class="sd">        number of expected_channels per the given region per the &lt;REGION&gt;_DATA</span>
<span class="sd">        global</span>

<span class="sd">        :param channel_list: a list of channels that were scanned</span>
<span class="sd">        :type channel_list: :obj:`list`</span>
<span class="sd">        :param region: the region to verify scanned channels against</span>
<span class="sd">        :type region: :class:`~custom_dicts.FrozenAttributeDict`</span>
<span class="sd">        :param is_boot_scan: channel_list was obtained during boot scan</span>
<span class="sd">        :type is_boot_scan: :obj:`int`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">acceptable_loss_ratio</span>  <span class="o">=</span> <span class="mf">0.2</span> <span class="k">if</span> <span class="n">is_boot_scan</span> <span class="k">else</span> <span class="mf">0.1</span>
        <span class="n">expected_num_chans</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
            <span class="n">region</span><span class="o">.</span><span class="n">expected_channels</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">acceptable_loss_ratio</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verifyGreaterEqualOrStop</span><span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">channel_list</span><span class="p">)),</span>
            <span class="n">expected_num_chans</span><span class="p">,</span>
            <span class="s2">&quot;Verify total ACS channels scanned for region &quot;</span>
            <span class="s2">&quot;</span><span class="si">{!r}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">region</span><span class="p">))</span></div>

<div class="viewcode-block" id="AcsWorkflowTestFixure.verify_post_acs_operating_channel"><a class="viewcode-back" href="../../../networking.acs.html#networking.acs.base.AcsWorkflowTestFixure.verify_post_acs_operating_channel">[docs]</a>    <span class="k">def</span> <span class="nf">verify_post_acs_operating_channel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zone</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Waits and verifies for the operating channel on zone to be the channel</span>
<span class="sd">        that currently has the lowest channel metric</span>

<span class="sd">        :param zone: the dut to verify</span>
<span class="sd">        :type zone: :class:`~sonos.client.internal.SonosZoneComponent`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">_is_operating_chan_lowest_cm</span><span class="p">():</span>
            <span class="n">primary</span> <span class="o">=</span> <span class="n">zone</span><span class="o">.</span><span class="n">cli</span><span class="o">.</span><span class="n">get_primary</span><span class="p">()</span>
            <span class="n">fullstatus</span> <span class="o">=</span> <span class="n">zone</span><span class="o">.</span><span class="n">cli</span><span class="o">.</span><span class="n">get_ath_status</span><span class="p">(</span><span class="n">interface</span><span class="o">=</span><span class="n">INTERFACE_5GHZ</span><span class="p">,</span>
                                                 <span class="n">full</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">cm_ordered_chans</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_channels_sorted_by_metric</span><span class="p">(</span>
                <span class="n">primary</span><span class="o">.</span><span class="n">acs</span><span class="o">.</span><span class="n">channels_table</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">fullstatus</span><span class="o">.</span><span class="n">operating_channel</span> <span class="o">==</span> <span class="n">cm_ordered_chans</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># poll the operating channel until its value matches the expected</span>
            <span class="c1"># channel to prevent from grabbing the last scanned channel after</span>
            <span class="c1"># ACS has completed</span>
            <span class="n">wait_until_true</span><span class="p">(</span><span class="n">_is_operating_chan_lowest_cm</span><span class="p">,</span>
                <span class="n">timeout_seconds</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                <span class="n">iteration_delay</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TimeoutError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">fullstatus</span> <span class="o">=</span> <span class="n">zone</span><span class="o">.</span><span class="n">cli</span><span class="o">.</span><span class="n">get_ath_status</span><span class="p">(</span><span class="n">interface</span><span class="o">=</span><span class="n">INTERFACE_5GHZ</span><span class="p">,</span>
                                                 <span class="n">full</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">primary</span> <span class="o">=</span> <span class="n">zone</span><span class="o">.</span><span class="n">cli</span><span class="o">.</span><span class="n">get_primary</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">verify_channel_has_lowest_cm</span><span class="p">(</span>
                <span class="n">fullstatus</span><span class="o">.</span><span class="n">operating_channel</span><span class="p">,</span>
                <span class="n">primary</span><span class="o">.</span><span class="n">acs</span><span class="o">.</span><span class="n">channels_table</span><span class="p">,</span>
                <span class="s2">&quot;Verify post ACS operating channel has lowest channel metric&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="AcsWorkflowTestFixure.verify_acs_scan"><a class="viewcode-back" href="../../../networking.acs.html#networking.acs.base.AcsWorkflowTestFixure.verify_acs_scan">[docs]</a>    <span class="k">def</span> <span class="nf">verify_acs_scan</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zone</span><span class="p">,</span> <span class="n">expect_cac</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">region</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">is_boot_scan</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Verify an ACS idle scan end to end</span>

<span class="sd">        :param zone: the dut to verify</span>
<span class="sd">        :type zone: :class:`~sonos.client.internal.SonosZoneComponent`</span>
<span class="sd">        :param expect_cac: is cac expected, if so verify it</span>
<span class="sd">        :type expect_cac: :bool:</span>
<span class="sd">        :param region: region in which to verify the acs scan against</span>
<span class="sd">        :type region: :class:`~custom_dicts.FrozenAttributeDict`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># if this is a boot scan assume scan state active and monitor channels</span>
        <span class="c1"># immediately</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_boot_scan</span><span class="p">:</span>
            <span class="n">_wait_retry_acs_and_active_scan</span> <span class="o">=</span> <span class="n">retry</span><span class="p">(</span>
                <span class="n">attempts</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span>
                <span class="n">retry_delay</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
                <span class="n">expected_exception</span><span class="o">=</span><span class="ne">AttributeError</span><span class="p">)(</span><span class="n">wait_until_true</span><span class="p">)</span>
            <span class="n">_wait_retry_acs_and_active_scan</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_zone_scanning</span><span class="p">(</span><span class="n">zone</span><span class="p">))</span>
        <span class="n">chans_scanned</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_operating_channels</span><span class="p">(</span><span class="n">zone</span><span class="p">,</span> <span class="n">INTERFACE_5GHZ</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">zone</span><span class="o">.</span><span class="n">cli</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;dmesg&#39;</span><span class="p">))</span>
        <span class="n">post_scan_chan</span> <span class="o">=</span> <span class="n">zone</span><span class="o">.</span><span class="n">cli</span><span class="o">.</span><span class="n">get_operating_channel</span><span class="p">(</span><span class="n">INTERFACE_5GHZ</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verifyTrueOrStop</span><span class="p">(</span>
            <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">chans_scanned</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">chans_scanned</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span>
            <span class="s1">&#39;Verify when observing a duplicate channel while monitoring the &#39;</span>
            <span class="s1">&#39;ACS scan that only one such duplication occurs and that the &#39;</span>
            <span class="s1">&#39;duplicate channel is the expected channel either with the lowest &#39;</span>
            <span class="s1">&#39;CM needs CAC or lowest CM where no CAC is expected, an excess &#39;</span>
            <span class="s1">&#39;greater than one between the observed channels and the expected &#39;</span>
            <span class="s1">&#39;channels indicates a redundantly scanned channel SWPBL-86821 &#39;</span>
            <span class="s1">&#39;scanned channels: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">chans_scanned</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">chans_scanned</span><span class="p">))</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">chans_scanned</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">verifyTrueOrStop</span><span class="p">(</span>
                <span class="n">chans_scanned</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">post_scan_chan</span><span class="p">,</span>
                <span class="s2">&quot;in the event of a twice observed channel during scan active &quot;</span>
                <span class="s2">&quot;state expect that channel to be the channel the zone remains &quot;</span>
                <span class="s2">&quot;on post scan for either CAC or for potential satellite &quot;</span>
                <span class="s2">&quot;occupation, current chan: </span><span class="si">{}</span><span class="s2">, scanned_channels: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">zone</span><span class="o">.</span><span class="n">cli</span><span class="o">.</span><span class="n">get_operating_channel</span><span class="p">(</span><span class="n">INTERFACE_5GHZ</span><span class="p">),</span>
                    <span class="n">chans_scanned</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">region</span><span class="p">:</span>
            <span class="n">region</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_zone_region_data</span><span class="p">(</span><span class="n">zone</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">verify_unique_channels_scanned</span><span class="p">(</span><span class="n">chans_scanned</span><span class="p">,</span> <span class="n">region</span><span class="p">,</span>
                    <span class="n">is_boot_scan</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">expect_cac</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">wait_for_cac_begin</span><span class="p">(</span><span class="n">zone</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">verifyTrueOrStop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">is_zone_clearing_cac</span><span class="p">(</span><span class="n">zone</span><span class="p">),</span>
                    <span class="s2">&quot;Verify idle CAC is running immediately following ACS&quot;</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">zone</span><span class="o">.</span><span class="n">get_radio_type</span><span class="p">(</span><span class="s1">&#39;ath1&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;mt7615&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_verify_mtk_cac_channel</span><span class="p">(</span><span class="n">zone</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_verify_cac_channel_has_lowest_cm</span><span class="p">(</span><span class="n">zone</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">wait_for_cac_complete</span><span class="p">(</span><span class="n">zone</span><span class="p">,</span>
                        <span class="n">interval_delay</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cac_interval</span> <span class="o">*</span> <span class="mf">0.2</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">verify_idle_cac_interval</span><span class="p">(</span><span class="n">zone</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">idle_cac_channel</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">verifyEqualOrStop</span><span class="p">(</span>
                        <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pre_cac_cleared_dfs_channels</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                    <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_cleared_dfs_channels</span><span class="p">(</span>
                        <span class="n">zone</span><span class="o">.</span><span class="n">diag</span><span class="o">.</span><span class="n">get_primary</span><span class="p">()</span><span class="o">.</span><span class="n">acs</span><span class="o">.</span><span class="n">channels_table</span><span class="p">)),</span>
                        <span class="s2">&quot;Verify number of DFS channels that have cleared CAC&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">post_chan_scan</span> <span class="o">=</span> <span class="n">zone</span><span class="o">.</span><span class="n">diag</span><span class="o">.</span><span class="n">get_primary</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">verifyFalseOrStop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">is_zone_clearing_cac</span><span class="p">(</span><span class="n">zone</span><span class="p">),</span>
                    <span class="s2">&quot;Verify idle CAC does not run when all clear&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">verifyTrueOrStop</span><span class="p">(</span>
                    <span class="nb">all</span><span class="p">([</span><span class="nb">bool</span><span class="p">(</span><span class="ow">not</span> <span class="n">chan</span><span class="o">.</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">AcsFlags</span><span class="o">.</span><span class="n">CAC</span><span class="p">)]</span> <span class="k">for</span> <span class="n">chan</span> <span class="ow">in</span>
                        <span class="n">post_chan_scan</span><span class="o">.</span><span class="n">acs</span><span class="o">.</span><span class="n">channels_table</span>
                        <span class="k">if</span> <span class="n">chan</span><span class="o">.</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">AcsFlags</span><span class="o">.</span><span class="n">DFS</span><span class="p">),</span>
                    <span class="s2">&quot;Verify all DFS channels have cleared CAC&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">verify_post_acs_operating_channel</span><span class="p">(</span><span class="n">zone</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">StopRunningTestException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Caught exception, logging  </span><span class="si">{}</span><span class="s1"> dmesg for debug &#39;</span>
                    <span class="s1">&#39;of silence LM/radar detect failures </span><span class="se">\n</span><span class="s1"> </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">zone</span><span class="p">,</span><span class="n">zone</span><span class="o">.</span><span class="n">cli</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;dmesg&#39;</span><span class="p">)))</span>
            <span class="k">raise</span> <span class="n">e</span></div></div>


<div class="viewcode-block" id="RebootHtMastersCleanupFixture"><a class="viewcode-back" href="../../../networking.acs.html#networking.acs.base.RebootHtMastersCleanupFixture">[docs]</a><span class="k">class</span> <span class="nc">RebootHtMastersCleanupFixture</span><span class="p">(</span><span class="n">AcsWorkflowTestFixure</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Used by discovery script to ensure HT Masters get rebooted before the</span>
<span class="sd">    next suite runs</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="RebootHtMastersCleanupFixture.test_reboot_ht_masters"><a class="viewcode-back" href="../../../networking.acs.html#networking.acs.base.RebootHtMastersCleanupFixture.test_reboot_ht_masters">[docs]</a>    <span class="k">def</span> <span class="nf">test_reboot_ht_masters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subnet</span><span class="o">.</span><span class="n">reboot_devices</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ht_masters</span><span class="p">)</span></div></div>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../index.html">TestCase Documentation</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../audio.html">audio package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../cloud.html">cloud package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../common.html">common package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../data_reporting.html">data_reporting package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dataio.html">dataio package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples.html">examples package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../hdmi.html">hdmi package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ixchariot.html">ixchariot package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../networking.html">networking package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../other.html">other package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../perf.html">perf package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../pytest_automation.html">pytest_automation package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../secure_registration.html">secure_registration package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../syssw.html">syssw package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../upnp.html">upnp package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../voice.html">voice package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../webserver.html">webserver package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../webserver_v0.html">webserver_v0 package</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../index.html">Module code</a><ul>
  <li><a href="../../networking.html">networking</a><ul>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019, Author.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.8.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>